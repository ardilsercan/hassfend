{"ast":null,"code":"import _decorate from \"@babel/runtime/helpers/decorate\";\nimport \"@material/mwc-button/mwc-button\";\nconst mdiDelete = \"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z\";\nconst mdiDevices = \"M3 6H21V4H3C1.9 4 1 4.9 1 6V18C1 19.1 1.9 20 3 20H7V18H3V6M13 12H9V13.78C8.39 14.33 8 15.11 8 16C8 16.89 8.39 17.67 9 18.22V20H13V18.22C13.61 17.67 14 16.88 14 16S13.61 14.33 13 13.78V12M11 17.5C10.17 17.5 9.5 16.83 9.5 16S10.17 14.5 11 14.5 12.5 15.17 12.5 16 11.83 17.5 11 17.5M22 8H16C15.5 8 15 8.5 15 9V19C15 19.5 15.5 20 16 20H22C22.5 20 23 19.5 23 19V9C23 8.5 22.5 8 22 8M21 18H17V10H21V18Z\";\nimport { html, LitElement } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport { fireEvent } from \"../../../../common/dom/fire_event\";\nimport \"../../../../components/ha-card\";\nimport \"../../../../components/ha-icon-button\";\nimport \"../../../../components/ha-state-icon\";\nimport { saveEnergyPreferences } from \"../../../../data/energy\";\nimport { getStatisticLabel } from \"../../../../data/recorder\";\nimport { showAlertDialog, showConfirmationDialog } from \"../../../../dialogs/generic/show-dialog-box\";\nimport { haStyle } from \"../../../../resources/styles\";\nimport { documentationUrl } from \"../../../../util/documentation-url\";\nimport { showEnergySettingsDeviceDialog } from \"../dialogs/show-dialogs-energy\";\nimport \"./ha-energy-validation-result\";\nimport { energyCardStyles } from \"./styles\";\nexport let EnergyDeviceSettings = _decorate([customElement(\"ha-energy-device-settings\")], function (_initialize, _LitElement) {\n  class EnergyDeviceSettings extends _LitElement {\n    constructor(...args) {\n      super(...args);\n      _initialize(this);\n    }\n  }\n  return {\n    F: EnergyDeviceSettings,\n    d: [{\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"preferences\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"statsMetadata\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"validationResult\",\n      value: void 0\n    }, {\n      kind: \"method\",\n      key: \"render\",\n      value: function render() {\n        var _this$validationResul;\n        return html`\n      <ha-card outlined>\n        <h1 class=\"card-header\">\n          <ha-svg-icon .path=${mdiDevices}></ha-svg-icon>\n          ${this.hass.localize(\"ui.panel.config.energy.device_consumption.title\")}\n        </h1>\n\n        <div class=\"card-content\">\n          <p>\n            ${this.hass.localize(\"ui.panel.config.energy.device_consumption.sub\")}\n            <a\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              href=${documentationUrl(this.hass, \"/docs/energy/individual-devices/\")}\n              >${this.hass.localize(\"ui.panel.config.energy.device_consumption.learn_more\")}</a\n            >\n          </p>\n          ${(_this$validationResul = this.validationResult) === null || _this$validationResul === void 0 ? void 0 : _this$validationResul.device_consumption.map(result => html`\n              <ha-energy-validation-result\n                .hass=${this.hass}\n                .issues=${result}\n              ></ha-energy-validation-result>\n            `)}\n          <h3>\n            ${this.hass.localize(\"ui.panel.config.energy.device_consumption.devices\")}\n          </h3>\n          ${this.preferences.device_consumption.map(device => {\n          var _this$statsMetadata;\n          const entityState = this.hass.states[device.stat_consumption];\n          return html`\n              <div class=\"row\">\n                <ha-state-icon\n                  .hass=${this.hass}\n                  .stateObj=${entityState}\n                ></ha-state-icon>\n                <span class=\"content\"\n                  >${getStatisticLabel(this.hass, device.stat_consumption, (_this$statsMetadata = this.statsMetadata) === null || _this$statsMetadata === void 0 ? void 0 : _this$statsMetadata[device.stat_consumption])}</span\n                >\n                <ha-icon-button\n                  .label=${this.hass.localize(\"ui.common.delete\")}\n                  @click=${this._deleteDevice}\n                  .device=${device}\n                  .path=${mdiDelete}\n                ></ha-icon-button>\n              </div>\n            `;\n        })}\n          <div class=\"row\">\n            <ha-svg-icon .path=${mdiDevices}></ha-svg-icon>\n            <mwc-button @click=${this._addDevice}\n              >${this.hass.localize(\"ui.panel.config.energy.device_consumption.add_device\")}</mwc-button\n            >\n          </div>\n        </div>\n      </ha-card>\n    `;\n      }\n    }, {\n      kind: \"method\",\n      key: \"_addDevice\",\n      value: function _addDevice() {\n        showEnergySettingsDeviceDialog(this, {\n          device_consumptions: this.preferences.device_consumption,\n          saveCallback: async device => {\n            await this._savePreferences({\n              ...this.preferences,\n              device_consumption: this.preferences.device_consumption.concat(device)\n            });\n          }\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"_deleteDevice\",\n      value: async function _deleteDevice(ev) {\n        const deviceToDelete = ev.currentTarget.device;\n        if (!(await showConfirmationDialog(this, {\n          title: this.hass.localize(\"ui.panel.config.energy.delete_source\")\n        }))) {\n          return;\n        }\n        try {\n          await this._savePreferences({\n            ...this.preferences,\n            device_consumption: this.preferences.device_consumption.filter(device => device !== deviceToDelete)\n          });\n        } catch (err) {\n          showAlertDialog(this, {\n            title: `Failed to save config: ${err.message}`\n          });\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"_savePreferences\",\n      value: async function _savePreferences(preferences) {\n        const result = await saveEnergyPreferences(this.hass, preferences);\n        fireEvent(this, \"value-changed\", {\n          value: result\n        });\n      }\n    }, {\n      kind: \"get\",\n      static: true,\n      key: \"styles\",\n      value: function styles() {\n        return [haStyle, energyCardStyles];\n      }\n    }]\n  };\n}, LitElement);","map":{"version":3,"names":["mdiDelete","mdiDevices","html","LitElement","customElement","property","fireEvent","saveEnergyPreferences","getStatisticLabel","showAlertDialog","showConfirmationDialog","haStyle","documentationUrl","showEnergySettingsDeviceDialog","energyCardStyles","EnergyDeviceSettings","_decorate","_initialize","_LitElement","constructor","args","F","d","kind","decorators","attribute","key","value","render","_this$validationResul","hass","localize","validationResult","device_consumption","map","result","preferences","device","_this$statsMetadata","entityState","states","stat_consumption","statsMetadata","_deleteDevice","_addDevice","device_consumptions","saveCallback","_savePreferences","concat","ev","deviceToDelete","currentTarget","title","filter","err","message","static","styles"],"sources":["/workspaces/frontend/src/panels/config/energy/components/ha-energy-device-settings.ts"],"sourcesContent":["import \"@material/mwc-button/mwc-button\";\nimport { mdiDelete, mdiDevices } from \"@mdi/js\";\nimport { CSSResultGroup, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport { fireEvent } from \"../../../../common/dom/fire_event\";\nimport \"../../../../components/ha-card\";\nimport \"../../../../components/ha-icon-button\";\nimport \"../../../../components/ha-state-icon\";\nimport {\n  DeviceConsumptionEnergyPreference,\n  EnergyPreferences,\n  EnergyPreferencesValidation,\n  saveEnergyPreferences,\n} from \"../../../../data/energy\";\nimport {\n  StatisticsMetaData,\n  getStatisticLabel,\n} from \"../../../../data/recorder\";\nimport {\n  showAlertDialog,\n  showConfirmationDialog,\n} from \"../../../../dialogs/generic/show-dialog-box\";\nimport { haStyle } from \"../../../../resources/styles\";\nimport { HomeAssistant } from \"../../../../types\";\nimport { documentationUrl } from \"../../../../util/documentation-url\";\nimport { showEnergySettingsDeviceDialog } from \"../dialogs/show-dialogs-energy\";\nimport \"./ha-energy-validation-result\";\nimport { energyCardStyles } from \"./styles\";\n\n@customElement(\"ha-energy-device-settings\")\nexport class EnergyDeviceSettings extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false })\n  public preferences!: EnergyPreferences;\n\n  @property({ attribute: false })\n  public statsMetadata?: Record<string, StatisticsMetaData>;\n\n  @property({ attribute: false })\n  public validationResult?: EnergyPreferencesValidation;\n\n  protected render(): TemplateResult {\n    return html`\n      <ha-card outlined>\n        <h1 class=\"card-header\">\n          <ha-svg-icon .path=${mdiDevices}></ha-svg-icon>\n          ${this.hass.localize(\n            \"ui.panel.config.energy.device_consumption.title\"\n          )}\n        </h1>\n\n        <div class=\"card-content\">\n          <p>\n            ${this.hass.localize(\n              \"ui.panel.config.energy.device_consumption.sub\"\n            )}\n            <a\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              href=${documentationUrl(\n                this.hass,\n                \"/docs/energy/individual-devices/\"\n              )}\n              >${this.hass.localize(\n                \"ui.panel.config.energy.device_consumption.learn_more\"\n              )}</a\n            >\n          </p>\n          ${this.validationResult?.device_consumption.map(\n            (result) => html`\n              <ha-energy-validation-result\n                .hass=${this.hass}\n                .issues=${result}\n              ></ha-energy-validation-result>\n            `\n          )}\n          <h3>\n            ${this.hass.localize(\n              \"ui.panel.config.energy.device_consumption.devices\"\n            )}\n          </h3>\n          ${this.preferences.device_consumption.map((device) => {\n            const entityState = this.hass.states[device.stat_consumption];\n            return html`\n              <div class=\"row\">\n                <ha-state-icon\n                  .hass=${this.hass}\n                  .stateObj=${entityState}\n                ></ha-state-icon>\n                <span class=\"content\"\n                  >${getStatisticLabel(\n                    this.hass,\n                    device.stat_consumption,\n                    this.statsMetadata?.[device.stat_consumption]\n                  )}</span\n                >\n                <ha-icon-button\n                  .label=${this.hass.localize(\"ui.common.delete\")}\n                  @click=${this._deleteDevice}\n                  .device=${device}\n                  .path=${mdiDelete}\n                ></ha-icon-button>\n              </div>\n            `;\n          })}\n          <div class=\"row\">\n            <ha-svg-icon .path=${mdiDevices}></ha-svg-icon>\n            <mwc-button @click=${this._addDevice}\n              >${this.hass.localize(\n                \"ui.panel.config.energy.device_consumption.add_device\"\n              )}</mwc-button\n            >\n          </div>\n        </div>\n      </ha-card>\n    `;\n  }\n\n  private _addDevice() {\n    showEnergySettingsDeviceDialog(this, {\n      device_consumptions: this.preferences\n        .device_consumption as DeviceConsumptionEnergyPreference[],\n      saveCallback: async (device) => {\n        await this._savePreferences({\n          ...this.preferences,\n          device_consumption:\n            this.preferences.device_consumption.concat(device),\n        });\n      },\n    });\n  }\n\n  private async _deleteDevice(ev) {\n    const deviceToDelete: DeviceConsumptionEnergyPreference =\n      ev.currentTarget.device;\n\n    if (\n      !(await showConfirmationDialog(this, {\n        title: this.hass.localize(\"ui.panel.config.energy.delete_source\"),\n      }))\n    ) {\n      return;\n    }\n\n    try {\n      await this._savePreferences({\n        ...this.preferences,\n        device_consumption: this.preferences.device_consumption.filter(\n          (device) => device !== deviceToDelete\n        ),\n      });\n    } catch (err: any) {\n      showAlertDialog(this, { title: `Failed to save config: ${err.message}` });\n    }\n  }\n\n  private async _savePreferences(preferences: EnergyPreferences) {\n    const result = await saveEnergyPreferences(this.hass, preferences);\n    fireEvent(this, \"value-changed\", { value: result });\n  }\n\n  static get styles(): CSSResultGroup {\n    return [haStyle, energyCardStyles];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-energy-device-settings\": EnergyDeviceSettings;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}