{"ast":null,"code":"import _createForOfIteratorHelper from \"@babel/runtime/helpers/createForOfIteratorHelper\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _callSuper from \"@babel/runtime/helpers/callSuper\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _decorate from \"@babel/runtime/helpers/decorate\";\nimport _get from \"@babel/runtime/helpers/get\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.some.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport { property } from \"lit/decorators\";\nexport var SubscribeMixin = function SubscribeMixin(superClass) {\n  var SubscribeClass = _decorate(null, function (_initialize, _superClass) {\n    var SubscribeClass = /*#__PURE__*/function (_superClass2) {\n      _inherits(SubscribeClass, _superClass2);\n      function SubscribeClass() {\n        var _this;\n        _classCallCheck(this, SubscribeClass);\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n        _this = _callSuper(this, SubscribeClass, [].concat(args));\n        _initialize(_assertThisInitialized(_this));\n        return _this;\n      }\n      return _createClass(SubscribeClass);\n    }(_superClass);\n    return {\n      F: SubscribeClass,\n      d: [{\n        kind: \"field\",\n        decorators: [property({\n          attribute: false\n        })],\n        key: \"hass\",\n        value: void 0\n      }, {\n        kind: \"field\",\n        key: \"hassSubscribeRequiredHostProps\",\n        value: void 0\n      }, {\n        kind: \"field\",\n        key: \"__unsubs\",\n        value: void 0\n      }, {\n        kind: \"method\",\n        key: \"connectedCallback\",\n        value:\n        // we wait with subscribing till these properties are set on the host element\n\n        function connectedCallback() {\n          _get(_getPrototypeOf(SubscribeClass.prototype), \"connectedCallback\", this).call(this);\n          this.__checkSubscribed();\n        }\n      }, {\n        kind: \"method\",\n        key: \"disconnectedCallback\",\n        value: function disconnectedCallback() {\n          _get(_getPrototypeOf(SubscribeClass.prototype), \"disconnectedCallback\", this).call(this);\n          if (this.__unsubs) {\n            while (this.__unsubs.length) {\n              var unsub = this.__unsubs.pop();\n              if (unsub instanceof Promise) {\n                unsub.then(function (unsubFunc) {\n                  return unsubFunc();\n                });\n              } else {\n                unsub();\n              }\n            }\n            this.__unsubs = undefined;\n          }\n        }\n      }, {\n        kind: \"method\",\n        key: \"updated\",\n        value: function updated(changedProps) {\n          _get(_getPrototypeOf(SubscribeClass.prototype), \"updated\", this).call(this, changedProps);\n          if (changedProps.has(\"hass\")) {\n            this.__checkSubscribed();\n            return;\n          }\n          if (!this.hassSubscribeRequiredHostProps) {\n            return;\n          }\n          var _iterator = _createForOfIteratorHelper(changedProps.keys()),\n            _step;\n          try {\n            for (_iterator.s(); !(_step = _iterator.n()).done;) {\n              var key = _step.value;\n              if (this.hassSubscribeRequiredHostProps.includes(key)) {\n                this.__checkSubscribed();\n                return;\n              }\n            }\n          } catch (err) {\n            _iterator.e(err);\n          } finally {\n            _iterator.f();\n          }\n        }\n      }, {\n        kind: \"method\",\n        key: \"hassSubscribe\",\n        value: function hassSubscribe() {\n          return [];\n        }\n      }, {\n        kind: \"method\",\n        key: \"__checkSubscribed\",\n        value: function __checkSubscribed() {\n          var _this$hassSubscribeRe,\n            _this2 = this;\n          if (this.__unsubs !== undefined || !this.isConnected || this.hass === undefined || (_this$hassSubscribeRe = this.hassSubscribeRequiredHostProps) !== null && _this$hassSubscribeRe !== void 0 && _this$hassSubscribeRe.some(function (prop) {\n            return _this2[prop] === undefined;\n          })) {\n            return;\n          }\n          this.__unsubs = this.hassSubscribe();\n        }\n      }]\n    };\n  }, superClass);\n  return SubscribeClass;\n};","map":{"version":3,"names":["property","SubscribeMixin","superClass","SubscribeClass","_decorate","_initialize","_superClass","_superClass2","_inherits","_this","_classCallCheck","_len","arguments","length","args","Array","_key","_callSuper","concat","_assertThisInitialized","_createClass","F","d","kind","decorators","attribute","key","value","connectedCallback","_get","_getPrototypeOf","prototype","call","__checkSubscribed","disconnectedCallback","__unsubs","unsub","pop","Promise","then","unsubFunc","undefined","updated","changedProps","has","hassSubscribeRequiredHostProps","_iterator","_createForOfIteratorHelper","keys","_step","s","n","done","includes","err","e","f","hassSubscribe","_this$hassSubscribeRe","_this2","isConnected","hass","some","prop"],"sources":["/workspaces/frontend/src/mixins/subscribe-mixin.ts"],"sourcesContent":["import { UnsubscribeFunc } from \"home-assistant-js-websocket\";\nimport { PropertyValues, ReactiveElement } from \"lit\";\nimport { property } from \"lit/decorators\";\nimport { Constructor, HomeAssistant } from \"../types\";\n\nexport interface HassSubscribeElement {\n  hassSubscribe(): UnsubscribeFunc[];\n}\n\nexport const SubscribeMixin = <T extends Constructor<ReactiveElement>>(\n  superClass: T\n) => {\n  class SubscribeClass extends superClass {\n    @property({ attribute: false }) public hass?: HomeAssistant;\n\n    // we wait with subscribing till these properties are set on the host element\n    protected hassSubscribeRequiredHostProps?: string[];\n\n    private __unsubs?: Array<UnsubscribeFunc | Promise<UnsubscribeFunc>>;\n\n    public connectedCallback() {\n      super.connectedCallback();\n      this.__checkSubscribed();\n    }\n\n    public disconnectedCallback() {\n      super.disconnectedCallback();\n      if (this.__unsubs) {\n        while (this.__unsubs.length) {\n          const unsub = this.__unsubs.pop()!;\n          if (unsub instanceof Promise) {\n            unsub.then((unsubFunc) => unsubFunc());\n          } else {\n            unsub();\n          }\n        }\n        this.__unsubs = undefined;\n      }\n    }\n\n    protected updated(changedProps: PropertyValues) {\n      super.updated(changedProps);\n      if (changedProps.has(\"hass\")) {\n        this.__checkSubscribed();\n        return;\n      }\n      if (!this.hassSubscribeRequiredHostProps) {\n        return;\n      }\n      for (const key of changedProps.keys()) {\n        if (this.hassSubscribeRequiredHostProps.includes(key as string)) {\n          this.__checkSubscribed();\n          return;\n        }\n      }\n    }\n\n    protected hassSubscribe(): Array<\n      UnsubscribeFunc | Promise<UnsubscribeFunc>\n    > {\n      return [];\n    }\n\n    private __checkSubscribed(): void {\n      if (\n        this.__unsubs !== undefined ||\n        !(this as unknown as Element).isConnected ||\n        this.hass === undefined ||\n        this.hassSubscribeRequiredHostProps?.some(\n          (prop) => this[prop] === undefined\n        )\n      ) {\n        return;\n      }\n      this.__unsubs = this.hassSubscribe();\n    }\n  }\n  return SubscribeClass;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}