{"ast":null,"code":"import { createCollection } from \"home-assistant-js-websocket\";\nimport { debounce } from \"../common/util/debounce\";\nexport const severitySort = {\n  critical: 1,\n  error: 2,\n  warning: 3\n};\nexport const fetchRepairsIssues = conn => conn.sendMessagePromise({\n  type: \"repairs/list_issues\"\n});\nexport const fetchRepairsIssueData = (conn, domain, issue_id) => conn.sendMessagePromise({\n  type: \"repairs/get_issue_data\",\n  domain,\n  issue_id\n});\nexport const ignoreRepairsIssue = async (hass, issue, ignore) => hass.callWS({\n  type: \"repairs/ignore_issue\",\n  issue_id: issue.issue_id,\n  domain: issue.domain,\n  ignore\n});\nexport const createRepairsFlow = (hass, handler, issue_id) => hass.callApi(\"POST\", \"repairs/issues/fix\", {\n  handler,\n  issue_id\n});\nexport const fetchRepairsFlow = (hass, flowId) => hass.callApi(\"GET\", `repairs/issues/fix/${flowId}`);\nexport const handleRepairsFlowStep = (hass, flowId, data) => hass.callApi(\"POST\", `repairs/issues/fix/${flowId}`, data);\nexport const deleteRepairsFlow = (hass, flowId) => hass.callApi(\"DELETE\", `repairs/issues/fix/${flowId}`);\nconst subscribeRepairsIssueUpdates = (conn, store) => conn.subscribeEvents(debounce(() => fetchRepairsIssues(conn).then(repairs => store.setState(repairs, true)), 500, true), \"repairs_issue_registry_updated\");\nexport const subscribeRepairsIssueRegistry = (conn, onChange) => createCollection(\"_repairsIssueRegistry\", fetchRepairsIssues, subscribeRepairsIssueUpdates, conn, onChange);","map":{"version":3,"names":["createCollection","debounce","severitySort","critical","error","warning","fetchRepairsIssues","conn","sendMessagePromise","type","fetchRepairsIssueData","domain","issue_id","ignoreRepairsIssue","hass","issue","ignore","callWS","createRepairsFlow","handler","callApi","fetchRepairsFlow","flowId","handleRepairsFlowStep","data","deleteRepairsFlow","subscribeRepairsIssueUpdates","store","subscribeEvents","then","repairs","setState","subscribeRepairsIssueRegistry","onChange"],"sources":["/workspaces/frontend/src/data/repairs.ts"],"sourcesContent":["import type { Connection } from \"home-assistant-js-websocket\";\nimport { createCollection } from \"home-assistant-js-websocket\";\nimport type { Store } from \"home-assistant-js-websocket/dist/store\";\nimport { debounce } from \"../common/util/debounce\";\nimport type { HomeAssistant } from \"../types\";\nimport type { DataEntryFlowStep } from \"./data_entry_flow\";\n\nexport interface RepairsIssue {\n  domain: string;\n  issue_domain?: string;\n  issue_id: string;\n  active: boolean;\n  is_fixable: boolean;\n  severity: \"error\" | \"warning\" | \"critical\";\n  breaks_in_ha_version?: string;\n  ignored: boolean;\n  created: string;\n  dismissed_version?: string;\n  learn_more_url?: string;\n  translation_key?: string;\n  translation_placeholders?: Record<string, string>;\n}\n\nexport const severitySort = {\n  critical: 1,\n  error: 2,\n  warning: 3,\n};\n\nexport const fetchRepairsIssues = (conn: Connection) =>\n  conn.sendMessagePromise<{ issues: RepairsIssue[] }>({\n    type: \"repairs/list_issues\",\n  });\n\nexport const fetchRepairsIssueData = (conn: Connection, domain, issue_id) =>\n  conn.sendMessagePromise<{ issue_data: { string: any } }>({\n    type: \"repairs/get_issue_data\",\n    domain,\n    issue_id,\n  });\n\nexport const ignoreRepairsIssue = async (\n  hass: HomeAssistant,\n  issue: RepairsIssue,\n  ignore: boolean\n) =>\n  hass.callWS<string>({\n    type: \"repairs/ignore_issue\",\n    issue_id: issue.issue_id,\n    domain: issue.domain,\n    ignore,\n  });\n\nexport const createRepairsFlow = (\n  hass: HomeAssistant,\n  handler: string,\n  issue_id: string\n) =>\n  hass.callApi<DataEntryFlowStep>(\"POST\", \"repairs/issues/fix\", {\n    handler,\n    issue_id,\n  });\n\nexport const fetchRepairsFlow = (hass: HomeAssistant, flowId: string) =>\n  hass.callApi<DataEntryFlowStep>(\"GET\", `repairs/issues/fix/${flowId}`);\n\nexport const handleRepairsFlowStep = (\n  hass: HomeAssistant,\n  flowId: string,\n  data: Record<string, any>\n) =>\n  hass.callApi<DataEntryFlowStep>(\"POST\", `repairs/issues/fix/${flowId}`, data);\n\nexport const deleteRepairsFlow = (hass: HomeAssistant, flowId: string) =>\n  hass.callApi(\"DELETE\", `repairs/issues/fix/${flowId}`);\n\nconst subscribeRepairsIssueUpdates = (\n  conn: Connection,\n  store: Store<{ issues: RepairsIssue[] }>\n) =>\n  conn.subscribeEvents(\n    debounce(\n      () =>\n        fetchRepairsIssues(conn).then((repairs) =>\n          store.setState(repairs, true)\n        ),\n      500,\n      true\n    ),\n    \"repairs_issue_registry_updated\"\n  );\n\nexport const subscribeRepairsIssueRegistry = (\n  conn: Connection,\n  onChange: (repairs: { issues: RepairsIssue[] }) => void\n) =>\n  createCollection<{ issues: RepairsIssue[] }>(\n    \"_repairsIssueRegistry\",\n    fetchRepairsIssues,\n    subscribeRepairsIssueUpdates,\n    conn,\n    onChange\n  );\n"],"mappings":"AACA,SAASA,gBAAgB,QAAQ,6BAA6B;AAE9D,SAASC,QAAQ,QAAQ,yBAAyB;AAoBlD,OAAO,MAAMC,YAAY,GAAG;EAC1BC,QAAQ,EAAE,CAAC;EACXC,KAAK,EAAE,CAAC;EACRC,OAAO,EAAE;AACX,CAAC;AAED,OAAO,MAAMC,kBAAkB,GAAIC,IAAgB,IACjDA,IAAI,CAACC,kBAAkB,CAA6B;EAClDC,IAAI,EAAE;AACR,CAAC,CAAC;AAEJ,OAAO,MAAMC,qBAAqB,GAAGA,CAACH,IAAgB,EAAEI,MAAM,EAAEC,QAAQ,KACtEL,IAAI,CAACC,kBAAkB,CAAkC;EACvDC,IAAI,EAAE,wBAAwB;EAC9BE,MAAM;EACNC;AACF,CAAC,CAAC;AAEJ,OAAO,MAAMC,kBAAkB,GAAG,MAAAA,CAChCC,IAAmB,EACnBC,KAAmB,EACnBC,MAAe,KAEfF,IAAI,CAACG,MAAM,CAAS;EAClBR,IAAI,EAAE,sBAAsB;EAC5BG,QAAQ,EAAEG,KAAK,CAACH,QAAQ;EACxBD,MAAM,EAAEI,KAAK,CAACJ,MAAM;EACpBK;AACF,CAAC,CAAC;AAEJ,OAAO,MAAME,iBAAiB,GAAGA,CAC/BJ,IAAmB,EACnBK,OAAe,EACfP,QAAgB,KAEhBE,IAAI,CAACM,OAAO,CAAoB,MAAM,EAAE,oBAAoB,EAAE;EAC5DD,OAAO;EACPP;AACF,CAAC,CAAC;AAEJ,OAAO,MAAMS,gBAAgB,GAAGA,CAACP,IAAmB,EAAEQ,MAAc,KAClER,IAAI,CAACM,OAAO,CAAoB,KAAK,EAAG,sBAAqBE,MAAO,EAAC,CAAC;AAExE,OAAO,MAAMC,qBAAqB,GAAGA,CACnCT,IAAmB,EACnBQ,MAAc,EACdE,IAAyB,KAEzBV,IAAI,CAACM,OAAO,CAAoB,MAAM,EAAG,sBAAqBE,MAAO,EAAC,EAAEE,IAAI,CAAC;AAE/E,OAAO,MAAMC,iBAAiB,GAAGA,CAACX,IAAmB,EAAEQ,MAAc,KACnER,IAAI,CAACM,OAAO,CAAC,QAAQ,EAAG,sBAAqBE,MAAO,EAAC,CAAC;AAExD,MAAMI,4BAA4B,GAAGA,CACnCnB,IAAgB,EAChBoB,KAAwC,KAExCpB,IAAI,CAACqB,eAAe,CAClB3B,QAAQ,CACN,MACEK,kBAAkB,CAACC,IAAI,CAAC,CAACsB,IAAI,CAAEC,OAAO,IACpCH,KAAK,CAACI,QAAQ,CAACD,OAAO,EAAE,IAAI,CAC9B,CAAC,EACH,GAAG,EACH,IACF,CAAC,EACD,gCACF,CAAC;AAEH,OAAO,MAAME,6BAA6B,GAAGA,CAC3CzB,IAAgB,EAChB0B,QAAuD,KAEvDjC,gBAAgB,CACd,uBAAuB,EACvBM,kBAAkB,EAClBoB,4BAA4B,EAC5BnB,IAAI,EACJ0B,QACF,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}