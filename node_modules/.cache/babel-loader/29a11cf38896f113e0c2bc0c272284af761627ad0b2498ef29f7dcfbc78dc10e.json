{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/helpers/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _callSuper from \"@babel/runtime/helpers/callSuper\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _decorate from \"@babel/runtime/helpers/decorate\";\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6, _templateObject7, _templateObject8, _templateObject9, _templateObject10, _templateObject11, _templateObject12, _templateObject13, _templateObject14, _templateObject15;\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.object.assign.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.object.values.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.filter.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/esnext.iterator.map.js\";\nimport \"core-js/modules/esnext.iterator.some.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"@lrnwebcomponents/simple-tooltip/simple-tooltip\";\n// @ts-ignore\nimport chipStyles from \"@material/chips/dist/mdc.chips.min.css\";\nimport \"@material/mwc-button/mwc-button\";\nimport \"@material/mwc-menu/mwc-menu-surface\";\nvar mdiClose = \"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z\";\nvar mdiDevices = \"M3 6H21V4H3C1.9 4 1 4.9 1 6V18C1 19.1 1.9 20 3 20H7V18H3V6M13 12H9V13.78C8.39 14.33 8 15.11 8 16C8 16.89 8.39 17.67 9 18.22V20H13V18.22C13.61 17.67 14 16.88 14 16S13.61 14.33 13 13.78V12M11 17.5C10.17 17.5 9.5 16.83 9.5 16S10.17 14.5 11 14.5 12.5 15.17 12.5 16 11.83 17.5 11 17.5M22 8H16C15.5 8 15 8.5 15 9V19C15 19.5 15.5 20 16 20H22C22.5 20 23 19.5 23 19V9C23 8.5 22.5 8 22 8M21 18H17V10H21V18Z\";\nvar mdiPlus = \"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z\";\nvar mdiSofa = \"M12.5 7C12.5 5.89 13.39 5 14.5 5H18C19.1 5 20 5.9 20 7V9.16C18.84 9.57 18 10.67 18 11.97V14H12.5V7M6 11.96V14H11.5V7C11.5 5.89 10.61 5 9.5 5H6C4.9 5 4 5.9 4 7V9.15C5.16 9.56 6 10.67 6 11.96M20.66 10.03C19.68 10.19 19 11.12 19 12.12V15H5V12C5 10.9 4.11 10 3 10S1 10.9 1 12V17C1 18.1 1.9 19 3 19V21H5V19H19V21H21V19C22.1 19 23 18.1 23 17V12C23 10.79 21.91 9.82 20.66 10.03Z\";\nvar mdiUnfoldMoreVertical = \"M18.17,12L15,8.83L16.41,7.41L21,12L16.41,16.58L15,15.17L18.17,12M5.83,12L9,15.17L7.59,16.59L3,12L7.59,7.42L9,8.83L5.83,12Z\";\nimport { css, html, LitElement, nothing, unsafeCSS } from \"lit\";\nimport { customElement, property, query, state } from \"lit/decorators\";\nimport { classMap } from \"lit/directives/class-map\";\nimport { ensureArray } from \"../common/array/ensure-array\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { stopPropagation } from \"../common/dom/stop_propagation\";\nimport { computeDomain } from \"../common/entity/compute_domain\";\nimport { computeStateName } from \"../common/entity/compute_state_name\";\nimport { isValidEntityId } from \"../common/entity/valid_entity_id\";\nimport { computeDeviceName } from \"../data/device_registry\";\nimport \"./device/ha-device-picker\";\nimport \"./entity/ha-entity-picker\";\nimport \"./ha-area-picker\";\nimport \"./ha-icon-button\";\nimport \"./ha-input-helper-text\";\nimport \"./ha-svg-icon\";\nexport var HaTargetPicker = _decorate([customElement(\"ha-target-picker\")], function (_initialize, _LitElement) {\n  var HaTargetPicker = /*#__PURE__*/function (_LitElement2) {\n    _inherits(HaTargetPicker, _LitElement2);\n    function HaTargetPicker() {\n      var _this;\n      _classCallCheck(this, HaTargetPicker);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _callSuper(this, HaTargetPicker, [].concat(args));\n      _initialize(_assertThisInitialized(_this));\n      return _this;\n    }\n    return _createClass(HaTargetPicker);\n  }(_LitElement);\n  return {\n    F: HaTargetPicker,\n    d: [{\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"value\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"label\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"helper\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Array,\n        attribute: \"include-domains\"\n      })],\n      key: \"includeDomains\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Array,\n        attribute: \"include-device-classes\"\n      })],\n      key: \"includeDeviceClasses\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"deviceFilter\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"entityFilter\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Boolean,\n        reflect: true\n      })],\n      key: \"disabled\",\n      value: function value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Boolean\n      })],\n      key: \"addOnTop\",\n      value: function value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_addMode\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [query(\"#input\")],\n      key: \"_inputElement\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [query(\".add-container\", true)],\n      key: \"_addContainer\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      key: \"_opened\",\n      value: function value() {\n        return false;\n      }\n    }, {\n      kind: \"method\",\n      key: \"render\",\n      value:\n      /**\n       * Show only targets with entities from specific domains.\n       * @type {Array}\n       * @attr include-domains\n       */\n\n      /**\n       * Show only targets with entities of these device classes.\n       * @type {Array}\n       * @attr include-device-classes\n       */\n\n      function render() {\n        if (this.addOnTop) {\n          return html(_templateObject || (_templateObject = _taggedTemplateLiteral([\" \", \" \", \" \"])), this._renderChips(), this._renderItems());\n        }\n        return html(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\" \", \" \", \" \"])), this._renderItems(), this._renderChips());\n      }\n    }, {\n      kind: \"method\",\n      key: \"_renderItems\",\n      value: function _renderItems() {\n        var _this$value,\n          _this2 = this,\n          _this$value2,\n          _this$value3;\n        return html(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\\n      <div class=\\\"mdc-chip-set items\\\">\\n        \", \"\\n        \", \"\\n        \", \"\\n      </div>\\n    \"])), (_this$value = this.value) !== null && _this$value !== void 0 && _this$value.area_id ? ensureArray(this.value.area_id).map(function (area_id) {\n          var area = _this2.hass.areas[area_id];\n          return _this2._renderChip(\"area_id\", area_id, (area === null || area === void 0 ? void 0 : area.name) || area_id, undefined, area === null || area === void 0 ? void 0 : area.icon, mdiSofa);\n        }) : \"\", (_this$value2 = this.value) !== null && _this$value2 !== void 0 && _this$value2.device_id ? ensureArray(this.value.device_id).map(function (device_id) {\n          var device = _this2.hass.devices[device_id];\n          return _this2._renderChip(\"device_id\", device_id, device ? computeDeviceName(device, _this2.hass) : device_id, undefined, undefined, mdiDevices);\n        }) : \"\", (_this$value3 = this.value) !== null && _this$value3 !== void 0 && _this$value3.entity_id ? ensureArray(this.value.entity_id).map(function (entity_id) {\n          var entity = _this2.hass.states[entity_id];\n          return _this2._renderChip(\"entity_id\", entity_id, entity ? computeStateName(entity) : entity_id, entity);\n        }) : \"\");\n      }\n    }, {\n      kind: \"method\",\n      key: \"_renderChips\",\n      value: function _renderChips() {\n        return html(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"\\n      <div class=\\\"mdc-chip-set add-container\\\">\\n        <div\\n          class=\\\"mdc-chip area_id add\\\"\\n          .type=\", \"\\n          @click=\", \"\\n        >\\n          <div class=\\\"mdc-chip__ripple\\\"></div>\\n          <ha-svg-icon\\n            class=\\\"mdc-chip__icon mdc-chip__icon--leading\\\"\\n            .path=\", \"\\n          ></ha-svg-icon>\\n          <span role=\\\"gridcell\\\">\\n            <span role=\\\"button\\\" tabindex=\\\"0\\\" class=\\\"mdc-chip__primary-action\\\">\\n              <span class=\\\"mdc-chip__text\\\"\\n                >\", \"</span\\n              >\\n            </span>\\n          </span>\\n        </div>\\n        <div\\n          class=\\\"mdc-chip device_id add\\\"\\n          .type=\", \"\\n          @click=\", \"\\n        >\\n          <div class=\\\"mdc-chip__ripple\\\"></div>\\n          <ha-svg-icon\\n            class=\\\"mdc-chip__icon mdc-chip__icon--leading\\\"\\n            .path=\", \"\\n          ></ha-svg-icon>\\n          <span role=\\\"gridcell\\\">\\n            <span role=\\\"button\\\" tabindex=\\\"0\\\" class=\\\"mdc-chip__primary-action\\\">\\n              <span class=\\\"mdc-chip__text\\\"\\n                >\", \"</span\\n              >\\n            </span>\\n          </span>\\n        </div>\\n        <div\\n          class=\\\"mdc-chip entity_id add\\\"\\n          .type=\", \"\\n          @click=\", \"\\n        >\\n          <div class=\\\"mdc-chip__ripple\\\"></div>\\n          <ha-svg-icon\\n            class=\\\"mdc-chip__icon mdc-chip__icon--leading\\\"\\n            .path=\", \"\\n          ></ha-svg-icon>\\n          <span role=\\\"gridcell\\\">\\n            <span role=\\\"button\\\" tabindex=\\\"0\\\" class=\\\"mdc-chip__primary-action\\\">\\n              <span class=\\\"mdc-chip__text\\\"\\n                >\", \"</span\\n              >\\n            </span>\\n          </span>\\n        </div>\\n        \", \"\\n      </div>\\n      \", \"\\n    \"])), \"area_id\", this._showPicker, mdiPlus, this.hass.localize(\"ui.components.target-picker.add_area_id\"), \"device_id\", this._showPicker, mdiPlus, this.hass.localize(\"ui.components.target-picker.add_device_id\"), \"entity_id\", this._showPicker, mdiPlus, this.hass.localize(\"ui.components.target-picker.add_entity_id\"), this._renderPicker(), this.helper ? html(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"<ha-input-helper-text>\", \"</ha-input-helper-text>\"])), this.helper) : \"\");\n      }\n    }, {\n      kind: \"method\",\n      key: \"_showPicker\",\n      value: function _showPicker(ev) {\n        this._addMode = ev.currentTarget.type;\n      }\n    }, {\n      kind: \"method\",\n      key: \"_renderChip\",\n      value: function _renderChip(type, id, name, entityState, icon, fallbackIconPath) {\n        return html(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"\\n      <div\\n        class=\\\"mdc-chip \", \"\\\"\\n      >\\n        \", \"\\n        \", \"\\n        <span role=\\\"gridcell\\\">\\n          <span role=\\\"button\\\" tabindex=\\\"0\\\" class=\\\"mdc-chip__primary-action\\\">\\n            <span class=\\\"mdc-chip__text\\\">\", \"</span>\\n          </span>\\n        </span>\\n        \", \"\\n        <span role=\\\"gridcell\\\">\\n          <ha-icon-button\\n            class=\\\"mdc-chip__icon mdc-chip__icon--trailing\\\"\\n            .label=\", \"\\n            .path=\", \"\\n            hideTooltip\\n            .id=\", \"\\n            .type=\", \"\\n            @click=\", \"\\n          ></ha-icon-button>\\n          <simple-tooltip animation-delay=\\\"0\\\"\\n            >\", \"</simple-tooltip\\n          >\\n        </span>\\n      </div>\\n    \"])), classMap(_defineProperty({}, type, true)), icon ? html(_templateObject7 || (_templateObject7 = _taggedTemplateLiteral([\"<ha-icon\\n              class=\\\"mdc-chip__icon mdc-chip__icon--leading\\\"\\n              .icon=\", \"\\n            ></ha-icon>\"])), icon) : fallbackIconPath ? html(_templateObject8 || (_templateObject8 = _taggedTemplateLiteral([\"<ha-svg-icon\\n                class=\\\"mdc-chip__icon mdc-chip__icon--leading\\\"\\n                .path=\", \"\\n              ></ha-svg-icon>\"])), fallbackIconPath) : \"\", entityState ? html(_templateObject9 || (_templateObject9 = _taggedTemplateLiteral([\"<ha-state-icon\\n              class=\\\"mdc-chip__icon mdc-chip__icon--leading\\\"\\n              .hass=\", \"\\n              .stateObj=\", \"\\n            ></ha-state-icon>\"])), this.hass, entityState) : \"\", name, type === \"entity_id\" ? \"\" : html(_templateObject10 || (_templateObject10 = _taggedTemplateLiteral([\"<span role=\\\"gridcell\\\">\\n              <ha-icon-button\\n                class=\\\"expand-btn mdc-chip__icon mdc-chip__icon--trailing\\\"\\n                .label=\", \"\\n                .path=\", \"\\n                hideTooltip\\n                .id=\", \"\\n                .type=\", \"\\n                @click=\", \"\\n              ></ha-icon-button>\\n              <simple-tooltip class=\\\"expand\\\" animation-delay=\\\"0\\\"\\n                >\", \"</simple-tooltip\\n              >\\n            </span>\"])), this.hass.localize(\"ui.components.target-picker.expand\"), mdiUnfoldMoreVertical, id, type, this._handleExpand, this.hass.localize(\"ui.components.target-picker.expand_\".concat(type))), this.hass.localize(\"ui.components.target-picker.remove\"), mdiClose, id, type, this._handleRemove, this.hass.localize(\"ui.components.target-picker.remove_\".concat(type)));\n      }\n    }, {\n      kind: \"method\",\n      key: \"_renderPicker\",\n      value: function _renderPicker() {\n        var _this$value4, _this$value5, _this$value6;\n        if (!this._addMode) {\n          return nothing;\n        }\n        return html(_templateObject11 || (_templateObject11 = _taggedTemplateLiteral([\"<mwc-menu-surface\\n      open\\n      .anchor=\", \"\\n      @closed=\", \"\\n      @opened=\", \"\\n      @opened-changed=\", \"\\n      @input=\", \"\\n      >\", \"</mwc-menu-surface\\n    >\"])), this._addContainer, this._onClosed, this._onOpened, this._openedChanged, stopPropagation, this._addMode === \"area_id\" ? html(_templateObject12 || (_templateObject12 = _taggedTemplateLiteral([\"\\n            <ha-area-picker\\n              .hass=\", \"\\n              id=\\\"input\\\"\\n              .type=\", \"\\n              .label=\", \"\\n              no-add\\n              .deviceFilter=\", \"\\n              .entityFilter=\", \"\\n              .includeDeviceClasses=\", \"\\n              .includeDomains=\", \"\\n              .excludeAreas=\", \"\\n              @value-changed=\", \"\\n              @click=\", \"\\n            ></ha-area-picker>\\n          \"])), this.hass, \"area_id\", this.hass.localize(\"ui.components.target-picker.add_area_id\"), this.deviceFilter, this.entityFilter, this.includeDeviceClasses, this.includeDomains, ensureArray((_this$value4 = this.value) === null || _this$value4 === void 0 ? void 0 : _this$value4.area_id), this._targetPicked, this._preventDefault) : this._addMode === \"device_id\" ? html(_templateObject13 || (_templateObject13 = _taggedTemplateLiteral([\"\\n              <ha-device-picker\\n                .hass=\", \"\\n                id=\\\"input\\\"\\n                .type=\", \"\\n                .label=\", \"\\n                .deviceFilter=\", \"\\n                .entityFilter=\", \"\\n                .includeDeviceClasses=\", \"\\n                .includeDomains=\", \"\\n                .excludeDevices=\", \"\\n                @value-changed=\", \"\\n                @click=\", \"\\n              ></ha-device-picker>\\n            \"])), this.hass, \"device_id\", this.hass.localize(\"ui.components.target-picker.add_device_id\"), this.deviceFilter, this.entityFilter, this.includeDeviceClasses, this.includeDomains, ensureArray((_this$value5 = this.value) === null || _this$value5 === void 0 ? void 0 : _this$value5.device_id), this._targetPicked, this._preventDefault) : html(_templateObject14 || (_templateObject14 = _taggedTemplateLiteral([\"\\n              <ha-entity-picker\\n                .hass=\", \"\\n                id=\\\"input\\\"\\n                .type=\", \"\\n                .label=\", \"\\n                .entityFilter=\", \"\\n                .includeDeviceClasses=\", \"\\n                .includeDomains=\", \"\\n                .excludeEntities=\", \"\\n                @value-changed=\", \"\\n                @click=\", \"\\n                allow-custom-entity\\n              ></ha-entity-picker>\\n            \"])), this.hass, \"entity_id\", this.hass.localize(\"ui.components.target-picker.add_entity_id\"), this.entityFilter, this.includeDeviceClasses, this.includeDomains, ensureArray((_this$value6 = this.value) === null || _this$value6 === void 0 ? void 0 : _this$value6.entity_id), this._targetPicked, this._preventDefault));\n      }\n    }, {\n      kind: \"method\",\n      key: \"_targetPicked\",\n      value: function _targetPicked(ev) {\n        ev.stopPropagation();\n        if (!ev.detail.value) {\n          return;\n        }\n        var value = ev.detail.value;\n        var target = ev.currentTarget;\n        if (target.type === \"entity_id\" && !isValidEntityId(value)) {\n          return;\n        }\n        target.value = \"\";\n        if (this.value && this.value[target.type] && ensureArray(this.value[target.type]).includes(value)) {\n          return;\n        }\n        fireEvent(this, \"value-changed\", {\n          value: this.value ? Object.assign(Object.assign({}, this.value), {}, _defineProperty({}, target.type, this.value[target.type] ? [].concat(_toConsumableArray(ensureArray(this.value[target.type])), [value]) : value)) : _defineProperty({}, target.type, value)\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"_handleExpand\",\n      value: function _handleExpand(ev) {\n        var _this3 = this;\n        var target = ev.currentTarget;\n        var newDevices = [];\n        var newEntities = [];\n        if (target.type === \"area_id\") {\n          Object.values(this.hass.devices).forEach(function (device) {\n            var _device_id;\n            if (device.area_id === target.id && !((_device_id = _this3.value.device_id) !== null && _device_id !== void 0 && _device_id.includes(device.id)) && _this3._deviceMeetsFilter(device)) {\n              newDevices.push(device.id);\n            }\n          });\n          Object.values(this.hass.entities).forEach(function (entity) {\n            var _entity_id;\n            if (entity.area_id === target.id && !((_entity_id = _this3.value.entity_id) !== null && _entity_id !== void 0 && _entity_id.includes(entity.entity_id)) && _this3._entityRegMeetsFilter(entity)) {\n              newEntities.push(entity.entity_id);\n            }\n          });\n        } else if (target.type === \"device_id\") {\n          Object.values(this.hass.entities).forEach(function (entity) {\n            var _entity_id2;\n            if (entity.device_id === target.id && !((_entity_id2 = _this3.value.entity_id) !== null && _entity_id2 !== void 0 && _entity_id2.includes(entity.entity_id)) && _this3._entityRegMeetsFilter(entity)) {\n              newEntities.push(entity.entity_id);\n            }\n          });\n        } else {\n          return;\n        }\n        var value = this.value;\n        if (newEntities.length) {\n          value = this._addItems(value, \"entity_id\", newEntities);\n        }\n        if (newDevices.length) {\n          value = this._addItems(value, \"device_id\", newDevices);\n        }\n        value = this._removeItem(value, target.type, target.id);\n        fireEvent(this, \"value-changed\", {\n          value: value\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"_handleRemove\",\n      value: function _handleRemove(ev) {\n        var target = ev.currentTarget;\n        fireEvent(this, \"value-changed\", {\n          value: this._removeItem(this.value, target.type, target.id)\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"_addItems\",\n      value: function _addItems(value, type, ids) {\n        return Object.assign(Object.assign({}, value), {}, _defineProperty({}, type, value[type] ? ensureArray(value[type]).concat(ids) : ids));\n      }\n    }, {\n      kind: \"method\",\n      key: \"_removeItem\",\n      value: function _removeItem(value, type, id) {\n        var newVal = ensureArray(value[type]).filter(function (val) {\n          return String(val) !== id;\n        });\n        if (newVal.length) {\n          return Object.assign(Object.assign({}, value), {}, _defineProperty({}, type, newVal));\n        }\n        var val = Object.assign({}, value);\n        delete val[type];\n        if (Object.keys(val).length) {\n          return val;\n        }\n        return undefined;\n      }\n    }, {\n      kind: \"method\",\n      key: \"_onClosed\",\n      value: function _onClosed(ev) {\n        ev.stopPropagation();\n        ev.target.open = true;\n      }\n    }, {\n      kind: \"method\",\n      key: \"_onOpened\",\n      value: (function () {\n        var _onOpened2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n          var _this$_inputElement, _this$_inputElement2;\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                if (this._addMode) {\n                  _context.next = 2;\n                  break;\n                }\n                return _context.abrupt(\"return\");\n              case 2:\n                _context.next = 4;\n                return (_this$_inputElement = this._inputElement) === null || _this$_inputElement === void 0 ? void 0 : _this$_inputElement.focus();\n              case 4:\n                _context.next = 6;\n                return (_this$_inputElement2 = this._inputElement) === null || _this$_inputElement2 === void 0 ? void 0 : _this$_inputElement2.open();\n              case 6:\n                this._opened = true;\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }, _callee, this);\n        }));\n        function _onOpened() {\n          return _onOpened2.apply(this, arguments);\n        }\n        return _onOpened;\n      }())\n    }, {\n      kind: \"method\",\n      key: \"_openedChanged\",\n      value: function _openedChanged(ev) {\n        if (this._opened && !ev.detail.value) {\n          this._opened = false;\n          this._addMode = undefined;\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"_preventDefault\",\n      value: function _preventDefault(ev) {\n        ev.preventDefault();\n      }\n    }, {\n      kind: \"method\",\n      key: \"_deviceMeetsFilter\",\n      value: function _deviceMeetsFilter(device) {\n        var _this4 = this;\n        var devEntities = Object.values(this.hass.entities).filter(function (entity) {\n          return entity.device_id === device.id;\n        });\n        if (this.includeDomains) {\n          if (!devEntities || !devEntities.length) {\n            return false;\n          }\n          if (!devEntities.some(function (entity) {\n            return _this4.includeDomains.includes(computeDomain(entity.entity_id));\n          })) {\n            return false;\n          }\n        }\n        if (this.includeDeviceClasses) {\n          if (!devEntities || !devEntities.length) {\n            return false;\n          }\n          if (!devEntities.some(function (entity) {\n            var stateObj = _this4.hass.states[entity.entity_id];\n            if (!stateObj) {\n              return false;\n            }\n            return stateObj.attributes.device_class && _this4.includeDeviceClasses.includes(stateObj.attributes.device_class);\n          })) {\n            return false;\n          }\n        }\n        if (this.deviceFilter) {\n          if (!this.deviceFilter(device)) {\n            return false;\n          }\n        }\n        if (this.entityFilter) {\n          if (!devEntities.some(function (entity) {\n            var stateObj = _this4.hass.states[entity.entity_id];\n            if (!stateObj) {\n              return false;\n            }\n            return _this4.entityFilter(stateObj);\n          })) {\n            return false;\n          }\n        }\n        return true;\n      }\n    }, {\n      kind: \"method\",\n      key: \"_entityRegMeetsFilter\",\n      value: function _entityRegMeetsFilter(entity) {\n        if (entity.entity_category) {\n          return false;\n        }\n        if (this.includeDomains && !this.includeDomains.includes(computeDomain(entity.entity_id))) {\n          return false;\n        }\n        if (this.includeDeviceClasses) {\n          var stateObj = this.hass.states[entity.entity_id];\n          if (!stateObj) {\n            return false;\n          }\n          if (!stateObj.attributes.device_class || !this.includeDeviceClasses.includes(stateObj.attributes.device_class)) {\n            return false;\n          }\n        }\n        if (this.entityFilter) {\n          var _stateObj = this.hass.states[entity.entity_id];\n          if (!_stateObj) {\n            return false;\n          }\n          if (!this.entityFilter(_stateObj)) {\n            return false;\n          }\n        }\n        return true;\n      }\n    }, {\n      kind: \"get\",\n      static: true,\n      key: \"styles\",\n      value: function styles() {\n        return css(_templateObject15 || (_templateObject15 = _taggedTemplateLiteral([\"\\n      \", \"\\n      .mdc-chip {\\n        color: var(--primary-text-color);\\n      }\\n      .items {\\n        z-index: 2;\\n      }\\n      .mdc-chip-set {\\n        padding: 4px 0;\\n      }\\n      .mdc-chip.add {\\n        color: rgba(0, 0, 0, 0.87);\\n      }\\n      .add-container {\\n        position: relative;\\n        display: inline-flex;\\n      }\\n      .mdc-chip:not(.add) {\\n        cursor: default;\\n      }\\n      .mdc-chip ha-icon-button {\\n        --mdc-icon-button-size: 24px;\\n        display: flex;\\n        align-items: center;\\n        outline: none;\\n      }\\n      .mdc-chip ha-icon-button ha-svg-icon {\\n        border-radius: 50%;\\n        background: var(--secondary-text-color);\\n      }\\n      .mdc-chip__icon.mdc-chip__icon--trailing {\\n        width: 16px;\\n        height: 16px;\\n        --mdc-icon-size: 14px;\\n        color: var(--secondary-text-color);\\n        margin-inline-start: 4px !important;\\n        margin-inline-end: -4px !important;\\n        direction: var(--direction);\\n      }\\n      .mdc-chip__icon--leading {\\n        display: flex;\\n        align-items: center;\\n        justify-content: center;\\n        --mdc-icon-size: 20px;\\n        border-radius: 50%;\\n        padding: 6px;\\n        margin-left: -14px !important;\\n        margin-inline-start: -14px !important;\\n        margin-inline-end: 4px !important;\\n        direction: var(--direction);\\n      }\\n      .expand-btn {\\n        margin-right: 0;\\n        margin-inline-end: 0;\\n        margin-inline-start: initial;\\n      }\\n      .mdc-chip.area_id:not(.add) {\\n        border: 2px solid #fed6a4;\\n        background: var(--card-background-color);\\n      }\\n      .mdc-chip.area_id:not(.add) .mdc-chip__icon--leading,\\n      .mdc-chip.area_id.add {\\n        background: #fed6a4;\\n      }\\n      .mdc-chip.device_id:not(.add) {\\n        border: 2px solid #a8e1fb;\\n        background: var(--card-background-color);\\n      }\\n      .mdc-chip.device_id:not(.add) .mdc-chip__icon--leading,\\n      .mdc-chip.device_id.add {\\n        background: #a8e1fb;\\n      }\\n      .mdc-chip.entity_id:not(.add) {\\n        border: 2px solid #d2e7b9;\\n        background: var(--card-background-color);\\n      }\\n      .mdc-chip.entity_id:not(.add) .mdc-chip__icon--leading,\\n      .mdc-chip.entity_id.add {\\n        background: #d2e7b9;\\n      }\\n      .mdc-chip:hover {\\n        z-index: 5;\\n      }\\n      simple-tooltip.expand {\\n        min-width: 200px;\\n      }\\n      :host([disabled]) .mdc-chip {\\n        opacity: var(--light-disabled-opacity);\\n        pointer-events: none;\\n      }\\n      mwc-menu-surface {\\n        --mdc-menu-min-width: 100%;\\n      }\\n      ha-entity-picker,\\n      ha-device-picker,\\n      ha-area-picker {\\n        display: block;\\n        width: 100%;\\n      }\\n    \"])), unsafeCSS(chipStyles));\n      }\n    }]\n  };\n}, LitElement);","map":{"version":3,"names":["chipStyles","mdiClose","mdiDevices","mdiPlus","mdiSofa","mdiUnfoldMoreVertical","css","html","LitElement","nothing","unsafeCSS","customElement","property","query","state","classMap","ensureArray","fireEvent","stopPropagation","computeDomain","computeStateName","isValidEntityId","computeDeviceName","HaTargetPicker","_decorate","_initialize","_LitElement","_LitElement2","_inherits","_this","_classCallCheck","_len","arguments","length","args","Array","_key","_callSuper","concat","_assertThisInitialized","_createClass","F","d","kind","decorators","attribute","key","value","type","Boolean","reflect","render","addOnTop","_templateObject","_taggedTemplateLiteral","_renderChips","_renderItems","_templateObject2","_this$value","_this2","_this$value2","_this$value3","_templateObject3","area_id","map","area","hass","areas","_renderChip","name","undefined","icon","device_id","device","devices","entity_id","entity","states","_templateObject4","_showPicker","localize","_renderPicker","helper","_templateObject5","ev","_addMode","currentTarget","id","entityState","fallbackIconPath","_templateObject6","_defineProperty","_templateObject7","_templateObject8","_templateObject9","_templateObject10","_handleExpand","_handleRemove","_this$value4","_this$value5","_this$value6","_templateObject11","_addContainer","_onClosed","_onOpened","_openedChanged","_templateObject12","deviceFilter","entityFilter","includeDeviceClasses","includeDomains","_targetPicked","_preventDefault","_templateObject13","_templateObject14","detail","target","includes","Object","assign","_toConsumableArray","_this3","newDevices","newEntities","values","forEach","_device_id","_deviceMeetsFilter","push","entities","_entity_id","_entityRegMeetsFilter","_entity_id2","_addItems","_removeItem","ids","newVal","filter","val","String","keys","open","_onOpened2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_this$_inputElement","_this$_inputElement2","wrap","_callee$","_context","prev","next","abrupt","_inputElement","focus","_opened","stop","apply","preventDefault","_this4","devEntities","some","stateObj","attributes","device_class","entity_category","static","styles","_templateObject15"],"sources":["/workspaces/frontend/src/components/ha-target-picker.ts"],"sourcesContent":["import \"@lrnwebcomponents/simple-tooltip/simple-tooltip\";\n// @ts-ignore\nimport chipStyles from \"@material/chips/dist/mdc.chips.min.css\";\nimport \"@material/mwc-button/mwc-button\";\nimport \"@material/mwc-menu/mwc-menu-surface\";\nimport {\n  mdiClose,\n  mdiDevices,\n  mdiPlus,\n  mdiSofa,\n  mdiUnfoldMoreVertical,\n} from \"@mdi/js\";\nimport { ComboBoxLightOpenedChangedEvent } from \"@vaadin/combo-box/vaadin-combo-box-light\";\nimport { HassEntity, HassServiceTarget } from \"home-assistant-js-websocket\";\nimport { css, CSSResultGroup, html, LitElement, nothing, unsafeCSS } from \"lit\";\nimport { customElement, property, query, state } from \"lit/decorators\";\nimport { classMap } from \"lit/directives/class-map\";\nimport { ensureArray } from \"../common/array/ensure-array\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { stopPropagation } from \"../common/dom/stop_propagation\";\nimport { computeDomain } from \"../common/entity/compute_domain\";\nimport { computeStateName } from \"../common/entity/compute_state_name\";\nimport { isValidEntityId } from \"../common/entity/valid_entity_id\";\nimport {\n  computeDeviceName,\n  DeviceRegistryEntry,\n} from \"../data/device_registry\";\nimport { EntityRegistryDisplayEntry } from \"../data/entity_registry\";\nimport { HomeAssistant } from \"../types\";\nimport \"./device/ha-device-picker\";\nimport type { HaDevicePickerDeviceFilterFunc } from \"./device/ha-device-picker\";\nimport \"./entity/ha-entity-picker\";\nimport type { HaEntityPickerEntityFilterFunc } from \"./entity/ha-entity-picker\";\nimport \"./ha-area-picker\";\nimport \"./ha-icon-button\";\nimport \"./ha-input-helper-text\";\nimport \"./ha-svg-icon\";\n\n@customElement(\"ha-target-picker\")\nexport class HaTargetPicker extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public value?: HassServiceTarget;\n\n  @property() public label?: string;\n\n  @property() public helper?: string;\n\n  /**\n   * Show only targets with entities from specific domains.\n   * @type {Array}\n   * @attr include-domains\n   */\n  @property({ type: Array, attribute: \"include-domains\" })\n  public includeDomains?: string[];\n\n  /**\n   * Show only targets with entities of these device classes.\n   * @type {Array}\n   * @attr include-device-classes\n   */\n  @property({ type: Array, attribute: \"include-device-classes\" })\n  public includeDeviceClasses?: string[];\n\n  @property({ attribute: false })\n  public deviceFilter?: HaDevicePickerDeviceFilterFunc;\n\n  @property({ attribute: false })\n  public entityFilter?: HaEntityPickerEntityFilterFunc;\n\n  @property({ type: Boolean, reflect: true }) public disabled = false;\n\n  @property({ type: Boolean }) public addOnTop = false;\n\n  @state() private _addMode?: \"area_id\" | \"entity_id\" | \"device_id\";\n\n  @query(\"#input\") private _inputElement?;\n\n  @query(\".add-container\", true) private _addContainer?: HTMLDivElement;\n\n  private _opened = false;\n\n  protected render() {\n    if (this.addOnTop) {\n      return html` ${this._renderChips()} ${this._renderItems()} `;\n    }\n    return html` ${this._renderItems()} ${this._renderChips()} `;\n  }\n\n  private _renderItems() {\n    return html`\n      <div class=\"mdc-chip-set items\">\n        ${this.value?.area_id\n          ? ensureArray(this.value.area_id).map((area_id) => {\n              const area = this.hass.areas![area_id];\n              return this._renderChip(\n                \"area_id\",\n                area_id,\n                area?.name || area_id,\n                undefined,\n                area?.icon,\n                mdiSofa\n              );\n            })\n          : \"\"}\n        ${this.value?.device_id\n          ? ensureArray(this.value.device_id).map((device_id) => {\n              const device = this.hass.devices![device_id];\n              return this._renderChip(\n                \"device_id\",\n                device_id,\n                device ? computeDeviceName(device, this.hass) : device_id,\n                undefined,\n                undefined,\n                mdiDevices\n              );\n            })\n          : \"\"}\n        ${this.value?.entity_id\n          ? ensureArray(this.value.entity_id).map((entity_id) => {\n              const entity = this.hass.states[entity_id];\n              return this._renderChip(\n                \"entity_id\",\n                entity_id,\n                entity ? computeStateName(entity) : entity_id,\n                entity\n              );\n            })\n          : \"\"}\n      </div>\n    `;\n  }\n\n  private _renderChips() {\n    return html`\n      <div class=\"mdc-chip-set add-container\">\n        <div\n          class=\"mdc-chip area_id add\"\n          .type=${\"area_id\"}\n          @click=${this._showPicker}\n        >\n          <div class=\"mdc-chip__ripple\"></div>\n          <ha-svg-icon\n            class=\"mdc-chip__icon mdc-chip__icon--leading\"\n            .path=${mdiPlus}\n          ></ha-svg-icon>\n          <span role=\"gridcell\">\n            <span role=\"button\" tabindex=\"0\" class=\"mdc-chip__primary-action\">\n              <span class=\"mdc-chip__text\"\n                >${this.hass.localize(\n                  \"ui.components.target-picker.add_area_id\"\n                )}</span\n              >\n            </span>\n          </span>\n        </div>\n        <div\n          class=\"mdc-chip device_id add\"\n          .type=${\"device_id\"}\n          @click=${this._showPicker}\n        >\n          <div class=\"mdc-chip__ripple\"></div>\n          <ha-svg-icon\n            class=\"mdc-chip__icon mdc-chip__icon--leading\"\n            .path=${mdiPlus}\n          ></ha-svg-icon>\n          <span role=\"gridcell\">\n            <span role=\"button\" tabindex=\"0\" class=\"mdc-chip__primary-action\">\n              <span class=\"mdc-chip__text\"\n                >${this.hass.localize(\n                  \"ui.components.target-picker.add_device_id\"\n                )}</span\n              >\n            </span>\n          </span>\n        </div>\n        <div\n          class=\"mdc-chip entity_id add\"\n          .type=${\"entity_id\"}\n          @click=${this._showPicker}\n        >\n          <div class=\"mdc-chip__ripple\"></div>\n          <ha-svg-icon\n            class=\"mdc-chip__icon mdc-chip__icon--leading\"\n            .path=${mdiPlus}\n          ></ha-svg-icon>\n          <span role=\"gridcell\">\n            <span role=\"button\" tabindex=\"0\" class=\"mdc-chip__primary-action\">\n              <span class=\"mdc-chip__text\"\n                >${this.hass.localize(\n                  \"ui.components.target-picker.add_entity_id\"\n                )}</span\n              >\n            </span>\n          </span>\n        </div>\n        ${this._renderPicker()}\n      </div>\n      ${this.helper\n        ? html`<ha-input-helper-text>${this.helper}</ha-input-helper-text>`\n        : \"\"}\n    `;\n  }\n\n  private _showPicker(ev) {\n    this._addMode = ev.currentTarget.type;\n  }\n\n  private _renderChip(\n    type: \"area_id\" | \"device_id\" | \"entity_id\",\n    id: string,\n    name: string,\n    entityState?: HassEntity,\n    icon?: string | null,\n    fallbackIconPath?: string\n  ) {\n    return html`\n      <div\n        class=\"mdc-chip ${classMap({\n          [type]: true,\n        })}\"\n      >\n        ${icon\n          ? html`<ha-icon\n              class=\"mdc-chip__icon mdc-chip__icon--leading\"\n              .icon=${icon}\n            ></ha-icon>`\n          : fallbackIconPath\n            ? html`<ha-svg-icon\n                class=\"mdc-chip__icon mdc-chip__icon--leading\"\n                .path=${fallbackIconPath}\n              ></ha-svg-icon>`\n            : \"\"}\n        ${entityState\n          ? html`<ha-state-icon\n              class=\"mdc-chip__icon mdc-chip__icon--leading\"\n              .hass=${this.hass}\n              .stateObj=${entityState}\n            ></ha-state-icon>`\n          : \"\"}\n        <span role=\"gridcell\">\n          <span role=\"button\" tabindex=\"0\" class=\"mdc-chip__primary-action\">\n            <span class=\"mdc-chip__text\">${name}</span>\n          </span>\n        </span>\n        ${type === \"entity_id\"\n          ? \"\"\n          : html`<span role=\"gridcell\">\n              <ha-icon-button\n                class=\"expand-btn mdc-chip__icon mdc-chip__icon--trailing\"\n                .label=${this.hass.localize(\n                  \"ui.components.target-picker.expand\"\n                )}\n                .path=${mdiUnfoldMoreVertical}\n                hideTooltip\n                .id=${id}\n                .type=${type}\n                @click=${this._handleExpand}\n              ></ha-icon-button>\n              <simple-tooltip class=\"expand\" animation-delay=\"0\"\n                >${this.hass.localize(\n                  `ui.components.target-picker.expand_${type}`\n                )}</simple-tooltip\n              >\n            </span>`}\n        <span role=\"gridcell\">\n          <ha-icon-button\n            class=\"mdc-chip__icon mdc-chip__icon--trailing\"\n            .label=${this.hass.localize(\"ui.components.target-picker.remove\")}\n            .path=${mdiClose}\n            hideTooltip\n            .id=${id}\n            .type=${type}\n            @click=${this._handleRemove}\n          ></ha-icon-button>\n          <simple-tooltip animation-delay=\"0\"\n            >${this.hass.localize(\n              `ui.components.target-picker.remove_${type}`\n            )}</simple-tooltip\n          >\n        </span>\n      </div>\n    `;\n  }\n\n  private _renderPicker() {\n    if (!this._addMode) {\n      return nothing;\n    }\n    return html`<mwc-menu-surface\n      open\n      .anchor=${this._addContainer}\n      @closed=${this._onClosed}\n      @opened=${this._onOpened}\n      @opened-changed=${this._openedChanged}\n      @input=${stopPropagation}\n      >${this._addMode === \"area_id\"\n        ? html`\n            <ha-area-picker\n              .hass=${this.hass}\n              id=\"input\"\n              .type=${\"area_id\"}\n              .label=${this.hass.localize(\n                \"ui.components.target-picker.add_area_id\"\n              )}\n              no-add\n              .deviceFilter=${this.deviceFilter}\n              .entityFilter=${this.entityFilter}\n              .includeDeviceClasses=${this.includeDeviceClasses}\n              .includeDomains=${this.includeDomains}\n              .excludeAreas=${ensureArray(this.value?.area_id)}\n              @value-changed=${this._targetPicked}\n              @click=${this._preventDefault}\n            ></ha-area-picker>\n          `\n        : this._addMode === \"device_id\"\n          ? html`\n              <ha-device-picker\n                .hass=${this.hass}\n                id=\"input\"\n                .type=${\"device_id\"}\n                .label=${this.hass.localize(\n                  \"ui.components.target-picker.add_device_id\"\n                )}\n                .deviceFilter=${this.deviceFilter}\n                .entityFilter=${this.entityFilter}\n                .includeDeviceClasses=${this.includeDeviceClasses}\n                .includeDomains=${this.includeDomains}\n                .excludeDevices=${ensureArray(this.value?.device_id)}\n                @value-changed=${this._targetPicked}\n                @click=${this._preventDefault}\n              ></ha-device-picker>\n            `\n          : html`\n              <ha-entity-picker\n                .hass=${this.hass}\n                id=\"input\"\n                .type=${\"entity_id\"}\n                .label=${this.hass.localize(\n                  \"ui.components.target-picker.add_entity_id\"\n                )}\n                .entityFilter=${this.entityFilter}\n                .includeDeviceClasses=${this.includeDeviceClasses}\n                .includeDomains=${this.includeDomains}\n                .excludeEntities=${ensureArray(this.value?.entity_id)}\n                @value-changed=${this._targetPicked}\n                @click=${this._preventDefault}\n                allow-custom-entity\n              ></ha-entity-picker>\n            `}</mwc-menu-surface\n    >`;\n  }\n\n  private _targetPicked(ev) {\n    ev.stopPropagation();\n    if (!ev.detail.value) {\n      return;\n    }\n    const value = ev.detail.value;\n    const target = ev.currentTarget;\n\n    if (target.type === \"entity_id\" && !isValidEntityId(value)) {\n      return;\n    }\n\n    target.value = \"\";\n    if (\n      this.value &&\n      this.value[target.type] &&\n      ensureArray(this.value[target.type]).includes(value)\n    ) {\n      return;\n    }\n    fireEvent(this, \"value-changed\", {\n      value: this.value\n        ? {\n            ...this.value,\n            [target.type]: this.value[target.type]\n              ? [...ensureArray(this.value[target.type]), value]\n              : value,\n          }\n        : { [target.type]: value },\n    });\n  }\n\n  private _handleExpand(ev) {\n    const target = ev.currentTarget as any;\n    const newDevices: string[] = [];\n    const newEntities: string[] = [];\n    if (target.type === \"area_id\") {\n      Object.values(this.hass.devices).forEach((device) => {\n        if (\n          device.area_id === target.id &&\n          !this.value!.device_id?.includes(device.id) &&\n          this._deviceMeetsFilter(device)\n        ) {\n          newDevices.push(device.id);\n        }\n      });\n      Object.values(this.hass.entities).forEach((entity) => {\n        if (\n          entity.area_id === target.id &&\n          !this.value!.entity_id?.includes(entity.entity_id) &&\n          this._entityRegMeetsFilter(entity)\n        ) {\n          newEntities.push(entity.entity_id);\n        }\n      });\n    } else if (target.type === \"device_id\") {\n      Object.values(this.hass.entities).forEach((entity) => {\n        if (\n          entity.device_id === target.id &&\n          !this.value!.entity_id?.includes(entity.entity_id) &&\n          this._entityRegMeetsFilter(entity)\n        ) {\n          newEntities.push(entity.entity_id);\n        }\n      });\n    } else {\n      return;\n    }\n    let value = this.value;\n    if (newEntities.length) {\n      value = this._addItems(value, \"entity_id\", newEntities);\n    }\n    if (newDevices.length) {\n      value = this._addItems(value, \"device_id\", newDevices);\n    }\n    value = this._removeItem(value, target.type, target.id);\n    fireEvent(this, \"value-changed\", { value });\n  }\n\n  private _handleRemove(ev) {\n    const target = ev.currentTarget as any;\n    fireEvent(this, \"value-changed\", {\n      value: this._removeItem(this.value, target.type, target.id),\n    });\n  }\n\n  private _addItems(\n    value: this[\"value\"],\n    type: string,\n    ids: string[]\n  ): this[\"value\"] {\n    return {\n      ...value,\n      [type]: value![type] ? ensureArray(value![type])!.concat(ids) : ids,\n    };\n  }\n\n  private _removeItem(\n    value: this[\"value\"],\n    type: string,\n    id: string\n  ): this[\"value\"] {\n    const newVal = ensureArray(value![type])!.filter(\n      (val) => String(val) !== id\n    );\n    if (newVal.length) {\n      return {\n        ...value,\n        [type]: newVal,\n      };\n    }\n    const val = { ...value }!;\n    delete val[type];\n    if (Object.keys(val).length) {\n      return val;\n    }\n    return undefined;\n  }\n\n  private _onClosed(ev) {\n    ev.stopPropagation();\n    ev.target.open = true;\n  }\n\n  private async _onOpened() {\n    if (!this._addMode) {\n      return;\n    }\n    await this._inputElement?.focus();\n    await this._inputElement?.open();\n    this._opened = true;\n  }\n\n  private _openedChanged(ev: ComboBoxLightOpenedChangedEvent) {\n    if (this._opened && !ev.detail.value) {\n      this._opened = false;\n      this._addMode = undefined;\n    }\n  }\n\n  private _preventDefault(ev: Event) {\n    ev.preventDefault();\n  }\n\n  private _deviceMeetsFilter(device: DeviceRegistryEntry): boolean {\n    const devEntities = Object.values(this.hass.entities).filter(\n      (entity) => entity.device_id === device.id\n    );\n\n    if (this.includeDomains) {\n      if (!devEntities || !devEntities.length) {\n        return false;\n      }\n      if (\n        !devEntities.some((entity) =>\n          this.includeDomains!.includes(computeDomain(entity.entity_id))\n        )\n      ) {\n        return false;\n      }\n    }\n\n    if (this.includeDeviceClasses) {\n      if (!devEntities || !devEntities.length) {\n        return false;\n      }\n      if (\n        !devEntities.some((entity) => {\n          const stateObj = this.hass.states[entity.entity_id];\n          if (!stateObj) {\n            return false;\n          }\n          return (\n            stateObj.attributes.device_class &&\n            this.includeDeviceClasses!.includes(\n              stateObj.attributes.device_class\n            )\n          );\n        })\n      ) {\n        return false;\n      }\n    }\n\n    if (this.deviceFilter) {\n      if (!this.deviceFilter(device)) {\n        return false;\n      }\n    }\n\n    if (this.entityFilter) {\n      if (\n        !devEntities.some((entity) => {\n          const stateObj = this.hass.states[entity.entity_id];\n          if (!stateObj) {\n            return false;\n          }\n          return this.entityFilter!(stateObj);\n        })\n      ) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  private _entityRegMeetsFilter(entity: EntityRegistryDisplayEntry): boolean {\n    if (entity.entity_category) {\n      return false;\n    }\n\n    if (\n      this.includeDomains &&\n      !this.includeDomains.includes(computeDomain(entity.entity_id))\n    ) {\n      return false;\n    }\n    if (this.includeDeviceClasses) {\n      const stateObj = this.hass.states[entity.entity_id];\n      if (!stateObj) {\n        return false;\n      }\n      if (\n        !stateObj.attributes.device_class ||\n        !this.includeDeviceClasses!.includes(stateObj.attributes.device_class)\n      ) {\n        return false;\n      }\n    }\n\n    if (this.entityFilter) {\n      const stateObj = this.hass.states[entity.entity_id];\n      if (!stateObj) {\n        return false;\n      }\n      if (!this.entityFilter!(stateObj)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      ${unsafeCSS(chipStyles)}\n      .mdc-chip {\n        color: var(--primary-text-color);\n      }\n      .items {\n        z-index: 2;\n      }\n      .mdc-chip-set {\n        padding: 4px 0;\n      }\n      .mdc-chip.add {\n        color: rgba(0, 0, 0, 0.87);\n      }\n      .add-container {\n        position: relative;\n        display: inline-flex;\n      }\n      .mdc-chip:not(.add) {\n        cursor: default;\n      }\n      .mdc-chip ha-icon-button {\n        --mdc-icon-button-size: 24px;\n        display: flex;\n        align-items: center;\n        outline: none;\n      }\n      .mdc-chip ha-icon-button ha-svg-icon {\n        border-radius: 50%;\n        background: var(--secondary-text-color);\n      }\n      .mdc-chip__icon.mdc-chip__icon--trailing {\n        width: 16px;\n        height: 16px;\n        --mdc-icon-size: 14px;\n        color: var(--secondary-text-color);\n        margin-inline-start: 4px !important;\n        margin-inline-end: -4px !important;\n        direction: var(--direction);\n      }\n      .mdc-chip__icon--leading {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        --mdc-icon-size: 20px;\n        border-radius: 50%;\n        padding: 6px;\n        margin-left: -14px !important;\n        margin-inline-start: -14px !important;\n        margin-inline-end: 4px !important;\n        direction: var(--direction);\n      }\n      .expand-btn {\n        margin-right: 0;\n        margin-inline-end: 0;\n        margin-inline-start: initial;\n      }\n      .mdc-chip.area_id:not(.add) {\n        border: 2px solid #fed6a4;\n        background: var(--card-background-color);\n      }\n      .mdc-chip.area_id:not(.add) .mdc-chip__icon--leading,\n      .mdc-chip.area_id.add {\n        background: #fed6a4;\n      }\n      .mdc-chip.device_id:not(.add) {\n        border: 2px solid #a8e1fb;\n        background: var(--card-background-color);\n      }\n      .mdc-chip.device_id:not(.add) .mdc-chip__icon--leading,\n      .mdc-chip.device_id.add {\n        background: #a8e1fb;\n      }\n      .mdc-chip.entity_id:not(.add) {\n        border: 2px solid #d2e7b9;\n        background: var(--card-background-color);\n      }\n      .mdc-chip.entity_id:not(.add) .mdc-chip__icon--leading,\n      .mdc-chip.entity_id.add {\n        background: #d2e7b9;\n      }\n      .mdc-chip:hover {\n        z-index: 5;\n      }\n      simple-tooltip.expand {\n        min-width: 200px;\n      }\n      :host([disabled]) .mdc-chip {\n        opacity: var(--light-disabled-opacity);\n        pointer-events: none;\n      }\n      mwc-menu-surface {\n        --mdc-menu-min-width: 100%;\n      }\n      ha-entity-picker,\n      ha-device-picker,\n      ha-area-picker {\n        display: block;\n        width: 100%;\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-target-picker\": HaTargetPicker;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,iDAAiD;AACxD;AACA,OAAOA,UAAU,MAAM,wCAAwC;AAC/D,OAAO,iCAAiC;AACxC,OAAO,qCAAqC;AAAC,IAAAC,QAAA;AAAA,IAAAC,UAAA;AAAA,IAAAC,OAAA;AAAA,IAAAC,OAAA;AAAA,IAAAC,qBAAA;AAU7C,SAASC,GAAG,EAAkBC,IAAI,EAAEC,UAAU,EAAEC,OAAO,EAAEC,SAAS,QAAQ,KAAK;AAC/E,SAASC,aAAa,EAAEC,QAAQ,EAAEC,KAAK,EAAEC,KAAK,QAAQ,gBAAgB;AACtE,SAASC,QAAQ,QAAQ,0BAA0B;AACnD,SAASC,WAAW,QAAQ,8BAA8B;AAC1D,SAASC,SAAS,QAAQ,0BAA0B;AACpD,SAASC,eAAe,QAAQ,gCAAgC;AAChE,SAASC,aAAa,QAAQ,iCAAiC;AAC/D,SAASC,gBAAgB,QAAQ,qCAAqC;AACtE,SAASC,eAAe,QAAQ,kCAAkC;AAClE,SACEC,iBAAiB,QAEZ,yBAAyB;AAGhC,OAAO,2BAA2B;AAElC,OAAO,2BAA2B;AAElC,OAAO,kBAAkB;AACzB,OAAO,kBAAkB;AACzB,OAAO,wBAAwB;AAC/B,OAAO,eAAe;AAEtB,WACaC,cAAc,GAAAC,SAAA,EAD1Bb,aAAa,CAAC,kBAAkB,CAAC,aAAAc,WAAA,EAAAC,WAAA;EAAA,IACrBH,cAAc,0BAAAI,YAAA;IAAAC,SAAA,CAAAL,cAAA,EAAAI,YAAA;IAAA,SAAAJ,eAAA;MAAA,IAAAM,KAAA;MAAAC,eAAA,OAAAP,cAAA;MAAA,SAAAQ,IAAA,GAAAC,SAAA,CAAAC,MAAA,EAAAC,IAAA,OAAAC,KAAA,CAAAJ,IAAA,GAAAK,IAAA,MAAAA,IAAA,GAAAL,IAAA,EAAAK,IAAA;QAAAF,IAAA,CAAAE,IAAA,IAAAJ,SAAA,CAAAI,IAAA;MAAA;MAAAP,KAAA,GAAAQ,UAAA,OAAAd,cAAA,KAAAe,MAAA,CAAAJ,IAAA;MAAAT,WAAA,CAAAc,sBAAA,CAAAV,KAAA;MAAA,OAAAA,KAAA;IAAA;IAAA,OAAAW,YAAA,CAAAjB,cAAA;EAAA,EAAAG,WAAA;EAAA;IAAAe,CAAA,EAAdlB,cAAc;IAAAmB,CAAA;MAAAC,IAAA;MAAAC,UAAA,GACxBhC,QAAQ,CAAC;QAAEiC,SAAS,EAAE;MAAM,CAAC,CAAC;MAAAC,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAE9BhC,QAAQ,CAAC;QAAEiC,SAAS,EAAE;MAAM,CAAC,CAAC;MAAAC,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAE9BhC,QAAQ,CAAC,CAAC;MAAAkC,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAEVhC,QAAQ,CAAC,CAAC;MAAAkC,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAOVhC,QAAQ,CAAC;QAAEoC,IAAI,EAAEb,KAAK;QAAEU,SAAS,EAAE;MAAkB,CAAC,CAAC;MAAAC,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAQvDhC,QAAQ,CAAC;QAAEoC,IAAI,EAAEb,KAAK;QAAEU,SAAS,EAAE;MAAyB,CAAC,CAAC;MAAAC,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAG9DhC,QAAQ,CAAC;QAAEiC,SAAS,EAAE;MAAM,CAAC,CAAC;MAAAC,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAG9BhC,QAAQ,CAAC;QAAEiC,SAAS,EAAE;MAAM,CAAC,CAAC;MAAAC,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAG9BhC,QAAQ,CAAC;QAAEoC,IAAI,EAAEC,OAAO;QAAEC,OAAO,EAAE;MAAK,CAAC,CAAC;MAAAJ,GAAA;MAAAC,KAAA,WAAAA,MAAA;QAAA,OAAmB,KAAK;MAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAElEhC,QAAQ,CAAC;QAAEoC,IAAI,EAAEC;MAAQ,CAAC,CAAC;MAAAH,GAAA;MAAAC,KAAA,WAAAA,MAAA;QAAA,OAAmB,KAAK;MAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAEnD9B,KAAK,CAAC,CAAC;MAAAgC,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAEP/B,KAAK,CAAC,QAAQ,CAAC;MAAAiC,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAEf/B,KAAK,CAAC,gBAAgB,EAAE,IAAI,CAAC;MAAAiC,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAG,GAAA;MAAAC,KAAA,WAAAA,MAAA;QAAA,OAEZ,KAAK;MAAA;IAAA;MAAAJ,IAAA;MAAAG,GAAA;MAAAC,KAAA;MAhCvB;AACF;AACA;AACA;AACA;;MAIE;AACF;AACA;AACA;AACA;;MAsBE,SAAAI,OAAA,EAAmB;QACjB,IAAI,IAAI,CAACC,QAAQ,EAAE;UACjB,OAAO7C,IAAI,CAAA8C,eAAA,KAAAA,eAAA,GAAAC,sBAAA,oBAAI,IAAI,CAACC,YAAY,CAAC,CAAC,EAAI,IAAI,CAACC,YAAY,CAAC,CAAC;QAC3D;QACA,OAAOjD,IAAI,CAAAkD,gBAAA,KAAAA,gBAAA,GAAAH,sBAAA,oBAAI,IAAI,CAACE,YAAY,CAAC,CAAC,EAAI,IAAI,CAACD,YAAY,CAAC,CAAC;MAC3D;IAAC;MAAAZ,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAS,aAAA,EAAuB;QAAA,IAAAE,WAAA;UAAAC,MAAA;UAAAC,YAAA;UAAAC,YAAA;QACrB,OAAOtD,IAAI,CAAAuD,gBAAA,KAAAA,gBAAA,GAAAR,sBAAA,iHAEL,CAAAI,WAAA,OAAI,CAACX,KAAK,cAAAW,WAAA,eAAVA,WAAA,CAAYK,OAAO,GACjB/C,WAAW,CAAC,IAAI,CAAC+B,KAAK,CAACgB,OAAO,CAAC,CAACC,GAAG,CAAC,UAACD,OAAO,EAAK;UAC/C,IAAME,IAAI,GAAGN,MAAI,CAACO,IAAI,CAACC,KAAK,CAAEJ,OAAO,CAAC;UACtC,OAAOJ,MAAI,CAACS,WAAW,CACrB,SAAS,EACTL,OAAO,EACP,CAAAE,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEI,IAAI,KAAIN,OAAO,EACrBO,SAAS,EACTL,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEM,IAAI,EACVnE,OACF,CAAC;QACH,CAAC,CAAC,GACF,EAAE,EACJ,CAAAwD,YAAA,OAAI,CAACb,KAAK,cAAAa,YAAA,eAAVA,YAAA,CAAYY,SAAS,GACnBxD,WAAW,CAAC,IAAI,CAAC+B,KAAK,CAACyB,SAAS,CAAC,CAACR,GAAG,CAAC,UAACQ,SAAS,EAAK;UACnD,IAAMC,MAAM,GAAGd,MAAI,CAACO,IAAI,CAACQ,OAAO,CAAEF,SAAS,CAAC;UAC5C,OAAOb,MAAI,CAACS,WAAW,CACrB,WAAW,EACXI,SAAS,EACTC,MAAM,GAAGnD,iBAAiB,CAACmD,MAAM,EAAEd,MAAI,CAACO,IAAI,CAAC,GAAGM,SAAS,EACzDF,SAAS,EACTA,SAAS,EACTpE,UACF,CAAC;QACH,CAAC,CAAC,GACF,EAAE,EACJ,CAAA2D,YAAA,OAAI,CAACd,KAAK,cAAAc,YAAA,eAAVA,YAAA,CAAYc,SAAS,GACnB3D,WAAW,CAAC,IAAI,CAAC+B,KAAK,CAAC4B,SAAS,CAAC,CAACX,GAAG,CAAC,UAACW,SAAS,EAAK;UACnD,IAAMC,MAAM,GAAGjB,MAAI,CAACO,IAAI,CAACW,MAAM,CAACF,SAAS,CAAC;UAC1C,OAAOhB,MAAI,CAACS,WAAW,CACrB,WAAW,EACXO,SAAS,EACTC,MAAM,GAAGxD,gBAAgB,CAACwD,MAAM,CAAC,GAAGD,SAAS,EAC7CC,MACF,CAAC;QACH,CAAC,CAAC,GACF,EAAE;MAGZ;IAAC;MAAAjC,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAQ,aAAA,EAAuB;QACrB,OAAOhD,IAAI,CAAAuE,gBAAA,KAAAA,gBAAA,GAAAxB,sBAAA,wxDAIG,SAAS,EACR,IAAI,CAACyB,WAAW,EAKf5E,OAAO,EAKR,IAAI,CAAC+D,IAAI,CAACc,QAAQ,CACnB,yCACF,CAAC,EAOC,WAAW,EACV,IAAI,CAACD,WAAW,EAKf5E,OAAO,EAKR,IAAI,CAAC+D,IAAI,CAACc,QAAQ,CACnB,2CACF,CAAC,EAOC,WAAW,EACV,IAAI,CAACD,WAAW,EAKf5E,OAAO,EAKR,IAAI,CAAC+D,IAAI,CAACc,QAAQ,CACnB,2CACF,CAAC,EAKP,IAAI,CAACC,aAAa,CAAC,CAAC,EAEtB,IAAI,CAACC,MAAM,GACT3E,IAAI,CAAA4E,gBAAA,KAAAA,gBAAA,GAAA7B,sBAAA,0DAAyB,IAAI,CAAC4B,MAAM,IACxC,EAAE;MAEV;IAAC;MAAAvC,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAgC,YAAoBK,EAAE,EAAE;QACtB,IAAI,CAACC,QAAQ,GAAGD,EAAE,CAACE,aAAa,CAACtC,IAAI;MACvC;IAAC;MAAAL,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAqB,YACEpB,IAA2C,EAC3CuC,EAAU,EACVlB,IAAY,EACZmB,WAAwB,EACxBjB,IAAoB,EACpBkB,gBAAyB,EACzB;QACA,OAAOlF,IAAI,CAAAmF,gBAAA,KAAAA,gBAAA,GAAApC,sBAAA,4uBAEWvC,QAAQ,CAAA4E,eAAA,KACvB3C,IAAI,EAAG,IAAI,CACb,CAAC,EAEAuB,IAAI,GACFhE,IAAI,CAAAqF,gBAAA,KAAAA,gBAAA,GAAAtC,sBAAA,oIAEMiB,IAAI,IAEdkB,gBAAgB,GACdlF,IAAI,CAAAsF,gBAAA,KAAAA,gBAAA,GAAAvC,sBAAA,kJAEMmC,gBAAgB,IAE1B,EAAE,EACND,WAAW,GACTjF,IAAI,CAAAuF,gBAAA,KAAAA,gBAAA,GAAAxC,sBAAA,8KAEM,IAAI,CAACY,IAAI,EACLsB,WAAW,IAEzB,EAAE,EAG6BnB,IAAI,EAGrCrB,IAAI,KAAK,WAAW,GAClB,EAAE,GACFzC,IAAI,CAAAwF,iBAAA,KAAAA,iBAAA,GAAAzC,sBAAA,4eAGS,IAAI,CAACY,IAAI,CAACc,QAAQ,CACzB,oCACF,CAAC,EACO3E,qBAAqB,EAEvBkF,EAAE,EACAvC,IAAI,EACH,IAAI,CAACgD,aAAa,EAGxB,IAAI,CAAC9B,IAAI,CAACc,QAAQ,uCAAA1C,MAAA,CACmBU,IAAI,CAC5C,CAAC,CAEG,EAIC,IAAI,CAACkB,IAAI,CAACc,QAAQ,CAAC,oCAAoC,CAAC,EACzD/E,QAAQ,EAEVsF,EAAE,EACAvC,IAAI,EACH,IAAI,CAACiD,aAAa,EAGxB,IAAI,CAAC/B,IAAI,CAACc,QAAQ,uCAAA1C,MAAA,CACmBU,IAAI,CAC5C,CAAC;MAKX;IAAC;MAAAL,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAkC,cAAA,EAAwB;QAAA,IAAAiB,YAAA,EAAAC,YAAA,EAAAC,YAAA;QACtB,IAAI,CAAC,IAAI,CAACf,QAAQ,EAAE;UAClB,OAAO5E,OAAO;QAChB;QACA,OAAOF,IAAI,CAAA8F,iBAAA,KAAAA,iBAAA,GAAA/C,sBAAA,uLAEC,IAAI,CAACgD,aAAa,EAClB,IAAI,CAACC,SAAS,EACd,IAAI,CAACC,SAAS,EACN,IAAI,CAACC,cAAc,EAC5BvF,eAAe,EACrB,IAAI,CAACmE,QAAQ,KAAK,SAAS,GAC1B9E,IAAI,CAAAmG,iBAAA,KAAAA,iBAAA,GAAApD,sBAAA,qcAEQ,IAAI,CAACY,IAAI,EAET,SAAS,EACR,IAAI,CAACA,IAAI,CAACc,QAAQ,CACzB,yCACF,CAAC,EAEe,IAAI,CAAC2B,YAAY,EACjB,IAAI,CAACC,YAAY,EACT,IAAI,CAACC,oBAAoB,EAC/B,IAAI,CAACC,cAAc,EACrB9F,WAAW,EAAAkF,YAAA,GAAC,IAAI,CAACnD,KAAK,cAAAmD,YAAA,uBAAVA,YAAA,CAAYnC,OAAO,CAAC,EAC/B,IAAI,CAACgD,aAAa,EAC1B,IAAI,CAACC,eAAe,IAGjC,IAAI,CAAC3B,QAAQ,KAAK,WAAW,GAC3B9E,IAAI,CAAA0G,iBAAA,KAAAA,iBAAA,GAAA3D,sBAAA,idAEQ,IAAI,CAACY,IAAI,EAET,WAAW,EACV,IAAI,CAACA,IAAI,CAACc,QAAQ,CACzB,2CACF,CAAC,EACe,IAAI,CAAC2B,YAAY,EACjB,IAAI,CAACC,YAAY,EACT,IAAI,CAACC,oBAAoB,EAC/B,IAAI,CAACC,cAAc,EACnB9F,WAAW,EAAAmF,YAAA,GAAC,IAAI,CAACpD,KAAK,cAAAoD,YAAA,uBAAVA,YAAA,CAAY3B,SAAS,CAAC,EACnC,IAAI,CAACuC,aAAa,EAC1B,IAAI,CAACC,eAAe,IAGjCzG,IAAI,CAAA2G,iBAAA,KAAAA,iBAAA,GAAA5D,sBAAA,mdAEQ,IAAI,CAACY,IAAI,EAET,WAAW,EACV,IAAI,CAACA,IAAI,CAACc,QAAQ,CACzB,2CACF,CAAC,EACe,IAAI,CAAC4B,YAAY,EACT,IAAI,CAACC,oBAAoB,EAC/B,IAAI,CAACC,cAAc,EAClB9F,WAAW,EAAAoF,YAAA,GAAC,IAAI,CAACrD,KAAK,cAAAqD,YAAA,uBAAVA,YAAA,CAAYzB,SAAS,CAAC,EACpC,IAAI,CAACoC,aAAa,EAC1B,IAAI,CAACC,eAAe,CAGhC;MAEX;IAAC;MAAArE,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAgE,cAAsB3B,EAAE,EAAE;QACxBA,EAAE,CAAClE,eAAe,CAAC,CAAC;QACpB,IAAI,CAACkE,EAAE,CAAC+B,MAAM,CAACpE,KAAK,EAAE;UACpB;QACF;QACA,IAAMA,KAAK,GAAGqC,EAAE,CAAC+B,MAAM,CAACpE,KAAK;QAC7B,IAAMqE,MAAM,GAAGhC,EAAE,CAACE,aAAa;QAE/B,IAAI8B,MAAM,CAACpE,IAAI,KAAK,WAAW,IAAI,CAAC3B,eAAe,CAAC0B,KAAK,CAAC,EAAE;UAC1D;QACF;QAEAqE,MAAM,CAACrE,KAAK,GAAG,EAAE;QACjB,IACE,IAAI,CAACA,KAAK,IACV,IAAI,CAACA,KAAK,CAACqE,MAAM,CAACpE,IAAI,CAAC,IACvBhC,WAAW,CAAC,IAAI,CAAC+B,KAAK,CAACqE,MAAM,CAACpE,IAAI,CAAC,CAAC,CAACqE,QAAQ,CAACtE,KAAK,CAAC,EACpD;UACA;QACF;QACA9B,SAAS,CAAC,IAAI,EAAE,eAAe,EAAE;UAC/B8B,KAAK,EAAE,IAAI,CAACA,KAAK,GAAAuE,MAAA,CAAAC,MAAA,CAAAD,MAAA,CAAAC,MAAA,KAER,IAAI,CAACxE,KAAK,OAAA4C,eAAA,KACZyB,MAAM,CAACpE,IAAI,EAAG,IAAI,CAACD,KAAK,CAACqE,MAAM,CAACpE,IAAI,CAAC,MAAAV,MAAA,CAAAkF,kBAAA,CAC9BxG,WAAW,CAAC,IAAI,CAAC+B,KAAK,CAACqE,MAAM,CAACpE,IAAI,CAAC,CAAC,IAAED,KAAK,KAC/CA,KAAK,KAAA4C,eAAA,KAERyB,MAAM,CAACpE,IAAI,EAAGD,KAAK;QAC5B,CAAC,CAAC;MACJ;IAAC;MAAAJ,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAiD,cAAsBZ,EAAE,EAAE;QAAA,IAAAqC,MAAA;QACxB,IAAML,MAAM,GAAGhC,EAAE,CAACE,aAAoB;QACtC,IAAMoC,UAAoB,GAAG,EAAE;QAC/B,IAAMC,WAAqB,GAAG,EAAE;QAChC,IAAIP,MAAM,CAACpE,IAAI,KAAK,SAAS,EAAE;UAC7BsE,MAAM,CAACM,MAAM,CAAC,IAAI,CAAC1D,IAAI,CAACQ,OAAO,CAAC,CAACmD,OAAO,CAAC,UAACpD,MAAM,EAAK;YAAA,IAAAqD,UAAA;YACnD,IACErD,MAAM,CAACV,OAAO,KAAKqD,MAAM,CAAC7B,EAAE,IAC5B,GAAAuC,UAAA,GAACL,MAAI,CAAC1E,KAAK,CAAEyB,SAAS,cAAAsD,UAAA,eAArBA,UAAA,CAAuBT,QAAQ,CAAC5C,MAAM,CAACc,EAAE,CAAC,KAC3CkC,MAAI,CAACM,kBAAkB,CAACtD,MAAM,CAAC,EAC/B;cACAiD,UAAU,CAACM,IAAI,CAACvD,MAAM,CAACc,EAAE,CAAC;YAC5B;UACF,CAAC,CAAC;UACF+B,MAAM,CAACM,MAAM,CAAC,IAAI,CAAC1D,IAAI,CAAC+D,QAAQ,CAAC,CAACJ,OAAO,CAAC,UAACjD,MAAM,EAAK;YAAA,IAAAsD,UAAA;YACpD,IACEtD,MAAM,CAACb,OAAO,KAAKqD,MAAM,CAAC7B,EAAE,IAC5B,GAAA2C,UAAA,GAACT,MAAI,CAAC1E,KAAK,CAAE4B,SAAS,cAAAuD,UAAA,eAArBA,UAAA,CAAuBb,QAAQ,CAACzC,MAAM,CAACD,SAAS,CAAC,KAClD8C,MAAI,CAACU,qBAAqB,CAACvD,MAAM,CAAC,EAClC;cACA+C,WAAW,CAACK,IAAI,CAACpD,MAAM,CAACD,SAAS,CAAC;YACpC;UACF,CAAC,CAAC;QACJ,CAAC,MAAM,IAAIyC,MAAM,CAACpE,IAAI,KAAK,WAAW,EAAE;UACtCsE,MAAM,CAACM,MAAM,CAAC,IAAI,CAAC1D,IAAI,CAAC+D,QAAQ,CAAC,CAACJ,OAAO,CAAC,UAACjD,MAAM,EAAK;YAAA,IAAAwD,WAAA;YACpD,IACExD,MAAM,CAACJ,SAAS,KAAK4C,MAAM,CAAC7B,EAAE,IAC9B,GAAA6C,WAAA,GAACX,MAAI,CAAC1E,KAAK,CAAE4B,SAAS,cAAAyD,WAAA,eAArBA,WAAA,CAAuBf,QAAQ,CAACzC,MAAM,CAACD,SAAS,CAAC,KAClD8C,MAAI,CAACU,qBAAqB,CAACvD,MAAM,CAAC,EAClC;cACA+C,WAAW,CAACK,IAAI,CAACpD,MAAM,CAACD,SAAS,CAAC;YACpC;UACF,CAAC,CAAC;QACJ,CAAC,MAAM;UACL;QACF;QACA,IAAI5B,KAAK,GAAG,IAAI,CAACA,KAAK;QACtB,IAAI4E,WAAW,CAAC1F,MAAM,EAAE;UACtBc,KAAK,GAAG,IAAI,CAACsF,SAAS,CAACtF,KAAK,EAAE,WAAW,EAAE4E,WAAW,CAAC;QACzD;QACA,IAAID,UAAU,CAACzF,MAAM,EAAE;UACrBc,KAAK,GAAG,IAAI,CAACsF,SAAS,CAACtF,KAAK,EAAE,WAAW,EAAE2E,UAAU,CAAC;QACxD;QACA3E,KAAK,GAAG,IAAI,CAACuF,WAAW,CAACvF,KAAK,EAAEqE,MAAM,CAACpE,IAAI,EAAEoE,MAAM,CAAC7B,EAAE,CAAC;QACvDtE,SAAS,CAAC,IAAI,EAAE,eAAe,EAAE;UAAE8B,KAAK,EAALA;QAAM,CAAC,CAAC;MAC7C;IAAC;MAAAJ,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAkD,cAAsBb,EAAE,EAAE;QACxB,IAAMgC,MAAM,GAAGhC,EAAE,CAACE,aAAoB;QACtCrE,SAAS,CAAC,IAAI,EAAE,eAAe,EAAE;UAC/B8B,KAAK,EAAE,IAAI,CAACuF,WAAW,CAAC,IAAI,CAACvF,KAAK,EAAEqE,MAAM,CAACpE,IAAI,EAAEoE,MAAM,CAAC7B,EAAE;QAC5D,CAAC,CAAC;MACJ;IAAC;MAAA5C,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAsF,UACEtF,KAAoB,EACpBC,IAAY,EACZuF,GAAa,EACE;QACf,OAAAjB,MAAA,CAAAC,MAAA,CAAAD,MAAA,CAAAC,MAAA,KACKxE,KAAK,OAAA4C,eAAA,KACP3C,IAAI,EAAGD,KAAK,CAAEC,IAAI,CAAC,GAAGhC,WAAW,CAAC+B,KAAK,CAAEC,IAAI,CAAC,CAAC,CAAEV,MAAM,CAACiG,GAAG,CAAC,GAAGA,GAAG;MAEvE;IAAC;MAAA5F,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAuF,YACEvF,KAAoB,EACpBC,IAAY,EACZuC,EAAU,EACK;QACf,IAAMiD,MAAM,GAAGxH,WAAW,CAAC+B,KAAK,CAAEC,IAAI,CAAC,CAAC,CAAEyF,MAAM,CAC9C,UAACC,GAAG;UAAA,OAAKC,MAAM,CAACD,GAAG,CAAC,KAAKnD,EAAE;QAAA,CAC7B,CAAC;QACD,IAAIiD,MAAM,CAACvG,MAAM,EAAE;UACjB,OAAAqF,MAAA,CAAAC,MAAA,CAAAD,MAAA,CAAAC,MAAA,KACKxE,KAAK,OAAA4C,eAAA,KACP3C,IAAI,EAAGwF,MAAM;QAElB;QACA,IAAME,GAAG,GAAApB,MAAA,CAAAC,MAAA,KAAQxE,KAAK,CAAG;QACzB,OAAO2F,GAAG,CAAC1F,IAAI,CAAC;QAChB,IAAIsE,MAAM,CAACsB,IAAI,CAACF,GAAG,CAAC,CAACzG,MAAM,EAAE;UAC3B,OAAOyG,GAAG;QACZ;QACA,OAAOpE,SAAS;MAClB;IAAC;MAAA3B,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAwD,UAAkBnB,EAAE,EAAE;QACpBA,EAAE,CAAClE,eAAe,CAAC,CAAC;QACpBkE,EAAE,CAACgC,MAAM,CAACyB,IAAI,GAAG,IAAI;MACvB;IAAC;MAAAlG,IAAA;MAAAG,GAAA;MAAAC,KAAA;QAAA,IAAA+F,UAAA,GAAAC,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAED,SAAAC,QAAA;UAAA,IAAAC,mBAAA,EAAAC,oBAAA;UAAA,OAAAJ,mBAAA,GAAAK,IAAA,UAAAC,SAAAC,QAAA;YAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;cAAA;gBAAA,IACO,IAAI,CAACpE,QAAQ;kBAAAkE,QAAA,CAAAE,IAAA;kBAAA;gBAAA;gBAAA,OAAAF,QAAA,CAAAG,MAAA;cAAA;gBAAAH,QAAA,CAAAE,IAAA;gBAAA,QAAAN,mBAAA,GAGZ,IAAI,CAACQ,aAAa,cAAAR,mBAAA,uBAAlBA,mBAAA,CAAoBS,KAAK,CAAC,CAAC;cAAA;gBAAAL,QAAA,CAAAE,IAAA;gBAAA,QAAAL,oBAAA,GAC3B,IAAI,CAACO,aAAa,cAAAP,oBAAA,uBAAlBA,oBAAA,CAAoBP,IAAI,CAAC,CAAC;cAAA;gBAChC,IAAI,CAACgB,OAAO,GAAG,IAAI;cAAC;cAAA;gBAAA,OAAAN,QAAA,CAAAO,IAAA;YAAA;UAAA,GAAAZ,OAAA;QAAA,CACrB;QAAA,SAAA1C,UAAA;UAAA,OAAAsC,UAAA,CAAAiB,KAAA,OAAA/H,SAAA;QAAA;QAAA,OAAAwE,SAAA;MAAA;IAAA;MAAA7D,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAA0D,eAAuBrB,EAAmC,EAAE;QAC1D,IAAI,IAAI,CAACyE,OAAO,IAAI,CAACzE,EAAE,CAAC+B,MAAM,CAACpE,KAAK,EAAE;UACpC,IAAI,CAAC8G,OAAO,GAAG,KAAK;UACpB,IAAI,CAACxE,QAAQ,GAAGf,SAAS;QAC3B;MACF;IAAC;MAAA3B,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAiE,gBAAwB5B,EAAS,EAAE;QACjCA,EAAE,CAAC4E,cAAc,CAAC,CAAC;MACrB;IAAC;MAAArH,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAgF,mBAA2BtD,MAA2B,EAAW;QAAA,IAAAwF,MAAA;QAC/D,IAAMC,WAAW,GAAG5C,MAAM,CAACM,MAAM,CAAC,IAAI,CAAC1D,IAAI,CAAC+D,QAAQ,CAAC,CAACQ,MAAM,CAC1D,UAAC7D,MAAM;UAAA,OAAKA,MAAM,CAACJ,SAAS,KAAKC,MAAM,CAACc,EAAE;QAAA,CAC5C,CAAC;QAED,IAAI,IAAI,CAACuB,cAAc,EAAE;UACvB,IAAI,CAACoD,WAAW,IAAI,CAACA,WAAW,CAACjI,MAAM,EAAE;YACvC,OAAO,KAAK;UACd;UACA,IACE,CAACiI,WAAW,CAACC,IAAI,CAAC,UAACvF,MAAM;YAAA,OACvBqF,MAAI,CAACnD,cAAc,CAAEO,QAAQ,CAAClG,aAAa,CAACyD,MAAM,CAACD,SAAS,CAAC,CAAC;UAAA,CAChE,CAAC,EACD;YACA,OAAO,KAAK;UACd;QACF;QAEA,IAAI,IAAI,CAACkC,oBAAoB,EAAE;UAC7B,IAAI,CAACqD,WAAW,IAAI,CAACA,WAAW,CAACjI,MAAM,EAAE;YACvC,OAAO,KAAK;UACd;UACA,IACE,CAACiI,WAAW,CAACC,IAAI,CAAC,UAACvF,MAAM,EAAK;YAC5B,IAAMwF,QAAQ,GAAGH,MAAI,CAAC/F,IAAI,CAACW,MAAM,CAACD,MAAM,CAACD,SAAS,CAAC;YACnD,IAAI,CAACyF,QAAQ,EAAE;cACb,OAAO,KAAK;YACd;YACA,OACEA,QAAQ,CAACC,UAAU,CAACC,YAAY,IAChCL,MAAI,CAACpD,oBAAoB,CAAEQ,QAAQ,CACjC+C,QAAQ,CAACC,UAAU,CAACC,YACtB,CAAC;UAEL,CAAC,CAAC,EACF;YACA,OAAO,KAAK;UACd;QACF;QAEA,IAAI,IAAI,CAAC3D,YAAY,EAAE;UACrB,IAAI,CAAC,IAAI,CAACA,YAAY,CAAClC,MAAM,CAAC,EAAE;YAC9B,OAAO,KAAK;UACd;QACF;QAEA,IAAI,IAAI,CAACmC,YAAY,EAAE;UACrB,IACE,CAACsD,WAAW,CAACC,IAAI,CAAC,UAACvF,MAAM,EAAK;YAC5B,IAAMwF,QAAQ,GAAGH,MAAI,CAAC/F,IAAI,CAACW,MAAM,CAACD,MAAM,CAACD,SAAS,CAAC;YACnD,IAAI,CAACyF,QAAQ,EAAE;cACb,OAAO,KAAK;YACd;YACA,OAAOH,MAAI,CAACrD,YAAY,CAAEwD,QAAQ,CAAC;UACrC,CAAC,CAAC,EACF;YACA,OAAO,KAAK;UACd;QACF;QACA,OAAO,IAAI;MACb;IAAC;MAAAzH,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAoF,sBAA8BvD,MAAkC,EAAW;QACzE,IAAIA,MAAM,CAAC2F,eAAe,EAAE;UAC1B,OAAO,KAAK;QACd;QAEA,IACE,IAAI,CAACzD,cAAc,IACnB,CAAC,IAAI,CAACA,cAAc,CAACO,QAAQ,CAAClG,aAAa,CAACyD,MAAM,CAACD,SAAS,CAAC,CAAC,EAC9D;UACA,OAAO,KAAK;QACd;QACA,IAAI,IAAI,CAACkC,oBAAoB,EAAE;UAC7B,IAAMuD,QAAQ,GAAG,IAAI,CAAClG,IAAI,CAACW,MAAM,CAACD,MAAM,CAACD,SAAS,CAAC;UACnD,IAAI,CAACyF,QAAQ,EAAE;YACb,OAAO,KAAK;UACd;UACA,IACE,CAACA,QAAQ,CAACC,UAAU,CAACC,YAAY,IACjC,CAAC,IAAI,CAACzD,oBAAoB,CAAEQ,QAAQ,CAAC+C,QAAQ,CAACC,UAAU,CAACC,YAAY,CAAC,EACtE;YACA,OAAO,KAAK;UACd;QACF;QAEA,IAAI,IAAI,CAAC1D,YAAY,EAAE;UACrB,IAAMwD,SAAQ,GAAG,IAAI,CAAClG,IAAI,CAACW,MAAM,CAACD,MAAM,CAACD,SAAS,CAAC;UACnD,IAAI,CAACyF,SAAQ,EAAE;YACb,OAAO,KAAK;UACd;UACA,IAAI,CAAC,IAAI,CAACxD,YAAY,CAAEwD,SAAQ,CAAC,EAAE;YACjC,OAAO,KAAK;UACd;QACF;QACA,OAAO,IAAI;MACb;IAAC;MAAAzH,IAAA;MAAA6H,MAAA;MAAA1H,GAAA;MAAAC,KAAA,EAED,SAAA0H,OAAA,EAAoC;QAClC,OAAOnK,GAAG,CAAAoK,iBAAA,KAAAA,iBAAA,GAAApH,sBAAA,4uFACN5C,SAAS,CAACV,UAAU,CAAC;MAoG3B;IAAC;EAAA;AAAA,GAlpBiCQ,UAAU"},"metadata":{},"sourceType":"module","externalDependencies":[]}