{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/helpers/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.url.js\";\nimport \"core-js/modules/web.url-search-params.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nexport var AudioRecorder = /*#__PURE__*/function () {\n  function AudioRecorder(callback) {\n    _classCallCheck(this, AudioRecorder);\n    this._active = false;\n    this._callback = void 0;\n    this._context = void 0;\n    this._stream = void 0;\n    this._source = void 0;\n    this._recorder = void 0;\n    this._callback = callback;\n  }\n  _createClass(AudioRecorder, [{\n    key: \"active\",\n    get: function get() {\n      return this._active;\n    }\n  }, {\n    key: \"sampleRate\",\n    get: function get() {\n      var _this$_context;\n      return (_this$_context = this._context) === null || _this$_context === void 0 ? void 0 : _this$_context.sampleRate;\n    }\n  }, {\n    key: \"start\",\n    value: function () {\n      var _start = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (!(!this._context || !this._stream || !this._source || !this._recorder)) {\n                _context.next = 12;\n                break;\n              }\n              _context.prev = 1;\n              _context.next = 4;\n              return this._createContext();\n            case 4:\n              _context.next = 10;\n              break;\n            case 6:\n              _context.prev = 6;\n              _context.t0 = _context[\"catch\"](1);\n              // eslint-disable-next-line no-console\n              console.error(_context.t0);\n              this._active = false;\n            case 10:\n              _context.next = 16;\n              break;\n            case 12:\n              this._stream.getTracks()[0].enabled = true;\n              _context.next = 15;\n              return this._context.resume();\n            case 15:\n              this._active = true;\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this, [[1, 6]]);\n      }));\n      function start() {\n        return _start.apply(this, arguments);\n      }\n      return start;\n    }()\n  }, {\n    key: \"stop\",\n    value: function () {\n      var _stop = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var _this$_context2;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              this._active = false;\n              if (this._stream) {\n                this._stream.getTracks()[0].enabled = false;\n              }\n              _context2.next = 4;\n              return (_this$_context2 = this._context) === null || _this$_context2 === void 0 ? void 0 : _this$_context2.suspend();\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function stop() {\n        return _stop.apply(this, arguments);\n      }\n      return stop;\n    }()\n  }, {\n    key: \"close\",\n    value: function close() {\n      var _this$_stream, _this$_source, _this$_context3;\n      this._active = false;\n      (_this$_stream = this._stream) === null || _this$_stream === void 0 || _this$_stream.getTracks()[0].stop();\n      if (this._recorder) {\n        this._recorder.port.onmessage = null;\n      }\n      (_this$_source = this._source) === null || _this$_source === void 0 || _this$_source.disconnect();\n      (_this$_context3 = this._context) === null || _this$_context3 === void 0 || _this$_context3.close();\n      this._stream = undefined;\n      this._source = undefined;\n      this._recorder = undefined;\n      this._context = undefined;\n    }\n  }, {\n    key: \"_createContext\",\n    value: function () {\n      var _createContext2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var _this = this;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              // @ts-ignore-next-line\n              this._context = new (window.AudioContext || window.webkitAudioContext)();\n              _context3.next = 3;\n              return navigator.mediaDevices.getUserMedia({\n                audio: true\n              });\n            case 3:\n              this._stream = _context3.sent;\n              _context3.next = 6;\n              return this._context.audioWorklet.addModule(new URL(\"./recorder.worklet.js\", import.meta.url));\n            case 6:\n              this._source = this._context.createMediaStreamSource(this._stream);\n              this._recorder = new AudioWorkletNode(this._context, \"recorder.worklet\");\n              this._recorder.port.onmessage = function (e) {\n                if (!_this._active) {\n                  return;\n                }\n                _this._callback(e.data);\n              };\n              this._active = true;\n              this._source.connect(this._recorder);\n            case 11:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function _createContext() {\n        return _createContext2.apply(this, arguments);\n      }\n      return _createContext;\n    }()\n  }], [{\n    key: \"isSupported\",\n    get: function get() {\n      return window.isSecureContext && (\n      // @ts-ignore-next-line\n      window.AudioContext || window.webkitAudioContext);\n    }\n  }]);\n  return AudioRecorder;\n}();","map":{"version":3,"names":["AudioRecorder","callback","_classCallCheck","_active","_callback","_context","_stream","_source","_recorder","_createClass","key","get","_this$_context","sampleRate","value","_start","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","prev","next","_createContext","t0","console","error","getTracks","enabled","resume","stop","start","apply","arguments","_stop","_callee2","_this$_context2","_callee2$","_context2","suspend","close","_this$_stream","_this$_source","_this$_context3","port","onmessage","disconnect","undefined","_createContext2","_callee3","_this","_callee3$","_context3","window","AudioContext","webkitAudioContext","navigator","mediaDevices","getUserMedia","audio","sent","audioWorklet","addModule","URL","import","meta","url","createMediaStreamSource","AudioWorkletNode","e","data","connect","isSecureContext"],"sources":["/workspaces/frontend/src/util/audio-recorder.ts"],"sourcesContent":["export class AudioRecorder {\n  private _active = false;\n\n  private _callback: (data: Int16Array) => void;\n\n  private _context: AudioContext | undefined;\n\n  private _stream: MediaStream | undefined;\n\n  private _source: MediaStreamAudioSourceNode | undefined;\n\n  private _recorder: AudioWorkletNode | undefined;\n\n  constructor(callback: (data: Int16Array) => void) {\n    this._callback = callback;\n  }\n\n  public get active() {\n    return this._active;\n  }\n\n  public get sampleRate() {\n    return this._context?.sampleRate;\n  }\n\n  public static get isSupported() {\n    return (\n      window.isSecureContext &&\n      // @ts-ignore-next-line\n      (window.AudioContext || window.webkitAudioContext)\n    );\n  }\n\n  public async start() {\n    if (!this._context || !this._stream || !this._source || !this._recorder) {\n      try {\n        await this._createContext();\n      } catch (err) {\n        // eslint-disable-next-line no-console\n        console.error(err);\n        this._active = false;\n      }\n    } else {\n      this._stream.getTracks()[0].enabled = true;\n      await this._context.resume();\n      this._active = true;\n    }\n  }\n\n  public async stop() {\n    this._active = false;\n    if (this._stream) {\n      this._stream.getTracks()[0].enabled = false;\n    }\n    await this._context?.suspend();\n  }\n\n  public close() {\n    this._active = false;\n    this._stream?.getTracks()[0].stop();\n    if (this._recorder) {\n      this._recorder.port.onmessage = null;\n    }\n    this._source?.disconnect();\n    this._context?.close();\n    this._stream = undefined;\n    this._source = undefined;\n    this._recorder = undefined;\n    this._context = undefined;\n  }\n\n  private async _createContext() {\n    // @ts-ignore-next-line\n    this._context = new (window.AudioContext || window.webkitAudioContext)();\n    this._stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\n    await this._context.audioWorklet.addModule(\n      new URL(\"./recorder.worklet.js\", import.meta.url)\n    );\n\n    this._source = this._context.createMediaStreamSource(this._stream);\n    this._recorder = new AudioWorkletNode(this._context, \"recorder.worklet\");\n\n    this._recorder.port.onmessage = (e) => {\n      if (!this._active) {\n        return;\n      }\n      this._callback(e.data);\n    };\n    this._active = true;\n    this._source.connect(this._recorder);\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}