{"ast":null,"code":"import \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.object.assign.js\";\nimport durationToSeconds from \"../common/datetime/duration_to_seconds\";\nimport secondsToDuration from \"../common/datetime/seconds_to_duration\";\nexport var fetchTimer = function fetchTimer(hass) {\n  return hass.callWS({\n    type: \"timer/list\"\n  });\n};\nexport var createTimer = function createTimer(hass, values) {\n  return hass.callWS(Object.assign({\n    type: \"timer/create\"\n  }, values));\n};\nexport var updateTimer = function updateTimer(hass, id, updates) {\n  return hass.callWS(Object.assign({\n    type: \"timer/update\",\n    timer_id: id\n  }, updates));\n};\nexport var deleteTimer = function deleteTimer(hass, id) {\n  return hass.callWS({\n    type: \"timer/delete\",\n    timer_id: id\n  });\n};\nexport var timerTimeRemaining = function timerTimeRemaining(stateObj) {\n  if (!stateObj.attributes.remaining) {\n    return undefined;\n  }\n  var timeRemaining = durationToSeconds(stateObj.attributes.remaining);\n  if (stateObj.state === \"active\") {\n    var now = new Date().getTime();\n    var madeActive = new Date(stateObj.last_changed).getTime();\n    timeRemaining = Math.max(timeRemaining - (now - madeActive) / 1000, 0);\n  }\n  return timeRemaining;\n};\nexport var computeDisplayTimer = function computeDisplayTimer(hass, stateObj, timeRemaining) {\n  if (!stateObj) {\n    return null;\n  }\n  if (stateObj.state === \"idle\" || timeRemaining === 0) {\n    return hass.formatEntityState(stateObj);\n  }\n  var display = secondsToDuration(timeRemaining || 0);\n  if (stateObj.state === \"paused\") {\n    display = \"\".concat(display, \" (\").concat(hass.formatEntityState(stateObj), \")\");\n  }\n  return display;\n};","map":{"version":3,"names":["durationToSeconds","secondsToDuration","fetchTimer","hass","callWS","type","createTimer","values","Object","assign","updateTimer","id","updates","timer_id","deleteTimer","timerTimeRemaining","stateObj","attributes","remaining","undefined","timeRemaining","state","now","Date","getTime","madeActive","last_changed","Math","max","computeDisplayTimer","formatEntityState","display","concat"],"sources":["/workspaces/frontend/src/data/timer.ts"],"sourcesContent":["import {\n  HassEntity,\n  HassEntityAttributeBase,\n  HassEntityBase,\n} from \"home-assistant-js-websocket\";\nimport durationToSeconds from \"../common/datetime/duration_to_seconds\";\nimport secondsToDuration from \"../common/datetime/seconds_to_duration\";\nimport { HomeAssistant } from \"../types\";\n\nexport type TimerEntity = HassEntityBase & {\n  attributes: HassEntityAttributeBase & {\n    duration: string;\n    remaining: string;\n    restore: boolean;\n  };\n};\n\nexport interface DurationDict {\n  hours?: number | string;\n  minutes?: number | string;\n  seconds?: number | string;\n}\n\nexport interface Timer {\n  id: string;\n  name: string;\n  icon?: string;\n  duration?: string | number | DurationDict;\n  restore?: boolean;\n}\n\nexport interface TimerMutableParams {\n  name: string;\n  icon: string;\n  duration: string | number | DurationDict;\n  restore: boolean;\n}\n\nexport const fetchTimer = (hass: HomeAssistant) =>\n  hass.callWS<Timer[]>({ type: \"timer/list\" });\n\nexport const createTimer = (hass: HomeAssistant, values: TimerMutableParams) =>\n  hass.callWS<Timer>({\n    type: \"timer/create\",\n    ...values,\n  });\n\nexport const updateTimer = (\n  hass: HomeAssistant,\n  id: string,\n  updates: Partial<TimerMutableParams>\n) =>\n  hass.callWS<Timer>({\n    type: \"timer/update\",\n    timer_id: id,\n    ...updates,\n  });\n\nexport const deleteTimer = (hass: HomeAssistant, id: string) =>\n  hass.callWS({\n    type: \"timer/delete\",\n    timer_id: id,\n  });\n\nexport const timerTimeRemaining = (\n  stateObj: HassEntity\n): undefined | number => {\n  if (!stateObj.attributes.remaining) {\n    return undefined;\n  }\n  let timeRemaining = durationToSeconds(stateObj.attributes.remaining);\n\n  if (stateObj.state === \"active\") {\n    const now = new Date().getTime();\n    const madeActive = new Date(stateObj.last_changed).getTime();\n    timeRemaining = Math.max(timeRemaining - (now - madeActive) / 1000, 0);\n  }\n\n  return timeRemaining;\n};\n\nexport const computeDisplayTimer = (\n  hass: HomeAssistant,\n  stateObj: HassEntity,\n  timeRemaining?: number\n): string | null => {\n  if (!stateObj) {\n    return null;\n  }\n\n  if (stateObj.state === \"idle\" || timeRemaining === 0) {\n    return hass.formatEntityState(stateObj);\n  }\n\n  let display = secondsToDuration(timeRemaining || 0);\n\n  if (stateObj.state === \"paused\") {\n    display = `${display} (${hass.formatEntityState(stateObj)})`;\n  }\n\n  return display;\n};\n"],"mappings":";;AAKA,OAAOA,iBAAiB,MAAM,wCAAwC;AACtE,OAAOC,iBAAiB,MAAM,wCAAwC;AAgCtE,OAAO,IAAMC,UAAU,GAAG,SAAbA,UAAUA,CAAIC,IAAmB;EAAA,OAC5CA,IAAI,CAACC,MAAM,CAAU;IAAEC,IAAI,EAAE;EAAa,CAAC,CAAC;AAAA;AAE9C,OAAO,IAAMC,WAAW,GAAG,SAAdA,WAAWA,CAAIH,IAAmB,EAAEI,MAA0B;EAAA,OACzEJ,IAAI,CAACC,MAAM,CAAAI,MAAA,CAAAC,MAAA;IACTJ,IAAI,EAAE;EAAc,GACjBE,MAAM,CACV,CAAC;AAAA;AAEJ,OAAO,IAAMG,WAAW,GAAG,SAAdA,WAAWA,CACtBP,IAAmB,EACnBQ,EAAU,EACVC,OAAoC;EAAA,OAEpCT,IAAI,CAACC,MAAM,CAAAI,MAAA,CAAAC,MAAA;IACTJ,IAAI,EAAE,cAAc;IACpBQ,QAAQ,EAAEF;EAAE,GACTC,OAAO,CACX,CAAC;AAAA;AAEJ,OAAO,IAAME,WAAW,GAAG,SAAdA,WAAWA,CAAIX,IAAmB,EAAEQ,EAAU;EAAA,OACzDR,IAAI,CAACC,MAAM,CAAC;IACVC,IAAI,EAAE,cAAc;IACpBQ,QAAQ,EAAEF;EACZ,CAAC,CAAC;AAAA;AAEJ,OAAO,IAAMI,kBAAkB,GAAG,SAArBA,kBAAkBA,CAC7BC,QAAoB,EACG;EACvB,IAAI,CAACA,QAAQ,CAACC,UAAU,CAACC,SAAS,EAAE;IAClC,OAAOC,SAAS;EAClB;EACA,IAAIC,aAAa,GAAGpB,iBAAiB,CAACgB,QAAQ,CAACC,UAAU,CAACC,SAAS,CAAC;EAEpE,IAAIF,QAAQ,CAACK,KAAK,KAAK,QAAQ,EAAE;IAC/B,IAAMC,GAAG,GAAG,IAAIC,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC;IAChC,IAAMC,UAAU,GAAG,IAAIF,IAAI,CAACP,QAAQ,CAACU,YAAY,CAAC,CAACF,OAAO,CAAC,CAAC;IAC5DJ,aAAa,GAAGO,IAAI,CAACC,GAAG,CAACR,aAAa,GAAG,CAACE,GAAG,GAAGG,UAAU,IAAI,IAAI,EAAE,CAAC,CAAC;EACxE;EAEA,OAAOL,aAAa;AACtB,CAAC;AAED,OAAO,IAAMS,mBAAmB,GAAG,SAAtBA,mBAAmBA,CAC9B1B,IAAmB,EACnBa,QAAoB,EACpBI,aAAsB,EACJ;EAClB,IAAI,CAACJ,QAAQ,EAAE;IACb,OAAO,IAAI;EACb;EAEA,IAAIA,QAAQ,CAACK,KAAK,KAAK,MAAM,IAAID,aAAa,KAAK,CAAC,EAAE;IACpD,OAAOjB,IAAI,CAAC2B,iBAAiB,CAACd,QAAQ,CAAC;EACzC;EAEA,IAAIe,OAAO,GAAG9B,iBAAiB,CAACmB,aAAa,IAAI,CAAC,CAAC;EAEnD,IAAIJ,QAAQ,CAACK,KAAK,KAAK,QAAQ,EAAE;IAC/BU,OAAO,MAAAC,MAAA,CAAMD,OAAO,QAAAC,MAAA,CAAK7B,IAAI,CAAC2B,iBAAiB,CAACd,QAAQ,CAAC,MAAG;EAC9D;EAEA,OAAOe,OAAO;AAChB,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}