{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/helpers/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _callSuper from \"@babel/runtime/helpers/callSuper\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _decorate from \"@babel/runtime/helpers/decorate\";\nimport _get from \"@babel/runtime/helpers/get\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _templateObject;\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.object.assign.js\";\nimport { LitElement, html } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { subscribePreviewTimeDate } from \"../../../data/time_date\";\nimport \"./entity-preview-row\";\nimport { debounce } from \"../../../common/util/debounce\";\nvar FlowPreviewTimeDate = _decorate([customElement(\"flow-preview-time_date\")], function (_initialize, _LitElement) {\n  var FlowPreviewTimeDate = /*#__PURE__*/function (_LitElement2) {\n    _inherits(FlowPreviewTimeDate, _LitElement2);\n    function FlowPreviewTimeDate() {\n      var _this;\n      _classCallCheck(this, FlowPreviewTimeDate);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _callSuper(this, FlowPreviewTimeDate, [].concat(args));\n      _initialize(_assertThisInitialized(_this));\n      return _this;\n    }\n    return _createClass(FlowPreviewTimeDate);\n  }(_LitElement);\n  return {\n    F: FlowPreviewTimeDate,\n    d: [{\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"flowType\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      key: \"handler\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"stepId\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"flowId\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"stepData\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_preview\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      key: \"_unsub\",\n      value: void 0\n    }, {\n      kind: \"method\",\n      key: \"disconnectedCallback\",\n      value: function disconnectedCallback() {\n        _get(_getPrototypeOf(FlowPreviewTimeDate.prototype), \"disconnectedCallback\", this).call(this);\n        if (this._unsub) {\n          this._unsub.then(function (unsub) {\n            return unsub();\n          });\n          this._unsub = undefined;\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"willUpdate\",\n      value: function willUpdate(changedProps) {\n        if (changedProps.has(\"stepData\")) {\n          this._debouncedSubscribePreview();\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"render\",\n      value: function render() {\n        return html(_templateObject || (_templateObject = _taggedTemplateLiteral([\"<entity-preview-row\\n      .hass=\", \"\\n      .stateObj=\", \"\\n    ></entity-preview-row>\"])), this.hass, this._preview);\n      }\n    }, {\n      kind: \"field\",\n      key: \"_setPreview\",\n      value: function value() {\n        var _this2 = this;\n        return function (preview) {\n          var now = new Date().toISOString();\n          _this2._preview = Object.assign({\n            entity_id: \"\".concat(_this2.stepId, \".___flow_preview___\"),\n            last_changed: now,\n            last_updated: now,\n            context: {\n              id: \"\",\n              parent_id: null,\n              user_id: null\n            }\n          }, preview);\n        };\n      }\n    }, {\n      kind: \"field\",\n      key: \"_debouncedSubscribePreview\",\n      value: function value() {\n        var _this3 = this;\n        return debounce(function () {\n          _this3._subscribePreview();\n        }, 250);\n      }\n    }, {\n      kind: \"method\",\n      key: \"_subscribePreview\",\n      value: function () {\n        var _subscribePreview2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                if (!this._unsub) {\n                  _context.next = 6;\n                  break;\n                }\n                _context.next = 3;\n                return this._unsub;\n              case 3:\n                _context.t0 = _context.sent;\n                (0, _context.t0)();\n                this._unsub = undefined;\n              case 6:\n                if (!(this.flowType === \"repair_flow\")) {\n                  _context.next = 8;\n                  break;\n                }\n                return _context.abrupt(\"return\");\n              case 8:\n                _context.prev = 8;\n                this._unsub = subscribePreviewTimeDate(this.hass, this.flowId, this.flowType, this.stepData, this._setPreview);\n                _context.next = 12;\n                return this._unsub;\n              case 12:\n                _context.next = 17;\n                break;\n              case 14:\n                _context.prev = 14;\n                _context.t1 = _context[\"catch\"](8);\n                this._preview = undefined;\n              case 17:\n              case \"end\":\n                return _context.stop();\n            }\n          }, _callee, this, [[8, 14]]);\n        }));\n        function _subscribePreview() {\n          return _subscribePreview2.apply(this, arguments);\n        }\n        return _subscribePreview;\n      }()\n    }]\n  };\n}, LitElement);","map":{"version":3,"names":["LitElement","html","customElement","property","state","subscribePreviewTimeDate","debounce","FlowPreviewTimeDate","_decorate","_initialize","_LitElement","_LitElement2","_inherits","_this","_classCallCheck","_len","arguments","length","args","Array","_key","_callSuper","concat","_assertThisInitialized","_createClass","F","d","kind","decorators","attribute","key","value","disconnectedCallback","_get","_getPrototypeOf","prototype","call","_unsub","then","unsub","undefined","willUpdate","changedProps","has","_debouncedSubscribePreview","render","_templateObject","_taggedTemplateLiteral","hass","_preview","_this2","preview","now","Date","toISOString","Object","assign","entity_id","stepId","last_changed","last_updated","context","id","parent_id","user_id","_this3","_subscribePreview","_subscribePreview2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","t0","sent","flowType","abrupt","flowId","stepData","_setPreview","t1","stop","apply"],"sources":["/workspaces/frontend/src/dialogs/config-flow/previews/flow-preview-time_date.ts"],"sourcesContent":["import { HassEntity, UnsubscribeFunc } from \"home-assistant-js-websocket\";\nimport { LitElement, html } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { FlowType } from \"../../../data/data_entry_flow\";\nimport {\n  TimeDatePreview,\n  subscribePreviewTimeDate,\n} from \"../../../data/time_date\";\nimport { HomeAssistant } from \"../../../types\";\nimport \"./entity-preview-row\";\nimport { debounce } from \"../../../common/util/debounce\";\n\n@customElement(\"flow-preview-time_date\")\nclass FlowPreviewTimeDate extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property() public flowType!: FlowType;\n\n  public handler!: string;\n\n  @property() public stepId!: string;\n\n  @property() public flowId!: string;\n\n  @property() public stepData!: Record<string, any>;\n\n  @state() private _preview?: HassEntity;\n\n  private _unsub?: Promise<UnsubscribeFunc>;\n\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n    if (this._unsub) {\n      this._unsub.then((unsub) => unsub());\n      this._unsub = undefined;\n    }\n  }\n\n  willUpdate(changedProps) {\n    if (changedProps.has(\"stepData\")) {\n      this._debouncedSubscribePreview();\n    }\n  }\n\n  protected render() {\n    return html`<entity-preview-row\n      .hass=${this.hass}\n      .stateObj=${this._preview}\n    ></entity-preview-row>`;\n  }\n\n  private _setPreview = (preview: TimeDatePreview) => {\n    const now = new Date().toISOString();\n    this._preview = {\n      entity_id: `${this.stepId}.___flow_preview___`,\n      last_changed: now,\n      last_updated: now,\n      context: { id: \"\", parent_id: null, user_id: null },\n      ...preview,\n    };\n  };\n\n  private _debouncedSubscribePreview = debounce(() => {\n    this._subscribePreview();\n  }, 250);\n\n  private async _subscribePreview() {\n    if (this._unsub) {\n      (await this._unsub)();\n      this._unsub = undefined;\n    }\n    if (this.flowType === \"repair_flow\") {\n      return;\n    }\n    try {\n      this._unsub = subscribePreviewTimeDate(\n        this.hass,\n        this.flowId,\n        this.flowType,\n        this.stepData,\n        this._setPreview\n      );\n      await this._unsub;\n    } catch (err) {\n      this._preview = undefined;\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"flow-preview-time_date\": FlowPreviewTimeDate;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}