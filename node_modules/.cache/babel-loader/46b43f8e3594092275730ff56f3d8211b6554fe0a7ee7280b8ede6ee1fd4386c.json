{"ast":null,"code":"import { getCollection } from \"home-assistant-js-websocket\";\nimport { fetchConfig } from \"./lovelace/config/types\";\nexport const subscribeLovelaceUpdates = (conn, urlPath, onChange) => conn.subscribeEvents(ev => {\n  if (ev.data.url_path === urlPath) {\n    onChange();\n  }\n}, \"lovelace_updated\");\nexport const getLovelaceCollection = (conn, urlPath = null) => getCollection(conn, `_lovelace_${urlPath !== null && urlPath !== void 0 ? urlPath : \"\"}`, conn2 => fetchConfig(conn2, urlPath, false), (_conn, store) => subscribeLovelaceUpdates(conn, urlPath, () => fetchConfig(conn, urlPath, false).then(config => store.setState(config, true))));\n\n// Legacy functions to support cast for Home Assistion < 0.107\nconst fetchLegacyConfig = (conn, force) => conn.sendMessagePromise({\n  type: \"lovelace/config\",\n  force\n});\nconst subscribeLegacyLovelaceUpdates = (conn, onChange) => conn.subscribeEvents(onChange, \"lovelace_updated\");\nexport const getLegacyLovelaceCollection = conn => getCollection(conn, \"_lovelace\", conn2 => fetchLegacyConfig(conn2, false), (_conn, store) => subscribeLegacyLovelaceUpdates(conn, () => fetchLegacyConfig(conn, false).then(config => store.setState(config, true))));","map":{"version":3,"names":["getCollection","fetchConfig","subscribeLovelaceUpdates","conn","urlPath","onChange","subscribeEvents","ev","data","url_path","getLovelaceCollection","conn2","_conn","store","then","config","setState","fetchLegacyConfig","force","sendMessagePromise","type","subscribeLegacyLovelaceUpdates","getLegacyLovelaceCollection"],"sources":["/workspaces/frontend/src/data/lovelace.ts"],"sourcesContent":["import {\n  Connection,\n  getCollection,\n  HassEventBase,\n} from \"home-assistant-js-websocket\";\nimport { HuiErrorCard } from \"../panels/lovelace/cards/hui-error-card\";\nimport {\n  Lovelace,\n  LovelaceBadge,\n  LovelaceCard,\n} from \"../panels/lovelace/types\";\nimport { HomeAssistant } from \"../types\";\nimport { fetchConfig, LegacyLovelaceConfig } from \"./lovelace/config/types\";\nimport { LovelaceViewConfig } from \"./lovelace/config/view\";\n\nexport interface LovelacePanelConfig {\n  mode: \"yaml\" | \"storage\";\n}\n\nexport interface LovelaceViewElement extends HTMLElement {\n  hass?: HomeAssistant;\n  lovelace?: Lovelace;\n  narrow?: boolean;\n  index?: number;\n  cards?: Array<LovelaceCard | HuiErrorCard>;\n  badges?: LovelaceBadge[];\n  isStrategy: boolean;\n  setConfig(config: LovelaceViewConfig): void;\n}\n\ntype LovelaceUpdatedEvent = HassEventBase & {\n  event_type: \"lovelace_updated\";\n  data: {\n    url_path: string | null;\n    mode: \"yaml\" | \"storage\";\n  };\n};\n\nexport const subscribeLovelaceUpdates = (\n  conn: Connection,\n  urlPath: string | null,\n  onChange: () => void\n) =>\n  conn.subscribeEvents<LovelaceUpdatedEvent>((ev) => {\n    if (ev.data.url_path === urlPath) {\n      onChange();\n    }\n  }, \"lovelace_updated\");\n\nexport const getLovelaceCollection = (\n  conn: Connection,\n  urlPath: string | null = null\n) =>\n  getCollection(\n    conn,\n    `_lovelace_${urlPath ?? \"\"}`,\n    (conn2) => fetchConfig(conn2, urlPath, false),\n    (_conn, store) =>\n      subscribeLovelaceUpdates(conn, urlPath, () =>\n        fetchConfig(conn, urlPath, false).then((config) =>\n          store.setState(config, true)\n        )\n      )\n  );\n\n// Legacy functions to support cast for Home Assistion < 0.107\nconst fetchLegacyConfig = (\n  conn: Connection,\n  force: boolean\n): Promise<LegacyLovelaceConfig> =>\n  conn.sendMessagePromise({\n    type: \"lovelace/config\",\n    force,\n  });\n\nconst subscribeLegacyLovelaceUpdates = (\n  conn: Connection,\n  onChange: () => void\n) => conn.subscribeEvents(onChange, \"lovelace_updated\");\n\nexport const getLegacyLovelaceCollection = (conn: Connection) =>\n  getCollection(\n    conn,\n    \"_lovelace\",\n    (conn2) => fetchLegacyConfig(conn2, false),\n    (_conn, store) =>\n      subscribeLegacyLovelaceUpdates(conn, () =>\n        fetchLegacyConfig(conn, false).then((config) =>\n          store.setState(config, true)\n        )\n      )\n  );\n"],"mappings":"AAAA,SAEEA,aAAa,QAER,6BAA6B;AAQpC,SAASC,WAAW,QAA8B,yBAAyB;AA0B3E,OAAO,MAAMC,wBAAwB,GAAGA,CACtCC,IAAgB,EAChBC,OAAsB,EACtBC,QAAoB,KAEpBF,IAAI,CAACG,eAAe,CAAwBC,EAAE,IAAK;EACjD,IAAIA,EAAE,CAACC,IAAI,CAACC,QAAQ,KAAKL,OAAO,EAAE;IAChCC,QAAQ,CAAC,CAAC;EACZ;AACF,CAAC,EAAE,kBAAkB,CAAC;AAExB,OAAO,MAAMK,qBAAqB,GAAGA,CACnCP,IAAgB,EAChBC,OAAsB,GAAG,IAAI,KAE7BJ,aAAa,CACXG,IAAI,EACH,aAAYC,OAAO,aAAPA,OAAO,cAAPA,OAAO,GAAI,EAAG,EAAC,EAC3BO,KAAK,IAAKV,WAAW,CAACU,KAAK,EAAEP,OAAO,EAAE,KAAK,CAAC,EAC7C,CAACQ,KAAK,EAAEC,KAAK,KACXX,wBAAwB,CAACC,IAAI,EAAEC,OAAO,EAAE,MACtCH,WAAW,CAACE,IAAI,EAAEC,OAAO,EAAE,KAAK,CAAC,CAACU,IAAI,CAAEC,MAAM,IAC5CF,KAAK,CAACG,QAAQ,CAACD,MAAM,EAAE,IAAI,CAC7B,CACF,CACJ,CAAC;;AAEH;AACA,MAAME,iBAAiB,GAAGA,CACxBd,IAAgB,EAChBe,KAAc,KAEdf,IAAI,CAACgB,kBAAkB,CAAC;EACtBC,IAAI,EAAE,iBAAiB;EACvBF;AACF,CAAC,CAAC;AAEJ,MAAMG,8BAA8B,GAAGA,CACrClB,IAAgB,EAChBE,QAAoB,KACjBF,IAAI,CAACG,eAAe,CAACD,QAAQ,EAAE,kBAAkB,CAAC;AAEvD,OAAO,MAAMiB,2BAA2B,GAAInB,IAAgB,IAC1DH,aAAa,CACXG,IAAI,EACJ,WAAW,EACVQ,KAAK,IAAKM,iBAAiB,CAACN,KAAK,EAAE,KAAK,CAAC,EAC1C,CAACC,KAAK,EAAEC,KAAK,KACXQ,8BAA8B,CAAClB,IAAI,EAAE,MACnCc,iBAAiB,CAACd,IAAI,EAAE,KAAK,CAAC,CAACW,IAAI,CAAEC,MAAM,IACzCF,KAAK,CAACG,QAAQ,CAACD,MAAM,EAAE,IAAI,CAC7B,CACF,CACJ,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}