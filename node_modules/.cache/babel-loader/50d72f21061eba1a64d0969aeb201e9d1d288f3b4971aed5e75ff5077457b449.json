{"ast":null,"code":"import _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _callSuper from \"@babel/runtime/helpers/callSuper\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _decorate from \"@babel/runtime/helpers/decorate\";\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6, _templateObject7;\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.url.js\";\nimport \"core-js/modules/web.url-search-params.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport \"@material/mwc-button\";\nimport \"../../components/ha-dialog\";\nimport \"../../components/ha-circular-progress\";\nimport \"../../components/ha-icon\";\nimport \"../../components/ha-icon-button\";\nimport { LitElement, css, html, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { haStyleDialog } from \"../../resources/styles\";\nvar HaDialogShowAudioMessage = _decorate([customElement(\"ha-dialog-show-audio-message\")], function (_initialize, _LitElement) {\n  var HaDialogShowAudioMessage = /*#__PURE__*/function (_LitElement2) {\n    _inherits(HaDialogShowAudioMessage, _LitElement2);\n    function HaDialogShowAudioMessage() {\n      var _this;\n      _classCallCheck(this, HaDialogShowAudioMessage);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _callSuper(this, HaDialogShowAudioMessage, [].concat(args));\n      _initialize(_assertThisInitialized(_this));\n      return _this;\n    }\n    return _createClass(HaDialogShowAudioMessage);\n  }(_LitElement);\n  return {\n    F: HaDialogShowAudioMessage,\n    d: [{\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_currentMessage\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_errorMsg\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_loading\",\n      value: function value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_opened\",\n      value: function value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_blobUrl\",\n      value: void 0\n    }, {\n      kind: \"method\",\n      key: \"render\",\n      value: function render() {\n        var _this$_currentMessage;\n        return html(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n      <ha-dialog\\n        .open=\", \"\\n        @closed=\", \"\\n        heading=\", \"\\n      >\\n        \", \"\\n      </ha-dialog>\\n    \"])), this._opened, this._closeDialog, this.hass.localize(\"ui.panel.mailbox.playback_title\"), this._loading ? html(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"<ha-circular-progress indeterminate></ha-circular-progress>\"]))) : html(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"<div class=\\\"icon\\\">\\n                <ha-icon-button id=\\\"delicon\\\" @click=\", \">\\n                  <ha-icon icon=\\\"hass:delete\\\"></ha-icon>\\n                </ha-icon-button>\\n              </div>\\n              \", \"\\n                \", \"\\n                \", \"\\n              </div>\"])), this._openDeleteDialog, this._currentMessage ? html(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"<div id=\\\"transcribe\\\">\\n                      \", \"\\n                    </div>\"])), (_this$_currentMessage = this._currentMessage) === null || _this$_currentMessage === void 0 ? void 0 : _this$_currentMessage.message) : nothing, this._errorMsg ? html(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"<div class=\\\"error\\\">\", \"</div>\"])), this._errorMsg) : nothing, this._blobUrl ? html(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\" <audio id=\\\"mp3\\\" preload=\\\"none\\\" controls autoplay>\\n                        <source\\n                          id=\\\"mp3src\\\"\\n                          src=\", \"\\n                          type=\\\"audio/mpeg\\\"\\n                        />\\n                      </audio>\"])), this._blobUrl) : nothing));\n      }\n    }, {\n      kind: \"method\",\n      key: \"showDialog\",\n      value: function showDialog(_ref) {\n        var _this2 = this;\n        var hass = _ref.hass,\n          message = _ref.message;\n        this.hass = hass;\n        this._errorMsg = undefined;\n        this._currentMessage = message;\n        this._opened = true;\n        var platform = message.platform;\n        if (platform.has_media) {\n          this._loading = true;\n          var url = \"/api/mailbox/media/\".concat(platform.name, \"/\").concat(message.sha);\n          this.hass.fetchWithAuth(url).then(function (response) {\n            if (response.ok) {\n              return response.blob();\n            }\n            return Promise.reject({\n              status: response.status,\n              statusText: response.statusText\n            });\n          }).then(function (blob) {\n            _this2._loading = false;\n            _this2._blobUrl = window.URL.createObjectURL(blob);\n          }).catch(function (err) {\n            _this2._loading = false;\n            _this2._errorMsg = \"Error loading audio: \".concat(err.statusText);\n          });\n        } else {\n          this._loading = false;\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"_openDeleteDialog\",\n      value: function _openDeleteDialog() {\n        if (confirm(this.hass.localize(\"ui.panel.mailbox.delete_prompt\"))) {\n          this._deleteSelected();\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"_deleteSelected\",\n      value: function _deleteSelected() {\n        var msg = this._currentMessage;\n        this.hass.callApi(\"DELETE\", \"mailbox/delete/\".concat(msg.platform.name, \"/\").concat(msg.sha));\n        this._closeDialog();\n      }\n    }, {\n      kind: \"method\",\n      key: \"_closeDialog\",\n      value: function _closeDialog() {\n        var mp3 = this.shadowRoot.querySelector(\"#mp3\");\n        mp3.pause();\n        this._currentMessage = undefined;\n        this._errorMsg = undefined;\n        this._loading = false;\n        this._opened = false;\n      }\n    }, {\n      kind: \"get\",\n      static: true,\n      key: \"styles\",\n      value: function styles() {\n        return [haStyleDialog, css(_templateObject7 || (_templateObject7 = _taggedTemplateLiteral([\"\\n        .error {\\n          color: red;\\n        }\\n        p {\\n          color: var(--secondary-text-color);\\n        }\\n        .icon {\\n          text-align: var(--float-end);\\n        }\\n      \"])))];\n      }\n    }]\n  };\n}, LitElement);","map":{"version":3,"names":["LitElement","css","html","nothing","customElement","property","state","haStyleDialog","HaDialogShowAudioMessage","_decorate","_initialize","_LitElement","_LitElement2","_inherits","_this","_classCallCheck","_len","arguments","length","args","Array","_key","_callSuper","concat","_assertThisInitialized","_createClass","F","d","kind","decorators","attribute","key","value","render","_this$_currentMessage","_templateObject","_taggedTemplateLiteral","_opened","_closeDialog","hass","localize","_loading","_templateObject2","_templateObject3","_openDeleteDialog","_currentMessage","_templateObject4","message","_errorMsg","_templateObject5","_blobUrl","_templateObject6","showDialog","_ref","_this2","undefined","platform","has_media","url","name","sha","fetchWithAuth","then","response","ok","blob","Promise","reject","status","statusText","window","URL","createObjectURL","catch","err","confirm","_deleteSelected","msg","callApi","mp3","shadowRoot","querySelector","pause","static","styles","_templateObject7"],"sources":["/Users/sercanardil/Desktop/frontend/src/panels/mailbox/ha-dialog-show-audio-message.ts"],"sourcesContent":["import \"@material/mwc-button\";\nimport \"../../components/ha-dialog\";\nimport \"../../components/ha-circular-progress\";\nimport \"../../components/ha-icon\";\nimport \"../../components/ha-icon-button\";\nimport {\n  CSSResultGroup,\n  LitElement,\n  TemplateResult,\n  css,\n  html,\n  nothing,\n} from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { HomeAssistant } from \"../../types\";\nimport { haStyleDialog } from \"../../resources/styles\";\n\n@customElement(\"ha-dialog-show-audio-message\")\nclass HaDialogShowAudioMessage extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @state() private _currentMessage?: any;\n\n  @state() private _errorMsg?: string;\n\n  @state() private _loading: boolean = false;\n\n  @state() private _opened: boolean = false;\n\n  @state() private _blobUrl?: string;\n\n  protected render(): TemplateResult {\n    return html`\n      <ha-dialog\n        .open=${this._opened}\n        @closed=${this._closeDialog}\n        heading=${this.hass.localize(\"ui.panel.mailbox.playback_title\")}\n      >\n        ${this._loading\n          ? html`<ha-circular-progress indeterminate></ha-circular-progress>`\n          : html`<div class=\"icon\">\n                <ha-icon-button id=\"delicon\" @click=${this._openDeleteDialog}>\n                  <ha-icon icon=\"hass:delete\"></ha-icon>\n                </ha-icon-button>\n              </div>\n              ${\n                this._currentMessage\n                  ? html`<div id=\"transcribe\">\n                      ${this._currentMessage?.message}\n                    </div>`\n                  : nothing\n              }\n                ${\n                  this._errorMsg\n                    ? html`<div class=\"error\">${this._errorMsg}</div>`\n                    : nothing\n                }\n                ${\n                  this._blobUrl\n                    ? html` <audio id=\"mp3\" preload=\"none\" controls autoplay>\n                        <source\n                          id=\"mp3src\"\n                          src=${this._blobUrl}\n                          type=\"audio/mpeg\"\n                        />\n                      </audio>`\n                    : nothing\n                }\n              </div>`}\n      </ha-dialog>\n    `;\n  }\n\n  showDialog({ hass, message }) {\n    this.hass = hass;\n    this._errorMsg = undefined;\n    this._currentMessage = message;\n    this._opened = true;\n    const platform = message.platform;\n    if (platform.has_media) {\n      this._loading = true;\n      const url = `/api/mailbox/media/${platform.name}/${message.sha}`;\n      this.hass\n        .fetchWithAuth(url)\n        .then((response) => {\n          if (response.ok) {\n            return response.blob();\n          }\n          return Promise.reject({\n            status: response.status,\n            statusText: response.statusText,\n          });\n        })\n        .then((blob) => {\n          this._loading = false;\n          this._blobUrl = window.URL.createObjectURL(blob);\n        })\n        .catch((err) => {\n          this._loading = false;\n          this._errorMsg = `Error loading audio: ${err.statusText}`;\n        });\n    } else {\n      this._loading = false;\n    }\n  }\n\n  private _openDeleteDialog() {\n    if (confirm(this.hass.localize(\"ui.panel.mailbox.delete_prompt\"))) {\n      this._deleteSelected();\n    }\n  }\n\n  private _deleteSelected() {\n    const msg = this._currentMessage;\n    this.hass.callApi(\n      \"DELETE\",\n      `mailbox/delete/${msg.platform.name}/${msg.sha}`\n    );\n    this._closeDialog();\n  }\n\n  private _closeDialog() {\n    const mp3 = this.shadowRoot!.querySelector(\"#mp3\")! as any;\n    mp3.pause();\n    this._currentMessage = undefined;\n    this._errorMsg = undefined;\n    this._loading = false;\n    this._opened = false;\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      haStyleDialog,\n      css`\n        .error {\n          color: red;\n        }\n        p {\n          color: var(--secondary-text-color);\n        }\n        .icon {\n          text-align: var(--float-end);\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-dialog-show-audio-message\": HaDialogShowAudioMessage;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,OAAO,sBAAsB;AAC7B,OAAO,4BAA4B;AACnC,OAAO,uCAAuC;AAC9C,OAAO,0BAA0B;AACjC,OAAO,iCAAiC;AACxC,SAEEA,UAAU,EAEVC,GAAG,EACHC,IAAI,EACJC,OAAO,QACF,KAAK;AACZ,SAASC,aAAa,EAAEC,QAAQ,EAAEC,KAAK,QAAQ,gBAAgB;AAE/D,SAASC,aAAa,QAAQ,wBAAwB;AAAC,IAGjDC,wBAAwB,GAAAC,SAAA,EAD7BL,aAAa,CAAC,8BAA8B,CAAC,aAAAM,WAAA,EAAAC,WAAA;EAAA,IACxCH,wBAAwB,0BAAAI,YAAA;IAAAC,SAAA,CAAAL,wBAAA,EAAAI,YAAA;IAAA,SAAAJ,yBAAA;MAAA,IAAAM,KAAA;MAAAC,eAAA,OAAAP,wBAAA;MAAA,SAAAQ,IAAA,GAAAC,SAAA,CAAAC,MAAA,EAAAC,IAAA,OAAAC,KAAA,CAAAJ,IAAA,GAAAK,IAAA,MAAAA,IAAA,GAAAL,IAAA,EAAAK,IAAA;QAAAF,IAAA,CAAAE,IAAA,IAAAJ,SAAA,CAAAI,IAAA;MAAA;MAAAP,KAAA,GAAAQ,UAAA,OAAAd,wBAAA,KAAAe,MAAA,CAAAJ,IAAA;MAAAT,WAAA,CAAAc,sBAAA,CAAAV,KAAA;MAAA,OAAAA,KAAA;IAAA;IAAA,OAAAW,YAAA,CAAAjB,wBAAA;EAAA,EAAAG,WAAA;EAAA;IAAAe,CAAA,EAAxBlB,wBAAwB;IAAAmB,CAAA;MAAAC,IAAA;MAAAC,UAAA,GAC3BxB,QAAQ,CAAC;QAAEyB,SAAS,EAAE;MAAM,CAAC,CAAC;MAAAC,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAE9BvB,KAAK,CAAC,CAAC;MAAAyB,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAEPvB,KAAK,CAAC,CAAC;MAAAyB,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAEPvB,KAAK,CAAC,CAAC;MAAAyB,GAAA;MAAAC,KAAA,WAAAA,MAAA;QAAA,OAA6B,KAAK;MAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAEzCvB,KAAK,CAAC,CAAC;MAAAyB,GAAA;MAAAC,KAAA,WAAAA,MAAA;QAAA,OAA4B,KAAK;MAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAExCvB,KAAK,CAAC,CAAC;MAAAyB,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAER,SAAAC,OAAA,EAAmC;QAAA,IAAAC,qBAAA;QACjC,OAAOhC,IAAI,CAAAiC,eAAA,KAAAA,eAAA,GAAAC,sBAAA,4IAEC,IAAI,CAACC,OAAO,EACV,IAAI,CAACC,YAAY,EACjB,IAAI,CAACC,IAAI,CAACC,QAAQ,CAAC,iCAAiC,CAAC,EAE7D,IAAI,CAACC,QAAQ,GACXvC,IAAI,CAAAwC,gBAAA,KAAAA,gBAAA,GAAAN,sBAAA,sEACJlC,IAAI,CAAAyC,gBAAA,KAAAA,gBAAA,GAAAP,sBAAA,qSACsC,IAAI,CAACQ,iBAAiB,EAK5D,IAAI,CAACC,eAAe,GAChB3C,IAAI,CAAA4C,gBAAA,KAAAA,gBAAA,GAAAV,sBAAA,yFAAAF,qBAAA,GACA,IAAI,CAACW,eAAe,cAAAX,qBAAA,uBAApBA,qBAAA,CAAsBa,OAAO,IAEjC5C,OAAO,EAGT,IAAI,CAAC6C,SAAS,GACV9C,IAAI,CAAA+C,gBAAA,KAAAA,gBAAA,GAAAb,sBAAA,wCAAsB,IAAI,CAACY,SAAS,IACxC7C,OAAO,EAGX,IAAI,CAAC+C,QAAQ,GACThD,IAAI,CAAAiD,gBAAA,KAAAA,gBAAA,GAAAf,sBAAA,wRAGM,IAAI,CAACc,QAAQ,IAIvB/C,OAAO,CAER;MAGnB;IAAC;MAAAyB,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAoB,WAAAC,IAAA,EAA8B;QAAA,IAAAC,MAAA;QAAA,IAAjBf,IAAI,GAAAc,IAAA,CAAJd,IAAI;UAAEQ,OAAO,GAAAM,IAAA,CAAPN,OAAO;QACxB,IAAI,CAACR,IAAI,GAAGA,IAAI;QAChB,IAAI,CAACS,SAAS,GAAGO,SAAS;QAC1B,IAAI,CAACV,eAAe,GAAGE,OAAO;QAC9B,IAAI,CAACV,OAAO,GAAG,IAAI;QACnB,IAAMmB,QAAQ,GAAGT,OAAO,CAACS,QAAQ;QACjC,IAAIA,QAAQ,CAACC,SAAS,EAAE;UACtB,IAAI,CAAChB,QAAQ,GAAG,IAAI;UACpB,IAAMiB,GAAG,yBAAAnC,MAAA,CAAyBiC,QAAQ,CAACG,IAAI,OAAApC,MAAA,CAAIwB,OAAO,CAACa,GAAG,CAAE;UAChE,IAAI,CAACrB,IAAI,CACNsB,aAAa,CAACH,GAAG,CAAC,CAClBI,IAAI,CAAC,UAACC,QAAQ,EAAK;YAClB,IAAIA,QAAQ,CAACC,EAAE,EAAE;cACf,OAAOD,QAAQ,CAACE,IAAI,CAAC,CAAC;YACxB;YACA,OAAOC,OAAO,CAACC,MAAM,CAAC;cACpBC,MAAM,EAAEL,QAAQ,CAACK,MAAM;cACvBC,UAAU,EAAEN,QAAQ,CAACM;YACvB,CAAC,CAAC;UACJ,CAAC,CAAC,CACDP,IAAI,CAAC,UAACG,IAAI,EAAK;YACdX,MAAI,CAACb,QAAQ,GAAG,KAAK;YACrBa,MAAI,CAACJ,QAAQ,GAAGoB,MAAM,CAACC,GAAG,CAACC,eAAe,CAACP,IAAI,CAAC;UAClD,CAAC,CAAC,CACDQ,KAAK,CAAC,UAACC,GAAG,EAAK;YACdpB,MAAI,CAACb,QAAQ,GAAG,KAAK;YACrBa,MAAI,CAACN,SAAS,2BAAAzB,MAAA,CAA2BmD,GAAG,CAACL,UAAU,CAAE;UAC3D,CAAC,CAAC;QACN,CAAC,MAAM;UACL,IAAI,CAAC5B,QAAQ,GAAG,KAAK;QACvB;MACF;IAAC;MAAAb,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAY,kBAAA,EAA4B;QAC1B,IAAI+B,OAAO,CAAC,IAAI,CAACpC,IAAI,CAACC,QAAQ,CAAC,gCAAgC,CAAC,CAAC,EAAE;UACjE,IAAI,CAACoC,eAAe,CAAC,CAAC;QACxB;MACF;IAAC;MAAAhD,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAA4C,gBAAA,EAA0B;QACxB,IAAMC,GAAG,GAAG,IAAI,CAAChC,eAAe;QAChC,IAAI,CAACN,IAAI,CAACuC,OAAO,CACf,QAAQ,oBAAAvD,MAAA,CACUsD,GAAG,CAACrB,QAAQ,CAACG,IAAI,OAAApC,MAAA,CAAIsD,GAAG,CAACjB,GAAG,CAChD,CAAC;QACD,IAAI,CAACtB,YAAY,CAAC,CAAC;MACrB;IAAC;MAAAV,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAM,aAAA,EAAuB;QACrB,IAAMyC,GAAG,GAAG,IAAI,CAACC,UAAU,CAAEC,aAAa,CAAC,MAAM,CAAS;QAC1DF,GAAG,CAACG,KAAK,CAAC,CAAC;QACX,IAAI,CAACrC,eAAe,GAAGU,SAAS;QAChC,IAAI,CAACP,SAAS,GAAGO,SAAS;QAC1B,IAAI,CAACd,QAAQ,GAAG,KAAK;QACrB,IAAI,CAACJ,OAAO,GAAG,KAAK;MACtB;IAAC;MAAAT,IAAA;MAAAuD,MAAA;MAAApD,GAAA;MAAAC,KAAA,EAED,SAAAoD,OAAA,EAAoC;QAClC,OAAO,CACL7E,aAAa,EACbN,GAAG,CAAAoF,gBAAA,KAAAA,gBAAA,GAAAjD,sBAAA,iNAWJ;MACH;IAAC;EAAA;AAAA,GA/HoCpC,UAAU"},"metadata":{},"sourceType":"module","externalDependencies":[]}