{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport \"core-js/modules/es.object.assign.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.object.values.js\";\nexport var subscribeNotifications = function subscribeNotifications(conn, onChange) {\n  var params = {\n    type: \"persistent_notification/subscribe\"\n  };\n  var stream = new NotificationStream();\n  var subscription = conn.subscribeMessage(function (message) {\n    return onChange(stream.processMessage(message));\n  }, params);\n  return function () {\n    subscription.then(function (unsub) {\n      return unsub === null || unsub === void 0 ? void 0 : unsub();\n    });\n  };\n};\nvar NotificationStream = /*#__PURE__*/function () {\n  function NotificationStream() {\n    _classCallCheck(this, NotificationStream);\n    this.notifications = void 0;\n    this.notifications = {};\n  }\n  _createClass(NotificationStream, [{\n    key: \"processMessage\",\n    value: function processMessage(streamMessage) {\n      if (streamMessage.type === \"removed\") {\n        for (var _i = 0, _Object$keys = Object.keys(streamMessage.notifications); _i < _Object$keys.length; _i++) {\n          var _notificationId = _Object$keys[_i];\n          delete this.notifications[_notificationId];\n        }\n      } else {\n        this.notifications = Object.assign(Object.assign({}, this.notifications), streamMessage.notifications);\n      }\n      return Object.values(this.notifications);\n    }\n  }]);\n  return NotificationStream;\n}();","map":{"version":3,"names":["subscribeNotifications","conn","onChange","params","type","stream","NotificationStream","subscription","subscribeMessage","message","processMessage","then","unsub","_classCallCheck","notifications","_createClass","key","value","streamMessage","_i","_Object$keys","Object","keys","length","notificationId","assign","values"],"sources":["/Users/sercanardil/Desktop/frontend/src/data/persistent_notification.ts"],"sourcesContent":["import {\n  Connection,\n  HassEntity,\n  UnsubscribeFunc,\n} from \"home-assistant-js-websocket\";\n\nexport interface PersitentNotificationEntity extends HassEntity {\n  notification_id?: string;\n  created_at?: string;\n  title?: string;\n  message?: string;\n}\n\nexport interface PersistentNotification {\n  created_at: string;\n  message: string;\n  notification_id: string;\n  title: string;\n  status: \"read\" | \"unread\";\n}\n\nexport interface PersistentNotifications {\n  [notificationId: string]: PersistentNotification;\n}\n\nexport interface PersistentNotificationMessage {\n  type: \"added\" | \"removed\" | \"current\" | \"updated\";\n  notifications: PersistentNotifications;\n}\n\nexport const subscribeNotifications = (\n  conn: Connection,\n  onChange: (notifications: PersistentNotification[]) => void\n): UnsubscribeFunc => {\n  const params = {\n    type: \"persistent_notification/subscribe\",\n  };\n  const stream = new NotificationStream();\n  const subscription = conn.subscribeMessage<PersistentNotificationMessage>(\n    (message) => onChange(stream.processMessage(message)),\n    params\n  );\n  return () => {\n    subscription.then((unsub) => unsub?.());\n  };\n};\n\nclass NotificationStream {\n  notifications: PersistentNotifications;\n\n  constructor() {\n    this.notifications = {};\n  }\n\n  processMessage(\n    streamMessage: PersistentNotificationMessage\n  ): PersistentNotification[] {\n    if (streamMessage.type === \"removed\") {\n      for (const notificationId of Object.keys(streamMessage.notifications)) {\n        delete this.notifications[notificationId];\n      }\n    } else {\n      this.notifications = {\n        ...this.notifications,\n        ...streamMessage.notifications,\n      };\n    }\n    return Object.values(this.notifications);\n  }\n}\n"],"mappings":";;;;;AA8BA,OAAO,IAAMA,sBAAsB,GAAG,SAAzBA,sBAAsBA,CACjCC,IAAgB,EAChBC,QAA2D,EACvC;EACpB,IAAMC,MAAM,GAAG;IACbC,IAAI,EAAE;EACR,CAAC;EACD,IAAMC,MAAM,GAAG,IAAIC,kBAAkB,CAAC,CAAC;EACvC,IAAMC,YAAY,GAAGN,IAAI,CAACO,gBAAgB,CACxC,UAACC,OAAO;IAAA,OAAKP,QAAQ,CAACG,MAAM,CAACK,cAAc,CAACD,OAAO,CAAC,CAAC;EAAA,GACrDN,MACF,CAAC;EACD,OAAO,YAAM;IACXI,YAAY,CAACI,IAAI,CAAC,UAACC,KAAK;MAAA,OAAKA,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAG,CAAC;IAAA,EAAC;EACzC,CAAC;AACH,CAAC;AAAC,IAEIN,kBAAkB;EAGtB,SAAAA,mBAAA,EAAc;IAAAO,eAAA,OAAAP,kBAAA;IAAA,KAFdQ,aAAa;IAGX,IAAI,CAACA,aAAa,GAAG,CAAC,CAAC;EACzB;EAACC,YAAA,CAAAT,kBAAA;IAAAU,GAAA;IAAAC,KAAA,EAED,SAAAP,eACEQ,aAA4C,EAClB;MAC1B,IAAIA,aAAa,CAACd,IAAI,KAAK,SAAS,EAAE;QACpC,SAAAe,EAAA,MAAAC,YAAA,GAA6BC,MAAM,CAACC,IAAI,CAACJ,aAAa,CAACJ,aAAa,CAAC,EAAAK,EAAA,GAAAC,YAAA,CAAAG,MAAA,EAAAJ,EAAA,IAAE;UAAlE,IAAMK,eAAc,GAAAJ,YAAA,CAAAD,EAAA;UACvB,OAAO,IAAI,CAACL,aAAa,CAACU,eAAc,CAAC;QAC3C;MACF,CAAC,MAAM;QACL,IAAI,CAACV,aAAa,GAAAO,MAAA,CAAAI,MAAA,CAAAJ,MAAA,CAAAI,MAAA,KACb,IAAI,CAACX,aAAa,GAClBI,aAAa,CAACJ,aAAa,CAC/B;MACH;MACA,OAAOO,MAAM,CAACK,MAAM,CAAC,IAAI,CAACZ,aAAa,CAAC;IAC1C;EAAC;EAAA,OAAAR,kBAAA;AAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}