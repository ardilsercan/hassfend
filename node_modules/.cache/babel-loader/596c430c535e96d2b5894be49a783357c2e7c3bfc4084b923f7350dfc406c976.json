{"ast":null,"code":"export class AudioRecorder {\n  constructor(callback) {\n    this._active = false;\n    this._callback = void 0;\n    this._context = void 0;\n    this._stream = void 0;\n    this._source = void 0;\n    this._recorder = void 0;\n    this._callback = callback;\n  }\n  get active() {\n    return this._active;\n  }\n  get sampleRate() {\n    var _this$_context;\n    return (_this$_context = this._context) === null || _this$_context === void 0 ? void 0 : _this$_context.sampleRate;\n  }\n  static get isSupported() {\n    return window.isSecureContext && (\n    // @ts-ignore-next-line\n    window.AudioContext || window.webkitAudioContext);\n  }\n  async start() {\n    if (!this._context || !this._stream || !this._source || !this._recorder) {\n      try {\n        await this._createContext();\n      } catch (err) {\n        // eslint-disable-next-line no-console\n        console.error(err);\n        this._active = false;\n      }\n    } else {\n      this._stream.getTracks()[0].enabled = true;\n      await this._context.resume();\n      this._active = true;\n    }\n  }\n  async stop() {\n    var _this$_context2;\n    this._active = false;\n    if (this._stream) {\n      this._stream.getTracks()[0].enabled = false;\n    }\n    await ((_this$_context2 = this._context) === null || _this$_context2 === void 0 ? void 0 : _this$_context2.suspend());\n  }\n  close() {\n    var _this$_stream, _this$_source, _this$_context3;\n    this._active = false;\n    (_this$_stream = this._stream) === null || _this$_stream === void 0 || _this$_stream.getTracks()[0].stop();\n    if (this._recorder) {\n      this._recorder.port.onmessage = null;\n    }\n    (_this$_source = this._source) === null || _this$_source === void 0 || _this$_source.disconnect();\n    (_this$_context3 = this._context) === null || _this$_context3 === void 0 || _this$_context3.close();\n    this._stream = undefined;\n    this._source = undefined;\n    this._recorder = undefined;\n    this._context = undefined;\n  }\n  async _createContext() {\n    // @ts-ignore-next-line\n    this._context = new (window.AudioContext || window.webkitAudioContext)();\n    this._stream = await navigator.mediaDevices.getUserMedia({\n      audio: true\n    });\n    await this._context.audioWorklet.addModule(new URL(\"./recorder.worklet.js\", import.meta.url));\n    this._source = this._context.createMediaStreamSource(this._stream);\n    this._recorder = new AudioWorkletNode(this._context, \"recorder.worklet\");\n    this._recorder.port.onmessage = e => {\n      if (!this._active) {\n        return;\n      }\n      this._callback(e.data);\n    };\n    this._active = true;\n    this._source.connect(this._recorder);\n  }\n}","map":{"version":3,"names":["AudioRecorder","constructor","callback","_active","_callback","_context","_stream","_source","_recorder","active","sampleRate","_this$_context","isSupported","window","isSecureContext","AudioContext","webkitAudioContext","start","_createContext","err","console","error","getTracks","enabled","resume","stop","_this$_context2","suspend","close","_this$_stream","_this$_source","_this$_context3","port","onmessage","disconnect","undefined","navigator","mediaDevices","getUserMedia","audio","audioWorklet","addModule","URL","import","meta","url","createMediaStreamSource","AudioWorkletNode","e","data","connect"],"sources":["/workspaces/frontend/src/util/audio-recorder.ts"],"sourcesContent":["export class AudioRecorder {\n  private _active = false;\n\n  private _callback: (data: Int16Array) => void;\n\n  private _context: AudioContext | undefined;\n\n  private _stream: MediaStream | undefined;\n\n  private _source: MediaStreamAudioSourceNode | undefined;\n\n  private _recorder: AudioWorkletNode | undefined;\n\n  constructor(callback: (data: Int16Array) => void) {\n    this._callback = callback;\n  }\n\n  public get active() {\n    return this._active;\n  }\n\n  public get sampleRate() {\n    return this._context?.sampleRate;\n  }\n\n  public static get isSupported() {\n    return (\n      window.isSecureContext &&\n      // @ts-ignore-next-line\n      (window.AudioContext || window.webkitAudioContext)\n    );\n  }\n\n  public async start() {\n    if (!this._context || !this._stream || !this._source || !this._recorder) {\n      try {\n        await this._createContext();\n      } catch (err) {\n        // eslint-disable-next-line no-console\n        console.error(err);\n        this._active = false;\n      }\n    } else {\n      this._stream.getTracks()[0].enabled = true;\n      await this._context.resume();\n      this._active = true;\n    }\n  }\n\n  public async stop() {\n    this._active = false;\n    if (this._stream) {\n      this._stream.getTracks()[0].enabled = false;\n    }\n    await this._context?.suspend();\n  }\n\n  public close() {\n    this._active = false;\n    this._stream?.getTracks()[0].stop();\n    if (this._recorder) {\n      this._recorder.port.onmessage = null;\n    }\n    this._source?.disconnect();\n    this._context?.close();\n    this._stream = undefined;\n    this._source = undefined;\n    this._recorder = undefined;\n    this._context = undefined;\n  }\n\n  private async _createContext() {\n    // @ts-ignore-next-line\n    this._context = new (window.AudioContext || window.webkitAudioContext)();\n    this._stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\n    await this._context.audioWorklet.addModule(\n      new URL(\"./recorder.worklet.js\", import.meta.url)\n    );\n\n    this._source = this._context.createMediaStreamSource(this._stream);\n    this._recorder = new AudioWorkletNode(this._context, \"recorder.worklet\");\n\n    this._recorder.port.onmessage = (e) => {\n      if (!this._active) {\n        return;\n      }\n      this._callback(e.data);\n    };\n    this._active = true;\n    this._source.connect(this._recorder);\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}