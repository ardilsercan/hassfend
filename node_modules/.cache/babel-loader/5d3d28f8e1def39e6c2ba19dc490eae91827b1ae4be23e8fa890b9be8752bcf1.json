{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/helpers/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport { getOptimisticCollection } from \"./collection\";\nexport var fetchFrontendUserData = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(conn, key) {\n    var result;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return conn.sendMessagePromise({\n            type: \"frontend/get_user_data\",\n            key: key\n          });\n        case 2:\n          result = _context.sent;\n          return _context.abrupt(\"return\", result.value);\n        case 4:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function fetchFrontendUserData(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport var saveFrontendUserData = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(conn, key, value) {\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          return _context2.abrupt(\"return\", conn.sendMessagePromise({\n            type: \"frontend/set_user_data\",\n            key: key,\n            value: value\n          }));\n        case 1:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n  return function saveFrontendUserData(_x3, _x4, _x5) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport var getOptimisticFrontendUserDataCollection = function getOptimisticFrontendUserDataCollection(conn, userDataKey) {\n  return getOptimisticCollection(function (_conn, data) {\n    return saveFrontendUserData(conn, userDataKey,\n    // @ts-ignore\n    data);\n  }, conn, \"_frontendUserData-\".concat(userDataKey), function () {\n    return fetchFrontendUserData(conn, userDataKey);\n  });\n};\nexport var subscribeFrontendUserData = function subscribeFrontendUserData(conn, userDataKey, onChange) {\n  return getOptimisticFrontendUserDataCollection(conn, userDataKey).subscribe(onChange);\n};","map":{"version":3,"names":["getOptimisticCollection","fetchFrontendUserData","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","conn","key","result","wrap","_callee$","_context","prev","next","sendMessagePromise","type","sent","abrupt","value","stop","_x","_x2","apply","arguments","saveFrontendUserData","_ref2","_callee2","_callee2$","_context2","_x3","_x4","_x5","getOptimisticFrontendUserDataCollection","userDataKey","_conn","data","concat","subscribeFrontendUserData","onChange","subscribe"],"sources":["/workspaces/frontend/src/data/frontend.ts"],"sourcesContent":["import { Connection } from \"home-assistant-js-websocket\";\nimport { getOptimisticCollection } from \"./collection\";\n\nexport interface CoreFrontendUserData {\n  showAdvanced?: boolean;\n}\n\ndeclare global {\n  interface FrontendUserData {\n    core: CoreFrontendUserData;\n  }\n}\n\nexport type ValidUserDataKey = keyof FrontendUserData;\n\nexport const fetchFrontendUserData = async <\n  UserDataKey extends ValidUserDataKey,\n>(\n  conn: Connection,\n  key: UserDataKey\n): Promise<FrontendUserData[UserDataKey] | null> => {\n  const result = await conn.sendMessagePromise<{\n    value: FrontendUserData[UserDataKey] | null;\n  }>({\n    type: \"frontend/get_user_data\",\n    key,\n  });\n  return result.value;\n};\n\nexport const saveFrontendUserData = async <\n  UserDataKey extends ValidUserDataKey,\n>(\n  conn: Connection,\n  key: UserDataKey,\n  value: FrontendUserData[UserDataKey]\n): Promise<void> =>\n  conn.sendMessagePromise<void>({\n    type: \"frontend/set_user_data\",\n    key,\n    value,\n  });\n\nexport const getOptimisticFrontendUserDataCollection = <\n  UserDataKey extends ValidUserDataKey,\n>(\n  conn: Connection,\n  userDataKey: UserDataKey\n) =>\n  getOptimisticCollection(\n    (_conn, data) =>\n      saveFrontendUserData(\n        conn,\n        userDataKey,\n        // @ts-ignore\n        data\n      ),\n    conn,\n    `_frontendUserData-${userDataKey}`,\n    () => fetchFrontendUserData(conn, userDataKey)\n  );\n\nexport const subscribeFrontendUserData = <UserDataKey extends ValidUserDataKey>(\n  conn: Connection,\n  userDataKey: UserDataKey,\n  onChange: (state: FrontendUserData[UserDataKey] | null) => void\n) =>\n  getOptimisticFrontendUserDataCollection(conn, userDataKey).subscribe(\n    onChange\n  );\n"],"mappings":";;AACA,SAASA,uBAAuB,QAAQ,cAAc;AActD,OAAO,IAAMC,qBAAqB;EAAA,IAAAC,IAAA,GAAAC,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QAGnCC,IAAgB,EAChBC,GAAgB;IAAA,IAAAC,MAAA;IAAA,OAAAL,mBAAA,GAAAM,IAAA,UAAAC,SAAAC,QAAA;MAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;QAAA;UAAAF,QAAA,CAAAE,IAAA;UAAA,OAEKP,IAAI,CAACQ,kBAAkB,CAEzC;YACDC,IAAI,EAAE,wBAAwB;YAC9BR,GAAG,EAAHA;UACF,CAAC,CAAC;QAAA;UALIC,MAAM,GAAAG,QAAA,CAAAK,IAAA;UAAA,OAAAL,QAAA,CAAAM,MAAA,WAMLT,MAAM,CAACU,KAAK;QAAA;QAAA;UAAA,OAAAP,QAAA,CAAAQ,IAAA;MAAA;IAAA,GAAAd,OAAA;EAAA,CACpB;EAAA,gBAbYL,qBAAqBA,CAAAoB,EAAA,EAAAC,GAAA;IAAA,OAAApB,IAAA,CAAAqB,KAAA,OAAAC,SAAA;EAAA;AAAA,GAajC;AAED,OAAO,IAAMC,oBAAoB;EAAA,IAAAC,KAAA,GAAAvB,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAsB,SAGlCpB,IAAgB,EAChBC,GAAgB,EAChBW,KAAoC;IAAA,OAAAf,mBAAA,GAAAM,IAAA,UAAAkB,UAAAC,SAAA;MAAA,kBAAAA,SAAA,CAAAhB,IAAA,GAAAgB,SAAA,CAAAf,IAAA;QAAA;UAAA,OAAAe,SAAA,CAAAX,MAAA,WAEpCX,IAAI,CAACQ,kBAAkB,CAAO;YAC5BC,IAAI,EAAE,wBAAwB;YAC9BR,GAAG,EAAHA,GAAG;YACHW,KAAK,EAALA;UACF,CAAC,CAAC;QAAA;QAAA;UAAA,OAAAU,SAAA,CAAAT,IAAA;MAAA;IAAA,GAAAO,QAAA;EAAA;EAAA,gBAXSF,oBAAoBA,CAAAK,GAAA,EAAAC,GAAA,EAAAC,GAAA;IAAA,OAAAN,KAAA,CAAAH,KAAA,OAAAC,SAAA;EAAA;AAAA,GAW7B;AAEJ,OAAO,IAAMS,uCAAuC,GAAG,SAA1CA,uCAAuCA,CAGlD1B,IAAgB,EAChB2B,WAAwB;EAAA,OAExBlC,uBAAuB,CACrB,UAACmC,KAAK,EAAEC,IAAI;IAAA,OACVX,oBAAoB,CAClBlB,IAAI,EACJ2B,WAAW;IACX;IACAE,IACF,CAAC;EAAA,GACH7B,IAAI,uBAAA8B,MAAA,CACiBH,WAAW,GAChC;IAAA,OAAMjC,qBAAqB,CAACM,IAAI,EAAE2B,WAAW,CAAC;EAAA,CAChD,CAAC;AAAA;AAEH,OAAO,IAAMI,yBAAyB,GAAG,SAA5BA,yBAAyBA,CACpC/B,IAAgB,EAChB2B,WAAwB,EACxBK,QAA+D;EAAA,OAE/DN,uCAAuC,CAAC1B,IAAI,EAAE2B,WAAW,CAAC,CAACM,SAAS,CAClED,QACF,CAAC;AAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}