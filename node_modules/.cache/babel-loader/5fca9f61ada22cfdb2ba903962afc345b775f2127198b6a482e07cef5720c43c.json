{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport \"core-js/modules/es.error.cause.js\";\nimport { BROWSER_PLAYER, MediaPlayerEntityFeature } from \"../../data/media-player\";\nexport var ERR_UNSUPPORTED_MEDIA = \"Unsupported Media\";\nexport var BrowserMediaPlayer = /*#__PURE__*/function () {\n  function BrowserMediaPlayer(hass, item, resolved, volume, onChange) {\n    var _this = this;\n    _classCallCheck(this, BrowserMediaPlayer);\n    this.hass = hass;\n    this.item = item;\n    this.resolved = resolved;\n    this.onChange = onChange;\n    this.player = void 0;\n    // We pretend we're playing while still buffering.\n    this.buffering = true;\n    this._removed = false;\n    this._handleChange = function () {\n      if (!_this._removed) {\n        _this.onChange();\n      }\n    };\n    var player = new Audio(this.resolved.url);\n    if (player.canPlayType(resolved.mime_type) === \"\") {\n      throw new Error(ERR_UNSUPPORTED_MEDIA);\n    }\n    player.autoplay = true;\n    player.volume = volume;\n    player.addEventListener(\"play\", this._handleChange);\n    player.addEventListener(\"playing\", function () {\n      _this.buffering = false;\n      _this._handleChange();\n    });\n    player.addEventListener(\"pause\", this._handleChange);\n    player.addEventListener(\"ended\", this._handleChange);\n    player.addEventListener(\"canplaythrough\", this._handleChange);\n    this.player = player;\n  }\n  _createClass(BrowserMediaPlayer, [{\n    key: \"pause\",\n    value: function pause() {\n      this.buffering = false;\n      this.player.pause();\n    }\n  }, {\n    key: \"play\",\n    value: function play() {\n      this.player.play();\n    }\n  }, {\n    key: \"setVolume\",\n    value: function setVolume(volume) {\n      this.player.volume = volume;\n      this.onChange();\n    }\n  }, {\n    key: \"remove\",\n    value: function remove() {\n      this._removed = true;\n      // @ts-ignore\n      this.onChange = undefined;\n      if (this.player) {\n        this.player.pause();\n      }\n    }\n  }, {\n    key: \"toStateObj\",\n    value: function toStateObj() {\n      // https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement\n      var stateObj = BrowserMediaPlayer.idleStateObj();\n      stateObj.state = this.buffering ? \"buffering\" : this.player.paused || this.player.ended ? \"paused\" : \"playing\";\n      stateObj.attributes = {\n        media_title: this.item.title,\n        entity_picture: this.item.thumbnail,\n        volume_level: this.player.volume,\n        supported_features:\n        // eslint-disable-next-line no-bitwise\n        MediaPlayerEntityFeature.PLAY |\n        // eslint-disable-next-line no-bitwise\n        MediaPlayerEntityFeature.PAUSE | MediaPlayerEntityFeature.VOLUME_SET\n      };\n      if (this.player.duration) {\n        stateObj.attributes.media_duration = this.player.duration;\n        stateObj.attributes.media_position = this.player.currentTime;\n        stateObj.attributes.media_position_updated_at = stateObj.last_updated;\n      }\n      return stateObj;\n    }\n  }], [{\n    key: \"idleStateObj\",\n    value: function idleStateObj() {\n      var now = new Date().toISOString();\n      return {\n        state: \"idle\",\n        entity_id: BROWSER_PLAYER,\n        last_changed: now,\n        last_updated: now,\n        attributes: {},\n        context: {\n          id: \"\",\n          user_id: null,\n          parent_id: null\n        }\n      };\n    }\n  }]);\n  return BrowserMediaPlayer;\n}();","map":{"version":3,"names":["BROWSER_PLAYER","MediaPlayerEntityFeature","ERR_UNSUPPORTED_MEDIA","BrowserMediaPlayer","hass","item","resolved","volume","onChange","_this","_classCallCheck","player","buffering","_removed","_handleChange","Audio","url","canPlayType","mime_type","Error","autoplay","addEventListener","_createClass","key","value","pause","play","setVolume","remove","undefined","toStateObj","stateObj","idleStateObj","state","paused","ended","attributes","media_title","title","entity_picture","thumbnail","volume_level","supported_features","PLAY","PAUSE","VOLUME_SET","duration","media_duration","media_position","currentTime","media_position_updated_at","last_updated","now","Date","toISOString","entity_id","last_changed","context","id","user_id","parent_id"],"sources":["/Users/sercanardil/Desktop/frontend/src/panels/media-browser/browser-media-player.ts"],"sourcesContent":["import {\n  BROWSER_PLAYER,\n  MediaPlayerEntity,\n  MediaPlayerEntityFeature,\n  MediaPlayerItem,\n} from \"../../data/media-player\";\nimport { ResolvedMediaSource } from \"../../data/media_source\";\nimport { HomeAssistant } from \"../../types\";\n\nexport const ERR_UNSUPPORTED_MEDIA = \"Unsupported Media\";\n\nexport class BrowserMediaPlayer {\n  private player: HTMLAudioElement;\n\n  // We pretend we're playing while still buffering.\n  public buffering = true;\n\n  private _removed = false;\n\n  constructor(\n    public hass: HomeAssistant,\n    public item: MediaPlayerItem,\n    public resolved: ResolvedMediaSource,\n    volume: number,\n    private onChange: () => void\n  ) {\n    const player = new Audio(this.resolved.url);\n    if (player.canPlayType(resolved.mime_type) === \"\") {\n      throw new Error(ERR_UNSUPPORTED_MEDIA);\n    }\n    player.autoplay = true;\n    player.volume = volume;\n    player.addEventListener(\"play\", this._handleChange);\n    player.addEventListener(\"playing\", () => {\n      this.buffering = false;\n      this._handleChange();\n    });\n    player.addEventListener(\"pause\", this._handleChange);\n    player.addEventListener(\"ended\", this._handleChange);\n    player.addEventListener(\"canplaythrough\", this._handleChange);\n    this.player = player;\n  }\n\n  private _handleChange = () => {\n    if (!this._removed) {\n      this.onChange();\n    }\n  };\n\n  public pause() {\n    this.buffering = false;\n    this.player.pause();\n  }\n\n  public play() {\n    this.player.play();\n  }\n\n  public setVolume(volume: number) {\n    this.player.volume = volume;\n    this.onChange();\n  }\n\n  public remove() {\n    this._removed = true;\n    // @ts-ignore\n    this.onChange = undefined;\n    if (this.player) {\n      this.player.pause();\n    }\n  }\n\n  static idleStateObj(): MediaPlayerEntity {\n    const now = new Date().toISOString();\n    return {\n      state: \"idle\",\n      entity_id: BROWSER_PLAYER,\n      last_changed: now,\n      last_updated: now,\n      attributes: {},\n      context: { id: \"\", user_id: null, parent_id: null },\n    };\n  }\n\n  toStateObj(): MediaPlayerEntity {\n    // https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement\n    const stateObj = BrowserMediaPlayer.idleStateObj();\n    stateObj.state = this.buffering\n      ? \"buffering\"\n      : this.player.paused || this.player.ended\n        ? \"paused\"\n        : \"playing\";\n    stateObj.attributes = {\n      media_title: this.item.title,\n      entity_picture: this.item.thumbnail,\n      volume_level: this.player.volume,\n      supported_features:\n        // eslint-disable-next-line no-bitwise\n        MediaPlayerEntityFeature.PLAY |\n        // eslint-disable-next-line no-bitwise\n        MediaPlayerEntityFeature.PAUSE |\n        MediaPlayerEntityFeature.VOLUME_SET,\n    };\n\n    if (this.player.duration) {\n      stateObj.attributes.media_duration = this.player.duration;\n      stateObj.attributes.media_position = this.player.currentTime;\n      stateObj.attributes.media_position_updated_at = stateObj.last_updated;\n    }\n    return stateObj;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}