{"ast":null,"code":"import _createClass from \"@babel/runtime/helpers/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _callSuper from \"@babel/runtime/helpers/callSuper\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _decorate from \"@babel/runtime/helpers/decorate\";\nimport _get from \"@babel/runtime/helpers/get\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { navigate } from \"../../../common/navigate\";\nimport { HassRouterPage } from \"../../../layouts/hass-router-page\";\nimport \"./account/cloud-account\";\nimport \"./login/cloud-login\";\nvar LOGGED_IN_URLS = [\"account\", \"google-assistant\", \"alexa\"];\nvar NOT_LOGGED_IN_URLS = [\"login\", \"register\", \"forgot-password\"];\nvar HaConfigCloud = _decorate([customElement(\"ha-config-cloud\")], function (_initialize, _HassRouterPage) {\n  var HaConfigCloud = /*#__PURE__*/function (_HassRouterPage2) {\n    _inherits(HaConfigCloud, _HassRouterPage2);\n    function HaConfigCloud() {\n      var _this;\n      _classCallCheck(this, HaConfigCloud);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _callSuper(this, HaConfigCloud, [].concat(args));\n      _initialize(_assertThisInitialized(_this));\n      return _this;\n    }\n    return _createClass(HaConfigCloud);\n  }(_HassRouterPage);\n  return {\n    F: HaConfigCloud,\n    d: [{\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Boolean\n      })],\n      key: \"isWide\",\n      value: function value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Boolean\n      })],\n      key: \"narrow\",\n      value: function value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"route\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"cloudStatus\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      key: \"routerOptions\",\n      value: function value() {\n        var _this2 = this;\n        return {\n          defaultPage: \"login\",\n          showLoading: true,\n          initialLoad: function initialLoad() {\n            return _this2._cloudStatusLoaded;\n          },\n          // Guard the different pages based on if we're logged in.\n          beforeRender: function beforeRender(page) {\n            if (_this2.cloudStatus.logged_in) {\n              if (!LOGGED_IN_URLS.includes(page)) {\n                return \"account\";\n              }\n            } else if (!NOT_LOGGED_IN_URLS.includes(page)) {\n              return \"login\";\n            }\n            return undefined;\n          },\n          routes: {\n            login: {\n              tag: \"cloud-login\"\n            },\n            register: {\n              tag: \"cloud-register\",\n              load: function load() {\n                return import(\"./register/cloud-register\");\n              }\n            },\n            \"forgot-password\": {\n              tag: \"cloud-forgot-password\",\n              load: function load() {\n                return import(\"./forgot-password/cloud-forgot-password\");\n              }\n            },\n            account: {\n              tag: \"cloud-account\"\n            }\n          }\n        };\n      }\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_flashMessage\",\n      value: function value() {\n        return \"\";\n      }\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_loginEmail\",\n      value: function value() {\n        return \"\";\n      }\n    }, {\n      kind: \"field\",\n      key: \"_resolveCloudStatusLoaded\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      key: \"_cloudStatusLoaded\",\n      value: function value() {\n        var _this3 = this;\n        return new Promise(function (resolve) {\n          _this3._resolveCloudStatusLoaded = resolve;\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"firstUpdated\",\n      value: function firstUpdated(changedProps) {\n        var _this4 = this;\n        _get(_getPrototypeOf(HaConfigCloud.prototype), \"firstUpdated\", this).call(this, changedProps);\n        this.addEventListener(\"cloud-done\", function (ev) {\n          _this4._flashMessage = ev.detail.flashMessage;\n          navigate(\"/config/cloud/login\");\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"updated\",\n      value: function updated(changedProps) {\n        _get(_getPrototypeOf(HaConfigCloud.prototype), \"updated\", this).call(this, changedProps);\n        if (changedProps.has(\"cloudStatus\")) {\n          var oldStatus = changedProps.get(\"cloudStatus\");\n          if (oldStatus === undefined) {\n            this._resolveCloudStatusLoaded();\n          } else if (oldStatus.logged_in !== this.cloudStatus.logged_in) {\n            navigate(this.route.prefix, {\n              replace: true\n            });\n          }\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"createElement\",\n      value: function createElement(tag) {\n        var _this5 = this;\n        var el = _get(_getPrototypeOf(HaConfigCloud.prototype), \"createElement\", this).call(this, tag);\n        el.addEventListener(\"email-changed\", function (ev) {\n          _this5._loginEmail = ev.detail.value;\n        });\n        el.addEventListener(\"flash-message-changed\", function (ev) {\n          _this5._flashMessage = ev.detail.value;\n        });\n        return el;\n      }\n    }, {\n      kind: \"method\",\n      key: \"updatePageEl\",\n      value: function updatePageEl(el) {\n        // We are not going to update if the current page if we are not logged in\n        // and the current page requires being logged in. Happens when we log out.\n        if (this.cloudStatus && !this.cloudStatus.logged_in && LOGGED_IN_URLS.includes(this._currentPage)) {\n          return;\n        }\n        el.hass = this.hass;\n        el.email = this._loginEmail;\n        el.isWide = this.isWide;\n        el.narrow = this.narrow;\n        el.cloudStatus = this.cloudStatus;\n        el.flashMessage = this._flashMessage;\n      }\n    }]\n  };\n}, HassRouterPage);","map":{"version":3,"names":["customElement","property","state","navigate","HassRouterPage","LOGGED_IN_URLS","NOT_LOGGED_IN_URLS","HaConfigCloud","_decorate","_initialize","_HassRouterPage","_HassRouterPage2","_inherits","_this","_classCallCheck","_len","arguments","length","args","Array","_key","_callSuper","concat","_assertThisInitialized","_createClass","F","d","kind","decorators","attribute","key","value","type","Boolean","_this2","defaultPage","showLoading","initialLoad","_cloudStatusLoaded","beforeRender","page","cloudStatus","logged_in","includes","undefined","routes","login","tag","register","load","account","_this3","Promise","resolve","_resolveCloudStatusLoaded","firstUpdated","changedProps","_this4","_get","_getPrototypeOf","prototype","call","addEventListener","ev","_flashMessage","detail","flashMessage","updated","has","oldStatus","get","route","prefix","replace","createElement","_this5","el","_loginEmail","updatePageEl","_currentPage","hass","email","isWide","narrow"],"sources":["/workspaces/frontend/src/panels/config/cloud/ha-config-cloud.ts"],"sourcesContent":["import { customElement, property, state } from \"lit/decorators\";\nimport { navigate } from \"../../../common/navigate\";\nimport { CloudStatus } from \"../../../data/cloud\";\nimport {\n  HassRouterPage,\n  RouterOptions,\n} from \"../../../layouts/hass-router-page\";\nimport { ValueChangedEvent, HomeAssistant, Route } from \"../../../types\";\nimport \"./account/cloud-account\";\nimport \"./login/cloud-login\";\n\nconst LOGGED_IN_URLS = [\"account\", \"google-assistant\", \"alexa\"];\nconst NOT_LOGGED_IN_URLS = [\"login\", \"register\", \"forgot-password\"];\n\n@customElement(\"ha-config-cloud\")\nclass HaConfigCloud extends HassRouterPage {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ type: Boolean }) public isWide = false;\n\n  @property({ type: Boolean }) public narrow = false;\n\n  @property({ attribute: false }) public route!: Route;\n\n  @property({ attribute: false }) public cloudStatus!: CloudStatus;\n\n  protected routerOptions: RouterOptions = {\n    defaultPage: \"login\",\n    showLoading: true,\n    initialLoad: () => this._cloudStatusLoaded,\n    // Guard the different pages based on if we're logged in.\n    beforeRender: (page: string) => {\n      if (this.cloudStatus.logged_in) {\n        if (!LOGGED_IN_URLS.includes(page)) {\n          return \"account\";\n        }\n      } else if (!NOT_LOGGED_IN_URLS.includes(page)) {\n        return \"login\";\n      }\n      return undefined;\n    },\n    routes: {\n      login: {\n        tag: \"cloud-login\",\n      },\n      register: {\n        tag: \"cloud-register\",\n        load: () => import(\"./register/cloud-register\"),\n      },\n      \"forgot-password\": {\n        tag: \"cloud-forgot-password\",\n        load: () => import(\"./forgot-password/cloud-forgot-password\"),\n      },\n      account: {\n        tag: \"cloud-account\",\n      },\n    },\n  };\n\n  @state() private _flashMessage = \"\";\n\n  @state() private _loginEmail = \"\";\n\n  private _resolveCloudStatusLoaded!: () => void;\n\n  private _cloudStatusLoaded = new Promise<void>((resolve) => {\n    this._resolveCloudStatusLoaded = resolve;\n  });\n\n  protected firstUpdated(changedProps) {\n    super.firstUpdated(changedProps);\n    this.addEventListener(\"cloud-done\", (ev) => {\n      this._flashMessage = (ev as any).detail.flashMessage;\n      navigate(\"/config/cloud/login\");\n    });\n  }\n\n  protected updated(changedProps) {\n    super.updated(changedProps);\n\n    if (changedProps.has(\"cloudStatus\")) {\n      const oldStatus = changedProps.get(\"cloudStatus\") as\n        | CloudStatus\n        | undefined;\n      if (oldStatus === undefined) {\n        this._resolveCloudStatusLoaded();\n      } else if (oldStatus.logged_in !== this.cloudStatus.logged_in) {\n        navigate(this.route.prefix, { replace: true });\n      }\n    }\n  }\n\n  protected createElement(tag: string) {\n    const el = super.createElement(tag);\n    el.addEventListener(\"email-changed\", (ev) => {\n      this._loginEmail = (ev as ValueChangedEvent<string>).detail.value;\n    });\n    el.addEventListener(\"flash-message-changed\", (ev) => {\n      this._flashMessage = (ev as ValueChangedEvent<string>).detail.value;\n    });\n    return el;\n  }\n\n  protected updatePageEl(el) {\n    // We are not going to update if the current page if we are not logged in\n    // and the current page requires being logged in. Happens when we log out.\n    if (\n      this.cloudStatus &&\n      !this.cloudStatus.logged_in &&\n      LOGGED_IN_URLS.includes(this._currentPage)\n    ) {\n      return;\n    }\n\n    el.hass = this.hass;\n    el.email = this._loginEmail;\n    el.isWide = this.isWide;\n    el.narrow = this.narrow;\n    el.cloudStatus = this.cloudStatus;\n    el.flashMessage = this._flashMessage;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-config-cloud\": HaConfigCloud;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}