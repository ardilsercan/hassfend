{"ast":null,"code":"import _callSuper from \"@babel/runtime/helpers/callSuper\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _decorate from \"@babel/runtime/helpers/decorate\";\nimport _get from \"@babel/runtime/helpers/get\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6, _templateObject7, _templateObject8, _templateObject9, _templateObject10;\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nvar mdiAlertCircle = \"M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z\";\nvar mdiCircle = \"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z\";\nvar mdiCircleOutline = \"M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z\";\nvar mdiProgressClock = \"M13,2.03V2.05L13,4.05C17.39,4.59 20.5,8.58 19.96,12.97C19.5,16.61 16.64,19.5 13,19.93V21.93C18.5,21.38 22.5,16.5 21.95,11C21.5,6.25 17.73,2.5 13,2.03M11,2.06C9.05,2.25 7.19,3 5.67,4.26L7.1,5.74C8.22,4.84 9.57,4.26 11,4.06V2.06M4.26,5.67C3,7.19 2.25,9.04 2.05,11H4.05C4.24,9.58 4.8,8.23 5.69,7.1L4.26,5.67M2.06,13C2.26,14.96 3.03,16.81 4.27,18.33L5.69,16.9C4.81,15.77 4.24,14.42 4.06,13H2.06M7.1,18.37L5.67,19.74C7.18,21 9.04,21.79 11,22V20C9.58,19.82 8.23,19.25 7.1,18.37M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z\";\nvar mdiProgressWrench = \"M13,2.03V2.05L13,4.05C17.39,4.59 20.5,8.58 19.96,12.97C19.5,16.61 16.64,19.5 13,19.93V21.93C18.5,21.38 22.5,16.5 21.95,11C21.5,6.25 17.73,2.5 13,2.03M11,2.06C9.05,2.25 7.19,3 5.67,4.26L7.1,5.74C8.22,4.84 9.57,4.26 11,4.06V2.06M4.26,5.67C3,7.19 2.25,9.04 2.05,11H4.05C4.24,9.58 4.8,8.23 5.69,7.1L4.26,5.67M2.06,13C2.26,14.96 3.03,16.81 4.27,18.33L5.69,16.9C4.81,15.77 4.24,14.42 4.06,13H2.06M7.1,18.37L5.67,19.74C7.18,21 9.04,21.79 11,22V20C9.58,19.82 8.23,19.25 7.1,18.37M16.82,15.19L12.71,11.08C13.12,10.04 12.89,8.82 12.03,7.97C11.13,7.06 9.78,6.88 8.69,7.38L10.63,9.32L9.28,10.68L7.29,8.73C6.75,9.82 7,11.17 7.88,12.08C8.74,12.94 9.96,13.16 11,12.76L15.11,16.86C15.29,17.05 15.56,17.05 15.74,16.86L16.78,15.83C17,15.65 17,15.33 16.82,15.19Z\";\nvar mdiRecordCircleOutline = \"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { ifDefined } from \"lit/directives/if-defined\";\nimport { formatDateTimeWithSeconds } from \"../../common/datetime/format_date_time\";\nimport { relativeTime } from \"../../common/datetime/relative_time\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport { toggleAttribute } from \"../../common/dom/toggle_attribute\";\nimport { subscribeEntityRegistry } from \"../../data/entity_registry\";\nimport { getActionType } from \"../../data/script\";\nimport { describeAction } from \"../../data/script_i18n\";\nimport { getDataFromPath, isTriggerPath } from \"../../data/trace\";\nimport \"./ha-timeline\";\nvar LOGBOOK_ENTRIES_BEFORE_FOLD = 2;\n\n/* eslint max-classes-per-file: \"off\" */\n\n// Report time entry when more than this time has passed\nvar SIGNIFICANT_TIME_CHANGE = 1000; // 1 seconds\n\nvar isSignificantTimeChange = function isSignificantTimeChange(a, b) {\n  return Math.abs(b.getTime() - a.getTime()) > SIGNIFICANT_TIME_CHANGE;\n};\nvar RenderedTimeTracker = /*#__PURE__*/function () {\n  function RenderedTimeTracker(hass, entries, trace) {\n    _classCallCheck(this, RenderedTimeTracker);\n    this.hass = hass;\n    this.entries = entries;\n    this.lastReportedTime = void 0;\n    this.lastReportedTime = new Date(trace.timestamp.start);\n  }\n  _createClass(RenderedTimeTracker, [{\n    key: \"setLastReportedTime\",\n    value: function setLastReportedTime(date) {\n      this.lastReportedTime = date;\n    }\n  }, {\n    key: \"renderTime\",\n    value: function renderTime(from, to) {\n      this.entries.push(html(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n      <ha-timeline label>\\n        \", \" later\\n      </ha-timeline>\\n    \"])), relativeTime(from, this.hass.locale, to, false)));\n      this.lastReportedTime = to;\n    }\n  }, {\n    key: \"maybeRenderTime\",\n    value: function maybeRenderTime(timestamp) {\n      if (!isSignificantTimeChange(timestamp, this.lastReportedTime)) {\n        this.lastReportedTime = timestamp;\n        return false;\n      }\n      this.renderTime(this.lastReportedTime, timestamp);\n      return true;\n    }\n  }]);\n  return RenderedTimeTracker;\n}();\nvar LogbookRenderer = /*#__PURE__*/function () {\n  function LogbookRenderer(entries, timeTracker, logbookEntries) {\n    _classCallCheck(this, LogbookRenderer);\n    this.entries = entries;\n    this.timeTracker = timeTracker;\n    this.logbookEntries = logbookEntries;\n    this.curIndex = void 0;\n    this.pendingItems = [];\n    // Skip the \"automation got triggered item\"\n    this.curIndex = logbookEntries.length > 0 && logbookEntries[0].domain === \"automation\" ? 1 : 0;\n  }\n  _createClass(LogbookRenderer, [{\n    key: \"curItem\",\n    get: function get() {\n      return this.logbookEntries[this.curIndex];\n    }\n  }, {\n    key: \"hasNext\",\n    get: function get() {\n      return this.curIndex < this.logbookEntries.length;\n    }\n  }, {\n    key: \"maybeRenderItem\",\n    value: function maybeRenderItem() {\n      var logbookEntry = this.curItem;\n      this.curIndex++;\n      var entryDate = new Date(logbookEntry.when * 1000);\n      if (this.pendingItems.length === 0) {\n        this.pendingItems.push([entryDate, logbookEntry]);\n        return;\n      }\n      var previousEntryDate = this.pendingItems[this.pendingItems.length - 1][0];\n\n      // If logbook entry is too long after the last one,\n      // add a time passed label\n      if (isSignificantTimeChange(previousEntryDate, entryDate)) {\n        this._renderLogbookEntries();\n        this.timeTracker.renderTime(previousEntryDate, entryDate);\n      }\n      this.pendingItems.push([entryDate, logbookEntry]);\n    }\n  }, {\n    key: \"flush\",\n    value: function flush() {\n      if (this.pendingItems.length > 0) {\n        this._renderLogbookEntries();\n      }\n    }\n  }, {\n    key: \"_renderLogbookEntries\",\n    value: function _renderLogbookEntries() {\n      this.timeTracker.maybeRenderTime(this.pendingItems[0][0]);\n      var parts = [];\n      var i;\n      for (i = 0; i < Math.min(this.pendingItems.length, LOGBOOK_ENTRIES_BEFORE_FOLD); i++) {\n        parts.push(this._renderLogbookEntryHelper(this.pendingItems[i][1]));\n      }\n      var moreItems;\n\n      // If we didn't render all items, push rest into `moreItems`\n      if (i < this.pendingItems.length) {\n        moreItems = [];\n        for (; i < this.pendingItems.length; i++) {\n          moreItems.push(this._renderLogbookEntryHelper(this.pendingItems[i][1]));\n        }\n      }\n      this.entries.push(html(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\\n      <ha-timeline .icon=\", \" .moreItems=\", \">\\n        \", \"\\n      </ha-timeline>\\n    \"])), mdiCircleOutline, moreItems, parts));\n\n      // Clear rendered items.\n      this.timeTracker.setLastReportedTime(this.pendingItems[this.pendingItems.length - 1][0]);\n      this.pendingItems = [];\n    }\n  }, {\n    key: \"_renderLogbookEntryHelper\",\n    value: function _renderLogbookEntryHelper(entry) {\n      return html(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\", \" (\", \")\\n      \", \"<br />\"])), entry.name, entry.entity_id, entry.message || \"turned \".concat(entry.state));\n    }\n  }]);\n  return LogbookRenderer;\n}();\nvar ActionRenderer = /*#__PURE__*/function () {\n  function ActionRenderer(hass, entityReg, entries, trace, logbookRenderer, timeTracker) {\n    _classCallCheck(this, ActionRenderer);\n    this.hass = hass;\n    this.entityReg = entityReg;\n    this.entries = entries;\n    this.trace = trace;\n    this.logbookRenderer = logbookRenderer;\n    this.timeTracker = timeTracker;\n    this.curIndex = 0;\n    this.keys = void 0;\n    this.keys = Object.keys(trace.trace);\n  }\n  _createClass(ActionRenderer, [{\n    key: \"curItem\",\n    get: function get() {\n      return this._getItem(this.curIndex);\n    }\n  }, {\n    key: \"hasNext\",\n    get: function get() {\n      return this.curIndex < this.keys.length;\n    }\n  }, {\n    key: \"renderItem\",\n    value: function renderItem() {\n      this.curIndex = this._renderItem(this.curIndex);\n    }\n  }, {\n    key: \"_getItem\",\n    value: function _getItem(index) {\n      return this.trace.trace[this.keys[index]];\n    }\n  }, {\n    key: \"_renderItem\",\n    value: function _renderItem(index, actionType, renderAllIterations) {\n      var _this = this;\n      var value = this._getItem(index);\n      if (renderAllIterations) {\n        var i;\n        value.forEach(function (item) {\n          i = _this._renderIteration(index, item, actionType);\n        });\n        return i;\n      }\n      return this._renderIteration(index, value[0], actionType);\n    }\n  }, {\n    key: \"_renderIteration\",\n    value: function _renderIteration(index, value, actionType) {\n      if (isTriggerPath(value.path)) {\n        return this._handleTrigger(index, value);\n      }\n      var timestamp = new Date(value.timestamp);\n\n      // Render all logbook items that are in front of this item.\n      while (this.logbookRenderer.hasNext && new Date(this.logbookRenderer.curItem.when * 1000) < timestamp) {\n        this.logbookRenderer.maybeRenderItem();\n      }\n      this.logbookRenderer.flush();\n      this.timeTracker.maybeRenderTime(timestamp);\n      var path = value.path;\n      var data;\n      try {\n        data = getDataFromPath(this.trace.config, path);\n      } catch (err) {\n        this._renderEntry(path, \"Unable to extract path \".concat(path, \". Download trace and report as bug\"));\n        return index + 1;\n      }\n      var parts = path.split(\"/\");\n      var isTopLevel = parts.length === 2;\n      if (!isTopLevel && !actionType) {\n        this._renderEntry(path, path.replace(/\\//g, \" \"));\n        return index + 1;\n      }\n      if (!actionType) {\n        actionType = getActionType(data);\n      }\n      if (actionType === \"choose\") {\n        return this._handleChoose(index);\n      }\n      if (actionType === \"repeat\") {\n        return this._handleRepeat(index);\n      }\n      if (actionType === \"if\") {\n        return this._handleIf(index);\n      }\n      if (actionType === \"parallel\") {\n        return this._handleParallel(index);\n      }\n      this._renderEntry(path, describeAction(this.hass, this.entityReg, data, actionType), undefined, data.enabled === false);\n      var i = index + 1;\n      for (; i < this.keys.length; i++) {\n        if (this.keys[i].split(\"/\").length === parts.length) {\n          break;\n        }\n      }\n      return i;\n    }\n  }, {\n    key: \"_handleTrigger\",\n    value: function _handleTrigger(index, triggerStep) {\n      this._renderEntry(triggerStep.path, \"\".concat(triggerStep.changed_variables.trigger.alias ? \"\".concat(triggerStep.changed_variables.trigger.alias, \" triggered\") : \"Triggered\", \" \").concat(triggerStep.path === \"trigger\" ? \"manually\" : \"by the \".concat(this.trace.trigger), \" at\\n    \").concat(formatDateTimeWithSeconds(new Date(triggerStep.timestamp), this.hass.locale, this.hass.config)), mdiCircle);\n      return index + 1;\n    }\n  }, {\n    key: \"_handleChoose\",\n    value: function _handleChoose(index) {\n      var _chooseTrace$result;\n      // startLevel: choose root config\n\n      // +1: 'default\n      // +2: executed sequence\n\n      // +1: 'choose'\n      // +2: current choice\n\n      // +3: 'conditions'\n      // +4: evaluated condition\n\n      // +3: 'sequence'\n      // +4: executed sequence\n\n      var choosePath = this.keys[index];\n      var startLevel = choosePath.split(\"/\").length;\n      var chooseTrace = this._getItem(index)[0];\n      var defaultExecuted = ((_chooseTrace$result = chooseTrace.result) === null || _chooseTrace$result === void 0 ? void 0 : _chooseTrace$result.choice) === \"default\";\n      var chooseConfig = this._getDataFromPath(this.keys[index]);\n      var disabled = chooseConfig.enabled === false;\n      var name = chooseConfig.alias || \"Choose\";\n      if (defaultExecuted) {\n        this._renderEntry(choosePath, \"\".concat(name, \": Default action executed\"), undefined, disabled);\n      } else if (chooseTrace.result) {\n        var choiceNumeric = chooseTrace.result.choice !== \"default\" ? chooseTrace.result.choice + 1 : undefined;\n        var choiceConfig = this._getDataFromPath(\"\".concat(this.keys[index], \"/choose/\").concat(chooseTrace.result.choice));\n        var choiceName = choiceConfig ? \"\".concat(choiceConfig.alias || \"Option \".concat(choiceNumeric), \" executed\") : \"Error: \".concat(chooseTrace.error);\n        this._renderEntry(choosePath, \"\".concat(name, \": \").concat(choiceName), undefined, disabled);\n      } else {\n        this._renderEntry(choosePath, \"\".concat(name, \": No action taken\"), undefined, disabled);\n      }\n      var i;\n\n      // Skip over conditions\n      for (i = index + 1; i < this.keys.length; i++) {\n        var parts = this.keys[i].split(\"/\");\n\n        // We're done if no more sequence in current level\n        if (parts.length <= startLevel) {\n          return i;\n        }\n\n        // We're going to skip all conditions\n        if (defaultExecuted && parts[startLevel + 1] === \"default\" || !defaultExecuted && parts[startLevel + 3] === \"sequence\") {\n          break;\n        }\n      }\n\n      // Render choice\n      while (i < this.keys.length) {\n        var path = this.keys[i];\n        var _parts = path.split(\"/\");\n\n        // We're done if no more sequence in current level\n        if (_parts.length <= startLevel) {\n          return i;\n        }\n\n        // We know it's an action sequence, so force the type like that\n        // for rendering.\n        i = this._renderItem(i, getActionType(this._getDataFromPath(path)));\n      }\n      return i;\n    }\n  }, {\n    key: \"_handleRepeat\",\n    value: function _handleRepeat(index) {\n      var repeatPath = this.keys[index];\n      var startLevel = repeatPath.split(\"/\").length;\n      var repeatConfig = this._getDataFromPath(this.keys[index]);\n      var disabled = repeatConfig.enabled === false;\n      var name = repeatConfig.alias || describeAction(this.hass, this.entityReg, repeatConfig);\n      this._renderEntry(repeatPath, name, undefined, disabled);\n      var i;\n      for (i = index + 1; i < this.keys.length; i++) {\n        var path = this.keys[i];\n        var parts = path.split(\"/\");\n\n        // We're done if no more sequence in current level\n        if (parts.length <= startLevel) {\n          return i;\n        }\n        i = this._renderItem(i, getActionType(this._getDataFromPath(path)), true);\n      }\n      return i;\n    }\n  }, {\n    key: \"_handleIf\",\n    value: function _handleIf(index) {\n      var _ifTrace$result;\n      var ifPath = this.keys[index];\n      var startLevel = ifPath.split(\"/\").length;\n      var ifTrace = this._getItem(index)[0];\n      var ifConfig = this._getDataFromPath(this.keys[index]);\n      var disabled = ifConfig.enabled === false;\n      var name = ifConfig.alias || \"If\";\n      if ((_ifTrace$result = ifTrace.result) !== null && _ifTrace$result !== void 0 && _ifTrace$result.choice) {\n        var choiceConfig = this._getDataFromPath(\"\".concat(this.keys[index], \"/\").concat(ifTrace.result.choice, \"/\"));\n        var choiceName = choiceConfig ? \"\".concat(choiceConfig.alias || \"\".concat(ifTrace.result.choice, \" action executed\")) : \"Error: \".concat(ifTrace.error);\n        this._renderEntry(ifPath, \"\".concat(name, \": \").concat(choiceName), undefined, disabled);\n      } else {\n        this._renderEntry(ifPath, \"\".concat(name, \": No action taken\"), undefined, disabled);\n      }\n      var i;\n\n      // Skip over conditions\n      for (i = index + 1; i < this.keys.length; i++) {\n        var path = this.keys[i];\n        var parts = this.keys[i].split(\"/\");\n\n        // We're done if no more sequence in current level\n        if (parts.length <= startLevel) {\n          return i;\n        }\n\n        // We're going to skip all conditions\n        if (parts[startLevel + 1] === \"condition\" || parts.length < startLevel + 2) {\n          continue;\n        }\n        i = this._renderItem(i, getActionType(this._getDataFromPath(path)));\n      }\n      return i;\n    }\n  }, {\n    key: \"_handleParallel\",\n    value: function _handleParallel(index) {\n      var parallelPath = this.keys[index];\n      var startLevel = parallelPath.split(\"/\").length;\n      var parallelConfig = this._getDataFromPath(this.keys[index]);\n      var disabled = parallelConfig.enabled === false;\n      var name = parallelConfig.alias || \"Execute in parallel\";\n      this._renderEntry(parallelPath, name, undefined, disabled);\n      var i;\n      for (i = index + 1; i < this.keys.length; i++) {\n        var path = this.keys[i];\n        var parts = path.split(\"/\");\n\n        // We're done if no more sequence in current level\n        if (parts.length <= startLevel) {\n          return i;\n        }\n        i = this._renderItem(i, getActionType(this._getDataFromPath(path)));\n      }\n      return i;\n    }\n  }, {\n    key: \"_renderEntry\",\n    value: function _renderEntry(path, description) {\n      var icon = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : mdiRecordCircleOutline;\n      var disabled = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n      this.entries.push(html(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"\\n      <ha-timeline .icon=\", \" data-path=\", \" .notEnabled=\", \">\\n        \", \"\", \"\\n      </ha-timeline>\\n    \"])), icon, path, disabled, description, disabled ? html(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"<span class=\\\"disabled\\\"> (disabled)</span>\"]))) : \"\"));\n    }\n  }, {\n    key: \"_getDataFromPath\",\n    value: function _getDataFromPath(path) {\n      return getDataFromPath(this.trace.config, path);\n    }\n  }]);\n  return ActionRenderer;\n}();\nexport var HaAutomationTracer = _decorate([customElement(\"hat-trace-timeline\")], function (_initialize, _LitElement) {\n  var HaAutomationTracer = /*#__PURE__*/function (_LitElement2) {\n    _inherits(HaAutomationTracer, _LitElement2);\n    function HaAutomationTracer() {\n      var _this2;\n      _classCallCheck(this, HaAutomationTracer);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this2 = _callSuper(this, HaAutomationTracer, [].concat(args));\n      _initialize(_assertThisInitialized(_this2));\n      return _this2;\n    }\n    return _createClass(HaAutomationTracer);\n  }(_LitElement);\n  return {\n    F: HaAutomationTracer,\n    d: [{\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"trace\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"logbookEntries\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"selectedPath\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Boolean\n      })],\n      key: \"allowPick\",\n      value: function value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_entityReg\",\n      value: function value() {\n        return [];\n      }\n    }, {\n      kind: \"method\",\n      key: \"hassSubscribe\",\n      value: function hassSubscribe() {\n        var _this3 = this;\n        return [subscribeEntityRegistry(this.hass.connection, function (entities) {\n          _this3._entityReg = entities;\n        })];\n      }\n    }, {\n      kind: \"method\",\n      key: \"render\",\n      value: function render() {\n        var _this4 = this;\n        if (!this.trace) {\n          return nothing;\n        }\n        var entries = [];\n        var timeTracker = new RenderedTimeTracker(this.hass, entries, this.trace);\n        var logbookRenderer = new LogbookRenderer(entries, timeTracker, this.logbookEntries || []);\n        var actionRenderer = new ActionRenderer(this.hass, this._entityReg, entries, this.trace, logbookRenderer, timeTracker);\n        while (actionRenderer.hasNext) {\n          actionRenderer.renderItem();\n        }\n        while (logbookRenderer.hasNext) {\n          logbookRenderer.maybeRenderItem();\n        }\n        logbookRenderer.flush();\n\n        // Render footer\n        var renderFinishedAt = function renderFinishedAt() {\n          return formatDateTimeWithSeconds(new Date(_this4.trace.timestamp.finish), _this4.hass.locale, _this4.hass.config);\n        };\n        var renderRuntime = function renderRuntime() {\n          return \"(runtime:\\n      \".concat(((new Date(_this4.trace.timestamp.finish).getTime() - new Date(_this4.trace.timestamp.start).getTime()) / 1000).toFixed(2), \"\\n      seconds)\");\n        };\n        var entry;\n        if (this.trace.state === \"running\") {\n          entry = {\n            description: \"Still running\",\n            icon: mdiProgressClock\n          };\n        } else if (this.trace.state === \"debugged\") {\n          entry = {\n            description: \"Debugged\",\n            icon: mdiProgressWrench\n          };\n        } else if (this.trace.script_execution === \"finished\") {\n          entry = {\n            description: \"Finished at \".concat(renderFinishedAt(), \" \").concat(renderRuntime()),\n            icon: mdiCircle\n          };\n        } else if (this.trace.script_execution === \"aborted\") {\n          entry = {\n            description: \"Aborted at \".concat(renderFinishedAt(), \" \").concat(renderRuntime()),\n            icon: mdiAlertCircle\n          };\n        } else if (this.trace.script_execution === \"cancelled\") {\n          entry = {\n            description: \"Cancelled at \".concat(renderFinishedAt(), \" \").concat(renderRuntime()),\n            icon: mdiAlertCircle\n          };\n        } else {\n          var reason;\n          var isError = false;\n          var extra;\n          switch (this.trace.script_execution) {\n            case \"failed_conditions\":\n              reason = \"a condition failed\";\n              break;\n            case \"failed_single\":\n              reason = \"only a single execution is allowed\";\n              break;\n            case \"failed_max_runs\":\n              reason = \"maximum number of parallel runs reached\";\n              break;\n            case \"error\":\n              reason = \"an error was encountered\";\n              isError = true;\n              extra = html(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"<br /><br />\", \"\"])), this.trace.error);\n              break;\n            default:\n              reason = \"of unknown reason \\\"\".concat(this.trace.script_execution, \"\\\"\");\n              isError = true;\n          }\n          entry = {\n            description: html(_templateObject7 || (_templateObject7 = _taggedTemplateLiteral([\"Stopped because \", \" at \", \"\\n        \", \"\", \"\"])), reason, renderFinishedAt(), renderRuntime(), extra || \"\"),\n            icon: mdiAlertCircle,\n            className: isError ? \"error\" : undefined\n          };\n        }\n        entries.push(html(_templateObject8 || (_templateObject8 = _taggedTemplateLiteral([\"\\n      <ha-timeline\\n        lastItem\\n        .icon=\", \"\\n        class=\", \"\\n      >\\n        \", \"\\n      </ha-timeline>\\n    \"])), entry.icon, ifDefined(entry.className), entry.description));\n        return html(_templateObject9 || (_templateObject9 = _taggedTemplateLiteral([\"\", \"\"])), entries);\n      }\n    }, {\n      kind: \"method\",\n      key: \"updated\",\n      value: function updated(props) {\n        var _this5 = this;\n        _get(_getPrototypeOf(HaAutomationTracer.prototype), \"updated\", this).call(this, props);\n\n        // Pick first path when we load a new trace.\n        if (this.allowPick && props.has(\"trace\") && this.trace && this.selectedPath && !(this.selectedPath in this.trace.trace)) {\n          var element = this.shadowRoot.querySelector(\"ha-timeline[data-path]\");\n          if (element) {\n            fireEvent(this, \"value-changed\", {\n              value: element.dataset.path\n            });\n            this.selectedPath = element.dataset.path;\n          }\n        }\n        if (props.has(\"trace\") || props.has(\"selectedPath\")) {\n          this.shadowRoot.querySelectorAll(\"ha-timeline[data-path]\").forEach(function (el) {\n            toggleAttribute(el, \"selected\", _this5.selectedPath === el.dataset.path);\n            if (!_this5.allowPick || el.tabIndex === 0) {\n              return;\n            }\n            el.tabIndex = 0;\n            var selectEl = function selectEl() {\n              _this5.selectedPath = el.dataset.path;\n              fireEvent(_this5, \"value-changed\", {\n                value: el.dataset.path\n              });\n            };\n            el.addEventListener(\"click\", selectEl);\n            el.addEventListener(\"keydown\", function (ev) {\n              if (ev.key === \"Enter\" || ev.key === \" \") {\n                selectEl();\n              }\n            });\n            el.addEventListener(\"mouseover\", function () {\n              el.raised = true;\n            });\n            el.addEventListener(\"mouseout\", function () {\n              el.raised = false;\n            });\n          });\n        }\n      }\n    }, {\n      kind: \"get\",\n      static: true,\n      key: \"styles\",\n      value: function styles() {\n        return [css(_templateObject10 || (_templateObject10 = _taggedTemplateLiteral([\"\\n        ha-timeline[lastItem].condition {\\n          --timeline-ball-color: var(--error-color);\\n        }\\n        ha-timeline[data-path] {\\n          cursor: pointer;\\n        }\\n        ha-timeline[selected] {\\n          --timeline-ball-color: var(--primary-color);\\n        }\\n        ha-timeline:focus {\\n          outline: none;\\n          --timeline-ball-color: var(--accent-color);\\n        }\\n        .error {\\n          --timeline-ball-color: var(--error-color);\\n          color: var(--error-color);\\n        }\\n      \"])))];\n      }\n    }]\n  };\n}, LitElement);","map":{"version":3,"names":["css","html","LitElement","nothing","customElement","property","state","ifDefined","formatDateTimeWithSeconds","relativeTime","fireEvent","toggleAttribute","subscribeEntityRegistry","getActionType","describeAction","getDataFromPath","isTriggerPath","LOGBOOK_ENTRIES_BEFORE_FOLD","SIGNIFICANT_TIME_CHANGE","isSignificantTimeChange","a","b","Math","abs","getTime","RenderedTimeTracker","hass","entries","trace","_classCallCheck","lastReportedTime","Date","timestamp","start","_createClass","key","value","setLastReportedTime","date","renderTime","from","to","push","_templateObject","_taggedTemplateLiteral","locale","maybeRenderTime","LogbookRenderer","timeTracker","logbookEntries","curIndex","pendingItems","length","domain","get","maybeRenderItem","logbookEntry","curItem","entryDate","when","previousEntryDate","_renderLogbookEntries","flush","parts","i","min","_renderLogbookEntryHelper","moreItems","_templateObject2","mdiCircleOutline","entry","_templateObject3","name","entity_id","message","concat","ActionRenderer","entityReg","logbookRenderer","keys","Object","_getItem","renderItem","_renderItem","index","actionType","renderAllIterations","_this","forEach","item","_renderIteration","path","_handleTrigger","hasNext","data","config","err","_renderEntry","split","isTopLevel","replace","_handleChoose","_handleRepeat","_handleIf","_handleParallel","undefined","enabled","triggerStep","changed_variables","trigger","alias","mdiCircle","_chooseTrace$result","choosePath","startLevel","chooseTrace","defaultExecuted","result","choice","chooseConfig","_getDataFromPath","disabled","choiceNumeric","choiceConfig","choiceName","error","repeatPath","repeatConfig","_ifTrace$result","ifPath","ifTrace","ifConfig","parallelPath","parallelConfig","description","icon","arguments","mdiRecordCircleOutline","_templateObject4","_templateObject5","HaAutomationTracer","_decorate","_initialize","_LitElement","_LitElement2","_inherits","_this2","_len","args","Array","_key","_callSuper","_assertThisInitialized","F","d","kind","decorators","attribute","type","Boolean","hassSubscribe","_this3","connection","entities","_entityReg","render","_this4","actionRenderer","renderFinishedAt","finish","renderRuntime","toFixed","mdiProgressClock","mdiProgressWrench","script_execution","mdiAlertCircle","reason","isError","extra","_templateObject6","_templateObject7","className","_templateObject8","_templateObject9","updated","props","_this5","_get","_getPrototypeOf","prototype","call","allowPick","has","selectedPath","element","shadowRoot","querySelector","dataset","querySelectorAll","el","tabIndex","selectEl","addEventListener","ev","raised","static","styles","_templateObject10"],"sources":["/Users/sercanardil/Desktop/frontend/src/components/trace/hat-trace-timeline.ts"],"sourcesContent":["import {\n  mdiAlertCircle,\n  mdiCircle,\n  mdiCircleOutline,\n  mdiProgressClock,\n  mdiProgressWrench,\n  mdiRecordCircleOutline,\n} from \"@mdi/js\";\nimport { UnsubscribeFunc } from \"home-assistant-js-websocket\";\nimport {\n  css,\n  CSSResultGroup,\n  html,\n  LitElement,\n  PropertyValues,\n  TemplateResult,\n  nothing,\n} from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { ifDefined } from \"lit/directives/if-defined\";\nimport { formatDateTimeWithSeconds } from \"../../common/datetime/format_date_time\";\nimport { relativeTime } from \"../../common/datetime/relative_time\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport { toggleAttribute } from \"../../common/dom/toggle_attribute\";\nimport {\n  EntityRegistryEntry,\n  subscribeEntityRegistry,\n} from \"../../data/entity_registry\";\nimport { LogbookEntry } from \"../../data/logbook\";\nimport {\n  ChooseAction,\n  ChooseActionChoice,\n  getActionType,\n  IfAction,\n  ParallelAction,\n  RepeatAction,\n} from \"../../data/script\";\nimport { describeAction } from \"../../data/script_i18n\";\nimport {\n  ActionTraceStep,\n  AutomationTraceExtended,\n  ChooseActionTraceStep,\n  getDataFromPath,\n  IfActionTraceStep,\n  isTriggerPath,\n  TriggerTraceStep,\n} from \"../../data/trace\";\nimport { HomeAssistant } from \"../../types\";\nimport \"./ha-timeline\";\nimport type { HaTimeline } from \"./ha-timeline\";\n\nconst LOGBOOK_ENTRIES_BEFORE_FOLD = 2;\n\n/* eslint max-classes-per-file: \"off\" */\n\n// Report time entry when more than this time has passed\nconst SIGNIFICANT_TIME_CHANGE = 1000; // 1 seconds\n\nconst isSignificantTimeChange = (a: Date, b: Date) =>\n  Math.abs(b.getTime() - a.getTime()) > SIGNIFICANT_TIME_CHANGE;\n\nclass RenderedTimeTracker {\n  private lastReportedTime: Date;\n\n  constructor(\n    private hass: HomeAssistant,\n    private entries: TemplateResult[],\n    trace: AutomationTraceExtended\n  ) {\n    this.lastReportedTime = new Date(trace.timestamp.start);\n  }\n\n  setLastReportedTime(date: Date) {\n    this.lastReportedTime = date;\n  }\n\n  renderTime(from: Date, to: Date): void {\n    this.entries.push(html`\n      <ha-timeline label>\n        ${relativeTime(from, this.hass.locale, to, false)} later\n      </ha-timeline>\n    `);\n    this.lastReportedTime = to;\n  }\n\n  maybeRenderTime(timestamp: Date): boolean {\n    if (!isSignificantTimeChange(timestamp, this.lastReportedTime)) {\n      this.lastReportedTime = timestamp;\n      return false;\n    }\n\n    this.renderTime(this.lastReportedTime, timestamp);\n    return true;\n  }\n}\n\nclass LogbookRenderer {\n  private curIndex: number;\n\n  private pendingItems: Array<[Date, LogbookEntry]> = [];\n\n  constructor(\n    private entries: TemplateResult[],\n    private timeTracker: RenderedTimeTracker,\n    private logbookEntries: LogbookEntry[]\n  ) {\n    // Skip the \"automation got triggered item\"\n    this.curIndex =\n      logbookEntries.length > 0 && logbookEntries[0].domain === \"automation\"\n        ? 1\n        : 0;\n  }\n\n  get curItem() {\n    return this.logbookEntries[this.curIndex];\n  }\n\n  get hasNext() {\n    return this.curIndex < this.logbookEntries.length;\n  }\n\n  maybeRenderItem() {\n    const logbookEntry = this.curItem;\n    this.curIndex++;\n    const entryDate = new Date(logbookEntry.when * 1000);\n\n    if (this.pendingItems.length === 0) {\n      this.pendingItems.push([entryDate, logbookEntry]);\n      return;\n    }\n\n    const previousEntryDate =\n      this.pendingItems[this.pendingItems.length - 1][0];\n\n    // If logbook entry is too long after the last one,\n    // add a time passed label\n    if (isSignificantTimeChange(previousEntryDate, entryDate)) {\n      this._renderLogbookEntries();\n      this.timeTracker.renderTime(previousEntryDate, entryDate);\n    }\n\n    this.pendingItems.push([entryDate, logbookEntry]);\n  }\n\n  flush() {\n    if (this.pendingItems.length > 0) {\n      this._renderLogbookEntries();\n    }\n  }\n\n  private _renderLogbookEntries() {\n    this.timeTracker.maybeRenderTime(this.pendingItems[0][0]);\n\n    const parts: TemplateResult[] = [];\n\n    let i;\n\n    for (\n      i = 0;\n      i < Math.min(this.pendingItems.length, LOGBOOK_ENTRIES_BEFORE_FOLD);\n      i++\n    ) {\n      parts.push(this._renderLogbookEntryHelper(this.pendingItems[i][1]));\n    }\n\n    let moreItems: TemplateResult[] | undefined;\n\n    // If we didn't render all items, push rest into `moreItems`\n    if (i < this.pendingItems.length) {\n      moreItems = [];\n      for (; i < this.pendingItems.length; i++) {\n        moreItems.push(this._renderLogbookEntryHelper(this.pendingItems[i][1]));\n      }\n    }\n\n    this.entries.push(html`\n      <ha-timeline .icon=${mdiCircleOutline} .moreItems=${moreItems}>\n        ${parts}\n      </ha-timeline>\n    `);\n\n    // Clear rendered items.\n    this.timeTracker.setLastReportedTime(\n      this.pendingItems[this.pendingItems.length - 1][0]\n    );\n    this.pendingItems = [];\n  }\n\n  private _renderLogbookEntryHelper(entry: LogbookEntry) {\n    return html`${entry.name} (${entry.entity_id})\n      ${entry.message || `turned ${entry.state}`}<br />`;\n  }\n}\n\nclass ActionRenderer {\n  private curIndex = 0;\n\n  private keys: string[];\n\n  constructor(\n    private hass: HomeAssistant,\n    private entityReg: EntityRegistryEntry[],\n    private entries: TemplateResult[],\n    private trace: AutomationTraceExtended,\n    private logbookRenderer: LogbookRenderer,\n    private timeTracker: RenderedTimeTracker\n  ) {\n    this.keys = Object.keys(trace.trace);\n  }\n\n  get curItem() {\n    return this._getItem(this.curIndex);\n  }\n\n  get hasNext() {\n    return this.curIndex < this.keys.length;\n  }\n\n  renderItem() {\n    this.curIndex = this._renderItem(this.curIndex);\n  }\n\n  private _getItem(index: number) {\n    return this.trace.trace[this.keys[index]];\n  }\n\n  private _renderItem(\n    index: number,\n    actionType?: ReturnType<typeof getActionType>,\n    renderAllIterations?: boolean\n  ): number {\n    const value = this._getItem(index);\n\n    if (renderAllIterations) {\n      let i;\n      value.forEach((item) => {\n        i = this._renderIteration(index, item, actionType);\n      });\n      return i;\n    }\n    return this._renderIteration(index, value[0], actionType);\n  }\n\n  private _renderIteration(\n    index: number,\n    value: ActionTraceStep,\n    actionType?: ReturnType<typeof getActionType>\n  ) {\n    if (isTriggerPath(value.path)) {\n      return this._handleTrigger(index, value as TriggerTraceStep);\n    }\n\n    const timestamp = new Date(value.timestamp);\n\n    // Render all logbook items that are in front of this item.\n    while (\n      this.logbookRenderer.hasNext &&\n      new Date(this.logbookRenderer.curItem.when * 1000) < timestamp\n    ) {\n      this.logbookRenderer.maybeRenderItem();\n    }\n\n    this.logbookRenderer.flush();\n    this.timeTracker.maybeRenderTime(timestamp);\n\n    const path = value.path;\n    let data;\n    try {\n      data = getDataFromPath(this.trace.config, path);\n    } catch (err: any) {\n      this._renderEntry(\n        path,\n        `Unable to extract path ${path}. Download trace and report as bug`\n      );\n      return index + 1;\n    }\n\n    const parts = path.split(\"/\");\n    const isTopLevel = parts.length === 2;\n\n    if (!isTopLevel && !actionType) {\n      this._renderEntry(path, path.replace(/\\//g, \" \"));\n      return index + 1;\n    }\n\n    if (!actionType) {\n      actionType = getActionType(data);\n    }\n\n    if (actionType === \"choose\") {\n      return this._handleChoose(index);\n    }\n\n    if (actionType === \"repeat\") {\n      return this._handleRepeat(index);\n    }\n\n    if (actionType === \"if\") {\n      return this._handleIf(index);\n    }\n\n    if (actionType === \"parallel\") {\n      return this._handleParallel(index);\n    }\n\n    this._renderEntry(\n      path,\n      describeAction(this.hass, this.entityReg, data, actionType),\n      undefined,\n      data.enabled === false\n    );\n\n    let i = index + 1;\n\n    for (; i < this.keys.length; i++) {\n      if (this.keys[i].split(\"/\").length === parts.length) {\n        break;\n      }\n    }\n\n    return i;\n  }\n\n  private _handleTrigger(index: number, triggerStep: TriggerTraceStep): number {\n    this._renderEntry(\n      triggerStep.path,\n      `${\n        triggerStep.changed_variables.trigger.alias\n          ? `${triggerStep.changed_variables.trigger.alias} triggered`\n          : \"Triggered\"\n      } ${\n        triggerStep.path === \"trigger\"\n          ? \"manually\"\n          : `by the ${this.trace.trigger}`\n      } at\n    ${formatDateTimeWithSeconds(\n      new Date(triggerStep.timestamp),\n      this.hass.locale,\n      this.hass.config\n    )}`,\n      mdiCircle\n    );\n    return index + 1;\n  }\n\n  private _handleChoose(index: number): number {\n    // startLevel: choose root config\n\n    // +1: 'default\n    // +2: executed sequence\n\n    // +1: 'choose'\n    // +2: current choice\n\n    // +3: 'conditions'\n    // +4: evaluated condition\n\n    // +3: 'sequence'\n    // +4: executed sequence\n\n    const choosePath = this.keys[index];\n    const startLevel = choosePath.split(\"/\").length;\n\n    const chooseTrace = this._getItem(index)[0] as ChooseActionTraceStep;\n    const defaultExecuted = chooseTrace.result?.choice === \"default\";\n    const chooseConfig = this._getDataFromPath(\n      this.keys[index]\n    ) as ChooseAction;\n    const disabled = chooseConfig.enabled === false;\n    const name = chooseConfig.alias || \"Choose\";\n\n    if (defaultExecuted) {\n      this._renderEntry(\n        choosePath,\n        `${name}: Default action executed`,\n        undefined,\n        disabled\n      );\n    } else if (chooseTrace.result) {\n      const choiceNumeric =\n        chooseTrace.result.choice !== \"default\"\n          ? chooseTrace.result.choice + 1\n          : undefined;\n      const choiceConfig = this._getDataFromPath(\n        `${this.keys[index]}/choose/${chooseTrace.result.choice}`\n      ) as ChooseActionChoice | undefined;\n      const choiceName = choiceConfig\n        ? `${choiceConfig.alias || `Option ${choiceNumeric}`} executed`\n        : `Error: ${chooseTrace.error}`;\n      this._renderEntry(\n        choosePath,\n        `${name}: ${choiceName}`,\n        undefined,\n        disabled\n      );\n    } else {\n      this._renderEntry(\n        choosePath,\n        `${name}: No action taken`,\n        undefined,\n        disabled\n      );\n    }\n\n    let i;\n\n    // Skip over conditions\n    for (i = index + 1; i < this.keys.length; i++) {\n      const parts = this.keys[i].split(\"/\");\n\n      // We're done if no more sequence in current level\n      if (parts.length <= startLevel) {\n        return i;\n      }\n\n      // We're going to skip all conditions\n      if (\n        (defaultExecuted && parts[startLevel + 1] === \"default\") ||\n        (!defaultExecuted && parts[startLevel + 3] === \"sequence\")\n      ) {\n        break;\n      }\n    }\n\n    // Render choice\n    while (i < this.keys.length) {\n      const path = this.keys[i];\n      const parts = path.split(\"/\");\n\n      // We're done if no more sequence in current level\n      if (parts.length <= startLevel) {\n        return i;\n      }\n\n      // We know it's an action sequence, so force the type like that\n      // for rendering.\n      i = this._renderItem(i, getActionType(this._getDataFromPath(path)));\n    }\n\n    return i;\n  }\n\n  private _handleRepeat(index: number): number {\n    const repeatPath = this.keys[index];\n    const startLevel = repeatPath.split(\"/\").length;\n\n    const repeatConfig = this._getDataFromPath(\n      this.keys[index]\n    ) as RepeatAction;\n    const disabled = repeatConfig.enabled === false;\n\n    const name =\n      repeatConfig.alias ||\n      describeAction(this.hass, this.entityReg, repeatConfig);\n\n    this._renderEntry(repeatPath, name, undefined, disabled);\n\n    let i;\n\n    for (i = index + 1; i < this.keys.length; i++) {\n      const path = this.keys[i];\n      const parts = path.split(\"/\");\n\n      // We're done if no more sequence in current level\n      if (parts.length <= startLevel) {\n        return i;\n      }\n\n      i = this._renderItem(i, getActionType(this._getDataFromPath(path)), true);\n    }\n\n    return i;\n  }\n\n  private _handleIf(index: number): number {\n    const ifPath = this.keys[index];\n    const startLevel = ifPath.split(\"/\").length;\n\n    const ifTrace = this._getItem(index)[0] as IfActionTraceStep;\n    const ifConfig = this._getDataFromPath(this.keys[index]) as IfAction;\n    const disabled = ifConfig.enabled === false;\n    const name = ifConfig.alias || \"If\";\n\n    if (ifTrace.result?.choice) {\n      const choiceConfig = this._getDataFromPath(\n        `${this.keys[index]}/${ifTrace.result.choice}/`\n      ) as any;\n      const choiceName = choiceConfig\n        ? `${choiceConfig.alias || `${ifTrace.result.choice} action executed`}`\n        : `Error: ${ifTrace.error}`;\n      this._renderEntry(ifPath, `${name}: ${choiceName}`, undefined, disabled);\n    } else {\n      this._renderEntry(\n        ifPath,\n        `${name}: No action taken`,\n        undefined,\n        disabled\n      );\n    }\n\n    let i;\n\n    // Skip over conditions\n    for (i = index + 1; i < this.keys.length; i++) {\n      const path = this.keys[i];\n      const parts = this.keys[i].split(\"/\");\n\n      // We're done if no more sequence in current level\n      if (parts.length <= startLevel) {\n        return i;\n      }\n\n      // We're going to skip all conditions\n      if (\n        parts[startLevel + 1] === \"condition\" ||\n        parts.length < startLevel + 2\n      ) {\n        continue;\n      }\n\n      i = this._renderItem(i, getActionType(this._getDataFromPath(path)));\n    }\n\n    return i;\n  }\n\n  private _handleParallel(index: number): number {\n    const parallelPath = this.keys[index];\n    const startLevel = parallelPath.split(\"/\").length;\n\n    const parallelConfig = this._getDataFromPath(\n      this.keys[index]\n    ) as ParallelAction;\n\n    const disabled = parallelConfig.enabled === false;\n\n    const name = parallelConfig.alias || \"Execute in parallel\";\n\n    this._renderEntry(parallelPath, name, undefined, disabled);\n\n    let i;\n\n    for (i = index + 1; i < this.keys.length; i++) {\n      const path = this.keys[i];\n      const parts = path.split(\"/\");\n\n      // We're done if no more sequence in current level\n      if (parts.length <= startLevel) {\n        return i;\n      }\n\n      i = this._renderItem(i, getActionType(this._getDataFromPath(path)));\n    }\n\n    return i;\n  }\n\n  private _renderEntry(\n    path: string,\n    description: string,\n    icon = mdiRecordCircleOutline,\n    disabled = false\n  ) {\n    this.entries.push(html`\n      <ha-timeline .icon=${icon} data-path=${path} .notEnabled=${disabled}>\n        ${description}${disabled\n          ? html`<span class=\"disabled\"> (disabled)</span>`\n          : \"\"}\n      </ha-timeline>\n    `);\n  }\n\n  private _getDataFromPath(path: string) {\n    return getDataFromPath(this.trace.config, path);\n  }\n}\n\n@customElement(\"hat-trace-timeline\")\nexport class HaAutomationTracer extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public trace?: AutomationTraceExtended;\n\n  @property({ attribute: false }) public logbookEntries?: LogbookEntry[];\n\n  @property({ attribute: false }) public selectedPath?: string;\n\n  @property({ type: Boolean }) public allowPick = false;\n\n  @state() private _entityReg: EntityRegistryEntry[] = [];\n\n  public hassSubscribe(): UnsubscribeFunc[] {\n    return [\n      subscribeEntityRegistry(this.hass.connection!, (entities) => {\n        this._entityReg = entities;\n      }),\n    ];\n  }\n\n  protected render() {\n    if (!this.trace) {\n      return nothing;\n    }\n\n    const entries: TemplateResult[] = [];\n\n    const timeTracker = new RenderedTimeTracker(this.hass, entries, this.trace);\n    const logbookRenderer = new LogbookRenderer(\n      entries,\n      timeTracker,\n      this.logbookEntries || []\n    );\n    const actionRenderer = new ActionRenderer(\n      this.hass,\n      this._entityReg,\n      entries,\n      this.trace,\n      logbookRenderer,\n      timeTracker\n    );\n\n    while (actionRenderer.hasNext) {\n      actionRenderer.renderItem();\n    }\n\n    while (logbookRenderer.hasNext) {\n      logbookRenderer.maybeRenderItem();\n    }\n\n    logbookRenderer.flush();\n\n    // Render footer\n    const renderFinishedAt = () =>\n      formatDateTimeWithSeconds(\n        new Date(this.trace!.timestamp.finish!),\n        this.hass.locale,\n        this.hass.config\n      );\n    const renderRuntime = () => `(runtime:\n      ${(\n        (new Date(this.trace!.timestamp.finish!).getTime() -\n          new Date(this.trace!.timestamp.start).getTime()) /\n        1000\n      ).toFixed(2)}\n      seconds)`;\n\n    let entry: {\n      description: TemplateResult | string;\n      icon: string;\n      className?: string;\n    };\n\n    if (this.trace.state === \"running\") {\n      entry = {\n        description: \"Still running\",\n        icon: mdiProgressClock,\n      };\n    } else if (this.trace.state === \"debugged\") {\n      entry = {\n        description: \"Debugged\",\n        icon: mdiProgressWrench,\n      };\n    } else if (this.trace.script_execution === \"finished\") {\n      entry = {\n        description: `Finished at ${renderFinishedAt()} ${renderRuntime()}`,\n        icon: mdiCircle,\n      };\n    } else if (this.trace.script_execution === \"aborted\") {\n      entry = {\n        description: `Aborted at ${renderFinishedAt()} ${renderRuntime()}`,\n        icon: mdiAlertCircle,\n      };\n    } else if (this.trace.script_execution === \"cancelled\") {\n      entry = {\n        description: `Cancelled at ${renderFinishedAt()} ${renderRuntime()}`,\n        icon: mdiAlertCircle,\n      };\n    } else {\n      let reason: string;\n      let isError = false;\n      let extra: TemplateResult | undefined;\n\n      switch (this.trace.script_execution) {\n        case \"failed_conditions\":\n          reason = \"a condition failed\";\n          break;\n        case \"failed_single\":\n          reason = \"only a single execution is allowed\";\n          break;\n        case \"failed_max_runs\":\n          reason = \"maximum number of parallel runs reached\";\n          break;\n        case \"error\":\n          reason = \"an error was encountered\";\n          isError = true;\n          extra = html`<br /><br />${this.trace.error!}`;\n          break;\n        default:\n          reason = `of unknown reason \"${this.trace.script_execution}\"`;\n          isError = true;\n      }\n\n      entry = {\n        description: html`Stopped because ${reason} at ${renderFinishedAt()}\n        ${renderRuntime()}${extra || \"\"}`,\n        icon: mdiAlertCircle,\n        className: isError ? \"error\" : undefined,\n      };\n    }\n\n    entries.push(html`\n      <ha-timeline\n        lastItem\n        .icon=${entry.icon}\n        class=${ifDefined(entry.className)}\n      >\n        ${entry.description}\n      </ha-timeline>\n    `);\n\n    return html`${entries}`;\n  }\n\n  protected updated(props: PropertyValues) {\n    super.updated(props);\n\n    // Pick first path when we load a new trace.\n    if (\n      this.allowPick &&\n      props.has(\"trace\") &&\n      this.trace &&\n      this.selectedPath &&\n      !(this.selectedPath in this.trace.trace)\n    ) {\n      const element = this.shadowRoot!.querySelector<HaTimeline>(\n        \"ha-timeline[data-path]\"\n      );\n      if (element) {\n        fireEvent(this, \"value-changed\", { value: element.dataset.path });\n        this.selectedPath = element.dataset.path;\n      }\n    }\n\n    if (props.has(\"trace\") || props.has(\"selectedPath\")) {\n      this.shadowRoot!.querySelectorAll<HaTimeline>(\n        \"ha-timeline[data-path]\"\n      ).forEach((el) => {\n        toggleAttribute(el, \"selected\", this.selectedPath === el.dataset.path);\n        if (!this.allowPick || el.tabIndex === 0) {\n          return;\n        }\n        el.tabIndex = 0;\n        const selectEl = () => {\n          this.selectedPath = el.dataset.path;\n          fireEvent(this, \"value-changed\", { value: el.dataset.path });\n        };\n        el.addEventListener(\"click\", selectEl);\n        el.addEventListener(\"keydown\", (ev: KeyboardEvent) => {\n          if (ev.key === \"Enter\" || ev.key === \" \") {\n            selectEl();\n          }\n        });\n        el.addEventListener(\"mouseover\", () => {\n          el.raised = true;\n        });\n        el.addEventListener(\"mouseout\", () => {\n          el.raised = false;\n        });\n      });\n    }\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      css`\n        ha-timeline[lastItem].condition {\n          --timeline-ball-color: var(--error-color);\n        }\n        ha-timeline[data-path] {\n          cursor: pointer;\n        }\n        ha-timeline[selected] {\n          --timeline-ball-color: var(--primary-color);\n        }\n        ha-timeline:focus {\n          outline: none;\n          --timeline-ball-color: var(--accent-color);\n        }\n        .error {\n          --timeline-ball-color: var(--error-color);\n          color: var(--error-color);\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"hat-trace-timeline\": HaAutomationTracer;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}