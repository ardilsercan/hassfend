{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/helpers/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport { fetchWithAuth } from \"./fetch-with-auth\";\nexport var handleFetchPromise = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(fetchPromise) {\n    var response, body, contentType;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return fetchPromise;\n        case 3:\n          response = _context.sent;\n          _context.next = 9;\n          break;\n        case 6:\n          _context.prev = 6;\n          _context.t0 = _context[\"catch\"](0);\n          throw {\n            error: \"Request error\",\n            status_code: undefined,\n            body: undefined\n          };\n        case 9:\n          body = null;\n          contentType = response.headers.get(\"content-type\");\n          if (!(contentType && contentType.includes(\"application/json\"))) {\n            _context.next = 23;\n            break;\n          }\n          _context.prev = 12;\n          _context.next = 15;\n          return response.json();\n        case 15:\n          body = _context.sent;\n          _context.next = 21;\n          break;\n        case 18:\n          _context.prev = 18;\n          _context.t1 = _context[\"catch\"](12);\n          throw {\n            error: \"Unable to parse JSON response\",\n            status_code: _context.t1.status,\n            body: null\n          };\n        case 21:\n          _context.next = 26;\n          break;\n        case 23:\n          _context.next = 25;\n          return response.text();\n        case 25:\n          body = _context.sent;\n        case 26:\n          if (response.ok) {\n            _context.next = 28;\n            break;\n          }\n          throw {\n            error: \"Response error: \".concat(response.status),\n            status_code: response.status,\n            body: body\n          };\n        case 28:\n          return _context.abrupt(\"return\", body);\n        case 29:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee, null, [[0, 6], [12, 18]]);\n  }));\n  return function handleFetchPromise(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport default function hassCallApi(_x2, _x3, _x4, _x5, _x6) {\n  return _hassCallApi.apply(this, arguments);\n}\nfunction _hassCallApi() {\n  _hassCallApi = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(auth, method, path, parameters, headers) {\n    var url, init;\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          url = \"\".concat(auth.data.hassUrl, \"/api/\").concat(path);\n          init = {\n            method: method,\n            headers: headers || {}\n          };\n          if (parameters) {\n            // @ts-ignore\n            init.headers[\"Content-Type\"] = \"application/json;charset=UTF-8\";\n            init.body = JSON.stringify(parameters);\n          }\n          return _context2.abrupt(\"return\", handleFetchPromise(fetchWithAuth(auth, url, init)));\n        case 4:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n  return _hassCallApi.apply(this, arguments);\n}","map":{"version":3,"names":["fetchWithAuth","handleFetchPromise","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","fetchPromise","response","body","contentType","wrap","_callee$","_context","prev","next","sent","t0","error","status_code","undefined","headers","get","includes","json","t1","status","text","ok","concat","abrupt","stop","_x","apply","arguments","hassCallApi","_x2","_x3","_x4","_x5","_x6","_hassCallApi","_callee2","auth","method","path","parameters","url","init","_callee2$","_context2","data","hassUrl","JSON","stringify"],"sources":["/workspaces/frontend/src/util/hass-call-api.ts"],"sourcesContent":["import { Auth } from \"home-assistant-js-websocket\";\nimport { fetchWithAuth } from \"./fetch-with-auth\";\n\nexport const handleFetchPromise = async <T>(\n  fetchPromise: Promise<Response>\n): Promise<T> => {\n  let response;\n\n  try {\n    response = await fetchPromise;\n  } catch (err: any) {\n    // eslint-disable-next-line @typescript-eslint/no-throw-literal\n    throw {\n      error: \"Request error\",\n      status_code: undefined,\n      body: undefined,\n    };\n  }\n\n  let body = null;\n\n  const contentType = response.headers.get(\"content-type\");\n\n  if (contentType && contentType.includes(\"application/json\")) {\n    try {\n      body = await response.json();\n    } catch (err: any) {\n      // eslint-disable-next-line @typescript-eslint/no-throw-literal\n      throw {\n        error: \"Unable to parse JSON response\",\n        status_code: err.status,\n        body: null,\n      };\n    }\n  } else {\n    body = await response.text();\n  }\n\n  if (!response.ok) {\n    // eslint-disable-next-line @typescript-eslint/no-throw-literal\n    throw {\n      error: `Response error: ${response.status}`,\n      status_code: response.status,\n      body,\n    };\n  }\n\n  return body as unknown as T;\n};\n\nexport default async function hassCallApi<T>(\n  auth: Auth,\n  method: string,\n  path: string,\n  parameters?: Record<string, unknown>,\n  headers?: Record<string, string>\n) {\n  const url = `${auth.data.hassUrl}/api/${path}`;\n\n  const init: RequestInit = {\n    method,\n    headers: headers || {},\n  };\n\n  if (parameters) {\n    // @ts-ignore\n    init.headers[\"Content-Type\"] = \"application/json;charset=UTF-8\";\n    init.body = JSON.stringify(parameters);\n  }\n\n  return handleFetchPromise<T>(fetchWithAuth(auth, url, init));\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}