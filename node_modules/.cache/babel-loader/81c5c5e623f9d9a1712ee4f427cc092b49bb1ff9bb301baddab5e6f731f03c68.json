{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/helpers/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _callSuper from \"@babel/runtime/helpers/callSuper\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _decorate from \"@babel/runtime/helpers/decorate\";\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4;\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"@material/mwc-button\";\nvar mdiContentCopy = \"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport { createCloseHeading } from \"../../components/ha-dialog\";\nimport \"../../components/ha-textfield\";\nimport \"../../components/ha-icon-button\";\nimport { haStyleDialog } from \"../../resources/styles\";\nimport { copyToClipboard } from \"../../common/util/copy-clipboard\";\nimport { showToast } from \"../../util/toast\";\nvar QR_LOGO_URL = \"/static/icons/favicon-192x192.png\";\nexport var HaLongLivedAccessTokenDialog = _decorate([customElement(\"ha-long-lived-access-token-dialog\")], function (_initialize, _LitElement) {\n  var HaLongLivedAccessTokenDialog = /*#__PURE__*/function (_LitElement2) {\n    _inherits(HaLongLivedAccessTokenDialog, _LitElement2);\n    function HaLongLivedAccessTokenDialog() {\n      var _this;\n      _classCallCheck(this, HaLongLivedAccessTokenDialog);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _callSuper(this, HaLongLivedAccessTokenDialog, [].concat(args));\n      _initialize(_assertThisInitialized(_this));\n      return _this;\n    }\n    return _createClass(HaLongLivedAccessTokenDialog);\n  }(_LitElement);\n  return {\n    F: HaLongLivedAccessTokenDialog,\n    d: [{\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_params\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_qrCode\",\n      value: void 0\n    }, {\n      kind: \"method\",\n      key: \"showDialog\",\n      value: function showDialog(params) {\n        this._params = params;\n      }\n    }, {\n      kind: \"method\",\n      key: \"closeDialog\",\n      value: function closeDialog() {\n        this._params = undefined;\n        this._qrCode = undefined;\n        fireEvent(this, \"dialog-closed\", {\n          dialog: this.localName\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"render\",\n      value: function render() {\n        if (!this._params || !this._params.token) {\n          return nothing;\n        }\n        return html(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n      <ha-dialog\\n        open\\n        hideActions\\n        .heading=\", \"\\n        @closed=\", \"\\n      >\\n        <div>\\n          <ha-textfield\\n            dialogInitialFocus\\n            .value=\", \"\\n            .label=\", \"\\n            type=\\\"text\\\"\\n            iconTrailing\\n            readOnly\\n          >\\n            <ha-icon-button\\n              @click=\", \"\\n              slot=\\\"trailingIcon\\\"\\n              .path=\", \"\\n            ></ha-icon-button>\\n          </ha-textfield>\\n          <div id=\\\"qr\\\">\\n            \", \"\\n          </div>\\n        </div>\\n      </ha-dialog>\\n    \"])), createCloseHeading(this.hass, this._params.name), this.closeDialog, this._params.token, this.hass.localize(\"ui.panel.profile.long_lived_access_tokens.prompt_copy_token\"), this._copyToken, mdiContentCopy, this._qrCode ? this._qrCode : html(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\\n                  <mwc-button @click=\", \">\\n                    Generate QR code\\n                  </mwc-button>\\n                \"])), this._generateQR));\n      }\n    }, {\n      kind: \"method\",\n      key: \"_copyToken\",\n      value: function () {\n        var _copyToken2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(ev) {\n          var textField;\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                textField = ev.target.parentElement;\n                _context.next = 3;\n                return copyToClipboard(textField.value);\n              case 3:\n                showToast(this, {\n                  message: this.hass.localize(\"ui.common.copied_clipboard\")\n                });\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }, _callee, this);\n        }));\n        function _copyToken(_x) {\n          return _copyToken2.apply(this, arguments);\n        }\n        return _copyToken;\n      }()\n    }, {\n      kind: \"method\",\n      key: \"_generateQR\",\n      value: function () {\n        var _generateQR2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n          var qrcode, canvas, context, imageObj;\n          return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n            while (1) switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return import(\"qrcode\");\n              case 2:\n                qrcode = _context2.sent;\n                _context2.next = 5;\n                return qrcode.toCanvas(this._params.token, {\n                  width: 180,\n                  errorCorrectionLevel: \"Q\"\n                });\n              case 5:\n                canvas = _context2.sent;\n                context = canvas.getContext(\"2d\");\n                imageObj = new Image();\n                imageObj.src = QR_LOGO_URL;\n                _context2.next = 11;\n                return new Promise(function (resolve) {\n                  imageObj.onload = resolve;\n                });\n              case 11:\n                context === null || context === void 0 || context.drawImage(imageObj, canvas.width / 3, canvas.height / 3, canvas.width / 3, canvas.height / 3);\n                this._qrCode = html(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"<img\\n        alt=\", \"\\n        src=\", \"\\n      ></img>\"])), this.hass.localize(\"ui.panel.profile.long_lived_access_tokens.qr_code_image\", {\n                  name: this._params.name\n                }), canvas.toDataURL());\n              case 13:\n              case \"end\":\n                return _context2.stop();\n            }\n          }, _callee2, this);\n        }));\n        function _generateQR() {\n          return _generateQR2.apply(this, arguments);\n        }\n        return _generateQR;\n      }()\n    }, {\n      kind: \"get\",\n      static: true,\n      key: \"styles\",\n      value: function styles() {\n        return [haStyleDialog, css(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"\\n        #qr {\\n          text-align: center;\\n        }\\n        ha-textfield {\\n          display: block;\\n          --textfield-icon-trailing-padding: 0;\\n        }\\n        ha-textfield > ha-icon-button {\\n          position: relative;\\n          right: -8px;\\n          --mdc-icon-button-size: 36px;\\n          --mdc-icon-size: 20px;\\n          color: var(--secondary-text-color);\\n          inset-inline-start: initial;\\n          inset-inline-end: -8px;\\n          direction: var(--direction);\\n        }\\n      \"])))];\n      }\n    }]\n  };\n}, LitElement);","map":{"version":3,"names":["mdiContentCopy","css","html","LitElement","nothing","customElement","property","state","fireEvent","createCloseHeading","haStyleDialog","copyToClipboard","showToast","QR_LOGO_URL","HaLongLivedAccessTokenDialog","_decorate","_initialize","_LitElement","_LitElement2","_inherits","_this","_classCallCheck","_len","arguments","length","args","Array","_key","_callSuper","concat","_assertThisInitialized","_createClass","F","d","kind","decorators","attribute","key","value","showDialog","params","_params","closeDialog","undefined","_qrCode","dialog","localName","render","token","_templateObject","_taggedTemplateLiteral","hass","name","localize","_copyToken","_templateObject2","_generateQR","_copyToken2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","ev","textField","wrap","_callee$","_context","prev","next","target","parentElement","message","stop","_x","apply","_generateQR2","_callee2","qrcode","canvas","context","imageObj","_callee2$","_context2","sent","toCanvas","width","errorCorrectionLevel","getContext","Image","src","Promise","resolve","onload","drawImage","height","_templateObject3","toDataURL","static","styles","_templateObject4"],"sources":["/workspaces/frontend/src/panels/profile/ha-long-lived-access-token-dialog.ts"],"sourcesContent":["import \"@material/mwc-button\";\nimport { mdiContentCopy } from \"@mdi/js\";\nimport {\n  css,\n  CSSResultGroup,\n  html,\n  LitElement,\n  TemplateResult,\n  nothing,\n} from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport { createCloseHeading } from \"../../components/ha-dialog\";\nimport \"../../components/ha-textfield\";\nimport \"../../components/ha-icon-button\";\nimport { haStyleDialog } from \"../../resources/styles\";\nimport type { HomeAssistant } from \"../../types\";\nimport { LongLivedAccessTokenDialogParams } from \"./show-long-lived-access-token-dialog\";\nimport type { HaTextField } from \"../../components/ha-textfield\";\nimport { copyToClipboard } from \"../../common/util/copy-clipboard\";\nimport { showToast } from \"../../util/toast\";\n\nconst QR_LOGO_URL = \"/static/icons/favicon-192x192.png\";\n\n@customElement(\"ha-long-lived-access-token-dialog\")\nexport class HaLongLivedAccessTokenDialog extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @state() private _params?: LongLivedAccessTokenDialogParams;\n\n  @state() private _qrCode?: TemplateResult;\n\n  public showDialog(params: LongLivedAccessTokenDialogParams): void {\n    this._params = params;\n  }\n\n  public closeDialog() {\n    this._params = undefined;\n    this._qrCode = undefined;\n    fireEvent(this, \"dialog-closed\", { dialog: this.localName });\n  }\n\n  protected render() {\n    if (!this._params || !this._params.token) {\n      return nothing;\n    }\n\n    return html`\n      <ha-dialog\n        open\n        hideActions\n        .heading=${createCloseHeading(this.hass, this._params.name)}\n        @closed=${this.closeDialog}\n      >\n        <div>\n          <ha-textfield\n            dialogInitialFocus\n            .value=${this._params.token}\n            .label=${this.hass.localize(\n              \"ui.panel.profile.long_lived_access_tokens.prompt_copy_token\"\n            )}\n            type=\"text\"\n            iconTrailing\n            readOnly\n          >\n            <ha-icon-button\n              @click=${this._copyToken}\n              slot=\"trailingIcon\"\n              .path=${mdiContentCopy}\n            ></ha-icon-button>\n          </ha-textfield>\n          <div id=\"qr\">\n            ${this._qrCode\n              ? this._qrCode\n              : html`\n                  <mwc-button @click=${this._generateQR}>\n                    Generate QR code\n                  </mwc-button>\n                `}\n          </div>\n        </div>\n      </ha-dialog>\n    `;\n  }\n\n  private async _copyToken(ev): Promise<void> {\n    const textField = ev.target.parentElement as HaTextField;\n    await copyToClipboard(textField.value);\n    showToast(this, {\n      message: this.hass.localize(\"ui.common.copied_clipboard\"),\n    });\n  }\n\n  private async _generateQR() {\n    const qrcode = await import(\"qrcode\");\n    const canvas = await qrcode.toCanvas(this._params!.token, {\n      width: 180,\n      errorCorrectionLevel: \"Q\",\n    });\n    const context = canvas.getContext(\"2d\");\n\n    const imageObj = new Image();\n    imageObj.src = QR_LOGO_URL;\n    await new Promise((resolve) => {\n      imageObj.onload = resolve;\n    });\n    context?.drawImage(\n      imageObj,\n      canvas.width / 3,\n      canvas.height / 3,\n      canvas.width / 3,\n      canvas.height / 3\n    );\n\n    this._qrCode = html`<img\n        alt=${this.hass.localize(\n          \"ui.panel.profile.long_lived_access_tokens.qr_code_image\",\n          { name: this._params!.name }\n        )}\n        src=${canvas.toDataURL()}\n      ></img>`;\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      haStyleDialog,\n      css`\n        #qr {\n          text-align: center;\n        }\n        ha-textfield {\n          display: block;\n          --textfield-icon-trailing-padding: 0;\n        }\n        ha-textfield > ha-icon-button {\n          position: relative;\n          right: -8px;\n          --mdc-icon-button-size: 36px;\n          --mdc-icon-size: 20px;\n          color: var(--secondary-text-color);\n          inset-inline-start: initial;\n          inset-inline-end: -8px;\n          direction: var(--direction);\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-long-lived-access-token-dialog\": HaLongLivedAccessTokenDialog;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;AAAA,OAAO,sBAAsB;AAAC,IAAAA,cAAA;AAE9B,SACEC,GAAG,EAEHC,IAAI,EACJC,UAAU,EAEVC,OAAO,QACF,KAAK;AACZ,SAASC,aAAa,EAAEC,QAAQ,EAAEC,KAAK,QAAQ,gBAAgB;AAC/D,SAASC,SAAS,QAAQ,6BAA6B;AACvD,SAASC,kBAAkB,QAAQ,4BAA4B;AAC/D,OAAO,+BAA+B;AACtC,OAAO,iCAAiC;AACxC,SAASC,aAAa,QAAQ,wBAAwB;AAItD,SAASC,eAAe,QAAQ,kCAAkC;AAClE,SAASC,SAAS,QAAQ,kBAAkB;AAE5C,IAAMC,WAAW,GAAG,mCAAmC;AAEvD,WACaC,4BAA4B,GAAAC,SAAA,EADxCV,aAAa,CAAC,mCAAmC,CAAC,aAAAW,WAAA,EAAAC,WAAA;EAAA,IACtCH,4BAA4B,0BAAAI,YAAA;IAAAC,SAAA,CAAAL,4BAAA,EAAAI,YAAA;IAAA,SAAAJ,6BAAA;MAAA,IAAAM,KAAA;MAAAC,eAAA,OAAAP,4BAAA;MAAA,SAAAQ,IAAA,GAAAC,SAAA,CAAAC,MAAA,EAAAC,IAAA,OAAAC,KAAA,CAAAJ,IAAA,GAAAK,IAAA,MAAAA,IAAA,GAAAL,IAAA,EAAAK,IAAA;QAAAF,IAAA,CAAAE,IAAA,IAAAJ,SAAA,CAAAI,IAAA;MAAA;MAAAP,KAAA,GAAAQ,UAAA,OAAAd,4BAAA,KAAAe,MAAA,CAAAJ,IAAA;MAAAT,WAAA,CAAAc,sBAAA,CAAAV,KAAA;MAAA,OAAAA,KAAA;IAAA;IAAA,OAAAW,YAAA,CAAAjB,4BAAA;EAAA,EAAAG,WAAA;EAAA;IAAAe,CAAA,EAA5BlB,4BAA4B;IAAAmB,CAAA;MAAAC,IAAA;MAAAC,UAAA,GACtC7B,QAAQ,CAAC;QAAE8B,SAAS,EAAE;MAAM,CAAC,CAAC;MAAAC,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAE9B5B,KAAK,CAAC,CAAC;MAAA8B,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAC,UAAA,GAEP5B,KAAK,CAAC,CAAC;MAAA8B,GAAA;MAAAC,KAAA;IAAA;MAAAJ,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAER,SAAAC,WAAkBC,MAAwC,EAAQ;QAChE,IAAI,CAACC,OAAO,GAAGD,MAAM;MACvB;IAAC;MAAAN,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAI,YAAA,EAAqB;QACnB,IAAI,CAACD,OAAO,GAAGE,SAAS;QACxB,IAAI,CAACC,OAAO,GAAGD,SAAS;QACxBnC,SAAS,CAAC,IAAI,EAAE,eAAe,EAAE;UAAEqC,MAAM,EAAE,IAAI,CAACC;QAAU,CAAC,CAAC;MAC9D;IAAC;MAAAZ,IAAA;MAAAG,GAAA;MAAAC,KAAA,EAED,SAAAS,OAAA,EAAmB;QACjB,IAAI,CAAC,IAAI,CAACN,OAAO,IAAI,CAAC,IAAI,CAACA,OAAO,CAACO,KAAK,EAAE;UACxC,OAAO5C,OAAO;QAChB;QAEA,OAAOF,IAAI,CAAA+C,eAAA,KAAAA,eAAA,GAAAC,sBAAA,imBAIIzC,kBAAkB,CAAC,IAAI,CAAC0C,IAAI,EAAE,IAAI,CAACV,OAAO,CAACW,IAAI,CAAC,EACjD,IAAI,CAACV,WAAW,EAKb,IAAI,CAACD,OAAO,CAACO,KAAK,EAClB,IAAI,CAACG,IAAI,CAACE,QAAQ,CACzB,6DACF,CAAC,EAMU,IAAI,CAACC,UAAU,EAEhBtD,cAAc,EAItB,IAAI,CAAC4C,OAAO,GACV,IAAI,CAACA,OAAO,GACZ1C,IAAI,CAAAqD,gBAAA,KAAAA,gBAAA,GAAAL,sBAAA,8IACmB,IAAI,CAACM,WAAW,CAGtC;MAKf;IAAC;MAAAtB,IAAA;MAAAG,GAAA;MAAAC,KAAA;QAAA,IAAAmB,WAAA,GAAAC,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAED,SAAAC,QAAyBC,EAAE;UAAA,IAAAC,SAAA;UAAA,OAAAJ,mBAAA,GAAAK,IAAA,UAAAC,SAAAC,QAAA;YAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;cAAA;gBACnBL,SAAS,GAAGD,EAAE,CAACO,MAAM,CAACC,aAAa;gBAAAJ,QAAA,CAAAE,IAAA;gBAAA,OACnCzD,eAAe,CAACoD,SAAS,CAACzB,KAAK,CAAC;cAAA;gBACtC1B,SAAS,CAAC,IAAI,EAAE;kBACd2D,OAAO,EAAE,IAAI,CAACpB,IAAI,CAACE,QAAQ,CAAC,4BAA4B;gBAC1D,CAAC,CAAC;cAAC;cAAA;gBAAA,OAAAa,QAAA,CAAAM,IAAA;YAAA;UAAA,GAAAX,OAAA;QAAA,CACJ;QAAA,SAAAP,WAAAmB,EAAA;UAAA,OAAAhB,WAAA,CAAAiB,KAAA,OAAAnD,SAAA;QAAA;QAAA,OAAA+B,UAAA;MAAA;IAAA;MAAApB,IAAA;MAAAG,GAAA;MAAAC,KAAA;QAAA,IAAAqC,YAAA,GAAAjB,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAED,SAAAgB,SAAA;UAAA,IAAAC,MAAA,EAAAC,MAAA,EAAAC,OAAA,EAAAC,QAAA;UAAA,OAAArB,mBAAA,GAAAK,IAAA,UAAAiB,UAAAC,SAAA;YAAA,kBAAAA,SAAA,CAAAf,IAAA,GAAAe,SAAA,CAAAd,IAAA;cAAA;gBAAAc,SAAA,CAAAd,IAAA;gBAAA,OACuB,MAAM,CAAC,QAAQ,CAAC;cAAA;gBAA/BS,MAAM,GAAAK,SAAA,CAAAC,IAAA;gBAAAD,SAAA,CAAAd,IAAA;gBAAA,OACSS,MAAM,CAACO,QAAQ,CAAC,IAAI,CAAC3C,OAAO,CAAEO,KAAK,EAAE;kBACxDqC,KAAK,EAAE,GAAG;kBACVC,oBAAoB,EAAE;gBACxB,CAAC,CAAC;cAAA;gBAHIR,MAAM,GAAAI,SAAA,CAAAC,IAAA;gBAINJ,OAAO,GAAGD,MAAM,CAACS,UAAU,CAAC,IAAI,CAAC;gBAEjCP,QAAQ,GAAG,IAAIQ,KAAK,CAAC,CAAC;gBAC5BR,QAAQ,CAACS,GAAG,GAAG5E,WAAW;gBAACqE,SAAA,CAAAd,IAAA;gBAAA,OACrB,IAAIsB,OAAO,CAAC,UAACC,OAAO,EAAK;kBAC7BX,QAAQ,CAACY,MAAM,GAAGD,OAAO;gBAC3B,CAAC,CAAC;cAAA;gBACFZ,OAAO,aAAPA,OAAO,eAAPA,OAAO,CAAEc,SAAS,CAChBb,QAAQ,EACRF,MAAM,CAACO,KAAK,GAAG,CAAC,EAChBP,MAAM,CAACgB,MAAM,GAAG,CAAC,EACjBhB,MAAM,CAACO,KAAK,GAAG,CAAC,EAChBP,MAAM,CAACgB,MAAM,GAAG,CAClB,CAAC;gBAED,IAAI,CAAClD,OAAO,GAAG1C,IAAI,CAAA6F,gBAAA,KAAAA,gBAAA,GAAA7C,sBAAA,gEACT,IAAI,CAACC,IAAI,CAACE,QAAQ,CACtB,yDAAyD,EACzD;kBAAED,IAAI,EAAE,IAAI,CAACX,OAAO,CAAEW;gBAAK,CAC7B,CAAC,EACK0B,MAAM,CAACkB,SAAS,CAAC,CAAC,CAClB;cAAC;cAAA;gBAAA,OAAAd,SAAA,CAAAV,IAAA;YAAA;UAAA,GAAAI,QAAA;QAAA,CACZ;QAAA,SAAApB,YAAA;UAAA,OAAAmB,YAAA,CAAAD,KAAA,OAAAnD,SAAA;QAAA;QAAA,OAAAiC,WAAA;MAAA;IAAA;MAAAtB,IAAA;MAAA+D,MAAA;MAAA5D,GAAA;MAAAC,KAAA,EAED,SAAA4D,OAAA,EAAoC;QAClC,OAAO,CACLxF,aAAa,EACbT,GAAG,CAAAkG,gBAAA,KAAAA,gBAAA,GAAAjD,sBAAA,ihBAmBJ;MACH;IAAC;EAAA;AAAA,GAzH+C/C,UAAU"},"metadata":{},"sourceType":"module","externalDependencies":[]}