{"ast":null,"code":"import _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _callSuper from \"@babel/runtime/helpers/callSuper\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _decorate from \"@babel/runtime/helpers/decorate\";\nvar _templateObject;\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.object.assign.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { html, LitElement } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport { assert, boolean, literal, number, object, optional, string, union } from \"superstruct\";\nimport { createDurationData } from \"../../../../../common/datetime/create_duration_data\";\nimport { fireEvent } from \"../../../../../common/dom/fire_event\";\nimport \"../../../../../components/ha-form/ha-form\";\nimport { forDictStruct } from \"../../structs\";\nvar stateConditionStruct = object({\n  alias: optional(string()),\n  condition: literal(\"state\"),\n  entity_id: optional(string()),\n  attribute: optional(string()),\n  state: optional(string()),\n  for: optional(union([number(), string(), forDictStruct])),\n  enabled: optional(boolean())\n});\nvar SCHEMA = [{\n  name: \"entity_id\",\n  required: true,\n  selector: {\n    entity: {}\n  }\n}, {\n  name: \"attribute\",\n  selector: {\n    attribute: {\n      hide_attributes: [\"access_token\", \"available_modes\", \"color_modes\", \"editable\", \"effect_list\", \"entity_picture\", \"event_types\", \"fan_modes\", \"fan_speed_list\", \"forecast\", \"friendly_name\", \"hvac_modes\", \"icon\", \"operation_list\", \"options\", \"preset_modes\", \"sound_mode_list\", \"source_list\", \"state_class\", \"swing_modes\", \"token\"]\n    }\n  },\n  context: {\n    filter_entity: \"entity_id\"\n  }\n}, {\n  name: \"state\",\n  required: true,\n  selector: {\n    state: {}\n  },\n  context: {\n    filter_entity: \"entity_id\",\n    filter_attribute: \"attribute\"\n  }\n}, {\n  name: \"for\",\n  selector: {\n    duration: {}\n  }\n}];\nexport var HaStateCondition = _decorate([customElement(\"ha-automation-condition-state\")], function (_initialize, _LitElement) {\n  var HaStateCondition = /*#__PURE__*/function (_LitElement2) {\n    _inherits(HaStateCondition, _LitElement2);\n    function HaStateCondition() {\n      var _this;\n      _classCallCheck(this, HaStateCondition);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _callSuper(this, HaStateCondition, [].concat(args));\n      _initialize(_assertThisInitialized(_this));\n      return _this;\n    }\n    return _createClass(HaStateCondition);\n  }(_LitElement);\n  return {\n    F: HaStateCondition,\n    d: [{\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"condition\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Boolean\n      })],\n      key: \"disabled\",\n      value: function value() {\n        return false;\n      }\n    }, {\n      kind: \"get\",\n      static: true,\n      key: \"defaultConfig\",\n      value: function defaultConfig() {\n        return {\n          entity_id: \"\",\n          state: \"\"\n        };\n      }\n    }, {\n      kind: \"method\",\n      key: \"shouldUpdate\",\n      value: function shouldUpdate(changedProperties) {\n        if (changedProperties.has(\"condition\")) {\n          try {\n            assert(this.condition, stateConditionStruct);\n          } catch (e) {\n            fireEvent(this, \"ui-mode-not-available\", e);\n            return false;\n          }\n        }\n        return true;\n      }\n    }, {\n      kind: \"method\",\n      key: \"render\",\n      value: function render() {\n        var trgFor = createDurationData(this.condition.for);\n        var data = Object.assign(Object.assign({}, this.condition), {}, {\n          for: trgFor\n        });\n        return html(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n      <ha-form\\n        .hass=\", \"\\n        .data=\", \"\\n        .schema=\", \"\\n        .disabled=\", \"\\n        @value-changed=\", \"\\n        .computeLabel=\", \"\\n      ></ha-form>\\n    \"])), this.hass, data, SCHEMA, this.disabled, this._valueChanged, this._computeLabelCallback);\n      }\n    }, {\n      kind: \"method\",\n      key: \"_valueChanged\",\n      value: function _valueChanged(ev) {\n        ev.stopPropagation();\n        var newCondition = ev.detail.value;\n        Object.keys(newCondition).forEach(function (key) {\n          return newCondition[key] === undefined || newCondition[key] === \"\" ? delete newCondition[key] : {};\n        });\n\n        // We should not cleanup state in the above, as it is required.\n        // Set it to empty string if it is undefined.\n        if (!newCondition.state) {\n          newCondition.state = \"\";\n        }\n        fireEvent(this, \"value-changed\", {\n          value: newCondition\n        });\n      }\n    }, {\n      kind: \"field\",\n      key: \"_computeLabelCallback\",\n      value: function value() {\n        var _this2 = this;\n        return function (schema) {\n          switch (schema.name) {\n            case \"entity_id\":\n              return _this2.hass.localize(\"ui.components.entity.entity-picker.entity\");\n            case \"attribute\":\n              return _this2.hass.localize(\"ui.components.entity.entity-attribute-picker.attribute\");\n            case \"for\":\n              return _this2.hass.localize(\"ui.panel.config.automation.editor.triggers.type.state.for\");\n            default:\n              return _this2.hass.localize(\"ui.panel.config.automation.editor.conditions.type.state.\".concat(schema.name));\n          }\n        };\n      }\n    }]\n  };\n}, LitElement);","map":{"version":3,"names":["html","LitElement","customElement","property","assert","boolean","literal","number","object","optional","string","union","createDurationData","fireEvent","forDictStruct","stateConditionStruct","alias","condition","entity_id","attribute","state","for","enabled","SCHEMA","name","required","selector","entity","hide_attributes","context","filter_entity","filter_attribute","duration","HaStateCondition","_decorate","_initialize","_LitElement","_LitElement2","_inherits","_this","_classCallCheck","_len","arguments","length","args","Array","_key","_callSuper","concat","_assertThisInitialized","_createClass","F","d","kind","decorators","key","value","type","Boolean","static","defaultConfig","shouldUpdate","changedProperties","has","e","render","trgFor","data","Object","assign","_templateObject","_taggedTemplateLiteral","hass","disabled","_valueChanged","_computeLabelCallback","ev","stopPropagation","newCondition","detail","keys","forEach","undefined","_this2","schema","localize"],"sources":["/workspaces/frontend/src/panels/config/automation/condition/types/ha-automation-condition-state.ts"],"sourcesContent":["import { html, LitElement, PropertyValues } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport {\n  assert,\n  boolean,\n  literal,\n  number,\n  object,\n  optional,\n  string,\n  union,\n} from \"superstruct\";\nimport { createDurationData } from \"../../../../../common/datetime/create_duration_data\";\nimport { fireEvent } from \"../../../../../common/dom/fire_event\";\nimport \"../../../../../components/ha-form/ha-form\";\nimport type { SchemaUnion } from \"../../../../../components/ha-form/types\";\nimport type { StateCondition } from \"../../../../../data/automation\";\nimport type { HomeAssistant } from \"../../../../../types\";\nimport { forDictStruct } from \"../../structs\";\nimport type { ConditionElement } from \"../ha-automation-condition-row\";\n\nconst stateConditionStruct = object({\n  alias: optional(string()),\n  condition: literal(\"state\"),\n  entity_id: optional(string()),\n  attribute: optional(string()),\n  state: optional(string()),\n  for: optional(union([number(), string(), forDictStruct])),\n  enabled: optional(boolean()),\n});\n\nconst SCHEMA = [\n  { name: \"entity_id\", required: true, selector: { entity: {} } },\n  {\n    name: \"attribute\",\n    selector: {\n      attribute: {\n        hide_attributes: [\n          \"access_token\",\n          \"available_modes\",\n          \"color_modes\",\n          \"editable\",\n          \"effect_list\",\n          \"entity_picture\",\n          \"event_types\",\n          \"fan_modes\",\n          \"fan_speed_list\",\n          \"forecast\",\n          \"friendly_name\",\n          \"hvac_modes\",\n          \"icon\",\n          \"operation_list\",\n          \"options\",\n          \"preset_modes\",\n          \"sound_mode_list\",\n          \"source_list\",\n          \"state_class\",\n          \"swing_modes\",\n          \"token\",\n        ],\n      },\n    },\n    context: {\n      filter_entity: \"entity_id\",\n    },\n  },\n  {\n    name: \"state\",\n    required: true,\n    selector: {\n      state: {},\n    },\n    context: {\n      filter_entity: \"entity_id\",\n      filter_attribute: \"attribute\",\n    },\n  },\n  { name: \"for\", selector: { duration: {} } },\n] as const;\n\n@customElement(\"ha-automation-condition-state\")\nexport class HaStateCondition extends LitElement implements ConditionElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public condition!: StateCondition;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  public static get defaultConfig() {\n    return { entity_id: \"\", state: \"\" };\n  }\n\n  public shouldUpdate(changedProperties: PropertyValues) {\n    if (changedProperties.has(\"condition\")) {\n      try {\n        assert(this.condition, stateConditionStruct);\n      } catch (e: any) {\n        fireEvent(this, \"ui-mode-not-available\", e);\n        return false;\n      }\n    }\n    return true;\n  }\n\n  protected render() {\n    const trgFor = createDurationData(this.condition.for);\n    const data = { ...this.condition, for: trgFor };\n\n    return html`\n      <ha-form\n        .hass=${this.hass}\n        .data=${data}\n        .schema=${SCHEMA}\n        .disabled=${this.disabled}\n        @value-changed=${this._valueChanged}\n        .computeLabel=${this._computeLabelCallback}\n      ></ha-form>\n    `;\n  }\n\n  private _valueChanged(ev: CustomEvent): void {\n    ev.stopPropagation();\n    const newCondition = ev.detail.value;\n\n    Object.keys(newCondition).forEach((key) =>\n      newCondition[key] === undefined || newCondition[key] === \"\"\n        ? delete newCondition[key]\n        : {}\n    );\n\n    // We should not cleanup state in the above, as it is required.\n    // Set it to empty string if it is undefined.\n    if (!newCondition.state) {\n      newCondition.state = \"\";\n    }\n\n    fireEvent(this, \"value-changed\", { value: newCondition });\n  }\n\n  private _computeLabelCallback = (\n    schema: SchemaUnion<typeof SCHEMA>\n  ): string => {\n    switch (schema.name) {\n      case \"entity_id\":\n        return this.hass.localize(\"ui.components.entity.entity-picker.entity\");\n      case \"attribute\":\n        return this.hass.localize(\n          \"ui.components.entity.entity-attribute-picker.attribute\"\n        );\n      case \"for\":\n        return this.hass.localize(\n          `ui.panel.config.automation.editor.triggers.type.state.for`\n        );\n      default:\n        return this.hass.localize(\n          `ui.panel.config.automation.editor.conditions.type.state.${schema.name}`\n        );\n    }\n  };\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-automation-condition-state\": HaStateCondition;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}