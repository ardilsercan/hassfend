{"ast":null,"code":"import _decorate from \"@babel/runtime/helpers/decorate\";\nimport _get from \"@babel/runtime/helpers/get\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport { grid } from \"@lit-labs/virtualizer/layouts/grid\";\nimport \"@material/mwc-button/mwc-button\";\nimport \"@material/mwc-list/mwc-list\";\nimport \"@material/mwc-list/mwc-list-item\";\nconst mdiArrowUpRight = \"M21.5 9.5L20.09 10.92L17 7.83V13.5C17 17.09 14.09 20 10.5 20H4V18H10.5C13 18 15 16 15 13.5V7.83L11.91 10.91L10.5 9.5L16 4L21.5 9.5Z\";\nconst mdiPlay = \"M8,5.14V19.14L19,12.14L8,5.14Z\";\nconst mdiPlus = \"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z\";\nimport \"@lrnwebcomponents/simple-tooltip/simple-tooltip\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, eventOptions, property, query, state } from \"lit/decorators\";\nimport { classMap } from \"lit/directives/class-map\";\nimport { styleMap } from \"lit/directives/style-map\";\nimport { until } from \"lit/directives/until\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport { debounce } from \"../../common/util/debounce\";\nimport { isUnavailableState } from \"../../data/entity\";\nimport { browseMediaPlayer, BROWSER_PLAYER, MediaClassBrowserSettings } from \"../../data/media-player\";\nimport { browseLocalMediaPlayer } from \"../../data/media_source\";\nimport { isTTSMediaSource } from \"../../data/tts\";\nimport { showAlertDialog } from \"../../dialogs/generic/show-dialog-box\";\nimport { loadPolyfillIfNeeded } from \"../../resources/resize-observer.polyfill\";\nimport { haStyle } from \"../../resources/styles\";\nimport { brandsUrl, extractDomainFromBrandUrl, isBrandUrl } from \"../../util/brands-url\";\nimport { documentationUrl } from \"../../util/documentation-url\";\nimport \"../entity/ha-entity-picker\";\nimport \"../ha-alert\";\nimport \"../ha-button-menu\";\nimport \"../ha-card\";\nimport \"../ha-circular-progress\";\nimport \"../ha-fab\";\nimport \"../ha-icon-button\";\nimport \"../ha-svg-icon\";\nimport \"./ha-browse-media-tts\";\nimport { loadVirtualizer } from \"../../resources/virtualizer\";\nexport let HaMediaPlayerBrowse = _decorate([customElement(\"ha-media-player-browse\")], function (_initialize, _LitElement) {\n  class HaMediaPlayerBrowse extends _LitElement {\n    constructor(...args) {\n      super(...args);\n      _initialize(this);\n    }\n  }\n  return {\n    F: HaMediaPlayerBrowse,\n    d: [{\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"entityId\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"action\",\n      value() {\n        return \"play\";\n      }\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"preferredLayout\",\n      value() {\n        return \"auto\";\n      }\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Boolean\n      })],\n      key: \"dialog\",\n      value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"navigateIds\",\n      value() {\n        return [];\n      }\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Boolean,\n        reflect: true\n      })],\n      key: \"narrow\",\n      value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Boolean,\n        reflect: true\n      })],\n      key: \"scrolled\",\n      value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_error\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_parentItem\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_currentItem\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [query(\".header\")],\n      key: \"_header\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [query(\".content\")],\n      key: \"_content\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [query(\"lit-virtualizer\")],\n      key: \"_virtualizer\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      key: \"_observed\",\n      value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      key: \"_headerOffsetHeight\",\n      value() {\n        return 0;\n      }\n    }, {\n      kind: \"field\",\n      key: \"_resizeObserver\",\n      value: void 0\n    }, {\n      kind: \"method\",\n      key: \"connectedCallback\",\n      value:\n      // @todo Consider reworking to eliminate need for attribute since it is manipulated internally\n\n      // @todo Consider reworking to eliminate need for attribute since it is manipulated internally\n\n      function connectedCallback() {\n        _get(_getPrototypeOf(HaMediaPlayerBrowse.prototype), \"connectedCallback\", this).call(this);\n        this.updateComplete.then(() => this._attachResizeObserver());\n      }\n    }, {\n      kind: \"method\",\n      key: \"disconnectedCallback\",\n      value: function disconnectedCallback() {\n        _get(_getPrototypeOf(HaMediaPlayerBrowse.prototype), \"disconnectedCallback\", this).call(this);\n        if (this._resizeObserver) {\n          this._resizeObserver.disconnect();\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"refresh\",\n      value: async function refresh() {\n        const currentId = this.navigateIds[this.navigateIds.length - 1];\n        try {\n          this._currentItem = await this._fetchData(this.entityId, currentId.media_content_id, currentId.media_content_type);\n          // Update the parent with latest item.\n          fireEvent(this, \"media-browsed\", {\n            ids: this.navigateIds,\n            current: this._currentItem\n          });\n        } catch (err) {\n          this._setError(err);\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"play\",\n      value: function play() {\n        var _this$_currentItem;\n        if ((_this$_currentItem = this._currentItem) !== null && _this$_currentItem !== void 0 && _this$_currentItem.can_play) {\n          this._runAction(this._currentItem);\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"willUpdate\",\n      value: function willUpdate(changedProps) {\n        var _this$_content;\n        _get(_getPrototypeOf(HaMediaPlayerBrowse.prototype), \"willUpdate\", this).call(this, changedProps);\n        if (!this.hasUpdated) {\n          loadVirtualizer();\n        }\n        if (changedProps.has(\"entityId\")) {\n          this._setError(undefined);\n        } else if (!changedProps.has(\"navigateIds\")) {\n          // Neither entity ID or navigateIDs changed, nothing to fetch\n          return;\n        }\n        this._setError(undefined);\n        const oldNavigateIds = changedProps.get(\"navigateIds\");\n        const navigateIds = this.navigateIds;\n\n        // We're navigating. Reset the shizzle.\n        (_this$_content = this._content) === null || _this$_content === void 0 || _this$_content.scrollTo(0, 0);\n        this.scrolled = false;\n        const oldCurrentItem = this._currentItem;\n        const oldParentItem = this._parentItem;\n        this._currentItem = undefined;\n        this._parentItem = undefined;\n        const currentId = navigateIds[navigateIds.length - 1];\n        const parentId = navigateIds.length > 1 ? navigateIds[navigateIds.length - 2] : undefined;\n        let currentProm;\n        let parentProm;\n\n        // See if we can take loading shortcuts if navigating to parent or child\n        if (!changedProps.has(\"entityId\")) {\n          if (\n          // Check if we navigated to a child\n          oldNavigateIds && navigateIds.length === oldNavigateIds.length + 1 && oldNavigateIds.every((oldVal, idx) => {\n            const curVal = navigateIds[idx];\n            return curVal.media_content_id === oldVal.media_content_id && curVal.media_content_type === oldVal.media_content_type;\n          })) {\n            parentProm = Promise.resolve(oldCurrentItem);\n          } else if (\n          // Check if we navigated to a parent\n          oldNavigateIds && navigateIds.length === oldNavigateIds.length - 1 && navigateIds.every((curVal, idx) => {\n            const oldVal = oldNavigateIds[idx];\n            return curVal.media_content_id === oldVal.media_content_id && curVal.media_content_type === oldVal.media_content_type;\n          })) {\n            currentProm = Promise.resolve(oldParentItem);\n          }\n        }\n        // Fetch current\n        if (!currentProm) {\n          currentProm = this._fetchData(this.entityId, currentId.media_content_id, currentId.media_content_type);\n        }\n        currentProm.then(item => {\n          this._currentItem = item;\n          fireEvent(this, \"media-browsed\", {\n            ids: navigateIds,\n            current: item\n          });\n        }, err => {\n          var _this$hass$states$thi;\n          // When we change entity ID, we will first try to see if the new entity is\n          // able to resolve the new path. If that results in an error, browse the root.\n          const isNewEntityWithSamePath = oldNavigateIds && changedProps.has(\"entityId\") && navigateIds.length === oldNavigateIds.length && oldNavigateIds.every((oldItem, idx) => navigateIds[idx].media_content_id === oldItem.media_content_id && navigateIds[idx].media_content_type === oldItem.media_content_type);\n          if (isNewEntityWithSamePath) {\n            fireEvent(this, \"media-browsed\", {\n              ids: [{\n                media_content_id: undefined,\n                media_content_type: undefined\n              }],\n              replace: true\n            });\n          } else if (err.code === \"entity_not_found\" && isUnavailableState((_this$hass$states$thi = this.hass.states[this.entityId]) === null || _this$hass$states$thi === void 0 ? void 0 : _this$hass$states$thi.state)) {\n            this._setError({\n              message: this.hass.localize(`ui.components.media-browser.media_player_unavailable`),\n              code: \"entity_not_found\"\n            });\n          } else {\n            this._setError(err);\n          }\n        });\n        // Fetch parent\n        if (!parentProm && parentId !== undefined) {\n          parentProm = this._fetchData(this.entityId, parentId.media_content_id, parentId.media_content_type);\n        }\n        if (parentProm) {\n          parentProm.then(parent => {\n            this._parentItem = parent;\n          });\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"shouldUpdate\",\n      value: function shouldUpdate(changedProps) {\n        if (changedProps.size > 1 || !changedProps.has(\"hass\")) {\n          return true;\n        }\n        const oldHass = changedProps.get(\"hass\");\n        return oldHass === undefined || oldHass.localize !== this.hass.localize;\n      }\n    }, {\n      kind: \"method\",\n      key: \"firstUpdated\",\n      value: function firstUpdated() {\n        this._measureCard();\n        this._attachResizeObserver();\n      }\n    }, {\n      kind: \"method\",\n      key: \"updated\",\n      value: function updated(changedProps) {\n        _get(_getPrototypeOf(HaMediaPlayerBrowse.prototype), \"updated\", this).call(this, changedProps);\n        if (changedProps.has(\"_scrolled\")) {\n          this._animateHeaderHeight();\n        } else if (changedProps.has(\"_currentItem\")) {\n          var _this$_virtualizer;\n          this._setHeaderHeight();\n\n          // This fixes a race condition for resizing of the cards using the grid layout\n          if (this._observed) {\n            return;\n          }\n\n          // @ts-ignore\n          const virtualizer = (_this$_virtualizer = this._virtualizer) === null || _this$_virtualizer === void 0 ? void 0 : _this$_virtualizer._virtualizer;\n          if (virtualizer) {\n            this._observed = true;\n            setTimeout(() => virtualizer._observeMutations(), 0);\n          }\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"render\",\n      value: function render() {\n        if (this._error) {\n          return html`\n        <div class=\"container\">\n          <ha-alert alert-type=\"error\">\n            ${this._renderError(this._error)}\n          </ha-alert>\n        </div>\n      `;\n        }\n        if (!this._currentItem) {\n          return html`<ha-circular-progress indeterminate></ha-circular-progress>`;\n        }\n        const currentItem = this._currentItem;\n        const subtitle = this.hass.localize(`ui.components.media-browser.class.${currentItem.media_class}`);\n        const children = currentItem.children || [];\n        const mediaClass = MediaClassBrowserSettings[currentItem.media_class];\n        const childrenMediaClass = currentItem.children_media_class ? MediaClassBrowserSettings[currentItem.children_media_class] : MediaClassBrowserSettings.directory;\n        const backgroundImage = currentItem.thumbnail ? this._getThumbnailURLorBase64(currentItem.thumbnail).then(value => `url(${value})`) : \"none\";\n        return html`\n              ${currentItem.can_play ? html`\n                      <div\n                        class=\"header ${classMap({\n          \"no-img\": !currentItem.thumbnail,\n          \"no-dialog\": !this.dialog\n        })}\"\n                        @transitionend=${this._setHeaderHeight}\n                      >\n                        <div class=\"header-content\">\n                          ${currentItem.thumbnail ? html`\n                                <div\n                                  class=\"img\"\n                                  style=\"background-image: ${until(backgroundImage, \"\")}\"\n                                >\n                                  ${this.narrow && currentItem !== null && currentItem !== void 0 && currentItem.can_play ? html`\n                                        <ha-fab\n                                          mini\n                                          .item=${currentItem}\n                                          @click=${this._actionClicked}\n                                        >\n                                          <ha-svg-icon\n                                            slot=\"icon\"\n                                            .label=${this.hass.localize(`ui.components.media-browser.${this.action}-media`)}\n                                            .path=${this.action === \"play\" ? mdiPlay : mdiPlus}\n                                          ></ha-svg-icon>\n                                          ${this.hass.localize(`ui.components.media-browser.${this.action}`)}\n                                        </ha-fab>\n                                      ` : \"\"}\n                                </div>\n                              ` : nothing}\n                          <div class=\"header-info\">\n                            <div class=\"breadcrumb\">\n                              <h1 class=\"title\">${currentItem.title}</h1>\n                              ${subtitle ? html` <h2 class=\"subtitle\">${subtitle}</h2> ` : \"\"}\n                            </div>\n                            ${currentItem.can_play && (!currentItem.thumbnail || !this.narrow) ? html`\n                                  <mwc-button\n                                    raised\n                                    .item=${currentItem}\n                                    @click=${this._actionClicked}\n                                  >\n                                    <ha-svg-icon\n                                      .label=${this.hass.localize(`ui.components.media-browser.${this.action}-media`)}\n                                      .path=${this.action === \"play\" ? mdiPlay : mdiPlus}\n                                    ></ha-svg-icon>\n                                    ${this.hass.localize(`ui.components.media-browser.${this.action}`)}\n                                  </mwc-button>\n                                ` : \"\"}\n                          </div>\n                        </div>\n                      </div>\n                    ` : \"\"}\n          <div\n            class=\"content\"\n            @scroll=${this._scroll}\n            @touchmove=${this._scroll}\n          >\n            ${this._error ? html`\n                    <div class=\"container\">\n                      <ha-alert alert-type=\"error\">\n                        ${this._renderError(this._error)}\n                      </ha-alert>\n                    </div>\n                  ` : isTTSMediaSource(currentItem.media_content_id) ? html`\n                      <ha-browse-media-tts\n                        .item=${currentItem}\n                        .hass=${this.hass}\n                        .action=${this.action}\n                        @tts-picked=${this._ttsPicked}\n                      ></ha-browse-media-tts>\n                    ` : !children.length && !currentItem.not_shown ? html`\n                        <div class=\"container no-items\">\n                          ${currentItem.media_content_id === \"media-source://media_source/local/.\" ? html`\n                                <div class=\"highlight-add-button\">\n                                  <span>\n                                    <ha-svg-icon\n                                      .path=${mdiArrowUpRight}\n                                    ></ha-svg-icon>\n                                  </span>\n                                  <span>\n                                    ${this.hass.localize(\"ui.components.media-browser.file_management.highlight_button\")}\n                                  </span>\n                                </div>\n                              ` : this.hass.localize(\"ui.components.media-browser.no_items\")}\n                        </div>\n                      ` : this.preferredLayout === \"grid\" || this.preferredLayout === \"auto\" && childrenMediaClass.layout === \"grid\" ? html`\n                          <lit-virtualizer\n                            scroller\n                            .layout=${grid({\n          itemSize: {\n            width: \"175px\",\n            height: childrenMediaClass.thumbnail_ratio === \"portrait\" ? \"312px\" : \"225px\"\n          },\n          gap: \"16px\",\n          flex: {\n            preserve: \"aspect-ratio\"\n          },\n          justify: \"space-evenly\",\n          direction: \"vertical\"\n        })}\n                            .items=${children}\n                            .renderItem=${this._renderGridItem}\n                            class=\"children ${classMap({\n          portrait: childrenMediaClass.thumbnail_ratio === \"portrait\",\n          not_shown: !!currentItem.not_shown\n        })}\"\n                          ></lit-virtualizer>\n                          ${currentItem.not_shown ? html`\n                                <div class=\"grid not-shown\">\n                                  <div class=\"title\">\n                                    ${this.hass.localize(\"ui.components.media-browser.not_shown\", {\n          count: currentItem.not_shown\n        })}\n                                  </div>\n                                </div>\n                              ` : \"\"}\n                        ` : html`\n                          <mwc-list>\n                            <lit-virtualizer\n                              scroller\n                              .items=${children}\n                              style=${styleMap({\n          height: `${children.length * 72 + 26}px`\n        })}\n                              .renderItem=${this._renderListItem}\n                            ></lit-virtualizer>\n                            ${currentItem.not_shown ? html`\n                                  <mwc-list-item\n                                    noninteractive\n                                    class=\"not-shown\"\n                                    .graphic=${mediaClass.show_list_images ? \"medium\" : \"avatar\"}\n                                  >\n                                    <span class=\"title\">\n                                      ${this.hass.localize(\"ui.components.media-browser.not_shown\", {\n          count: currentItem.not_shown\n        })}\n                                    </span>\n                                  </mwc-list-item>\n                                ` : \"\"}\n                          </mwc-list>\n                        `}\n          </div>\n        </div>\n      </div>\n    `;\n      }\n    }, {\n      kind: \"field\",\n      key: \"_renderGridItem\",\n      value() {\n        return child => {\n          const backgroundImage = child.thumbnail ? this._getThumbnailURLorBase64(child.thumbnail).then(value => `url(${value})`) : \"none\";\n          return html`\n      <div class=\"child\" .item=${child} @click=${this._childClicked}>\n        <ha-card outlined>\n          <div class=\"thumbnail\">\n            ${child.thumbnail ? html`\n                  <div\n                    class=\"${classMap({\n            \"centered-image\": [\"app\", \"directory\"].includes(child.media_class),\n            \"brand-image\": isBrandUrl(child.thumbnail)\n          })} image\"\n                    style=\"background-image: ${until(backgroundImage, \"\")}\"\n                  ></div>\n                ` : html`\n                  <div class=\"icon-holder image\">\n                    <ha-svg-icon\n                      class=\"folder\"\n                      .path=${MediaClassBrowserSettings[child.media_class === \"directory\" ? child.children_media_class || child.media_class : child.media_class].icon}\n                    ></ha-svg-icon>\n                  </div>\n                `}\n            ${child.can_play ? html`\n                  <ha-icon-button\n                    class=\"play ${classMap({\n            can_expand: child.can_expand\n          })}\"\n                    .item=${child}\n                    .label=${this.hass.localize(`ui.components.media-browser.${this.action}-media`)}\n                    .path=${this.action === \"play\" ? mdiPlay : mdiPlus}\n                    @click=${this._actionClicked}\n                  ></ha-icon-button>\n                ` : \"\"}\n          </div>\n          <div class=\"title\">\n            ${child.title}\n            <simple-tooltip fitToVisibleBounds position=\"top\" offset=\"4\"\n              >${child.title}</simple-tooltip\n            >\n          </div>\n        </ha-card>\n      </div>\n    `;\n        };\n      }\n    }, {\n      kind: \"field\",\n      key: \"_renderListItem\",\n      value() {\n        return child => {\n          const currentItem = this._currentItem;\n          const mediaClass = MediaClassBrowserSettings[currentItem.media_class];\n          const backgroundImage = mediaClass.show_list_images && child.thumbnail ? this._getThumbnailURLorBase64(child.thumbnail).then(value => `url(${value})`) : \"none\";\n          return html`\n      <mwc-list-item\n        @click=${this._childClicked}\n        .item=${child}\n        .graphic=${mediaClass.show_list_images ? \"medium\" : \"avatar\"}\n      >\n        ${backgroundImage === \"none\" && !child.can_play ? html`<ha-svg-icon\n              .path=${MediaClassBrowserSettings[child.media_class === \"directory\" ? child.children_media_class || child.media_class : child.media_class].icon}\n              slot=\"graphic\"\n            ></ha-svg-icon>` : html`<div\n              class=${classMap({\n            graphic: true,\n            thumbnail: mediaClass.show_list_images === true\n          })}\n              style=\"background-image: ${until(backgroundImage, \"\")}\"\n              slot=\"graphic\"\n            >\n              ${child.can_play ? html`<ha-icon-button\n                    class=\"play ${classMap({\n            show: !mediaClass.show_list_images || !child.thumbnail\n          })}\"\n                    .item=${child}\n                    .label=${this.hass.localize(`ui.components.media-browser.${this.action}-media`)}\n                    .path=${this.action === \"play\" ? mdiPlay : mdiPlus}\n                    @click=${this._actionClicked}\n                  ></ha-icon-button>` : nothing}\n            </div>`}\n        <span class=\"title\">${child.title}</span>\n      </mwc-list-item>\n    `;\n        };\n      }\n    }, {\n      kind: \"method\",\n      key: \"_getThumbnailURLorBase64\",\n      value: async function _getThumbnailURLorBase64(thumbnailUrl) {\n        if (!thumbnailUrl) {\n          return \"\";\n        }\n        if (thumbnailUrl.startsWith(\"/\")) {\n          // Thumbnails served by local API require authentication\n          return new Promise((resolve, reject) => {\n            this.hass.fetchWithAuth(thumbnailUrl)\n            // Since we are fetching with an authorization header, we cannot just put the\n            // URL directly into the document; we need to embed the image. We could do this\n            // using blob URLs, but then we would need to keep track of them in order to\n            // release them properly. Instead, we embed the thumbnail using base64.\n            .then(response => response.blob()).then(blob => {\n              const reader = new FileReader();\n              reader.onload = () => {\n                const result = reader.result;\n                resolve(typeof result === \"string\" ? result : \"\");\n              };\n              reader.onerror = e => reject(e);\n              reader.readAsDataURL(blob);\n            });\n          });\n        }\n        if (isBrandUrl(thumbnailUrl)) {\n          var _this$hass$themes;\n          // The backend is not aware of the theme used by the users,\n          // so we rewrite the URL to show a proper icon\n          thumbnailUrl = brandsUrl({\n            domain: extractDomainFromBrandUrl(thumbnailUrl),\n            type: \"icon\",\n            useFallback: true,\n            darkOptimized: (_this$hass$themes = this.hass.themes) === null || _this$hass$themes === void 0 ? void 0 : _this$hass$themes.darkMode\n          });\n        }\n        return thumbnailUrl;\n      }\n    }, {\n      kind: \"field\",\n      key: \"_actionClicked\",\n      value() {\n        return ev => {\n          ev.stopPropagation();\n          const item = ev.currentTarget.item;\n          this._runAction(item);\n        };\n      }\n    }, {\n      kind: \"method\",\n      key: \"_runAction\",\n      value: function _runAction(item) {\n        fireEvent(this, \"media-picked\", {\n          item,\n          navigateIds: this.navigateIds\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"_ttsPicked\",\n      value: function _ttsPicked(ev) {\n        ev.stopPropagation();\n        const navigateIds = this.navigateIds.slice(0, -1);\n        navigateIds.push(ev.detail.item);\n        fireEvent(this, \"media-picked\", {\n          ...ev.detail,\n          navigateIds\n        });\n      }\n    }, {\n      kind: \"field\",\n      key: \"_childClicked\",\n      value() {\n        return async ev => {\n          const target = ev.currentTarget;\n          const item = target.item;\n          if (!item) {\n            return;\n          }\n          if (!item.can_expand) {\n            this._runAction(item);\n            return;\n          }\n          fireEvent(this, \"media-browsed\", {\n            ids: [...this.navigateIds, item]\n          });\n        };\n      }\n    }, {\n      kind: \"method\",\n      key: \"_fetchData\",\n      value: async function _fetchData(entityId, mediaContentId, mediaContentType) {\n        return entityId !== BROWSER_PLAYER ? browseMediaPlayer(this.hass, entityId, mediaContentId, mediaContentType) : browseLocalMediaPlayer(this.hass, mediaContentId);\n      }\n    }, {\n      kind: \"method\",\n      key: \"_measureCard\",\n      value: function _measureCard() {\n        this.narrow = (this.dialog ? window.innerWidth : this.offsetWidth) < 450;\n      }\n    }, {\n      kind: \"method\",\n      key: \"_attachResizeObserver\",\n      value: async function _attachResizeObserver() {\n        if (!this._resizeObserver) {\n          await loadPolyfillIfNeeded();\n          this._resizeObserver = new ResizeObserver(debounce(() => this._measureCard(), 250, false));\n        }\n        this._resizeObserver.observe(this);\n      }\n    }, {\n      kind: \"method\",\n      key: \"_closeDialogAction\",\n      value: function _closeDialogAction() {\n        fireEvent(this, \"close-dialog\");\n      }\n    }, {\n      kind: \"method\",\n      key: \"_setError\",\n      value: function _setError(error) {\n        if (!this.dialog) {\n          this._error = error;\n          return;\n        }\n        if (!error) {\n          return;\n        }\n        this._closeDialogAction();\n        showAlertDialog(this, {\n          title: this.hass.localize(\"ui.components.media-browser.media_browsing_error\"),\n          text: this._renderError(error)\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"_renderError\",\n      value: function _renderError(err) {\n        if (err.message === \"Media directory does not exist.\") {\n          return html`\n        <h2>\n          ${this.hass.localize(\"ui.components.media-browser.no_local_media_found\")}\n        </h2>\n        <p>\n          ${this.hass.localize(\"ui.components.media-browser.no_media_folder\")}\n          <br />\n          ${this.hass.localize(\"ui.components.media-browser.setup_local_help\", {\n            documentation: html`<a\n              href=${documentationUrl(this.hass, \"/more-info/local-media/setup-media\")}\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              >${this.hass.localize(\"ui.components.media-browser.documentation\")}</a\n            >`\n          })}\n          <br />\n          ${this.hass.localize(\"ui.components.media-browser.local_media_files\")}\n        </p>\n      `;\n        }\n        return html`<span class=\"error\">${err.message}</span>`;\n      }\n    }, {\n      kind: \"method\",\n      key: \"_setHeaderHeight\",\n      value: async function _setHeaderHeight() {\n        await this.updateComplete;\n        const header = this._header;\n        const content = this._content;\n        if (!header || !content) {\n          return;\n        }\n        this._headerOffsetHeight = header.offsetHeight;\n        content.style.marginTop = `${this._headerOffsetHeight}px`;\n        content.style.maxHeight = `calc(var(--media-browser-max-height, 100%) - ${this._headerOffsetHeight}px)`;\n      }\n    }, {\n      kind: \"method\",\n      key: \"_animateHeaderHeight\",\n      value: function _animateHeaderHeight() {\n        let start;\n        const animate = time => {\n          if (start === undefined) {\n            start = time;\n          }\n          const elapsed = time - start;\n          this._setHeaderHeight();\n          if (elapsed < 400) {\n            requestAnimationFrame(animate);\n          }\n        };\n        requestAnimationFrame(animate);\n      }\n    }, {\n      kind: \"method\",\n      decorators: [eventOptions({\n        passive: true\n      })],\n      key: \"_scroll\",\n      value: function _scroll(ev) {\n        const content = ev.currentTarget;\n        if (!this.scrolled && content.scrollTop > this._headerOffsetHeight) {\n          this.scrolled = true;\n        } else if (this.scrolled && content.scrollTop < this._headerOffsetHeight) {\n          this.scrolled = false;\n        }\n      }\n    }, {\n      kind: \"get\",\n      static: true,\n      key: \"styles\",\n      value: function styles() {\n        return [haStyle, css`\n        :host {\n          display: flex;\n          flex-direction: column;\n          position: relative;\n        }\n\n        ha-circular-progress {\n          --mdc-theme-primary: var(--primary-color);\n          display: flex;\n          justify-content: center;\n          margin: 40px;\n        }\n\n        .container {\n          padding: 16px;\n        }\n\n        .no-items {\n          padding-left: 32px;\n        }\n\n        .highlight-add-button {\n          display: flex;\n          flex-direction: row-reverse;\n          margin-right: 48px;\n        }\n\n        .highlight-add-button ha-svg-icon {\n          position: relative;\n          top: -0.5em;\n          margin-left: 8px;\n        }\n\n        .content {\n          overflow-y: auto;\n          box-sizing: border-box;\n          height: 100%;\n        }\n\n        /* HEADER */\n\n        .header {\n          display: flex;\n          justify-content: space-between;\n          border-bottom: 1px solid var(--divider-color);\n          background-color: var(--card-background-color);\n          position: absolute;\n          top: 0;\n          right: 0;\n          left: 0;\n          z-index: 3;\n          padding: 16px;\n        }\n        .header_button {\n          position: relative;\n          right: -8px;\n        }\n        .header-content {\n          display: flex;\n          flex-wrap: wrap;\n          flex-grow: 1;\n          align-items: flex-start;\n        }\n        .header-content .img {\n          height: 175px;\n          width: 175px;\n          margin-right: 16px;\n          background-size: cover;\n          border-radius: 2px;\n          transition:\n            width 0.4s,\n            height 0.4s;\n        }\n        .header-info {\n          display: flex;\n          flex-direction: column;\n          justify-content: space-between;\n          align-self: stretch;\n          min-width: 0;\n          flex: 1;\n        }\n        .header-info mwc-button {\n          display: block;\n          --mdc-theme-primary: var(--primary-color);\n          padding-bottom: 16px;\n        }\n        .breadcrumb {\n          display: flex;\n          flex-direction: column;\n          overflow: hidden;\n          flex-grow: 1;\n          padding-top: 16px;\n        }\n        .breadcrumb .title {\n          font-size: 32px;\n          line-height: 1.2;\n          font-weight: bold;\n          margin: 0;\n          overflow: hidden;\n          display: -webkit-box;\n          -webkit-box-orient: vertical;\n          -webkit-line-clamp: 2;\n          padding-right: 8px;\n        }\n        .breadcrumb .previous-title {\n          font-size: 14px;\n          padding-bottom: 8px;\n          color: var(--secondary-text-color);\n          overflow: hidden;\n          text-overflow: ellipsis;\n          cursor: pointer;\n          --mdc-icon-size: 14px;\n        }\n        .breadcrumb .subtitle {\n          font-size: 16px;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          margin-bottom: 0;\n          transition:\n            height 0.5s,\n            margin 0.5s;\n        }\n\n        .not-shown {\n          font-style: italic;\n          color: var(--secondary-text-color);\n          padding: 8px 16px 8px;\n        }\n\n        .grid.not-shown {\n          display: flex;\n          align-items: center;\n          text-align: center;\n        }\n\n        /* ============= CHILDREN ============= */\n\n        mwc-list {\n          --mdc-list-vertical-padding: 0;\n          --mdc-list-item-graphic-margin: 0;\n          --mdc-theme-text-icon-on-background: var(--secondary-text-color);\n          margin-top: 10px;\n        }\n\n        mwc-list li:last-child {\n          display: none;\n        }\n\n        mwc-list li[divider] {\n          border-bottom-color: var(--divider-color);\n        }\n\n        mwc-list-item {\n          width: 100%;\n        }\n\n        div.children {\n          display: grid;\n          grid-template-columns: repeat(\n            auto-fit,\n            minmax(var(--media-browse-item-size, 175px), 0.1fr)\n          );\n          grid-gap: 16px;\n          padding: 16px;\n        }\n\n        :host([dialog]) .children {\n          grid-template-columns: repeat(\n            auto-fit,\n            minmax(var(--media-browse-item-size, 175px), 0.33fr)\n          );\n        }\n\n        .child {\n          display: flex;\n          flex-direction: column;\n          cursor: pointer;\n        }\n\n        ha-card {\n          position: relative;\n          width: 100%;\n          box-sizing: border-box;\n        }\n\n        .children ha-card .thumbnail {\n          width: 100%;\n          position: relative;\n          box-sizing: border-box;\n          transition: padding-bottom 0.1s ease-out;\n          padding-bottom: 100%;\n        }\n\n        .portrait ha-card .thumbnail {\n          padding-bottom: 150%;\n        }\n\n        ha-card .image {\n          border-radius: 3px 3px 0 0;\n        }\n\n        .image {\n          position: absolute;\n          top: 0;\n          right: 0;\n          left: 0;\n          bottom: 0;\n          background-size: cover;\n          background-repeat: no-repeat;\n          background-position: center;\n        }\n\n        .centered-image {\n          margin: 0 8px;\n          background-size: contain;\n        }\n\n        .brand-image {\n          background-size: 40%;\n        }\n\n        .children ha-card .icon-holder {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n        }\n\n        .child .folder {\n          color: var(--secondary-text-color);\n          --mdc-icon-size: calc(var(--media-browse-item-size, 175px) * 0.4);\n        }\n\n        .child .play {\n          position: absolute;\n          transition: color 0.5s;\n          border-radius: 50%;\n          top: calc(50% - 50px);\n          right: calc(50% - 35px);\n          opacity: 0;\n          transition: opacity 0.1s ease-out;\n        }\n\n        .child .play:not(.can_expand) {\n          --mdc-icon-button-size: 70px;\n          --mdc-icon-size: 48px;\n        }\n\n        ha-card:hover .play {\n          opacity: 1;\n        }\n\n        ha-card:hover .play:not(.can_expand) {\n          color: var(--primary-color);\n        }\n\n        ha-card:hover .play.can_expand {\n          bottom: 8px;\n        }\n\n        .child .play.can_expand {\n          background-color: rgba(var(--rgb-card-background-color), 0.5);\n          top: auto;\n          bottom: 0px;\n          right: 8px;\n          transition:\n            bottom 0.1s ease-out,\n            opacity 0.1s ease-out;\n        }\n\n        .child .play:hover {\n          color: var(--primary-color);\n        }\n\n        .child .title {\n          font-size: 16px;\n          padding-top: 16px;\n          padding-left: 2px;\n          overflow: hidden;\n          display: -webkit-box;\n          -webkit-box-orient: vertical;\n          -webkit-line-clamp: 1;\n          text-overflow: ellipsis;\n        }\n\n        .child ha-card .title {\n          margin-bottom: 16px;\n          padding-left: 16px;\n        }\n\n        mwc-list-item .graphic {\n          background-size: contain;\n          background-repeat: no-repeat;\n          background-position: center;\n          border-radius: 2px;\n          display: flex;\n          align-content: center;\n          align-items: center;\n          line-height: initial;\n        }\n\n        mwc-list-item .graphic .play {\n          opacity: 0;\n          transition: all 0.5s;\n          background-color: rgba(var(--rgb-card-background-color), 0.5);\n          border-radius: 50%;\n          --mdc-icon-button-size: 40px;\n        }\n\n        mwc-list-item:hover .graphic .play {\n          opacity: 1;\n          color: var(--primary-text-color);\n        }\n\n        mwc-list-item .graphic .play.show {\n          opacity: 1;\n          background-color: transparent;\n        }\n\n        mwc-list-item .title {\n          margin-left: 16px;\n          margin-inline-start: 16px;\n          margin-inline-end: initial;\n        }\n\n        /* ============= Narrow ============= */\n\n        :host([narrow]) {\n          padding: 0;\n        }\n\n        :host([narrow]) .media-source {\n          padding: 0 24px;\n        }\n\n        :host([narrow]) div.children {\n          grid-template-columns: minmax(0, 1fr) minmax(0, 1fr) !important;\n        }\n\n        :host([narrow]) .breadcrumb .title {\n          font-size: 24px;\n        }\n        :host([narrow]) .header {\n          padding: 0;\n        }\n        :host([narrow]) .header.no-dialog {\n          display: block;\n        }\n        :host([narrow]) .header_button {\n          position: absolute;\n          top: 14px;\n          right: 8px;\n        }\n        :host([narrow]) .header-content {\n          flex-direction: column;\n          flex-wrap: nowrap;\n        }\n        :host([narrow]) .header-content .img {\n          height: auto;\n          width: 100%;\n          margin-right: 0;\n          padding-bottom: 50%;\n          margin-bottom: 8px;\n          position: relative;\n          background-position: center;\n          border-radius: 0;\n          transition:\n            width 0.4s,\n            height 0.4s,\n            padding-bottom 0.4s;\n        }\n        ha-fab {\n          position: absolute;\n          --mdc-theme-secondary: var(--primary-color);\n          bottom: -20px;\n          right: 20px;\n        }\n        :host([narrow]) .header-info mwc-button {\n          margin-top: 16px;\n          margin-bottom: 8px;\n        }\n        :host([narrow]) .header-info {\n          padding: 0 16px 8px;\n        }\n\n        /* ============= Scroll ============= */\n        :host([scrolled]) .breadcrumb .subtitle {\n          height: 0;\n          margin: 0;\n        }\n        :host([scrolled]) .breadcrumb .title {\n          -webkit-line-clamp: 1;\n        }\n        :host(:not([narrow])[scrolled]) .header:not(.no-img) ha-icon-button {\n          align-self: center;\n        }\n        :host([scrolled]) .header-info mwc-button,\n        .no-img .header-info mwc-button {\n          padding-right: 4px;\n        }\n        :host([scrolled][narrow]) .no-img .header-info mwc-button {\n          padding-right: 16px;\n        }\n        :host([scrolled]) .header-info {\n          flex-direction: row;\n        }\n        :host([scrolled]) .header-info mwc-button {\n          align-self: center;\n          margin-top: 0;\n          margin-bottom: 0;\n          padding-bottom: 0;\n        }\n        :host([scrolled][narrow]) .no-img .header-info {\n          flex-direction: row-reverse;\n        }\n        :host([scrolled][narrow]) .header-info {\n          padding: 20px 24px 10px 24px;\n          align-items: center;\n        }\n        :host([scrolled]) .header-content {\n          align-items: flex-end;\n          flex-direction: row;\n        }\n        :host([scrolled]) .header-content .img {\n          height: 75px;\n          width: 75px;\n        }\n        :host([scrolled]) .breadcrumb {\n          padding-top: 0;\n          align-self: center;\n        }\n        :host([scrolled][narrow]) .header-content .img {\n          height: 100px;\n          width: 100px;\n          padding-bottom: initial;\n          margin-bottom: 0;\n        }\n        :host([scrolled]) ha-fab {\n          bottom: 0px;\n          right: -24px;\n          --mdc-fab-box-shadow: none;\n          --mdc-theme-secondary: rgba(var(--rgb-primary-color), 0.5);\n        }\n\n        lit-virtualizer {\n          height: 100%;\n          overflow: overlay !important;\n          contain: size layout !important;\n        }\n\n        lit-virtualizer.not_shown {\n          height: calc(100% - 36px);\n        }\n\n        ha-browse-media-tts {\n          direction: var(--direction);\n        }\n      `];\n      }\n    }]\n  };\n}, LitElement);","map":{"version":3,"names":["grid","mdiArrowUpRight","mdiPlay","mdiPlus","css","html","LitElement","nothing","customElement","eventOptions","property","query","state","classMap","styleMap","until","fireEvent","debounce","isUnavailableState","browseMediaPlayer","BROWSER_PLAYER","MediaClassBrowserSettings","browseLocalMediaPlayer","isTTSMediaSource","showAlertDialog","loadPolyfillIfNeeded","haStyle","brandsUrl","extractDomainFromBrandUrl","isBrandUrl","documentationUrl","loadVirtualizer","HaMediaPlayerBrowse","_decorate","_initialize","_LitElement","constructor","args","F","d","kind","decorators","attribute","key","value","type","Boolean","reflect","connectedCallback","_get","_getPrototypeOf","prototype","call","updateComplete","then","_attachResizeObserver","disconnectedCallback","_resizeObserver","disconnect","refresh","currentId","navigateIds","length","_currentItem","_fetchData","entityId","media_content_id","media_content_type","ids","current","err","_setError","play","_this$_currentItem","can_play","_runAction","willUpdate","changedProps","_this$_content","hasUpdated","has","undefined","oldNavigateIds","get","_content","scrollTo","scrolled","oldCurrentItem","oldParentItem","_parentItem","parentId","currentProm","parentProm","every","oldVal","idx","curVal","Promise","resolve","item","_this$hass$states$thi","isNewEntityWithSamePath","oldItem","replace","code","hass","states","message","localize","parent","shouldUpdate","size","oldHass","firstUpdated","_measureCard","updated","_animateHeaderHeight","_this$_virtualizer","_setHeaderHeight","_observed","virtualizer","_virtualizer","setTimeout","_observeMutations","render","_error","_renderError","currentItem","subtitle","media_class","children","mediaClass","childrenMediaClass","children_media_class","directory","backgroundImage","thumbnail","_getThumbnailURLorBase64","dialog","narrow","_actionClicked","action","title","_scroll","_ttsPicked","not_shown","preferredLayout","layout","itemSize","width","height","thumbnail_ratio","gap","flex","preserve","justify","direction","_renderGridItem","portrait","count","_renderListItem","show_list_images","child","_childClicked","includes","icon","can_expand","graphic","show","thumbnailUrl","startsWith","reject","fetchWithAuth","response","blob","reader","FileReader","onload","result","onerror","e","readAsDataURL","_this$hass$themes","domain","useFallback","darkOptimized","themes","darkMode","ev","stopPropagation","currentTarget","slice","push","detail","target","mediaContentId","mediaContentType","window","innerWidth","offsetWidth","ResizeObserver","observe","_closeDialogAction","error","text","documentation","header","_header","content","_headerOffsetHeight","offsetHeight","style","marginTop","maxHeight","start","animate","time","elapsed","requestAnimationFrame","passive","scrollTop","static","styles"],"sources":["/Users/sercanardil/Desktop/frontend/src/components/media-player/ha-media-player-browse.ts"],"sourcesContent":["import type { LitVirtualizer } from \"@lit-labs/virtualizer\";\nimport { grid } from \"@lit-labs/virtualizer/layouts/grid\";\nimport \"@material/mwc-button/mwc-button\";\nimport \"@material/mwc-list/mwc-list\";\nimport \"@material/mwc-list/mwc-list-item\";\nimport { mdiArrowUpRight, mdiPlay, mdiPlus } from \"@mdi/js\";\nimport \"@lrnwebcomponents/simple-tooltip/simple-tooltip\";\nimport {\n  css,\n  CSSResultGroup,\n  html,\n  LitElement,\n  PropertyValues,\n  TemplateResult,\n  nothing,\n} from \"lit\";\nimport {\n  customElement,\n  eventOptions,\n  property,\n  query,\n  state,\n} from \"lit/decorators\";\nimport { classMap } from \"lit/directives/class-map\";\nimport { styleMap } from \"lit/directives/style-map\";\nimport { until } from \"lit/directives/until\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport { debounce } from \"../../common/util/debounce\";\nimport { isUnavailableState } from \"../../data/entity\";\nimport type { MediaPlayerItem } from \"../../data/media-player\";\nimport {\n  browseMediaPlayer,\n  BROWSER_PLAYER,\n  MediaClassBrowserSettings,\n  MediaPickedEvent,\n  MediaPlayerBrowseAction,\n  MediaPlayerLayoutType,\n} from \"../../data/media-player\";\nimport { browseLocalMediaPlayer } from \"../../data/media_source\";\nimport { isTTSMediaSource } from \"../../data/tts\";\nimport { showAlertDialog } from \"../../dialogs/generic/show-dialog-box\";\nimport { loadPolyfillIfNeeded } from \"../../resources/resize-observer.polyfill\";\nimport { haStyle } from \"../../resources/styles\";\nimport type { HomeAssistant } from \"../../types\";\nimport {\n  brandsUrl,\n  extractDomainFromBrandUrl,\n  isBrandUrl,\n} from \"../../util/brands-url\";\nimport { documentationUrl } from \"../../util/documentation-url\";\nimport \"../entity/ha-entity-picker\";\nimport \"../ha-alert\";\nimport \"../ha-button-menu\";\nimport \"../ha-card\";\nimport \"../ha-circular-progress\";\nimport \"../ha-fab\";\nimport \"../ha-icon-button\";\nimport \"../ha-svg-icon\";\nimport \"./ha-browse-media-tts\";\nimport type { TtsMediaPickedEvent } from \"./ha-browse-media-tts\";\nimport { loadVirtualizer } from \"../../resources/virtualizer\";\n\ndeclare global {\n  interface HASSDomEvents {\n    \"media-picked\": MediaPickedEvent;\n    \"media-browsed\": {\n      // Items of the new browse stack\n      ids: MediaPlayerItemId[];\n      // Current fetched item for this browse stack\n      current?: MediaPlayerItem;\n      // If the new stack should replace the old stack\n      replace?: boolean;\n    };\n  }\n}\n\nexport interface MediaPlayerItemId {\n  media_content_id: string | undefined;\n  media_content_type: string | undefined;\n}\n\n@customElement(\"ha-media-player-browse\")\nexport class HaMediaPlayerBrowse extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property() public entityId!: string;\n\n  @property() public action: MediaPlayerBrowseAction = \"play\";\n\n  @property() public preferredLayout: MediaPlayerLayoutType = \"auto\";\n\n  @property({ type: Boolean }) public dialog = false;\n\n  @property({ attribute: false }) public navigateIds: MediaPlayerItemId[] = [];\n\n  // @todo Consider reworking to eliminate need for attribute since it is manipulated internally\n  @property({ type: Boolean, reflect: true }) public narrow = false;\n\n  // @todo Consider reworking to eliminate need for attribute since it is manipulated internally\n  @property({ type: Boolean, reflect: true }) public scrolled = false;\n\n  @state() private _error?: { message: string; code: string };\n\n  @state() private _parentItem?: MediaPlayerItem;\n\n  @state() private _currentItem?: MediaPlayerItem;\n\n  @query(\".header\") private _header?: HTMLDivElement;\n\n  @query(\".content\") private _content?: HTMLDivElement;\n\n  @query(\"lit-virtualizer\") private _virtualizer?: LitVirtualizer;\n\n  private _observed = false;\n\n  private _headerOffsetHeight = 0;\n\n  private _resizeObserver?: ResizeObserver;\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n    this.updateComplete.then(() => this._attachResizeObserver());\n  }\n\n  public disconnectedCallback(): void {\n    super.disconnectedCallback();\n    if (this._resizeObserver) {\n      this._resizeObserver.disconnect();\n    }\n  }\n\n  public async refresh() {\n    const currentId = this.navigateIds[this.navigateIds.length - 1];\n    try {\n      this._currentItem = await this._fetchData(\n        this.entityId,\n        currentId.media_content_id,\n        currentId.media_content_type\n      );\n      // Update the parent with latest item.\n      fireEvent(this, \"media-browsed\", {\n        ids: this.navigateIds,\n        current: this._currentItem,\n      });\n    } catch (err) {\n      this._setError(err);\n    }\n  }\n\n  public play(): void {\n    if (this._currentItem?.can_play) {\n      this._runAction(this._currentItem);\n    }\n  }\n\n  public willUpdate(changedProps: PropertyValues<this>): void {\n    super.willUpdate(changedProps);\n\n    if (!this.hasUpdated) {\n      loadVirtualizer();\n    }\n\n    if (changedProps.has(\"entityId\")) {\n      this._setError(undefined);\n    } else if (!changedProps.has(\"navigateIds\")) {\n      // Neither entity ID or navigateIDs changed, nothing to fetch\n      return;\n    }\n\n    this._setError(undefined);\n\n    const oldNavigateIds = changedProps.get(\"navigateIds\") as\n      | this[\"navigateIds\"]\n      | undefined;\n    const navigateIds = this.navigateIds;\n\n    // We're navigating. Reset the shizzle.\n    this._content?.scrollTo(0, 0);\n    this.scrolled = false;\n    const oldCurrentItem = this._currentItem;\n    const oldParentItem = this._parentItem;\n    this._currentItem = undefined;\n    this._parentItem = undefined;\n    const currentId = navigateIds[navigateIds.length - 1];\n    const parentId =\n      navigateIds.length > 1 ? navigateIds[navigateIds.length - 2] : undefined;\n    let currentProm: Promise<MediaPlayerItem> | undefined;\n    let parentProm: Promise<MediaPlayerItem> | undefined;\n\n    // See if we can take loading shortcuts if navigating to parent or child\n    if (!changedProps.has(\"entityId\")) {\n      if (\n        // Check if we navigated to a child\n        oldNavigateIds &&\n        navigateIds.length === oldNavigateIds.length + 1 &&\n        oldNavigateIds.every((oldVal, idx) => {\n          const curVal = navigateIds[idx];\n          return (\n            curVal.media_content_id === oldVal.media_content_id &&\n            curVal.media_content_type === oldVal.media_content_type\n          );\n        })\n      ) {\n        parentProm = Promise.resolve(oldCurrentItem!);\n      } else if (\n        // Check if we navigated to a parent\n        oldNavigateIds &&\n        navigateIds.length === oldNavigateIds.length - 1 &&\n        navigateIds.every((curVal, idx) => {\n          const oldVal = oldNavigateIds[idx];\n          return (\n            curVal.media_content_id === oldVal.media_content_id &&\n            curVal.media_content_type === oldVal.media_content_type\n          );\n        })\n      ) {\n        currentProm = Promise.resolve(oldParentItem!);\n      }\n    }\n    // Fetch current\n    if (!currentProm) {\n      currentProm = this._fetchData(\n        this.entityId,\n        currentId.media_content_id,\n        currentId.media_content_type\n      );\n    }\n    currentProm.then(\n      (item) => {\n        this._currentItem = item;\n        fireEvent(this, \"media-browsed\", {\n          ids: navigateIds,\n          current: item,\n        });\n      },\n      (err) => {\n        // When we change entity ID, we will first try to see if the new entity is\n        // able to resolve the new path. If that results in an error, browse the root.\n        const isNewEntityWithSamePath =\n          oldNavigateIds &&\n          changedProps.has(\"entityId\") &&\n          navigateIds.length === oldNavigateIds.length &&\n          oldNavigateIds.every(\n            (oldItem, idx) =>\n              navigateIds[idx].media_content_id === oldItem.media_content_id &&\n              navigateIds[idx].media_content_type === oldItem.media_content_type\n          );\n        if (isNewEntityWithSamePath) {\n          fireEvent(this, \"media-browsed\", {\n            ids: [\n              { media_content_id: undefined, media_content_type: undefined },\n            ],\n            replace: true,\n          });\n        } else if (\n          err.code === \"entity_not_found\" &&\n          isUnavailableState(this.hass.states[this.entityId]?.state)\n        ) {\n          this._setError({\n            message: this.hass.localize(\n              `ui.components.media-browser.media_player_unavailable`\n            ),\n            code: \"entity_not_found\",\n          });\n        } else {\n          this._setError(err);\n        }\n      }\n    );\n    // Fetch parent\n    if (!parentProm && parentId !== undefined) {\n      parentProm = this._fetchData(\n        this.entityId,\n        parentId.media_content_id,\n        parentId.media_content_type\n      );\n    }\n    if (parentProm) {\n      parentProm.then((parent) => {\n        this._parentItem = parent;\n      });\n    }\n  }\n\n  protected shouldUpdate(changedProps: PropertyValues): boolean {\n    if (changedProps.size > 1 || !changedProps.has(\"hass\")) {\n      return true;\n    }\n    const oldHass = changedProps.get(\"hass\") as this[\"hass\"];\n    return oldHass === undefined || oldHass.localize !== this.hass.localize;\n  }\n\n  protected firstUpdated(): void {\n    this._measureCard();\n    this._attachResizeObserver();\n  }\n\n  protected updated(changedProps: PropertyValues): void {\n    super.updated(changedProps);\n\n    if (changedProps.has(\"_scrolled\")) {\n      this._animateHeaderHeight();\n    } else if (changedProps.has(\"_currentItem\")) {\n      this._setHeaderHeight();\n\n      // This fixes a race condition for resizing of the cards using the grid layout\n      if (this._observed) {\n        return;\n      }\n\n      // @ts-ignore\n      const virtualizer = this._virtualizer?._virtualizer;\n\n      if (virtualizer) {\n        this._observed = true;\n        setTimeout(() => virtualizer._observeMutations(), 0);\n      }\n    }\n  }\n\n  protected render() {\n    if (this._error) {\n      return html`\n        <div class=\"container\">\n          <ha-alert alert-type=\"error\">\n            ${this._renderError(this._error)}\n          </ha-alert>\n        </div>\n      `;\n    }\n\n    if (!this._currentItem) {\n      return html`<ha-circular-progress indeterminate></ha-circular-progress>`;\n    }\n\n    const currentItem = this._currentItem;\n\n    const subtitle = this.hass.localize(\n      `ui.components.media-browser.class.${currentItem.media_class}`\n    );\n    const children = currentItem.children || [];\n    const mediaClass = MediaClassBrowserSettings[currentItem.media_class];\n    const childrenMediaClass = currentItem.children_media_class\n      ? MediaClassBrowserSettings[currentItem.children_media_class]\n      : MediaClassBrowserSettings.directory;\n\n    const backgroundImage = currentItem.thumbnail\n      ? this._getThumbnailURLorBase64(currentItem.thumbnail).then(\n          (value) => `url(${value})`\n        )\n      : \"none\";\n\n    return html`\n              ${\n                currentItem.can_play\n                  ? html`\n                      <div\n                        class=\"header ${classMap({\n                          \"no-img\": !currentItem.thumbnail,\n                          \"no-dialog\": !this.dialog,\n                        })}\"\n                        @transitionend=${this._setHeaderHeight}\n                      >\n                        <div class=\"header-content\">\n                          ${currentItem.thumbnail\n                            ? html`\n                                <div\n                                  class=\"img\"\n                                  style=\"background-image: ${until(\n                                    backgroundImage,\n                                    \"\"\n                                  )}\"\n                                >\n                                  ${this.narrow && currentItem?.can_play\n                                    ? html`\n                                        <ha-fab\n                                          mini\n                                          .item=${currentItem}\n                                          @click=${this._actionClicked}\n                                        >\n                                          <ha-svg-icon\n                                            slot=\"icon\"\n                                            .label=${this.hass.localize(\n                                              `ui.components.media-browser.${this.action}-media`\n                                            )}\n                                            .path=${this.action === \"play\"\n                                              ? mdiPlay\n                                              : mdiPlus}\n                                          ></ha-svg-icon>\n                                          ${this.hass.localize(\n                                            `ui.components.media-browser.${this.action}`\n                                          )}\n                                        </ha-fab>\n                                      `\n                                    : \"\"}\n                                </div>\n                              `\n                            : nothing}\n                          <div class=\"header-info\">\n                            <div class=\"breadcrumb\">\n                              <h1 class=\"title\">${currentItem.title}</h1>\n                              ${subtitle\n                                ? html` <h2 class=\"subtitle\">${subtitle}</h2> `\n                                : \"\"}\n                            </div>\n                            ${currentItem.can_play &&\n                            (!currentItem.thumbnail || !this.narrow)\n                              ? html`\n                                  <mwc-button\n                                    raised\n                                    .item=${currentItem}\n                                    @click=${this._actionClicked}\n                                  >\n                                    <ha-svg-icon\n                                      .label=${this.hass.localize(\n                                        `ui.components.media-browser.${this.action}-media`\n                                      )}\n                                      .path=${this.action === \"play\"\n                                        ? mdiPlay\n                                        : mdiPlus}\n                                    ></ha-svg-icon>\n                                    ${this.hass.localize(\n                                      `ui.components.media-browser.${this.action}`\n                                    )}\n                                  </mwc-button>\n                                `\n                              : \"\"}\n                          </div>\n                        </div>\n                      </div>\n                    `\n                  : \"\"\n              }\n          <div\n            class=\"content\"\n            @scroll=${this._scroll}\n            @touchmove=${this._scroll}\n          >\n            ${\n              this._error\n                ? html`\n                    <div class=\"container\">\n                      <ha-alert alert-type=\"error\">\n                        ${this._renderError(this._error)}\n                      </ha-alert>\n                    </div>\n                  `\n                : isTTSMediaSource(currentItem.media_content_id)\n                  ? html`\n                      <ha-browse-media-tts\n                        .item=${currentItem}\n                        .hass=${this.hass}\n                        .action=${this.action}\n                        @tts-picked=${this._ttsPicked}\n                      ></ha-browse-media-tts>\n                    `\n                  : !children.length && !currentItem.not_shown\n                    ? html`\n                        <div class=\"container no-items\">\n                          ${currentItem.media_content_id ===\n                          \"media-source://media_source/local/.\"\n                            ? html`\n                                <div class=\"highlight-add-button\">\n                                  <span>\n                                    <ha-svg-icon\n                                      .path=${mdiArrowUpRight}\n                                    ></ha-svg-icon>\n                                  </span>\n                                  <span>\n                                    ${this.hass.localize(\n                                      \"ui.components.media-browser.file_management.highlight_button\"\n                                    )}\n                                  </span>\n                                </div>\n                              `\n                            : this.hass.localize(\n                                \"ui.components.media-browser.no_items\"\n                              )}\n                        </div>\n                      `\n                    : this.preferredLayout === \"grid\" ||\n                        (this.preferredLayout === \"auto\" &&\n                          childrenMediaClass.layout === \"grid\")\n                      ? html`\n                          <lit-virtualizer\n                            scroller\n                            .layout=${grid({\n                              itemSize: {\n                                width: \"175px\",\n                                height:\n                                  childrenMediaClass.thumbnail_ratio ===\n                                  \"portrait\"\n                                    ? \"312px\"\n                                    : \"225px\",\n                              },\n                              gap: \"16px\",\n                              flex: { preserve: \"aspect-ratio\" },\n                              justify: \"space-evenly\",\n                              direction: \"vertical\",\n                            })}\n                            .items=${children}\n                            .renderItem=${this._renderGridItem}\n                            class=\"children ${classMap({\n                              portrait:\n                                childrenMediaClass.thumbnail_ratio ===\n                                \"portrait\",\n                              not_shown: !!currentItem.not_shown,\n                            })}\"\n                          ></lit-virtualizer>\n                          ${currentItem.not_shown\n                            ? html`\n                                <div class=\"grid not-shown\">\n                                  <div class=\"title\">\n                                    ${this.hass.localize(\n                                      \"ui.components.media-browser.not_shown\",\n                                      { count: currentItem.not_shown }\n                                    )}\n                                  </div>\n                                </div>\n                              `\n                            : \"\"}\n                        `\n                      : html`\n                          <mwc-list>\n                            <lit-virtualizer\n                              scroller\n                              .items=${children}\n                              style=${styleMap({\n                                height: `${children.length * 72 + 26}px`,\n                              })}\n                              .renderItem=${this._renderListItem}\n                            ></lit-virtualizer>\n                            ${currentItem.not_shown\n                              ? html`\n                                  <mwc-list-item\n                                    noninteractive\n                                    class=\"not-shown\"\n                                    .graphic=${mediaClass.show_list_images\n                                      ? \"medium\"\n                                      : \"avatar\"}\n                                  >\n                                    <span class=\"title\">\n                                      ${this.hass.localize(\n                                        \"ui.components.media-browser.not_shown\",\n                                        { count: currentItem.not_shown }\n                                      )}\n                                    </span>\n                                  </mwc-list-item>\n                                `\n                              : \"\"}\n                          </mwc-list>\n                        `\n            }\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private _renderGridItem = (child: MediaPlayerItem): TemplateResult => {\n    const backgroundImage = child.thumbnail\n      ? this._getThumbnailURLorBase64(child.thumbnail).then(\n          (value) => `url(${value})`\n        )\n      : \"none\";\n\n    return html`\n      <div class=\"child\" .item=${child} @click=${this._childClicked}>\n        <ha-card outlined>\n          <div class=\"thumbnail\">\n            ${child.thumbnail\n              ? html`\n                  <div\n                    class=\"${classMap({\n                      \"centered-image\": [\"app\", \"directory\"].includes(\n                        child.media_class\n                      ),\n                      \"brand-image\": isBrandUrl(child.thumbnail),\n                    })} image\"\n                    style=\"background-image: ${until(backgroundImage, \"\")}\"\n                  ></div>\n                `\n              : html`\n                  <div class=\"icon-holder image\">\n                    <ha-svg-icon\n                      class=\"folder\"\n                      .path=${MediaClassBrowserSettings[\n                        child.media_class === \"directory\"\n                          ? child.children_media_class || child.media_class\n                          : child.media_class\n                      ].icon}\n                    ></ha-svg-icon>\n                  </div>\n                `}\n            ${child.can_play\n              ? html`\n                  <ha-icon-button\n                    class=\"play ${classMap({\n                      can_expand: child.can_expand,\n                    })}\"\n                    .item=${child}\n                    .label=${this.hass.localize(\n                      `ui.components.media-browser.${this.action}-media`\n                    )}\n                    .path=${this.action === \"play\" ? mdiPlay : mdiPlus}\n                    @click=${this._actionClicked}\n                  ></ha-icon-button>\n                `\n              : \"\"}\n          </div>\n          <div class=\"title\">\n            ${child.title}\n            <simple-tooltip fitToVisibleBounds position=\"top\" offset=\"4\"\n              >${child.title}</simple-tooltip\n            >\n          </div>\n        </ha-card>\n      </div>\n    `;\n  };\n\n  private _renderListItem = (child: MediaPlayerItem): TemplateResult => {\n    const currentItem = this._currentItem;\n    const mediaClass = MediaClassBrowserSettings[currentItem!.media_class];\n\n    const backgroundImage =\n      mediaClass.show_list_images && child.thumbnail\n        ? this._getThumbnailURLorBase64(child.thumbnail).then(\n            (value) => `url(${value})`\n          )\n        : \"none\";\n\n    return html`\n      <mwc-list-item\n        @click=${this._childClicked}\n        .item=${child}\n        .graphic=${mediaClass.show_list_images ? \"medium\" : \"avatar\"}\n      >\n        ${backgroundImage === \"none\" && !child.can_play\n          ? html`<ha-svg-icon\n              .path=${MediaClassBrowserSettings[\n                child.media_class === \"directory\"\n                  ? child.children_media_class || child.media_class\n                  : child.media_class\n              ].icon}\n              slot=\"graphic\"\n            ></ha-svg-icon>`\n          : html`<div\n              class=${classMap({\n                graphic: true,\n                thumbnail: mediaClass.show_list_images === true,\n              })}\n              style=\"background-image: ${until(backgroundImage, \"\")}\"\n              slot=\"graphic\"\n            >\n              ${child.can_play\n                ? html`<ha-icon-button\n                    class=\"play ${classMap({\n                      show: !mediaClass.show_list_images || !child.thumbnail,\n                    })}\"\n                    .item=${child}\n                    .label=${this.hass.localize(\n                      `ui.components.media-browser.${this.action}-media`\n                    )}\n                    .path=${this.action === \"play\" ? mdiPlay : mdiPlus}\n                    @click=${this._actionClicked}\n                  ></ha-icon-button>`\n                : nothing}\n            </div>`}\n        <span class=\"title\">${child.title}</span>\n      </mwc-list-item>\n    `;\n  };\n\n  private async _getThumbnailURLorBase64(\n    thumbnailUrl: string | undefined\n  ): Promise<string> {\n    if (!thumbnailUrl) {\n      return \"\";\n    }\n\n    if (thumbnailUrl.startsWith(\"/\")) {\n      // Thumbnails served by local API require authentication\n      return new Promise((resolve, reject) => {\n        this.hass\n          .fetchWithAuth(thumbnailUrl!)\n          // Since we are fetching with an authorization header, we cannot just put the\n          // URL directly into the document; we need to embed the image. We could do this\n          // using blob URLs, but then we would need to keep track of them in order to\n          // release them properly. Instead, we embed the thumbnail using base64.\n          .then((response) => response.blob())\n          .then((blob) => {\n            const reader = new FileReader();\n            reader.onload = () => {\n              const result = reader.result;\n              resolve(typeof result === \"string\" ? result : \"\");\n            };\n            reader.onerror = (e) => reject(e);\n            reader.readAsDataURL(blob);\n          });\n      });\n    }\n\n    if (isBrandUrl(thumbnailUrl)) {\n      // The backend is not aware of the theme used by the users,\n      // so we rewrite the URL to show a proper icon\n      thumbnailUrl = brandsUrl({\n        domain: extractDomainFromBrandUrl(thumbnailUrl),\n        type: \"icon\",\n        useFallback: true,\n        darkOptimized: this.hass.themes?.darkMode,\n      });\n    }\n\n    return thumbnailUrl;\n  }\n\n  private _actionClicked = (ev: MouseEvent): void => {\n    ev.stopPropagation();\n    const item = (ev.currentTarget as any).item;\n\n    this._runAction(item);\n  };\n\n  private _runAction(item: MediaPlayerItem): void {\n    fireEvent(this, \"media-picked\", { item, navigateIds: this.navigateIds });\n  }\n\n  private _ttsPicked(ev: CustomEvent<TtsMediaPickedEvent>): void {\n    ev.stopPropagation();\n    const navigateIds = this.navigateIds.slice(0, -1);\n    navigateIds.push(ev.detail.item);\n    fireEvent(this, \"media-picked\", {\n      ...ev.detail,\n      navigateIds,\n    });\n  }\n\n  private _childClicked = async (ev: MouseEvent): Promise<void> => {\n    const target = ev.currentTarget as any;\n    const item: MediaPlayerItem = target.item;\n\n    if (!item) {\n      return;\n    }\n\n    if (!item.can_expand) {\n      this._runAction(item);\n      return;\n    }\n\n    fireEvent(this, \"media-browsed\", {\n      ids: [...this.navigateIds, item],\n    });\n  };\n\n  private async _fetchData(\n    entityId: string,\n    mediaContentId?: string,\n    mediaContentType?: string\n  ): Promise<MediaPlayerItem> {\n    return entityId !== BROWSER_PLAYER\n      ? browseMediaPlayer(this.hass, entityId, mediaContentId, mediaContentType)\n      : browseLocalMediaPlayer(this.hass, mediaContentId);\n  }\n\n  private _measureCard(): void {\n    this.narrow = (this.dialog ? window.innerWidth : this.offsetWidth) < 450;\n  }\n\n  private async _attachResizeObserver(): Promise<void> {\n    if (!this._resizeObserver) {\n      await loadPolyfillIfNeeded();\n      this._resizeObserver = new ResizeObserver(\n        debounce(() => this._measureCard(), 250, false)\n      );\n    }\n\n    this._resizeObserver.observe(this);\n  }\n\n  private _closeDialogAction(): void {\n    fireEvent(this, \"close-dialog\");\n  }\n\n  private _setError(error: any) {\n    if (!this.dialog) {\n      this._error = error;\n      return;\n    }\n\n    if (!error) {\n      return;\n    }\n\n    this._closeDialogAction();\n    showAlertDialog(this, {\n      title: this.hass.localize(\n        \"ui.components.media-browser.media_browsing_error\"\n      ),\n      text: this._renderError(error),\n    });\n  }\n\n  private _renderError(err: { message: string; code: string }) {\n    if (err.message === \"Media directory does not exist.\") {\n      return html`\n        <h2>\n          ${this.hass.localize(\n            \"ui.components.media-browser.no_local_media_found\"\n          )}\n        </h2>\n        <p>\n          ${this.hass.localize(\"ui.components.media-browser.no_media_folder\")}\n          <br />\n          ${this.hass.localize(\"ui.components.media-browser.setup_local_help\", {\n            documentation: html`<a\n              href=${documentationUrl(\n                this.hass,\n                \"/more-info/local-media/setup-media\"\n              )}\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              >${this.hass.localize(\n                \"ui.components.media-browser.documentation\"\n              )}</a\n            >`,\n          })}\n          <br />\n          ${this.hass.localize(\"ui.components.media-browser.local_media_files\")}\n        </p>\n      `;\n    }\n    return html`<span class=\"error\">${err.message}</span>`;\n  }\n\n  private async _setHeaderHeight() {\n    await this.updateComplete;\n    const header = this._header;\n    const content = this._content;\n    if (!header || !content) {\n      return;\n    }\n    this._headerOffsetHeight = header.offsetHeight;\n    content.style.marginTop = `${this._headerOffsetHeight}px`;\n    content.style.maxHeight = `calc(var(--media-browser-max-height, 100%) - ${this._headerOffsetHeight}px)`;\n  }\n\n  private _animateHeaderHeight() {\n    let start;\n    const animate = (time) => {\n      if (start === undefined) {\n        start = time;\n      }\n      const elapsed = time - start;\n      this._setHeaderHeight();\n      if (elapsed < 400) {\n        requestAnimationFrame(animate);\n      }\n    };\n    requestAnimationFrame(animate);\n  }\n\n  @eventOptions({ passive: true })\n  private _scroll(ev: Event): void {\n    const content = ev.currentTarget as HTMLDivElement;\n    if (!this.scrolled && content.scrollTop > this._headerOffsetHeight) {\n      this.scrolled = true;\n    } else if (this.scrolled && content.scrollTop < this._headerOffsetHeight) {\n      this.scrolled = false;\n    }\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      haStyle,\n      css`\n        :host {\n          display: flex;\n          flex-direction: column;\n          position: relative;\n        }\n\n        ha-circular-progress {\n          --mdc-theme-primary: var(--primary-color);\n          display: flex;\n          justify-content: center;\n          margin: 40px;\n        }\n\n        .container {\n          padding: 16px;\n        }\n\n        .no-items {\n          padding-left: 32px;\n        }\n\n        .highlight-add-button {\n          display: flex;\n          flex-direction: row-reverse;\n          margin-right: 48px;\n        }\n\n        .highlight-add-button ha-svg-icon {\n          position: relative;\n          top: -0.5em;\n          margin-left: 8px;\n        }\n\n        .content {\n          overflow-y: auto;\n          box-sizing: border-box;\n          height: 100%;\n        }\n\n        /* HEADER */\n\n        .header {\n          display: flex;\n          justify-content: space-between;\n          border-bottom: 1px solid var(--divider-color);\n          background-color: var(--card-background-color);\n          position: absolute;\n          top: 0;\n          right: 0;\n          left: 0;\n          z-index: 3;\n          padding: 16px;\n        }\n        .header_button {\n          position: relative;\n          right: -8px;\n        }\n        .header-content {\n          display: flex;\n          flex-wrap: wrap;\n          flex-grow: 1;\n          align-items: flex-start;\n        }\n        .header-content .img {\n          height: 175px;\n          width: 175px;\n          margin-right: 16px;\n          background-size: cover;\n          border-radius: 2px;\n          transition:\n            width 0.4s,\n            height 0.4s;\n        }\n        .header-info {\n          display: flex;\n          flex-direction: column;\n          justify-content: space-between;\n          align-self: stretch;\n          min-width: 0;\n          flex: 1;\n        }\n        .header-info mwc-button {\n          display: block;\n          --mdc-theme-primary: var(--primary-color);\n          padding-bottom: 16px;\n        }\n        .breadcrumb {\n          display: flex;\n          flex-direction: column;\n          overflow: hidden;\n          flex-grow: 1;\n          padding-top: 16px;\n        }\n        .breadcrumb .title {\n          font-size: 32px;\n          line-height: 1.2;\n          font-weight: bold;\n          margin: 0;\n          overflow: hidden;\n          display: -webkit-box;\n          -webkit-box-orient: vertical;\n          -webkit-line-clamp: 2;\n          padding-right: 8px;\n        }\n        .breadcrumb .previous-title {\n          font-size: 14px;\n          padding-bottom: 8px;\n          color: var(--secondary-text-color);\n          overflow: hidden;\n          text-overflow: ellipsis;\n          cursor: pointer;\n          --mdc-icon-size: 14px;\n        }\n        .breadcrumb .subtitle {\n          font-size: 16px;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          margin-bottom: 0;\n          transition:\n            height 0.5s,\n            margin 0.5s;\n        }\n\n        .not-shown {\n          font-style: italic;\n          color: var(--secondary-text-color);\n          padding: 8px 16px 8px;\n        }\n\n        .grid.not-shown {\n          display: flex;\n          align-items: center;\n          text-align: center;\n        }\n\n        /* ============= CHILDREN ============= */\n\n        mwc-list {\n          --mdc-list-vertical-padding: 0;\n          --mdc-list-item-graphic-margin: 0;\n          --mdc-theme-text-icon-on-background: var(--secondary-text-color);\n          margin-top: 10px;\n        }\n\n        mwc-list li:last-child {\n          display: none;\n        }\n\n        mwc-list li[divider] {\n          border-bottom-color: var(--divider-color);\n        }\n\n        mwc-list-item {\n          width: 100%;\n        }\n\n        div.children {\n          display: grid;\n          grid-template-columns: repeat(\n            auto-fit,\n            minmax(var(--media-browse-item-size, 175px), 0.1fr)\n          );\n          grid-gap: 16px;\n          padding: 16px;\n        }\n\n        :host([dialog]) .children {\n          grid-template-columns: repeat(\n            auto-fit,\n            minmax(var(--media-browse-item-size, 175px), 0.33fr)\n          );\n        }\n\n        .child {\n          display: flex;\n          flex-direction: column;\n          cursor: pointer;\n        }\n\n        ha-card {\n          position: relative;\n          width: 100%;\n          box-sizing: border-box;\n        }\n\n        .children ha-card .thumbnail {\n          width: 100%;\n          position: relative;\n          box-sizing: border-box;\n          transition: padding-bottom 0.1s ease-out;\n          padding-bottom: 100%;\n        }\n\n        .portrait ha-card .thumbnail {\n          padding-bottom: 150%;\n        }\n\n        ha-card .image {\n          border-radius: 3px 3px 0 0;\n        }\n\n        .image {\n          position: absolute;\n          top: 0;\n          right: 0;\n          left: 0;\n          bottom: 0;\n          background-size: cover;\n          background-repeat: no-repeat;\n          background-position: center;\n        }\n\n        .centered-image {\n          margin: 0 8px;\n          background-size: contain;\n        }\n\n        .brand-image {\n          background-size: 40%;\n        }\n\n        .children ha-card .icon-holder {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n        }\n\n        .child .folder {\n          color: var(--secondary-text-color);\n          --mdc-icon-size: calc(var(--media-browse-item-size, 175px) * 0.4);\n        }\n\n        .child .play {\n          position: absolute;\n          transition: color 0.5s;\n          border-radius: 50%;\n          top: calc(50% - 50px);\n          right: calc(50% - 35px);\n          opacity: 0;\n          transition: opacity 0.1s ease-out;\n        }\n\n        .child .play:not(.can_expand) {\n          --mdc-icon-button-size: 70px;\n          --mdc-icon-size: 48px;\n        }\n\n        ha-card:hover .play {\n          opacity: 1;\n        }\n\n        ha-card:hover .play:not(.can_expand) {\n          color: var(--primary-color);\n        }\n\n        ha-card:hover .play.can_expand {\n          bottom: 8px;\n        }\n\n        .child .play.can_expand {\n          background-color: rgba(var(--rgb-card-background-color), 0.5);\n          top: auto;\n          bottom: 0px;\n          right: 8px;\n          transition:\n            bottom 0.1s ease-out,\n            opacity 0.1s ease-out;\n        }\n\n        .child .play:hover {\n          color: var(--primary-color);\n        }\n\n        .child .title {\n          font-size: 16px;\n          padding-top: 16px;\n          padding-left: 2px;\n          overflow: hidden;\n          display: -webkit-box;\n          -webkit-box-orient: vertical;\n          -webkit-line-clamp: 1;\n          text-overflow: ellipsis;\n        }\n\n        .child ha-card .title {\n          margin-bottom: 16px;\n          padding-left: 16px;\n        }\n\n        mwc-list-item .graphic {\n          background-size: contain;\n          background-repeat: no-repeat;\n          background-position: center;\n          border-radius: 2px;\n          display: flex;\n          align-content: center;\n          align-items: center;\n          line-height: initial;\n        }\n\n        mwc-list-item .graphic .play {\n          opacity: 0;\n          transition: all 0.5s;\n          background-color: rgba(var(--rgb-card-background-color), 0.5);\n          border-radius: 50%;\n          --mdc-icon-button-size: 40px;\n        }\n\n        mwc-list-item:hover .graphic .play {\n          opacity: 1;\n          color: var(--primary-text-color);\n        }\n\n        mwc-list-item .graphic .play.show {\n          opacity: 1;\n          background-color: transparent;\n        }\n\n        mwc-list-item .title {\n          margin-left: 16px;\n          margin-inline-start: 16px;\n          margin-inline-end: initial;\n        }\n\n        /* ============= Narrow ============= */\n\n        :host([narrow]) {\n          padding: 0;\n        }\n\n        :host([narrow]) .media-source {\n          padding: 0 24px;\n        }\n\n        :host([narrow]) div.children {\n          grid-template-columns: minmax(0, 1fr) minmax(0, 1fr) !important;\n        }\n\n        :host([narrow]) .breadcrumb .title {\n          font-size: 24px;\n        }\n        :host([narrow]) .header {\n          padding: 0;\n        }\n        :host([narrow]) .header.no-dialog {\n          display: block;\n        }\n        :host([narrow]) .header_button {\n          position: absolute;\n          top: 14px;\n          right: 8px;\n        }\n        :host([narrow]) .header-content {\n          flex-direction: column;\n          flex-wrap: nowrap;\n        }\n        :host([narrow]) .header-content .img {\n          height: auto;\n          width: 100%;\n          margin-right: 0;\n          padding-bottom: 50%;\n          margin-bottom: 8px;\n          position: relative;\n          background-position: center;\n          border-radius: 0;\n          transition:\n            width 0.4s,\n            height 0.4s,\n            padding-bottom 0.4s;\n        }\n        ha-fab {\n          position: absolute;\n          --mdc-theme-secondary: var(--primary-color);\n          bottom: -20px;\n          right: 20px;\n        }\n        :host([narrow]) .header-info mwc-button {\n          margin-top: 16px;\n          margin-bottom: 8px;\n        }\n        :host([narrow]) .header-info {\n          padding: 0 16px 8px;\n        }\n\n        /* ============= Scroll ============= */\n        :host([scrolled]) .breadcrumb .subtitle {\n          height: 0;\n          margin: 0;\n        }\n        :host([scrolled]) .breadcrumb .title {\n          -webkit-line-clamp: 1;\n        }\n        :host(:not([narrow])[scrolled]) .header:not(.no-img) ha-icon-button {\n          align-self: center;\n        }\n        :host([scrolled]) .header-info mwc-button,\n        .no-img .header-info mwc-button {\n          padding-right: 4px;\n        }\n        :host([scrolled][narrow]) .no-img .header-info mwc-button {\n          padding-right: 16px;\n        }\n        :host([scrolled]) .header-info {\n          flex-direction: row;\n        }\n        :host([scrolled]) .header-info mwc-button {\n          align-self: center;\n          margin-top: 0;\n          margin-bottom: 0;\n          padding-bottom: 0;\n        }\n        :host([scrolled][narrow]) .no-img .header-info {\n          flex-direction: row-reverse;\n        }\n        :host([scrolled][narrow]) .header-info {\n          padding: 20px 24px 10px 24px;\n          align-items: center;\n        }\n        :host([scrolled]) .header-content {\n          align-items: flex-end;\n          flex-direction: row;\n        }\n        :host([scrolled]) .header-content .img {\n          height: 75px;\n          width: 75px;\n        }\n        :host([scrolled]) .breadcrumb {\n          padding-top: 0;\n          align-self: center;\n        }\n        :host([scrolled][narrow]) .header-content .img {\n          height: 100px;\n          width: 100px;\n          padding-bottom: initial;\n          margin-bottom: 0;\n        }\n        :host([scrolled]) ha-fab {\n          bottom: 0px;\n          right: -24px;\n          --mdc-fab-box-shadow: none;\n          --mdc-theme-secondary: rgba(var(--rgb-primary-color), 0.5);\n        }\n\n        lit-virtualizer {\n          height: 100%;\n          overflow: overlay !important;\n          contain: size layout !important;\n        }\n\n        lit-virtualizer.not_shown {\n          height: calc(100% - 36px);\n        }\n\n        ha-browse-media-tts {\n          direction: var(--direction);\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-media-player-browse\": HaMediaPlayerBrowse;\n  }\n}\n"],"mappings":"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CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,CACF;MACH;IAAC;EAAA;AAAA,GAruCsCE,UAAU"},"metadata":{},"sourceType":"module","externalDependencies":[]}