{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/helpers/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _callSuper from \"@babel/runtime/helpers/callSuper\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _decorate from \"@babel/runtime/helpers/decorate\";\nimport _typeof from \"@babel/runtime/helpers/typeof\";\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6, _templateObject7, _templateObject8, _templateObject9, _templateObject10, _templateObject11, _templateObject12;\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.object.assign.js\";\nimport \"core-js/modules/es.object.entries.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.object.values.js\";\nimport \"core-js/modules/es.set.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.filter.js\";\nimport \"core-js/modules/esnext.iterator.find.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/esnext.iterator.map.js\";\nimport \"core-js/modules/esnext.iterator.some.js\";\nimport \"core-js/modules/esnext.set.difference.v2.js\";\nimport \"core-js/modules/esnext.set.intersection.v2.js\";\nimport \"core-js/modules/esnext.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/esnext.set.is-subset-of.v2.js\";\nimport \"core-js/modules/esnext.set.is-superset-of.v2.js\";\nimport \"core-js/modules/esnext.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/esnext.set.union.v2.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nvar mdiHelpCircle = \"M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property, query, state } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { ensureArray } from \"../common/array/ensure-array\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { computeDomain } from \"../common/entity/compute_domain\";\nimport { computeObjectId } from \"../common/entity/compute_object_id\";\nimport { supportsFeature } from \"../common/entity/supports-feature\";\nimport { nestedArrayMove } from \"../common/util/array-move\";\nimport { fetchIntegrationManifest } from \"../data/integration\";\nimport { areaMeetsTargetSelector, deviceMeetsTargetSelector, entityMeetsTargetSelector, expandAreaTarget, expandDeviceTarget } from \"../data/selector\";\nimport { documentationUrl } from \"../util/documentation-url\";\nimport \"./ha-checkbox\";\nimport \"./ha-icon-button\";\nimport \"./ha-selector/ha-selector\";\nimport \"./ha-service-picker\";\nimport \"./ha-settings-row\";\nimport \"./ha-yaml-editor\";\nvar attributeFilter = function attributeFilter(values, attribute) {\n  if (_typeof(attribute) === \"object\") {\n    if (Array.isArray(attribute)) {\n      return attribute.some(function (item) {\n        return values.includes(item);\n      });\n    }\n    return false;\n  }\n  return values.includes(attribute);\n};\nvar showOptionalToggle = function showOptionalToggle(field) {\n  return field.selector && !field.required && !(\"boolean\" in field.selector && field.default);\n};\nexport var HaServiceControl = _decorate([customElement(\"ha-service-control\")], function (_initialize, _LitElement) {\n  var HaServiceControl = /*#__PURE__*/function (_LitElement2) {\n    _inherits(HaServiceControl, _LitElement2);\n    function HaServiceControl() {\n      var _this;\n      _classCallCheck(this, HaServiceControl);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _callSuper(this, HaServiceControl, [].concat(args));\n      _initialize(_assertThisInitialized(_this));\n      return _this;\n    }\n    return _createClass(HaServiceControl);\n  }(_LitElement);\n  return {\n    F: HaServiceControl,\n    d: [{\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"value\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Boolean\n      })],\n      key: \"disabled\",\n      value: function value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Boolean,\n        reflect: true\n      })],\n      key: \"narrow\",\n      value: function value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Boolean\n      })],\n      key: \"showAdvanced\",\n      value: function value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Boolean,\n        reflect: true\n      })],\n      key: \"hidePicker\",\n      value: function value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_value\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_checkedKeys\",\n      value: function value() {\n        return new Set();\n      }\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_manifest\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [query(\"ha-yaml-editor\")],\n      key: \"_yamlEditor\",\n      value: void 0\n    }, {\n      kind: \"method\",\n      key: \"willUpdate\",\n      value: function willUpdate(changedProperties) {\n        var _this$value,\n          _this$value2,\n          _this$value3,\n          _this$value5,\n          _this$value6,\n          _this$value7,\n          _this$value8,\n          _this2 = this,\n          _this$_value;\n        if (!this.hasUpdated) {\n          this.hass.loadBackendTranslation(\"services\");\n          this.hass.loadBackendTranslation(\"selector\");\n        }\n        if (!changedProperties.has(\"value\")) {\n          return;\n        }\n        var oldValue = changedProperties.get(\"value\");\n        if ((oldValue === null || oldValue === void 0 ? void 0 : oldValue.service) !== ((_this$value = this.value) === null || _this$value === void 0 ? void 0 : _this$value.service)) {\n          this._checkedKeys = new Set();\n        }\n        var serviceData = this._getServiceInfo((_this$value2 = this.value) === null || _this$value2 === void 0 ? void 0 : _this$value2.service, this.hass.services);\n\n        // Fetch the manifest if we have a service selected and the service domain changed.\n        // If no service is selected, clear the manifest.\n        if ((_this$value3 = this.value) !== null && _this$value3 !== void 0 && _this$value3.service) {\n          if (!(oldValue !== null && oldValue !== void 0 && oldValue.service) || computeDomain(this.value.service) !== computeDomain(oldValue.service)) {\n            var _this$value4;\n            this._fetchManifest(computeDomain((_this$value4 = this.value) === null || _this$value4 === void 0 ? void 0 : _this$value4.service));\n          }\n        } else {\n          this._manifest = undefined;\n        }\n        if (serviceData && \"target\" in serviceData && ((_this$value5 = this.value) !== null && _this$value5 !== void 0 && (_this$value5 = _this$value5.data) !== null && _this$value5 !== void 0 && _this$value5.entity_id || (_this$value6 = this.value) !== null && _this$value6 !== void 0 && (_this$value6 = _this$value6.data) !== null && _this$value6 !== void 0 && _this$value6.area_id || (_this$value7 = this.value) !== null && _this$value7 !== void 0 && (_this$value7 = _this$value7.data) !== null && _this$value7 !== void 0 && _this$value7.device_id)) {\n          var _this$value$target, _this$value$target2, _this$value$target3;\n          var target = Object.assign({}, this.value.target);\n          if (this.value.data.entity_id && !((_this$value$target = this.value.target) !== null && _this$value$target !== void 0 && _this$value$target.entity_id)) {\n            target.entity_id = this.value.data.entity_id;\n          }\n          if (this.value.data.area_id && !((_this$value$target2 = this.value.target) !== null && _this$value$target2 !== void 0 && _this$value$target2.area_id)) {\n            target.area_id = this.value.data.area_id;\n          }\n          if (this.value.data.device_id && !((_this$value$target3 = this.value.target) !== null && _this$value$target3 !== void 0 && _this$value$target3.device_id)) {\n            target.device_id = this.value.data.device_id;\n          }\n          this._value = Object.assign(Object.assign({}, this.value), {}, {\n            target: target,\n            data: Object.assign({}, this.value.data)\n          });\n          delete this._value.data.entity_id;\n          delete this._value.data.device_id;\n          delete this._value.data.area_id;\n        } else {\n          this._value = this.value;\n        }\n        if ((oldValue === null || oldValue === void 0 ? void 0 : oldValue.service) !== ((_this$value8 = this.value) === null || _this$value8 === void 0 ? void 0 : _this$value8.service)) {\n          var updatedDefaultValue = false;\n          if (this._value && serviceData) {\n            var loadDefaults = this.value && !(\"data\" in this.value);\n            // Set mandatory bools without a default value to false\n            if (!this._value.data) {\n              this._value.data = {};\n            }\n            serviceData.fields.forEach(function (field) {\n              if (field.selector && field.required && field.default === undefined && \"boolean\" in field.selector && _this2._value.data[field.key] === undefined) {\n                updatedDefaultValue = true;\n                _this2._value.data[field.key] = false;\n              }\n              if (loadDefaults && field.selector && field.default !== undefined && _this2._value.data[field.key] === undefined) {\n                updatedDefaultValue = true;\n                _this2._value.data[field.key] = field.default;\n              }\n            });\n          }\n          if (updatedDefaultValue) {\n            fireEvent(this, \"value-changed\", {\n              value: Object.assign({}, this._value)\n            });\n          }\n        }\n        if ((_this$_value = this._value) !== null && _this$_value !== void 0 && _this$_value.data) {\n          var yamlEditor = this._yamlEditor;\n          if (yamlEditor && yamlEditor.value !== this._value.data) {\n            yamlEditor.setValue(this._value.data);\n          }\n        }\n      }\n    }, {\n      kind: \"field\",\n      key: \"_getServiceInfo\",\n      value: function value() {\n        return memoizeOne(function (service, serviceDomains) {\n          if (!service || !serviceDomains) {\n            return undefined;\n          }\n          var domain = computeDomain(service);\n          var serviceName = computeObjectId(service);\n          if (!(domain in serviceDomains)) {\n            return undefined;\n          }\n          if (!(serviceName in serviceDomains[domain])) {\n            return undefined;\n          }\n          var fields = Object.entries(serviceDomains[domain][serviceName].fields).map(function (_ref) {\n            var _ref2 = _slicedToArray(_ref, 2),\n              key = _ref2[0],\n              value = _ref2[1];\n            return Object.assign(Object.assign({\n              key: key\n            }, value), {}, {\n              selector: value.selector\n            });\n          });\n          return Object.assign(Object.assign({}, serviceDomains[domain][serviceName]), {}, {\n            fields: fields,\n            hasSelector: fields.length ? fields.filter(function (field) {\n              return field.selector;\n            }).map(function (field) {\n              return field.key;\n            }) : []\n          });\n        });\n      }\n    }, {\n      kind: \"field\",\n      key: \"_filterFields\",\n      value: function value() {\n        var _this3 = this;\n        return memoizeOne(function (serviceData, value) {\n          var _serviceData$fields;\n          return serviceData === null || serviceData === void 0 || (_serviceData$fields = serviceData.fields) === null || _serviceData$fields === void 0 ? void 0 : _serviceData$fields.filter(function (field) {\n            return !field.filter || _this3._filterField(serviceData.target, field.filter, value);\n          });\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"_filterField\",\n      value: function _filterField(target, filter, value) {\n        var _ensureArray,\n          _value$target,\n          _value$data,\n          _ensureArray2,\n          _value$target2,\n          _value$data2,\n          _ensureArray3,\n          _value$target3,\n          _value$data3,\n          _this4 = this;\n        var targetSelector = target ? {\n          target: target\n        } : {\n          target: {}\n        };\n        var targetEntities = ((_ensureArray = ensureArray((value === null || value === void 0 || (_value$target = value.target) === null || _value$target === void 0 ? void 0 : _value$target.entity_id) || (value === null || value === void 0 || (_value$data = value.data) === null || _value$data === void 0 ? void 0 : _value$data.entity_id))) === null || _ensureArray === void 0 ? void 0 : _ensureArray.slice()) || [];\n        var targetDevices = ((_ensureArray2 = ensureArray((value === null || value === void 0 || (_value$target2 = value.target) === null || _value$target2 === void 0 ? void 0 : _value$target2.device_id) || (value === null || value === void 0 || (_value$data2 = value.data) === null || _value$data2 === void 0 ? void 0 : _value$data2.device_id))) === null || _ensureArray2 === void 0 ? void 0 : _ensureArray2.slice()) || [];\n        var targetAreas = (_ensureArray3 = ensureArray((value === null || value === void 0 || (_value$target3 = value.target) === null || _value$target3 === void 0 ? void 0 : _value$target3.area_id) || (value === null || value === void 0 || (_value$data3 = value.data) === null || _value$data3 === void 0 ? void 0 : _value$data3.area_id))) === null || _ensureArray3 === void 0 ? void 0 : _ensureArray3.slice();\n        if (targetAreas) {\n          targetAreas.forEach(function (areaId) {\n            var expanded = expandAreaTarget(_this4.hass, areaId, _this4.hass.devices, _this4.hass.entities, targetSelector);\n            targetEntities.push.apply(targetEntities, _toConsumableArray(expanded.entities));\n            targetDevices.push.apply(targetDevices, _toConsumableArray(expanded.devices));\n          });\n        }\n        if (targetDevices.length) {\n          targetDevices.forEach(function (deviceId) {\n            targetEntities.push.apply(targetEntities, _toConsumableArray(expandDeviceTarget(_this4.hass, deviceId, _this4.hass.entities, targetSelector).entities));\n          });\n        }\n        if (!targetEntities.length) {\n          return false;\n        }\n        if (targetEntities.some(function (entityId) {\n          var _supported_features;\n          var entityState = _this4.hass.states[entityId];\n          if (!entityState) {\n            return false;\n          }\n          if ((_supported_features = filter.supported_features) !== null && _supported_features !== void 0 && _supported_features.some(function (feature) {\n            return supportsFeature(entityState, feature);\n          })) {\n            return true;\n          }\n          if (filter.attribute && Object.entries(filter.attribute).some(function (_ref3) {\n            var _ref4 = _slicedToArray(_ref3, 2),\n              attribute = _ref4[0],\n              values = _ref4[1];\n            return attribute in entityState.attributes && attributeFilter(values, entityState.attributes[attribute]);\n          })) {\n            return true;\n          }\n          return false;\n        })) {\n          return true;\n        }\n        return false;\n      }\n    }, {\n      kind: \"method\",\n      key: \"render\",\n      value: function render() {\n        var _this$_value2,\n          _this$_value3,\n          _this$_value4,\n          _this$_value5,\n          _this$_value6,\n          _this$_value7,\n          _this$_value8,\n          _this$_value9,\n          _this5 = this;\n        var serviceData = this._getServiceInfo((_this$_value2 = this._value) === null || _this$_value2 === void 0 ? void 0 : _this$_value2.service, this.hass.services);\n        var shouldRenderServiceDataYaml = (serviceData === null || serviceData === void 0 ? void 0 : serviceData.fields.length) && !serviceData.hasSelector.length || serviceData && Object.keys(((_this$_value3 = this._value) === null || _this$_value3 === void 0 ? void 0 : _this$_value3.data) || {}).some(function (key) {\n          return !serviceData.hasSelector.includes(key);\n        });\n        var entityId = shouldRenderServiceDataYaml && (serviceData === null || serviceData === void 0 ? void 0 : serviceData.fields.find(function (field) {\n          return field.key === \"entity_id\";\n        }));\n        var hasOptional = Boolean(!shouldRenderServiceDataYaml && (serviceData === null || serviceData === void 0 ? void 0 : serviceData.fields.some(function (field) {\n          return showOptionalToggle(field);\n        })));\n        var filteredFields = this._filterFields(serviceData, this._value);\n        var domain = (_this$_value4 = this._value) !== null && _this$_value4 !== void 0 && _this$_value4.service ? computeDomain(this._value.service) : undefined;\n        var serviceName = (_this$_value5 = this._value) !== null && _this$_value5 !== void 0 && _this$_value5.service ? computeObjectId(this._value.service) : undefined;\n        var description = serviceName && this.hass.localize(\"component.\".concat(domain, \".services.\").concat(serviceName, \".description\")) || (serviceData === null || serviceData === void 0 ? void 0 : serviceData.description);\n        return html(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\", \"\\n      <div class=\\\"description\\\">\\n        \", \"\\n        \", \"\\n      </div>\\n      \", \"\\n      \", \"\"])), this.hidePicker ? nothing : html(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"<ha-service-picker\\n            .hass=\", \"\\n            .value=\", \"\\n            .disabled=\", \"\\n            @value-changed=\", \"\\n          ></ha-service-picker>\"])), this.hass, (_this$_value6 = this._value) === null || _this$_value6 === void 0 ? void 0 : _this$_value6.service, this.disabled, this._serviceChanged), description ? html(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"<p>\", \"</p>\"])), description) : \"\", this._manifest ? html(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\" <a\\n              href=\", \"\\n              title=\", \"\\n              target=\\\"_blank\\\"\\n              rel=\\\"noreferrer\\\"\\n            >\\n              <ha-icon-button\\n                .path=\", \"\\n                class=\\\"help-icon\\\"\\n              ></ha-icon-button>\\n            </a>\"])), this._manifest.is_built_in ? documentationUrl(this.hass, \"/integrations/\".concat(this._manifest.domain)) : this._manifest.documentation, this.hass.localize(\"ui.components.service-control.integration_doc\"), mdiHelpCircle) : \"\", serviceData && \"target\" in serviceData ? html(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"<ha-settings-row .narrow=\", \">\\n            \", \"\\n            <span slot=\\\"heading\\\"\\n              >\", \"</span\\n            >\\n            <span slot=\\\"description\\\"\\n              >\", \"</span\\n            ><ha-selector\\n              .hass=\", \"\\n              .selector=\", \"\\n              .disabled=\", \"\\n              @value-changed=\", \"\\n              .value=\", \"\\n            ></ha-selector\\n          ></ha-settings-row>\"])), this.narrow, hasOptional ? html(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"<div slot=\\\"prefix\\\" class=\\\"checkbox-spacer\\\"></div>\"]))) : \"\", this.hass.localize(\"ui.components.service-control.target\"), this.hass.localize(\"ui.components.service-control.target_description\"), this.hass, serviceData.target ? {\n          target: serviceData.target\n        } : {\n          target: {}\n        }, this.disabled, this._targetChanged, (_this$_value7 = this._value) === null || _this$_value7 === void 0 ? void 0 : _this$_value7.target) : entityId ? html(_templateObject7 || (_templateObject7 = _taggedTemplateLiteral([\"<ha-entity-picker\\n              .hass=\", \"\\n              .disabled=\", \"\\n              .value=\", \"\\n              .label=\", \"\\n              @value-changed=\", \"\\n              allow-custom-entity\\n            ></ha-entity-picker>\"])), this.hass, this.disabled, (_this$_value8 = this._value) === null || _this$_value8 === void 0 || (_this$_value8 = _this$_value8.data) === null || _this$_value8 === void 0 ? void 0 : _this$_value8.entity_id, this.hass.localize(\"component.\".concat(domain, \".services.\").concat(serviceName, \".fields.entity_id.description\")) || entityId.description, this._entityPicked) : \"\", shouldRenderServiceDataYaml ? html(_templateObject8 || (_templateObject8 = _taggedTemplateLiteral([\"<ha-yaml-editor\\n            .hass=\", \"\\n            .label=\", \"\\n            .name=\", \"\\n            .readOnly=\", \"\\n            .defaultValue=\", \"\\n            @value-changed=\", \"\\n          ></ha-yaml-editor>\"])), this.hass, this.hass.localize(\"ui.components.service-control.data\"), \"data\", this.disabled, (_this$_value9 = this._value) === null || _this$_value9 === void 0 ? void 0 : _this$_value9.data, this._dataChanged) : filteredFields === null || filteredFields === void 0 ? void 0 : filteredFields.map(function (dataField) {\n          var _dataField$selector, _this5$_value, _this5$_value2, _this5$_value3, _this5$_value4;\n          var selector = (_dataField$selector = dataField === null || dataField === void 0 ? void 0 : dataField.selector) !== null && _dataField$selector !== void 0 ? _dataField$selector : {\n            text: undefined\n          };\n          var type = Object.keys(selector)[0];\n          var enhancedSelector = [\"action\", \"condition\", \"trigger\"].includes(type) ? _defineProperty({}, type, Object.assign(Object.assign({}, selector[type]), {}, {\n            path: [dataField.key]\n          })) : selector;\n          var showOptional = showOptionalToggle(dataField);\n          return dataField.selector && (!dataField.advanced || _this5.showAdvanced || (_this5$_value = _this5._value) !== null && _this5$_value !== void 0 && _this5$_value.data && _this5._value.data[dataField.key] !== undefined) ? html(_templateObject9 || (_templateObject9 = _taggedTemplateLiteral([\"<ha-settings-row .narrow=\", \">\\n                  \", \"\\n                  <span slot=\\\"heading\\\"\\n                    >\", \"</span\\n                  >\\n                  <span slot=\\\"description\\\"\\n                    >\", \"</span\\n                  >\\n                  <ha-selector\\n                    .disabled=\", \"\\n                    .hass=\", \"\\n                    .selector=\", \"\\n                    .key=\", \"\\n                    @value-changed=\", \"\\n                    .value=\", \"\\n                    .placeholder=\", \"\\n                    .localizeValue=\", \"\\n                    @item-moved=\", \"\\n                  ></ha-selector>\\n                </ha-settings-row>\"])), _this5.narrow, !showOptional ? hasOptional ? html(_templateObject10 || (_templateObject10 = _taggedTemplateLiteral([\"<div slot=\\\"prefix\\\" class=\\\"checkbox-spacer\\\"></div>\"]))) : \"\" : html(_templateObject11 || (_templateObject11 = _taggedTemplateLiteral([\"<ha-checkbox\\n                        .key=\", \"\\n                        .checked=\", \"\\n                        .disabled=\", \"\\n                        @change=\", \"\\n                        slot=\\\"prefix\\\"\\n                      ></ha-checkbox>\"])), dataField.key, _this5._checkedKeys.has(dataField.key) || ((_this5$_value2 = _this5._value) === null || _this5$_value2 === void 0 ? void 0 : _this5$_value2.data) && _this5._value.data[dataField.key] !== undefined, _this5.disabled, _this5._checkboxChanged), _this5.hass.localize(\"component.\".concat(domain, \".services.\").concat(serviceName, \".fields.\").concat(dataField.key, \".name\")) || dataField.name || dataField.key, _this5.hass.localize(\"component.\".concat(domain, \".services.\").concat(serviceName, \".fields.\").concat(dataField.key, \".description\")) || (dataField === null || dataField === void 0 ? void 0 : dataField.description), _this5.disabled || showOptional && !_this5._checkedKeys.has(dataField.key) && (!((_this5$_value3 = _this5._value) !== null && _this5$_value3 !== void 0 && _this5$_value3.data) || _this5._value.data[dataField.key] === undefined), _this5.hass, enhancedSelector, dataField.key, _this5._serviceDataChanged, (_this5$_value4 = _this5._value) !== null && _this5$_value4 !== void 0 && _this5$_value4.data ? _this5._value.data[dataField.key] : undefined, dataField.default, _this5._localizeValueCallback, _this5._itemMoved) : \"\";\n        }));\n      }\n    }, {\n      kind: \"field\",\n      key: \"_localizeValueCallback\",\n      value: function value() {\n        var _this6 = this;\n        return function (key) {\n          var _this6$_value;\n          if (!((_this6$_value = _this6._value) !== null && _this6$_value !== void 0 && _this6$_value.service)) {\n            return \"\";\n          }\n          return _this6.hass.localize(\"component.\".concat(computeDomain(_this6._value.service), \".selector.\").concat(key));\n        };\n      }\n    }, {\n      kind: \"method\",\n      key: \"_checkboxChanged\",\n      value: function _checkboxChanged(ev) {\n        var checked = ev.currentTarget.checked;\n        var key = ev.currentTarget.key;\n        var data;\n        if (checked) {\n          var _this$_getServiceInfo, _this$_value10;\n          this._checkedKeys.add(key);\n          var field = (_this$_getServiceInfo = this._getServiceInfo((_this$_value10 = this._value) === null || _this$_value10 === void 0 ? void 0 : _this$_value10.service, this.hass.services)) === null || _this$_getServiceInfo === void 0 ? void 0 : _this$_getServiceInfo.fields.find(function (_field) {\n            return _field.key === key;\n          });\n          var defaultValue = field === null || field === void 0 ? void 0 : field.default;\n          if (defaultValue == null && field !== null && field !== void 0 && field.selector && \"constant\" in field.selector) {\n            var _field$selector$const;\n            defaultValue = (_field$selector$const = field.selector.constant) === null || _field$selector$const === void 0 ? void 0 : _field$selector$const.value;\n          }\n          if (defaultValue == null && field !== null && field !== void 0 && field.selector && \"boolean\" in field.selector) {\n            defaultValue = false;\n          }\n          if (defaultValue != null) {\n            var _this$_value11;\n            data = Object.assign(Object.assign({}, (_this$_value11 = this._value) === null || _this$_value11 === void 0 ? void 0 : _this$_value11.data), {}, _defineProperty({}, key, defaultValue));\n          }\n        } else {\n          var _this$_value12;\n          this._checkedKeys.delete(key);\n          data = Object.assign({}, (_this$_value12 = this._value) === null || _this$_value12 === void 0 ? void 0 : _this$_value12.data);\n          delete data[key];\n        }\n        if (data) {\n          fireEvent(this, \"value-changed\", {\n            value: Object.assign(Object.assign({}, this._value), {}, {\n              data: data\n            })\n          });\n        }\n        this.requestUpdate(\"_checkedKeys\");\n      }\n    }, {\n      kind: \"method\",\n      key: \"_serviceChanged\",\n      value: function _serviceChanged(ev) {\n        var _this$_value13,\n          _this7 = this;\n        ev.stopPropagation();\n        if (ev.detail.value === ((_this$_value13 = this._value) === null || _this$_value13 === void 0 ? void 0 : _this$_value13.service)) {\n          return;\n        }\n        var newService = ev.detail.value || \"\";\n        var target;\n        if (newService) {\n          var _this$_value14;\n          var serviceData = this._getServiceInfo(newService, this.hass.services);\n          var currentTarget = (_this$_value14 = this._value) === null || _this$_value14 === void 0 ? void 0 : _this$_value14.target;\n          if (currentTarget && serviceData !== null && serviceData !== void 0 && serviceData.target) {\n            var _ensureArray4, _data, _ensureArray5, _data2, _ensureArray6, _data3;\n            var targetSelector = {\n              target: Object.assign({}, serviceData.target)\n            };\n            var targetEntities = ((_ensureArray4 = ensureArray(currentTarget.entity_id || ((_data = this._value.data) === null || _data === void 0 ? void 0 : _data.entity_id))) === null || _ensureArray4 === void 0 ? void 0 : _ensureArray4.slice()) || [];\n            var targetDevices = ((_ensureArray5 = ensureArray(currentTarget.device_id || ((_data2 = this._value.data) === null || _data2 === void 0 ? void 0 : _data2.device_id))) === null || _ensureArray5 === void 0 ? void 0 : _ensureArray5.slice()) || [];\n            var targetAreas = ((_ensureArray6 = ensureArray(currentTarget.area_id || ((_data3 = this._value.data) === null || _data3 === void 0 ? void 0 : _data3.area_id))) === null || _ensureArray6 === void 0 ? void 0 : _ensureArray6.slice()) || [];\n            if (targetAreas.length) {\n              targetAreas = targetAreas.filter(function (area) {\n                return areaMeetsTargetSelector(_this7.hass, _this7.hass.entities, _this7.hass.devices, area, targetSelector);\n              });\n            }\n            if (targetDevices.length) {\n              targetDevices = targetDevices.filter(function (device) {\n                return deviceMeetsTargetSelector(_this7.hass, Object.values(_this7.hass.entities), _this7.hass.devices[device], targetSelector);\n              });\n            }\n            if (targetEntities.length) {\n              targetEntities = targetEntities.filter(function (entity) {\n                return entityMeetsTargetSelector(_this7.hass.states[entity], targetSelector);\n              });\n            }\n            target = Object.assign(Object.assign(Object.assign({}, targetEntities.length ? {\n              entity_id: targetEntities\n            } : {}), targetDevices.length ? {\n              device_id: targetDevices\n            } : {}), targetAreas.length ? {\n              area_id: targetAreas\n            } : {});\n          }\n        }\n        var value = {\n          service: newService,\n          target: target\n        };\n        fireEvent(this, \"value-changed\", {\n          value: value\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"_entityPicked\",\n      value: function _entityPicked(ev) {\n        var _this$_value15, _this$_value16;\n        ev.stopPropagation();\n        var newValue = ev.detail.value;\n        if (((_this$_value15 = this._value) === null || _this$_value15 === void 0 || (_this$_value15 = _this$_value15.data) === null || _this$_value15 === void 0 ? void 0 : _this$_value15.entity_id) === newValue) {\n          return;\n        }\n        var value;\n        if (!newValue && (_this$_value16 = this._value) !== null && _this$_value16 !== void 0 && _this$_value16.data) {\n          value = Object.assign({}, this._value);\n          delete value.data.entity_id;\n        } else {\n          var _this$_value17;\n          value = Object.assign(Object.assign({}, this._value), {}, {\n            data: Object.assign(Object.assign({}, (_this$_value17 = this._value) === null || _this$_value17 === void 0 ? void 0 : _this$_value17.data), {}, {\n              entity_id: ev.detail.value\n            })\n          });\n        }\n        fireEvent(this, \"value-changed\", {\n          value: value\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"_targetChanged\",\n      value: function _targetChanged(ev) {\n        var _this$_value18;\n        ev.stopPropagation();\n        var newValue = ev.detail.value;\n        if (((_this$_value18 = this._value) === null || _this$_value18 === void 0 ? void 0 : _this$_value18.target) === newValue) {\n          return;\n        }\n        var value;\n        if (!newValue) {\n          value = Object.assign({}, this._value);\n          delete value.target;\n        } else {\n          value = Object.assign(Object.assign({}, this._value), {}, {\n            target: ev.detail.value\n          });\n        }\n        fireEvent(this, \"value-changed\", {\n          value: value\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"_serviceDataChanged\",\n      value: function _serviceDataChanged(ev) {\n        var _this$_value19, _this$_value20, _this$_value21;\n        ev.stopPropagation();\n        var key = ev.currentTarget.key;\n        var value = ev.detail.value;\n        if (((_this$_value19 = this._value) === null || _this$_value19 === void 0 || (_this$_value19 = _this$_value19.data) === null || _this$_value19 === void 0 ? void 0 : _this$_value19[key]) === value || !((_this$_value20 = this._value) !== null && _this$_value20 !== void 0 && (_this$_value20 = _this$_value20.data) !== null && _this$_value20 !== void 0 && _this$_value20[key]) && (value === \"\" || value === undefined)) {\n          return;\n        }\n        var data = Object.assign(Object.assign({}, (_this$_value21 = this._value) === null || _this$_value21 === void 0 ? void 0 : _this$_value21.data), {}, _defineProperty({}, key, value));\n        if (value === \"\" || value === undefined) {\n          delete data[key];\n        }\n        fireEvent(this, \"value-changed\", {\n          value: Object.assign(Object.assign({}, this._value), {}, {\n            data: data\n          })\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"_itemMoved\",\n      value: function _itemMoved(ev) {\n        var _this$value$data, _this$value9;\n        ev.stopPropagation();\n        var _ev$detail = ev.detail,\n          oldIndex = _ev$detail.oldIndex,\n          newIndex = _ev$detail.newIndex,\n          oldPath = _ev$detail.oldPath,\n          newPath = _ev$detail.newPath;\n        var data = (_this$value$data = (_this$value9 = this.value) === null || _this$value9 === void 0 ? void 0 : _this$value9.data) !== null && _this$value$data !== void 0 ? _this$value$data : {};\n        var newData = nestedArrayMove(data, oldIndex, newIndex, oldPath, newPath);\n        fireEvent(this, \"value-changed\", {\n          value: Object.assign(Object.assign({}, this.value), {}, {\n            data: newData\n          })\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"_dataChanged\",\n      value: function _dataChanged(ev) {\n        ev.stopPropagation();\n        if (!ev.detail.isValid) {\n          return;\n        }\n        fireEvent(this, \"value-changed\", {\n          value: Object.assign(Object.assign({}, this._value), {}, {\n            data: ev.detail.value\n          })\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"_fetchManifest\",\n      value: function () {\n        var _fetchManifest2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(integration) {\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                this._manifest = undefined;\n                _context.prev = 1;\n                _context.next = 4;\n                return fetchIntegrationManifest(this.hass, integration);\n              case 4:\n                this._manifest = _context.sent;\n                _context.next = 9;\n                break;\n              case 7:\n                _context.prev = 7;\n                _context.t0 = _context[\"catch\"](1);\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }, _callee, this, [[1, 7]]);\n        }));\n        function _fetchManifest(_x) {\n          return _fetchManifest2.apply(this, arguments);\n        }\n        return _fetchManifest;\n      }()\n    }, {\n      kind: \"get\",\n      static: true,\n      key: \"styles\",\n      value: function styles() {\n        return css(_templateObject12 || (_templateObject12 = _taggedTemplateLiteral([\"\\n      ha-settings-row {\\n        padding: var(--service-control-padding, 0 16px);\\n      }\\n      ha-settings-row {\\n        --paper-time-input-justify-content: flex-end;\\n        --settings-row-content-width: 100%;\\n        --settings-row-prefix-display: contents;\\n        border-top: var(\\n          --service-control-items-border-top,\\n          1px solid var(--divider-color)\\n        );\\n      }\\n      ha-service-picker,\\n      ha-entity-picker,\\n      ha-yaml-editor {\\n        display: block;\\n        margin: var(--service-control-padding, 0 16px);\\n      }\\n      ha-yaml-editor {\\n        padding: 16px 0;\\n      }\\n      p {\\n        margin: var(--service-control-padding, 0 16px);\\n        padding: 16px 0;\\n      }\\n      :host([hidePicker]) p {\\n        padding-top: 0;\\n      }\\n      .checkbox-spacer {\\n        width: 32px;\\n      }\\n      ha-checkbox {\\n        margin-left: -16px;\\n        margin-inline-start: -16px;\\n        margin-inline-end: initial;\\n      }\\n      .help-icon {\\n        color: var(--secondary-text-color);\\n      }\\n      .description {\\n        justify-content: space-between;\\n        display: flex;\\n        align-items: center;\\n        padding-right: 2px;\\n        padding-inline-end: 2px;\\n        padding-inline-start: initial;\\n      }\\n      .description p {\\n        direction: ltr;\\n      }\\n    \"])));\n      }\n    }]\n  };\n}, LitElement);","map":{"version":3,"names":["css","html","LitElement","nothing","customElement","property","query","state","memoizeOne","ensureArray","fireEvent","computeDomain","computeObjectId","supportsFeature","nestedArrayMove","fetchIntegrationManifest","areaMeetsTargetSelector","deviceMeetsTargetSelector","entityMeetsTargetSelector","expandAreaTarget","expandDeviceTarget","documentationUrl","attributeFilter","values","attribute","_typeof","Array","isArray","some","item","includes","showOptionalToggle","field","selector","required","default","HaServiceControl","_decorate","_initialize","_LitElement","_LitElement2","_inherits","_this","_classCallCheck","_len","arguments","length","args","_key","_callSuper","concat","_assertThisInitialized","_createClass","F","d","kind","decorators","key","value","type","Boolean","reflect","Set","willUpdate","changedProperties","_this$value","_this$value2","_this$value3","_this$value5","_this$value6","_this$value7","_this$value8","_this2","_this$_value","hasUpdated","hass","loadBackendTranslation","has","oldValue","get","service","_checkedKeys","serviceData","_getServiceInfo","services","_this$value4","_fetchManifest","_manifest","undefined","data","entity_id","area_id","device_id","_this$value$target","_this$value$target2","_this$value$target3","target","Object","assign","_value","updatedDefaultValue","loadDefaults","fields","forEach","yamlEditor","_yamlEditor","setValue","serviceDomains","domain","serviceName","entries","map","_ref","_ref2","_slicedToArray","hasSelector","filter","_this3","_serviceData$fields","_filterField","_ensureArray","_value$target","_value$data","_ensureArray2","_value$target2","_value$data2","_ensureArray3","_value$target3","_value$data3","_this4","targetSelector","targetEntities","slice","targetDevices","targetAreas","areaId","expanded","devices","entities","push","apply","_toConsumableArray","deviceId","entityId","_supported_features","entityState","states","supported_features","feature","_ref3","_ref4","attributes","render","_this$_value2","_this$_value3","_this$_value4","_this$_value5","_this$_value6","_this$_value7","_this$_value8","_this$_value9","_this5","shouldRenderServiceDataYaml","keys","find","hasOptional","filteredFields","_filterFields","description","localize","_templateObject","_taggedTemplateLiteral","hidePicker","_templateObject2","disabled","_serviceChanged","_templateObject3","_templateObject4","is_built_in","documentation","mdiHelpCircle","_templateObject5","narrow","_templateObject6","_targetChanged","_templateObject7","_entityPicked","_templateObject8","_dataChanged","dataField","_dataField$selector","_this5$_value","_this5$_value2","_this5$_value3","_this5$_value4","text","enhancedSelector","_defineProperty","path","showOptional","advanced","showAdvanced","_templateObject9","_templateObject10","_templateObject11","_checkboxChanged","name","_serviceDataChanged","_localizeValueCallback","_itemMoved","_this6","_this6$_value","ev","checked","currentTarget","_this$_getServiceInfo","_this$_value10","add","_field","defaultValue","_field$selector$const","constant","_this$_value11","_this$_value12","delete","requestUpdate","_this$_value13","_this7","stopPropagation","detail","newService","_this$_value14","_ensureArray4","_data","_ensureArray5","_data2","_ensureArray6","_data3","area","device","entity","_this$_value15","_this$_value16","newValue","_this$_value17","_this$_value18","_this$_value19","_this$_value20","_this$_value21","_this$value$data","_this$value9","_ev$detail","oldIndex","newIndex","oldPath","newPath","newData","isValid","_fetchManifest2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","integration","wrap","_callee$","_context","prev","next","sent","t0","stop","_x","static","styles","_templateObject12"],"sources":["/workspaces/frontend/src/components/ha-service-control.ts"],"sourcesContent":["import { mdiHelpCircle } from \"@mdi/js\";\nimport {\n  HassService,\n  HassServices,\n  HassServiceTarget,\n} from \"home-assistant-js-websocket\";\nimport {\n  css,\n  CSSResultGroup,\n  html,\n  LitElement,\n  nothing,\n  PropertyValues,\n} from \"lit\";\nimport { customElement, property, query, state } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { ensureArray } from \"../common/array/ensure-array\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { computeDomain } from \"../common/entity/compute_domain\";\nimport { computeObjectId } from \"../common/entity/compute_object_id\";\nimport { supportsFeature } from \"../common/entity/supports-feature\";\nimport { nestedArrayMove } from \"../common/util/array-move\";\nimport {\n  fetchIntegrationManifest,\n  IntegrationManifest,\n} from \"../data/integration\";\nimport {\n  areaMeetsTargetSelector,\n  deviceMeetsTargetSelector,\n  entityMeetsTargetSelector,\n  expandAreaTarget,\n  expandDeviceTarget,\n  Selector,\n} from \"../data/selector\";\nimport { HomeAssistant, ValueChangedEvent } from \"../types\";\nimport { documentationUrl } from \"../util/documentation-url\";\nimport \"./ha-checkbox\";\nimport \"./ha-icon-button\";\nimport \"./ha-selector/ha-selector\";\nimport \"./ha-service-picker\";\nimport \"./ha-settings-row\";\nimport \"./ha-yaml-editor\";\nimport type { HaYamlEditor } from \"./ha-yaml-editor\";\n\nconst attributeFilter = (values: any[], attribute: any) => {\n  if (typeof attribute === \"object\") {\n    if (Array.isArray(attribute)) {\n      return attribute.some((item) => values.includes(item));\n    }\n    return false;\n  }\n  return values.includes(attribute);\n};\n\nconst showOptionalToggle = (field) =>\n  field.selector &&\n  !field.required &&\n  !(\"boolean\" in field.selector && field.default);\n\ninterface ExtHassService extends Omit<HassService, \"fields\"> {\n  fields: {\n    key: string;\n    name?: string;\n    description: string;\n    required?: boolean;\n    advanced?: boolean;\n    default?: any;\n    example?: any;\n    filter?: {\n      supported_features?: number[];\n      attribute?: Record<string, any[]>;\n    };\n    selector?: Selector;\n  }[];\n  hasSelector: string[];\n}\n\n@customElement(\"ha-service-control\")\nexport class HaServiceControl extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public value?: {\n    service: string;\n    target?: HassServiceTarget;\n    data?: Record<string, any>;\n  };\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean, reflect: true }) public narrow = false;\n\n  @property({ type: Boolean }) public showAdvanced = false;\n\n  @property({ type: Boolean, reflect: true }) public hidePicker = false;\n\n  @state() private _value!: this[\"value\"];\n\n  @state() private _checkedKeys = new Set();\n\n  @state() private _manifest?: IntegrationManifest;\n\n  @query(\"ha-yaml-editor\") private _yamlEditor?: HaYamlEditor;\n\n  protected willUpdate(changedProperties: PropertyValues<this>) {\n    if (!this.hasUpdated) {\n      this.hass.loadBackendTranslation(\"services\");\n      this.hass.loadBackendTranslation(\"selector\");\n    }\n    if (!changedProperties.has(\"value\")) {\n      return;\n    }\n    const oldValue = changedProperties.get(\"value\") as\n      | undefined\n      | this[\"value\"];\n\n    if (oldValue?.service !== this.value?.service) {\n      this._checkedKeys = new Set();\n    }\n\n    const serviceData = this._getServiceInfo(\n      this.value?.service,\n      this.hass.services\n    );\n\n    // Fetch the manifest if we have a service selected and the service domain changed.\n    // If no service is selected, clear the manifest.\n    if (this.value?.service) {\n      if (\n        !oldValue?.service ||\n        computeDomain(this.value.service) !== computeDomain(oldValue.service)\n      ) {\n        this._fetchManifest(computeDomain(this.value?.service));\n      }\n    } else {\n      this._manifest = undefined;\n    }\n\n    if (\n      serviceData &&\n      \"target\" in serviceData &&\n      (this.value?.data?.entity_id ||\n        this.value?.data?.area_id ||\n        this.value?.data?.device_id)\n    ) {\n      const target = {\n        ...this.value.target,\n      };\n\n      if (this.value.data.entity_id && !this.value.target?.entity_id) {\n        target.entity_id = this.value.data.entity_id;\n      }\n      if (this.value.data.area_id && !this.value.target?.area_id) {\n        target.area_id = this.value.data.area_id;\n      }\n      if (this.value.data.device_id && !this.value.target?.device_id) {\n        target.device_id = this.value.data.device_id;\n      }\n\n      this._value = {\n        ...this.value,\n        target,\n        data: { ...this.value.data },\n      };\n\n      delete this._value.data!.entity_id;\n      delete this._value.data!.device_id;\n      delete this._value.data!.area_id;\n    } else {\n      this._value = this.value;\n    }\n\n    if (oldValue?.service !== this.value?.service) {\n      let updatedDefaultValue = false;\n      if (this._value && serviceData) {\n        const loadDefaults = this.value && !(\"data\" in this.value);\n        // Set mandatory bools without a default value to false\n        if (!this._value.data) {\n          this._value.data = {};\n        }\n        serviceData.fields.forEach((field) => {\n          if (\n            field.selector &&\n            field.required &&\n            field.default === undefined &&\n            \"boolean\" in field.selector &&\n            this._value!.data![field.key] === undefined\n          ) {\n            updatedDefaultValue = true;\n            this._value!.data![field.key] = false;\n          }\n          if (\n            loadDefaults &&\n            field.selector &&\n            field.default !== undefined &&\n            this._value!.data![field.key] === undefined\n          ) {\n            updatedDefaultValue = true;\n            this._value!.data![field.key] = field.default;\n          }\n        });\n      }\n      if (updatedDefaultValue) {\n        fireEvent(this, \"value-changed\", {\n          value: {\n            ...this._value,\n          },\n        });\n      }\n    }\n\n    if (this._value?.data) {\n      const yamlEditor = this._yamlEditor;\n      if (yamlEditor && yamlEditor.value !== this._value.data) {\n        yamlEditor.setValue(this._value.data);\n      }\n    }\n  }\n\n  private _getServiceInfo = memoizeOne(\n    (\n      service?: string,\n      serviceDomains?: HassServices\n    ): ExtHassService | undefined => {\n      if (!service || !serviceDomains) {\n        return undefined;\n      }\n      const domain = computeDomain(service);\n      const serviceName = computeObjectId(service);\n      if (!(domain in serviceDomains)) {\n        return undefined;\n      }\n      if (!(serviceName in serviceDomains[domain])) {\n        return undefined;\n      }\n\n      const fields = Object.entries(\n        serviceDomains[domain][serviceName].fields\n      ).map(([key, value]) => ({\n        key,\n        ...value,\n        selector: value.selector as Selector | undefined,\n      }));\n      return {\n        ...serviceDomains[domain][serviceName],\n        fields,\n        hasSelector: fields.length\n          ? fields.filter((field) => field.selector).map((field) => field.key)\n          : [],\n      };\n    }\n  );\n\n  private _filterFields = memoizeOne(\n    (serviceData: ExtHassService | undefined, value: this[\"value\"]) =>\n      serviceData?.fields?.filter(\n        (field) =>\n          !field.filter ||\n          this._filterField(serviceData.target, field.filter, value)\n      )\n  );\n\n  private _filterField(\n    target: ExtHassService[\"target\"],\n    filter: ExtHassService[\"fields\"][number][\"filter\"],\n    value: this[\"value\"]\n  ) {\n    const targetSelector = target ? { target } : { target: {} };\n    const targetEntities =\n      ensureArray(\n        value?.target?.entity_id || value?.data?.entity_id\n      )?.slice() || [];\n    const targetDevices =\n      ensureArray(\n        value?.target?.device_id || value?.data?.device_id\n      )?.slice() || [];\n    const targetAreas = ensureArray(\n      value?.target?.area_id || value?.data?.area_id\n    )?.slice();\n    if (targetAreas) {\n      targetAreas.forEach((areaId) => {\n        const expanded = expandAreaTarget(\n          this.hass,\n          areaId,\n          this.hass.devices,\n          this.hass.entities,\n          targetSelector\n        );\n        targetEntities.push(...expanded.entities);\n        targetDevices.push(...expanded.devices);\n      });\n    }\n    if (targetDevices.length) {\n      targetDevices.forEach((deviceId) => {\n        targetEntities.push(\n          ...expandDeviceTarget(\n            this.hass,\n            deviceId,\n            this.hass.entities,\n            targetSelector\n          ).entities\n        );\n      });\n    }\n    if (!targetEntities.length) {\n      return false;\n    }\n    if (\n      targetEntities.some((entityId) => {\n        const entityState = this.hass.states[entityId];\n        if (!entityState) {\n          return false;\n        }\n        if (\n          filter!.supported_features?.some((feature) =>\n            supportsFeature(entityState, feature)\n          )\n        ) {\n          return true;\n        }\n        if (\n          filter!.attribute &&\n          Object.entries(filter!.attribute).some(\n            ([attribute, values]) =>\n              attribute in entityState.attributes &&\n              attributeFilter(values, entityState.attributes[attribute])\n          )\n        ) {\n          return true;\n        }\n        return false;\n      })\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  protected render() {\n    const serviceData = this._getServiceInfo(\n      this._value?.service,\n      this.hass.services\n    );\n\n    const shouldRenderServiceDataYaml =\n      (serviceData?.fields.length && !serviceData.hasSelector.length) ||\n      (serviceData &&\n        Object.keys(this._value?.data || {}).some(\n          (key) => !serviceData!.hasSelector.includes(key)\n        ));\n\n    const entityId =\n      shouldRenderServiceDataYaml &&\n      serviceData?.fields.find((field) => field.key === \"entity_id\");\n\n    const hasOptional = Boolean(\n      !shouldRenderServiceDataYaml &&\n        serviceData?.fields.some((field) => showOptionalToggle(field))\n    );\n\n    const filteredFields = this._filterFields(serviceData, this._value);\n\n    const domain = this._value?.service\n      ? computeDomain(this._value.service)\n      : undefined;\n    const serviceName = this._value?.service\n      ? computeObjectId(this._value.service)\n      : undefined;\n\n    const description =\n      (serviceName &&\n        this.hass.localize(\n          `component.${domain}.services.${serviceName}.description`\n        )) ||\n      serviceData?.description;\n\n    return html`${this.hidePicker\n        ? nothing\n        : html`<ha-service-picker\n            .hass=${this.hass}\n            .value=${this._value?.service}\n            .disabled=${this.disabled}\n            @value-changed=${this._serviceChanged}\n          ></ha-service-picker>`}\n      <div class=\"description\">\n        ${description ? html`<p>${description}</p>` : \"\"}\n        ${this._manifest\n          ? html` <a\n              href=${this._manifest.is_built_in\n                ? documentationUrl(\n                    this.hass,\n                    `/integrations/${this._manifest.domain}`\n                  )\n                : this._manifest.documentation}\n              title=${this.hass.localize(\n                \"ui.components.service-control.integration_doc\"\n              )}\n              target=\"_blank\"\n              rel=\"noreferrer\"\n            >\n              <ha-icon-button\n                .path=${mdiHelpCircle}\n                class=\"help-icon\"\n              ></ha-icon-button>\n            </a>`\n          : \"\"}\n      </div>\n      ${serviceData && \"target\" in serviceData\n        ? html`<ha-settings-row .narrow=${this.narrow}>\n            ${hasOptional\n              ? html`<div slot=\"prefix\" class=\"checkbox-spacer\"></div>`\n              : \"\"}\n            <span slot=\"heading\"\n              >${this.hass.localize(\n                \"ui.components.service-control.target\"\n              )}</span\n            >\n            <span slot=\"description\"\n              >${this.hass.localize(\n                \"ui.components.service-control.target_description\"\n              )}</span\n            ><ha-selector\n              .hass=${this.hass}\n              .selector=${serviceData.target\n                ? { target: serviceData.target }\n                : { target: {} }}\n              .disabled=${this.disabled}\n              @value-changed=${this._targetChanged}\n              .value=${this._value?.target}\n            ></ha-selector\n          ></ha-settings-row>`\n        : entityId\n          ? html`<ha-entity-picker\n              .hass=${this.hass}\n              .disabled=${this.disabled}\n              .value=${this._value?.data?.entity_id}\n              .label=${this.hass.localize(\n                `component.${domain}.services.${serviceName}.fields.entity_id.description`\n              ) || entityId.description}\n              @value-changed=${this._entityPicked}\n              allow-custom-entity\n            ></ha-entity-picker>`\n          : \"\"}\n      ${shouldRenderServiceDataYaml\n        ? html`<ha-yaml-editor\n            .hass=${this.hass}\n            .label=${this.hass.localize(\"ui.components.service-control.data\")}\n            .name=${\"data\"}\n            .readOnly=${this.disabled}\n            .defaultValue=${this._value?.data}\n            @value-changed=${this._dataChanged}\n          ></ha-yaml-editor>`\n        : filteredFields?.map((dataField) => {\n            const selector = dataField?.selector ?? { text: undefined };\n            const type = Object.keys(selector)[0];\n            const enhancedSelector = [\n              \"action\",\n              \"condition\",\n              \"trigger\",\n            ].includes(type)\n              ? {\n                  [type]: {\n                    ...selector[type],\n                    path: [dataField.key],\n                  },\n                }\n              : selector;\n\n            const showOptional = showOptionalToggle(dataField);\n\n            return dataField.selector &&\n              (!dataField.advanced ||\n                this.showAdvanced ||\n                (this._value?.data &&\n                  this._value.data[dataField.key] !== undefined))\n              ? html`<ha-settings-row .narrow=${this.narrow}>\n                  ${!showOptional\n                    ? hasOptional\n                      ? html`<div slot=\"prefix\" class=\"checkbox-spacer\"></div>`\n                      : \"\"\n                    : html`<ha-checkbox\n                        .key=${dataField.key}\n                        .checked=${this._checkedKeys.has(dataField.key) ||\n                        (this._value?.data &&\n                          this._value.data[dataField.key] !== undefined)}\n                        .disabled=${this.disabled}\n                        @change=${this._checkboxChanged}\n                        slot=\"prefix\"\n                      ></ha-checkbox>`}\n                  <span slot=\"heading\"\n                    >${this.hass.localize(\n                      `component.${domain}.services.${serviceName}.fields.${dataField.key}.name`\n                    ) ||\n                    dataField.name ||\n                    dataField.key}</span\n                  >\n                  <span slot=\"description\"\n                    >${this.hass.localize(\n                      `component.${domain}.services.${serviceName}.fields.${dataField.key}.description`\n                    ) || dataField?.description}</span\n                  >\n                  <ha-selector\n                    .disabled=${this.disabled ||\n                    (showOptional &&\n                      !this._checkedKeys.has(dataField.key) &&\n                      (!this._value?.data ||\n                        this._value.data[dataField.key] === undefined))}\n                    .hass=${this.hass}\n                    .selector=${enhancedSelector}\n                    .key=${dataField.key}\n                    @value-changed=${this._serviceDataChanged}\n                    .value=${this._value?.data\n                      ? this._value.data[dataField.key]\n                      : undefined}\n                    .placeholder=${dataField.default}\n                    .localizeValue=${this._localizeValueCallback}\n                    @item-moved=${this._itemMoved}\n                  ></ha-selector>\n                </ha-settings-row>`\n              : \"\";\n          })}`;\n  }\n\n  private _localizeValueCallback = (key: string) => {\n    if (!this._value?.service) {\n      return \"\";\n    }\n    return this.hass.localize(\n      `component.${computeDomain(this._value.service)}.selector.${key}`\n    );\n  };\n\n  private _checkboxChanged(ev) {\n    const checked = ev.currentTarget.checked;\n    const key = ev.currentTarget.key;\n    let data;\n\n    if (checked) {\n      this._checkedKeys.add(key);\n      const field = this._getServiceInfo(\n        this._value?.service,\n        this.hass.services\n      )?.fields.find((_field) => _field.key === key);\n\n      let defaultValue = field?.default;\n\n      if (\n        defaultValue == null &&\n        field?.selector &&\n        \"constant\" in field.selector\n      ) {\n        defaultValue = field.selector.constant?.value;\n      }\n\n      if (\n        defaultValue == null &&\n        field?.selector &&\n        \"boolean\" in field.selector\n      ) {\n        defaultValue = false;\n      }\n\n      if (defaultValue != null) {\n        data = {\n          ...this._value?.data,\n          [key]: defaultValue,\n        };\n      }\n    } else {\n      this._checkedKeys.delete(key);\n      data = { ...this._value?.data };\n      delete data[key];\n    }\n    if (data) {\n      fireEvent(this, \"value-changed\", {\n        value: {\n          ...this._value,\n          data,\n        },\n      });\n    }\n    this.requestUpdate(\"_checkedKeys\");\n  }\n\n  private _serviceChanged(ev: ValueChangedEvent<string>) {\n    ev.stopPropagation();\n    if (ev.detail.value === this._value?.service) {\n      return;\n    }\n\n    const newService = ev.detail.value || \"\";\n    let target: HassServiceTarget | undefined;\n\n    if (newService) {\n      const serviceData = this._getServiceInfo(newService, this.hass.services);\n      const currentTarget = this._value?.target;\n      if (currentTarget && serviceData?.target) {\n        const targetSelector = { target: { ...serviceData.target } };\n        let targetEntities =\n          ensureArray(\n            currentTarget.entity_id || this._value!.data?.entity_id\n          )?.slice() || [];\n        let targetDevices =\n          ensureArray(\n            currentTarget.device_id || this._value!.data?.device_id\n          )?.slice() || [];\n        let targetAreas =\n          ensureArray(\n            currentTarget.area_id || this._value!.data?.area_id\n          )?.slice() || [];\n        if (targetAreas.length) {\n          targetAreas = targetAreas.filter((area) =>\n            areaMeetsTargetSelector(\n              this.hass,\n              this.hass.entities,\n              this.hass.devices,\n              area,\n              targetSelector\n            )\n          );\n        }\n        if (targetDevices.length) {\n          targetDevices = targetDevices.filter((device) =>\n            deviceMeetsTargetSelector(\n              this.hass,\n              Object.values(this.hass.entities),\n              this.hass.devices[device],\n              targetSelector\n            )\n          );\n        }\n        if (targetEntities.length) {\n          targetEntities = targetEntities.filter((entity) =>\n            entityMeetsTargetSelector(this.hass.states[entity], targetSelector)\n          );\n        }\n        target = {\n          ...(targetEntities.length ? { entity_id: targetEntities } : {}),\n          ...(targetDevices.length ? { device_id: targetDevices } : {}),\n          ...(targetAreas.length ? { area_id: targetAreas } : {}),\n        };\n      }\n    }\n\n    const value = {\n      service: newService,\n      target,\n    };\n\n    fireEvent(this, \"value-changed\", {\n      value,\n    });\n  }\n\n  private _entityPicked(ev: CustomEvent) {\n    ev.stopPropagation();\n    const newValue = ev.detail.value;\n    if (this._value?.data?.entity_id === newValue) {\n      return;\n    }\n    let value;\n    if (!newValue && this._value?.data) {\n      value = { ...this._value };\n      delete value.data.entity_id;\n    } else {\n      value = {\n        ...this._value,\n        data: { ...this._value?.data, entity_id: ev.detail.value },\n      };\n    }\n    fireEvent(this, \"value-changed\", {\n      value,\n    });\n  }\n\n  private _targetChanged(ev: CustomEvent) {\n    ev.stopPropagation();\n    const newValue = ev.detail.value;\n    if (this._value?.target === newValue) {\n      return;\n    }\n    let value;\n    if (!newValue) {\n      value = { ...this._value };\n      delete value.target;\n    } else {\n      value = { ...this._value, target: ev.detail.value };\n    }\n    fireEvent(this, \"value-changed\", {\n      value,\n    });\n  }\n\n  private _serviceDataChanged(ev: CustomEvent) {\n    ev.stopPropagation();\n    const key = (ev.currentTarget as any).key;\n    const value = ev.detail.value;\n    if (\n      this._value?.data?.[key] === value ||\n      (!this._value?.data?.[key] && (value === \"\" || value === undefined))\n    ) {\n      return;\n    }\n\n    const data = { ...this._value?.data, [key]: value };\n\n    if (value === \"\" || value === undefined) {\n      delete data[key];\n    }\n\n    fireEvent(this, \"value-changed\", {\n      value: {\n        ...this._value,\n        data,\n      },\n    });\n  }\n\n  private _itemMoved(ev) {\n    ev.stopPropagation();\n    const { oldIndex, newIndex, oldPath, newPath } = ev.detail;\n\n    const data = this.value?.data ?? {};\n\n    const newData = nestedArrayMove(data, oldIndex, newIndex, oldPath, newPath);\n\n    fireEvent(this, \"value-changed\", {\n      value: {\n        ...this.value,\n        data: newData,\n      },\n    });\n  }\n\n  private _dataChanged(ev: CustomEvent) {\n    ev.stopPropagation();\n    if (!ev.detail.isValid) {\n      return;\n    }\n    fireEvent(this, \"value-changed\", {\n      value: {\n        ...this._value,\n        data: ev.detail.value,\n      },\n    });\n  }\n\n  private async _fetchManifest(integration: string) {\n    this._manifest = undefined;\n    try {\n      this._manifest = await fetchIntegrationManifest(this.hass, integration);\n    } catch (err: any) {\n      // Ignore if loading manifest fails. Probably bad JSON in manifest\n    }\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      ha-settings-row {\n        padding: var(--service-control-padding, 0 16px);\n      }\n      ha-settings-row {\n        --paper-time-input-justify-content: flex-end;\n        --settings-row-content-width: 100%;\n        --settings-row-prefix-display: contents;\n        border-top: var(\n          --service-control-items-border-top,\n          1px solid var(--divider-color)\n        );\n      }\n      ha-service-picker,\n      ha-entity-picker,\n      ha-yaml-editor {\n        display: block;\n        margin: var(--service-control-padding, 0 16px);\n      }\n      ha-yaml-editor {\n        padding: 16px 0;\n      }\n      p {\n        margin: var(--service-control-padding, 0 16px);\n        padding: 16px 0;\n      }\n      :host([hidePicker]) p {\n        padding-top: 0;\n      }\n      .checkbox-spacer {\n        width: 32px;\n      }\n      ha-checkbox {\n        margin-left: -16px;\n        margin-inline-start: -16px;\n        margin-inline-end: initial;\n      }\n      .help-icon {\n        color: var(--secondary-text-color);\n      }\n      .description {\n        justify-content: space-between;\n        display: flex;\n        align-items: center;\n        padding-right: 2px;\n        padding-inline-end: 2px;\n        padding-inline-start: initial;\n      }\n      .description p {\n        direction: ltr;\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-service-control\": HaServiceControl;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}