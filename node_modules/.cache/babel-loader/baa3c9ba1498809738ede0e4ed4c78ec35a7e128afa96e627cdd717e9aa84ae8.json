{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/helpers/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _callSuper from \"@babel/runtime/helpers/callSuper\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _decorate from \"@babel/runtime/helpers/decorate\";\nimport _get from \"@babel/runtime/helpers/get\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6;\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.filter.js\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { classMap } from \"lit/directives/class-map\";\nimport { styleMap } from \"lit/directives/style-map\";\nimport { STATES_OFF } from \"../../../common/const\";\nimport { computeDomain } from \"../../../common/entity/compute_domain\";\nimport parseAspectRatio from \"../../../common/util/parse-aspect-ratio\";\nimport \"../../../components/ha-camera-stream\";\nimport \"../../../components/ha-circular-progress\";\nimport { fetchThumbnailUrlWithCache } from \"../../../data/camera\";\nimport { UNAVAILABLE } from \"../../../data/entity\";\nimport { computeImageUrl } from \"../../../data/image\";\nvar UPDATE_INTERVAL = 10000;\nvar DEFAULT_FILTER = \"grayscale(100%)\";\nvar MAX_IMAGE_WIDTH = 640;\nvar ASPECT_RATIO_DEFAULT = 9 / 16;\nvar LoadState = /*#__PURE__*/function (LoadState) {\n  LoadState[LoadState[\"Loading\"] = 1] = \"Loading\";\n  LoadState[LoadState[\"Loaded\"] = 2] = \"Loaded\";\n  LoadState[LoadState[\"Error\"] = 3] = \"Error\";\n  return LoadState;\n}(LoadState || {});\nexport var HuiImage = _decorate([customElement(\"hui-image\")], function (_initialize, _LitElement) {\n  var HuiImage = /*#__PURE__*/function (_LitElement2) {\n    _inherits(HuiImage, _LitElement2);\n    function HuiImage() {\n      var _this;\n      _classCallCheck(this, HuiImage);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _callSuper(this, HuiImage, [].concat(args));\n      _initialize(_assertThisInitialized(_this));\n      return _this;\n    }\n    return _createClass(HuiImage);\n  }(_LitElement);\n  return {\n    F: HuiImage,\n    d: [{\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"entity\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"image\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"stateImage\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"cameraImage\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"cameraView\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"aspectRatio\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"filter\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"stateFilter\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"darkModeImage\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"darkModeFilter\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"fitMode\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_imageVisible\",\n      value: function value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_loadState\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_cameraImageSrc\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_loadedImageSrc\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_lastImageHeight\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      key: \"_intersectionObserver\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      key: \"_cameraUpdater\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      key: \"_ratio\",\n      value: function value() {\n        return null;\n      }\n    }, {\n      kind: \"method\",\n      key: \"connectedCallback\",\n      value: function connectedCallback() {\n        _get(_getPrototypeOf(HuiImage.prototype), \"connectedCallback\", this).call(this);\n        if (this._loadState === undefined) {\n          this._loadState = LoadState.Loading;\n        }\n        if (this.cameraImage && this.cameraView !== \"live\") {\n          this._startIntersectionObserverOrUpdates();\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"disconnectedCallback\",\n      value: function disconnectedCallback() {\n        _get(_getPrototypeOf(HuiImage.prototype), \"disconnectedCallback\", this).call(this);\n        this._stopUpdateCameraInterval();\n        this._stopIntersectionObserver();\n        this._imageVisible = undefined;\n      }\n    }, {\n      kind: \"method\",\n      key: \"handleIntersectionCallback\",\n      value: function handleIntersectionCallback(entries) {\n        this._imageVisible = entries[0].isIntersecting;\n      }\n    }, {\n      kind: \"method\",\n      key: \"willUpdate\",\n      value: function willUpdate(changedProps) {\n        if (changedProps.has(\"hass\")) {\n          var oldHass = changedProps.get(\"hass\");\n          if (this._shouldStartCameraUpdates(oldHass)) {\n            this._startIntersectionObserverOrUpdates();\n          } else if (!this.hass.connected) {\n            this._stopUpdateCameraInterval();\n            this._stopIntersectionObserver();\n            this._loadState = LoadState.Loading;\n            this._cameraImageSrc = undefined;\n            this._loadedImageSrc = undefined;\n          }\n        }\n        if (changedProps.has(\"_imageVisible\")) {\n          if (this._imageVisible) {\n            if (this._shouldStartCameraUpdates()) {\n              this._startUpdateCameraInterval();\n            }\n          } else {\n            this._stopUpdateCameraInterval();\n          }\n        }\n        if (changedProps.has(\"aspectRatio\")) {\n          this._ratio = this.aspectRatio ? parseAspectRatio(this.aspectRatio) : null;\n        }\n        if (this._loadState === LoadState.Loading && !this.cameraImage) {\n          this._loadState = LoadState.Loaded;\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"render\",\n      value: function render() {\n        if (!this.hass) {\n          return nothing;\n        }\n        var useRatio = Boolean(this._ratio && this._ratio.w > 0 && this._ratio.h > 0);\n        var stateObj = this.entity ? this.hass.states[this.entity] : undefined;\n        var entityState = stateObj ? stateObj.state : UNAVAILABLE;\n\n        // Figure out image source to use\n        var imageSrc;\n        var cameraObj;\n        // Track if we are we using a fallback image, used for filter.\n        var imageFallback = !this.stateImage;\n        if (this.cameraImage) {\n          if (this.cameraView === \"live\") {\n            cameraObj = this.hass.states[this.cameraImage];\n          } else {\n            imageSrc = this._cameraImageSrc;\n          }\n        } else if (this.stateImage) {\n          var stateImage = this.stateImage[entityState];\n          if (stateImage) {\n            imageSrc = stateImage;\n          } else {\n            imageSrc = this.image;\n            imageFallback = true;\n          }\n        } else if (this.darkModeImage && this.hass.themes.darkMode) {\n          imageSrc = this.darkModeImage;\n        } else if (stateObj && computeDomain(stateObj.entity_id) === \"image\") {\n          imageSrc = computeImageUrl(stateObj);\n        } else {\n          imageSrc = this.image;\n        }\n        if (imageSrc) {\n          imageSrc = this.hass.hassUrl(imageSrc);\n        }\n\n        // Figure out filter to use\n        var filter = this.filter || \"\";\n        if (this.hass.themes.darkMode && this.darkModeFilter) {\n          filter += this.darkModeFilter;\n        }\n        if (this.stateFilter && this.stateFilter[entityState]) {\n          filter += this.stateFilter[entityState];\n        }\n        if (!filter && this.entity) {\n          var isOff = !stateObj || STATES_OFF.includes(entityState);\n          filter = isOff && imageFallback ? DEFAULT_FILTER : \"\";\n        }\n        return html(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n      <div\\n        style=\", \"\\n        class=\\\"container \", \"\\\"\\n      >\\n        \", \"\\n        \", \"\\n      </div>\\n    \"])), styleMap({\n          paddingBottom: useRatio ? \"\".concat((100 * this._ratio.h / this._ratio.w).toFixed(2), \"%\") : this._lastImageHeight === undefined ? \"56.25%\" : undefined,\n          backgroundImage: useRatio && this._loadedImageSrc ? \"url(\\\"\".concat(this._loadedImageSrc, \"\\\")\") : undefined,\n          filter: this._loadState === LoadState.Loaded || this.cameraView === \"live\" ? filter : undefined\n        }), classMap({\n          ratio: useRatio || this._lastImageHeight === undefined,\n          contain: this.fitMode === \"contain\",\n          fill: this.fitMode === \"fill\"\n        }), this.cameraImage && this.cameraView === \"live\" ? html(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\\n              <ha-camera-stream\\n                muted\\n                .hass=\", \"\\n                .stateObj=\", \"\\n                @load=\", \"\\n              ></ha-camera-stream>\\n            \"])), this.hass, cameraObj, this._onVideoLoad) : imageSrc === undefined ? nothing : html(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\\n                <img\\n                  id=\\\"image\\\"\\n                  src=\", \"\\n                  @error=\", \"\\n                  @load=\", \"\\n                  style=\", \"\\n                />\\n              \"])), imageSrc, this._onImageError, this._onImageLoad, styleMap({\n          display: useRatio || this._loadState === LoadState.Loaded ? \"block\" : \"none\"\n        })), this._loadState === LoadState.Error ? html(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"<div\\n              id=\\\"brokenImage\\\"\\n              style=\", \"\\n            ></div>\"])), styleMap({\n          height: !useRatio ? \"\".concat(this._lastImageHeight, \"px\") || \"100%\" : undefined\n        })) : this.cameraView !== \"live\" && (imageSrc === undefined || this._loadState === LoadState.Loading) ? html(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"<div\\n                class=\\\"progress-container\\\"\\n                style=\", \"\\n              >\\n                <ha-circular-progress\\n                  class=\\\"render-spinner\\\"\\n                  indeterminate\\n                  size=\\\"small\\\"\\n                ></ha-circular-progress>\\n              </div>\"])), styleMap({\n          height: !useRatio ? \"\".concat(this._lastImageHeight, \"px\") || \"100%\" : undefined\n        })) : \"\");\n      }\n    }, {\n      kind: \"method\",\n      key: \"_shouldStartCameraUpdates\",\n      value: function _shouldStartCameraUpdates(oldHass) {\n        return !!((!oldHass || oldHass.connected !== this.hass.connected) && this.hass.connected && this.cameraView !== \"live\");\n      }\n    }, {\n      kind: \"method\",\n      key: \"_startIntersectionObserverOrUpdates\",\n      value: function _startIntersectionObserverOrUpdates() {\n        if (\"IntersectionObserver\" in window) {\n          if (!this._intersectionObserver) {\n            this._intersectionObserver = new IntersectionObserver(this.handleIntersectionCallback.bind(this));\n          }\n          this._intersectionObserver.observe(this);\n        } else {\n          // No support for IntersectionObserver\n          // assume all images are visible\n          this._imageVisible = true;\n          this._startUpdateCameraInterval();\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"_stopIntersectionObserver\",\n      value: function _stopIntersectionObserver() {\n        if (this._intersectionObserver) {\n          this._intersectionObserver.disconnect();\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"_startUpdateCameraInterval\",\n      value: function _startUpdateCameraInterval() {\n        var _this2 = this;\n        this._stopUpdateCameraInterval();\n        this._updateCameraImageSrc();\n        if (this.cameraImage && this.isConnected) {\n          this._cameraUpdater = window.setInterval(function () {\n            return _this2._updateCameraImageSrcAtInterval();\n          }, UPDATE_INTERVAL);\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"_stopUpdateCameraInterval\",\n      value: function _stopUpdateCameraInterval() {\n        if (this._cameraUpdater) {\n          clearInterval(this._cameraUpdater);\n          this._cameraUpdater = undefined;\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"_onImageError\",\n      value: function _onImageError() {\n        this._loadState = LoadState.Error;\n      }\n    }, {\n      kind: \"method\",\n      key: \"_onImageLoad\",\n      value: function () {\n        var _onImageLoad2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(ev) {\n          var imgEl;\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                this._loadState = LoadState.Loaded;\n                imgEl = ev.target;\n                if (this._ratio && this._ratio.w > 0 && this._ratio.h > 0) {\n                  this._loadedImageSrc = imgEl.src;\n                }\n                _context.next = 5;\n                return this.updateComplete;\n              case 5:\n                this._lastImageHeight = imgEl.offsetHeight;\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }, _callee, this);\n        }));\n        function _onImageLoad(_x) {\n          return _onImageLoad2.apply(this, arguments);\n        }\n        return _onImageLoad;\n      }()\n    }, {\n      kind: \"method\",\n      key: \"_onVideoLoad\",\n      value: function () {\n        var _onVideoLoad2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(ev) {\n          var videoEl;\n          return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n            while (1) switch (_context2.prev = _context2.next) {\n              case 0:\n                this._loadState = LoadState.Loaded;\n                videoEl = ev.currentTarget;\n                _context2.next = 4;\n                return this.updateComplete;\n              case 4:\n                this._lastImageHeight = videoEl.offsetHeight;\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }, _callee2, this);\n        }));\n        function _onVideoLoad(_x2) {\n          return _onVideoLoad2.apply(this, arguments);\n        }\n        return _onVideoLoad;\n      }()\n    }, {\n      kind: \"method\",\n      key: \"_updateCameraImageSrcAtInterval\",\n      value: function () {\n        var _updateCameraImageSrcAtInterval2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n          return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n            while (1) switch (_context3.prev = _context3.next) {\n              case 0:\n                // If we hit the interval and it was still loading\n                // it means we timed out so we should show the error.\n                if (this._loadState === LoadState.Loading) {\n                  this._onImageError();\n                }\n                return _context3.abrupt(\"return\", this._updateCameraImageSrc());\n              case 2:\n              case \"end\":\n                return _context3.stop();\n            }\n          }, _callee3, this);\n        }));\n        function _updateCameraImageSrcAtInterval() {\n          return _updateCameraImageSrcAtInterval2.apply(this, arguments);\n        }\n        return _updateCameraImageSrcAtInterval;\n      }()\n    }, {\n      kind: \"method\",\n      key: \"_updateCameraImageSrc\",\n      value: function () {\n        var _updateCameraImageSrc2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n          var cameraState, element_width, width, height;\n          return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n            while (1) switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!(!this.hass || !this.cameraImage)) {\n                  _context4.next = 2;\n                  break;\n                }\n                return _context4.abrupt(\"return\");\n              case 2:\n                cameraState = this.hass.states[this.cameraImage];\n                if (cameraState) {\n                  _context4.next = 6;\n                  break;\n                }\n                this._onImageError();\n                return _context4.abrupt(\"return\");\n              case 6:\n                element_width = this.clientWidth || MAX_IMAGE_WIDTH;\n                width = Math.ceil(element_width * devicePixelRatio);\n                // If the image has not rendered yet we have no height\n                if (!this._lastImageHeight) {\n                  if (this._ratio && this._ratio.w > 0 && this._ratio.h > 0) {\n                    height = Math.ceil(width * (this._ratio.h / this._ratio.w));\n                  } else {\n                    // If we don't have a ratio and we don't have a height\n                    // we ask for 200% of what we need because the aspect\n                    // ratio might result in a smaller image\n                    width *= 2;\n                    height = Math.ceil(width * ASPECT_RATIO_DEFAULT);\n                  }\n                } else {\n                  height = Math.ceil(this._lastImageHeight * devicePixelRatio);\n                }\n                _context4.next = 11;\n                return fetchThumbnailUrlWithCache(this.hass, this.cameraImage, width, height);\n              case 11:\n                this._cameraImageSrc = _context4.sent;\n                if (this._cameraImageSrc === undefined) {\n                  this._onImageError();\n                }\n              case 13:\n              case \"end\":\n                return _context4.stop();\n            }\n          }, _callee4, this);\n        }));\n        function _updateCameraImageSrc() {\n          return _updateCameraImageSrc2.apply(this, arguments);\n        }\n        return _updateCameraImageSrc;\n      }()\n    }, {\n      kind: \"get\",\n      static: true,\n      key: \"styles\",\n      value: function styles() {\n        return css(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"\\n      :host {\\n        display: block;\\n      }\\n\\n      .container {\\n        transition: filter 0.2s linear;\\n        height: 100%;\\n      }\\n\\n      img {\\n        display: block;\\n        height: 100%;\\n        width: 100%;\\n        object-fit: cover;\\n      }\\n\\n      .progress-container {\\n        display: flex;\\n        justify-content: center;\\n        align-items: center;\\n      }\\n\\n      .ratio {\\n        position: relative;\\n        width: 100%;\\n        height: 0;\\n        background-position: center;\\n        background-size: cover;\\n      }\\n      .ratio.fill {\\n        background-size: 100% 100%;\\n      }\\n      .ratio.contain {\\n        background-size: contain;\\n        background-repeat: no-repeat;\\n      }\\n      .fill img {\\n        object-fit: fill;\\n      }\\n      .contain img {\\n        object-fit: contain;\\n      }\\n\\n      .ratio img,\\n      .ratio div {\\n        position: absolute;\\n        top: 0;\\n        left: 0;\\n        width: 100%;\\n        height: 100%;\\n      }\\n\\n      .ratio img {\\n        visibility: hidden;\\n      }\\n\\n      #brokenImage {\\n        background: grey url(\\\"/static/images/image-broken.svg\\\") center/36px\\n          no-repeat;\\n      }\\n    \"])));\n      }\n    }]\n  };\n}, LitElement);","map":{"version":3,"names":["css","html","LitElement","nothing","customElement","property","state","classMap","styleMap","STATES_OFF","computeDomain","parseAspectRatio","fetchThumbnailUrlWithCache","UNAVAILABLE","computeImageUrl","UPDATE_INTERVAL","DEFAULT_FILTER","MAX_IMAGE_WIDTH","ASPECT_RATIO_DEFAULT","LoadState","HuiImage","_decorate","_initialize","_LitElement","_LitElement2","_inherits","_this","_classCallCheck","_len","arguments","length","args","Array","_key","_callSuper","concat","_assertThisInitialized","_createClass","F","d","kind","decorators","attribute","key","value","connectedCallback","_get","_getPrototypeOf","prototype","call","_loadState","undefined","Loading","cameraImage","cameraView","_startIntersectionObserverOrUpdates","disconnectedCallback","_stopUpdateCameraInterval","_stopIntersectionObserver","_imageVisible","handleIntersectionCallback","entries","isIntersecting","willUpdate","changedProps","has","oldHass","get","_shouldStartCameraUpdates","hass","connected","_cameraImageSrc","_loadedImageSrc","_startUpdateCameraInterval","_ratio","aspectRatio","Loaded","render","useRatio","Boolean","w","h","stateObj","entity","states","entityState","imageSrc","cameraObj","imageFallback","stateImage","image","darkModeImage","themes","darkMode","entity_id","hassUrl","filter","darkModeFilter","stateFilter","isOff","includes","_templateObject","_taggedTemplateLiteral","paddingBottom","toFixed","_lastImageHeight","backgroundImage","ratio","contain","fitMode","fill","_templateObject2","_onVideoLoad","_templateObject3","_onImageError","_onImageLoad","display","Error","_templateObject4","height","_templateObject5","window","_intersectionObserver","IntersectionObserver","bind","observe","disconnect","_this2","_updateCameraImageSrc","isConnected","_cameraUpdater","setInterval","_updateCameraImageSrcAtInterval","clearInterval","_onImageLoad2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","ev","imgEl","wrap","_callee$","_context","prev","next","target","src","updateComplete","offsetHeight","stop","_x","apply","_onVideoLoad2","_callee2","videoEl","_callee2$","_context2","currentTarget","_x2","_updateCameraImageSrcAtInterval2","_callee3","_callee3$","_context3","abrupt","_updateCameraImageSrc2","_callee4","cameraState","element_width","width","_callee4$","_context4","clientWidth","Math","ceil","devicePixelRatio","sent","static","styles","_templateObject6"],"sources":["/workspaces/frontend/src/panels/lovelace/components/hui-image.ts"],"sourcesContent":["import {\n  css,\n  CSSResultGroup,\n  html,\n  LitElement,\n  PropertyValues,\n  nothing,\n} from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { classMap } from \"lit/directives/class-map\";\nimport { styleMap } from \"lit/directives/style-map\";\nimport { STATES_OFF } from \"../../../common/const\";\nimport { computeDomain } from \"../../../common/entity/compute_domain\";\nimport parseAspectRatio from \"../../../common/util/parse-aspect-ratio\";\nimport \"../../../components/ha-camera-stream\";\nimport type { HaCameraStream } from \"../../../components/ha-camera-stream\";\nimport \"../../../components/ha-circular-progress\";\nimport { CameraEntity, fetchThumbnailUrlWithCache } from \"../../../data/camera\";\nimport { UNAVAILABLE } from \"../../../data/entity\";\nimport { computeImageUrl, ImageEntity } from \"../../../data/image\";\nimport { HomeAssistant } from \"../../../types\";\n\nconst UPDATE_INTERVAL = 10000;\nconst DEFAULT_FILTER = \"grayscale(100%)\";\n\nconst MAX_IMAGE_WIDTH = 640;\nconst ASPECT_RATIO_DEFAULT = 9 / 16;\n\nconst enum LoadState {\n  Loading = 1,\n  Loaded = 2,\n  Error = 3,\n}\n\nexport interface StateSpecificConfig {\n  [state: string]: string;\n}\n\n@customElement(\"hui-image\")\nexport class HuiImage extends LitElement {\n  @property({ attribute: false }) public hass?: HomeAssistant;\n\n  @property() public entity?: string;\n\n  @property() public image?: string;\n\n  @property({ attribute: false }) public stateImage?: StateSpecificConfig;\n\n  @property() public cameraImage?: string;\n\n  @property() public cameraView?: \"live\" | \"auto\";\n\n  @property() public aspectRatio?: string;\n\n  @property() public filter?: string;\n\n  @property({ attribute: false }) public stateFilter?: StateSpecificConfig;\n\n  @property() public darkModeImage?: string;\n\n  @property() public darkModeFilter?: string;\n\n  @property() public fitMode?: \"cover\" | \"contain\" | \"fill\";\n\n  @state() private _imageVisible? = false;\n\n  @state() private _loadState?: LoadState;\n\n  @state() private _cameraImageSrc?: string;\n\n  @state() private _loadedImageSrc?: string;\n\n  @state() private _lastImageHeight?: number;\n\n  private _intersectionObserver?: IntersectionObserver;\n\n  private _cameraUpdater?: number;\n\n  private _ratio: {\n    w: number;\n    h: number;\n  } | null = null;\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n    if (this._loadState === undefined) {\n      this._loadState = LoadState.Loading;\n    }\n    if (this.cameraImage && this.cameraView !== \"live\") {\n      this._startIntersectionObserverOrUpdates();\n    }\n  }\n\n  public disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this._stopUpdateCameraInterval();\n    this._stopIntersectionObserver();\n    this._imageVisible = undefined;\n  }\n\n  protected handleIntersectionCallback(entries: IntersectionObserverEntry[]) {\n    this._imageVisible = entries[0].isIntersecting;\n  }\n\n  public willUpdate(changedProps: PropertyValues): void {\n    if (changedProps.has(\"hass\")) {\n      const oldHass = changedProps.get(\"hass\") as HomeAssistant | undefined;\n\n      if (this._shouldStartCameraUpdates(oldHass)) {\n        this._startIntersectionObserverOrUpdates();\n      } else if (!this.hass!.connected) {\n        this._stopUpdateCameraInterval();\n        this._stopIntersectionObserver();\n        this._loadState = LoadState.Loading;\n        this._cameraImageSrc = undefined;\n        this._loadedImageSrc = undefined;\n      }\n    }\n    if (changedProps.has(\"_imageVisible\")) {\n      if (this._imageVisible) {\n        if (this._shouldStartCameraUpdates()) {\n          this._startUpdateCameraInterval();\n        }\n      } else {\n        this._stopUpdateCameraInterval();\n      }\n    }\n    if (changedProps.has(\"aspectRatio\")) {\n      this._ratio = this.aspectRatio\n        ? parseAspectRatio(this.aspectRatio)\n        : null;\n    }\n    if (this._loadState === LoadState.Loading && !this.cameraImage) {\n      this._loadState = LoadState.Loaded;\n    }\n  }\n\n  protected render() {\n    if (!this.hass) {\n      return nothing;\n    }\n    const useRatio = Boolean(\n      this._ratio && this._ratio.w > 0 && this._ratio.h > 0\n    );\n    const stateObj = this.entity ? this.hass.states[this.entity] : undefined;\n    const entityState = stateObj ? stateObj.state : UNAVAILABLE;\n\n    // Figure out image source to use\n    let imageSrc: string | undefined;\n    let cameraObj: CameraEntity | undefined;\n    // Track if we are we using a fallback image, used for filter.\n    let imageFallback = !this.stateImage;\n\n    if (this.cameraImage) {\n      if (this.cameraView === \"live\") {\n        cameraObj = this.hass.states[this.cameraImage] as CameraEntity;\n      } else {\n        imageSrc = this._cameraImageSrc;\n      }\n    } else if (this.stateImage) {\n      const stateImage = this.stateImage[entityState];\n\n      if (stateImage) {\n        imageSrc = stateImage;\n      } else {\n        imageSrc = this.image;\n        imageFallback = true;\n      }\n    } else if (this.darkModeImage && this.hass.themes.darkMode) {\n      imageSrc = this.darkModeImage;\n    } else if (stateObj && computeDomain(stateObj.entity_id) === \"image\") {\n      imageSrc = computeImageUrl(stateObj as ImageEntity);\n    } else {\n      imageSrc = this.image;\n    }\n\n    if (imageSrc) {\n      imageSrc = this.hass.hassUrl(imageSrc);\n    }\n\n    // Figure out filter to use\n    let filter = this.filter || \"\";\n\n    if (this.hass.themes.darkMode && this.darkModeFilter) {\n      filter += this.darkModeFilter;\n    }\n\n    if (this.stateFilter && this.stateFilter[entityState]) {\n      filter += this.stateFilter[entityState];\n    }\n\n    if (!filter && this.entity) {\n      const isOff = !stateObj || STATES_OFF.includes(entityState);\n      filter = isOff && imageFallback ? DEFAULT_FILTER : \"\";\n    }\n\n    return html`\n      <div\n        style=${styleMap({\n          paddingBottom: useRatio\n            ? `${((100 * this._ratio!.h) / this._ratio!.w).toFixed(2)}%`\n            : this._lastImageHeight === undefined\n              ? \"56.25%\"\n              : undefined,\n          backgroundImage:\n            useRatio && this._loadedImageSrc\n              ? `url(\"${this._loadedImageSrc}\")`\n              : undefined,\n          filter:\n            this._loadState === LoadState.Loaded || this.cameraView === \"live\"\n              ? filter\n              : undefined,\n        })}\n        class=\"container ${classMap({\n          ratio: useRatio || this._lastImageHeight === undefined,\n          contain: this.fitMode === \"contain\",\n          fill: this.fitMode === \"fill\",\n        })}\"\n      >\n        ${this.cameraImage && this.cameraView === \"live\"\n          ? html`\n              <ha-camera-stream\n                muted\n                .hass=${this.hass}\n                .stateObj=${cameraObj}\n                @load=${this._onVideoLoad}\n              ></ha-camera-stream>\n            `\n          : imageSrc === undefined\n            ? nothing\n            : html`\n                <img\n                  id=\"image\"\n                  src=${imageSrc}\n                  @error=${this._onImageError}\n                  @load=${this._onImageLoad}\n                  style=${styleMap({\n                    display:\n                      useRatio || this._loadState === LoadState.Loaded\n                        ? \"block\"\n                        : \"none\",\n                  })}\n                />\n              `}\n        ${this._loadState === LoadState.Error\n          ? html`<div\n              id=\"brokenImage\"\n              style=${styleMap({\n                height: !useRatio\n                  ? `${this._lastImageHeight}px` || \"100%\"\n                  : undefined,\n              })}\n            ></div>`\n          : this.cameraView !== \"live\" &&\n              (imageSrc === undefined || this._loadState === LoadState.Loading)\n            ? html`<div\n                class=\"progress-container\"\n                style=${styleMap({\n                  height: !useRatio\n                    ? `${this._lastImageHeight}px` || \"100%\"\n                    : undefined,\n                })}\n              >\n                <ha-circular-progress\n                  class=\"render-spinner\"\n                  indeterminate\n                  size=\"small\"\n                ></ha-circular-progress>\n              </div>`\n            : \"\"}\n      </div>\n    `;\n  }\n\n  protected _shouldStartCameraUpdates(oldHass?: HomeAssistant): boolean {\n    return !!(\n      (!oldHass || oldHass.connected !== this.hass!.connected) &&\n      this.hass!.connected &&\n      this.cameraView !== \"live\"\n    );\n  }\n\n  private _startIntersectionObserverOrUpdates(): void {\n    if (\"IntersectionObserver\" in window) {\n      if (!this._intersectionObserver) {\n        this._intersectionObserver = new IntersectionObserver(\n          this.handleIntersectionCallback.bind(this)\n        );\n      }\n      this._intersectionObserver.observe(this);\n    } else {\n      // No support for IntersectionObserver\n      // assume all images are visible\n      this._imageVisible = true;\n      this._startUpdateCameraInterval();\n    }\n  }\n\n  private _stopIntersectionObserver(): void {\n    if (this._intersectionObserver) {\n      this._intersectionObserver.disconnect();\n    }\n  }\n\n  private _startUpdateCameraInterval(): void {\n    this._stopUpdateCameraInterval();\n    this._updateCameraImageSrc();\n    if (this.cameraImage && this.isConnected) {\n      this._cameraUpdater = window.setInterval(\n        () => this._updateCameraImageSrcAtInterval(),\n        UPDATE_INTERVAL\n      );\n    }\n  }\n\n  private _stopUpdateCameraInterval(): void {\n    if (this._cameraUpdater) {\n      clearInterval(this._cameraUpdater);\n      this._cameraUpdater = undefined;\n    }\n  }\n\n  private _onImageError(): void {\n    this._loadState = LoadState.Error;\n  }\n\n  private async _onImageLoad(ev: Event): Promise<void> {\n    this._loadState = LoadState.Loaded;\n    const imgEl = ev.target as HTMLImageElement;\n    if (this._ratio && this._ratio.w > 0 && this._ratio.h > 0) {\n      this._loadedImageSrc = imgEl.src;\n    }\n    await this.updateComplete;\n    this._lastImageHeight = imgEl.offsetHeight;\n  }\n\n  private async _onVideoLoad(ev: Event): Promise<void> {\n    this._loadState = LoadState.Loaded;\n    const videoEl = ev.currentTarget as HaCameraStream;\n    await this.updateComplete;\n    this._lastImageHeight = videoEl.offsetHeight;\n  }\n\n  private async _updateCameraImageSrcAtInterval(): Promise<void> {\n    // If we hit the interval and it was still loading\n    // it means we timed out so we should show the error.\n    if (this._loadState === LoadState.Loading) {\n      this._onImageError();\n    }\n    return this._updateCameraImageSrc();\n  }\n\n  private async _updateCameraImageSrc(): Promise<void> {\n    if (!this.hass || !this.cameraImage) {\n      return;\n    }\n\n    const cameraState = this.hass.states[this.cameraImage] as\n      | CameraEntity\n      | undefined;\n\n    if (!cameraState) {\n      this._onImageError();\n      return;\n    }\n\n    const element_width = this.clientWidth || MAX_IMAGE_WIDTH;\n    let width = Math.ceil(element_width * devicePixelRatio);\n    let height: number;\n    // If the image has not rendered yet we have no height\n    if (!this._lastImageHeight) {\n      if (this._ratio && this._ratio.w > 0 && this._ratio.h > 0) {\n        height = Math.ceil(width * (this._ratio.h / this._ratio.w));\n      } else {\n        // If we don't have a ratio and we don't have a height\n        // we ask for 200% of what we need because the aspect\n        // ratio might result in a smaller image\n        width *= 2;\n        height = Math.ceil(width * ASPECT_RATIO_DEFAULT);\n      }\n    } else {\n      height = Math.ceil(this._lastImageHeight * devicePixelRatio);\n    }\n    this._cameraImageSrc = await fetchThumbnailUrlWithCache(\n      this.hass,\n      this.cameraImage,\n      width,\n      height\n    );\n    if (this._cameraImageSrc === undefined) {\n      this._onImageError();\n    }\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      :host {\n        display: block;\n      }\n\n      .container {\n        transition: filter 0.2s linear;\n        height: 100%;\n      }\n\n      img {\n        display: block;\n        height: 100%;\n        width: 100%;\n        object-fit: cover;\n      }\n\n      .progress-container {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n      }\n\n      .ratio {\n        position: relative;\n        width: 100%;\n        height: 0;\n        background-position: center;\n        background-size: cover;\n      }\n      .ratio.fill {\n        background-size: 100% 100%;\n      }\n      .ratio.contain {\n        background-size: contain;\n        background-repeat: no-repeat;\n      }\n      .fill img {\n        object-fit: fill;\n      }\n      .contain img {\n        object-fit: contain;\n      }\n\n      .ratio img,\n      .ratio div {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n      }\n\n      .ratio img {\n        visibility: hidden;\n      }\n\n      #brokenImage {\n        background: grey url(\"/static/images/image-broken.svg\") center/36px\n          no-repeat;\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"hui-image\": HuiImage;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}