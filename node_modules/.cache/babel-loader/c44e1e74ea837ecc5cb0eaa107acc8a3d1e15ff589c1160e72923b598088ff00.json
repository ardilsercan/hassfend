{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/helpers/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _callSuper from \"@babel/runtime/helpers/callSuper\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\nvar _templateObject;\nimport \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.json.stringify.js\";\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nimport { html, noChange } from 'lit';\nimport { directive, PartType } from 'lit/directive.js';\nimport { AsyncDirective } from 'lit/async-directive.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { Virtualizer } from './Virtualizer.js';\nexport { virtualizerRef } from './Virtualizer.js';\nexport var defaultKeyFunction = function defaultKeyFunction(item) {\n  return item;\n};\nexport var defaultRenderItem = function defaultRenderItem(item, idx) {\n  return html(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\", \": \", \"\"])), idx, JSON.stringify(item, null, 2));\n};\nvar VirtualizeDirective = /*#__PURE__*/function (_AsyncDirective) {\n  _inherits(VirtualizeDirective, _AsyncDirective);\n  function VirtualizeDirective(part) {\n    var _this;\n    _classCallCheck(this, VirtualizeDirective);\n    _this = _callSuper(this, VirtualizeDirective, [part]);\n    _this._virtualizer = null;\n    _this._first = 0;\n    _this._last = -1;\n    _this._renderItem = function (item, idx) {\n      return defaultRenderItem(item, idx + _this._first);\n    };\n    _this._keyFunction = function (item, idx) {\n      return defaultKeyFunction(item, idx + _this._first);\n    };\n    _this._items = [];\n    if (part.type !== PartType.CHILD) {\n      throw new Error('The virtualize directive can only be used in child expressions');\n    }\n    return _this;\n  }\n  _createClass(VirtualizeDirective, [{\n    key: \"render\",\n    value: function render(config) {\n      if (config) {\n        this._setFunctions(config);\n      }\n      var itemsToRender = [];\n      if (this._first >= 0 && this._last >= this._first) {\n        for (var i = this._first; i <= this._last; i++) {\n          itemsToRender.push(this._items[i]);\n        }\n      }\n      return repeat(itemsToRender, this._keyFunction, this._renderItem);\n    }\n  }, {\n    key: \"update\",\n    value: function update(part, _ref) {\n      var _ref2 = _slicedToArray(_ref, 1),\n        config = _ref2[0];\n      this._setFunctions(config);\n      var itemsChanged = this._items !== config.items;\n      this._items = config.items || [];\n      if (this._virtualizer) {\n        this._updateVirtualizerConfig(part, config);\n      } else {\n        this._initialize(part, config);\n      }\n      return itemsChanged ? noChange : this.render();\n    }\n  }, {\n    key: \"_updateVirtualizerConfig\",\n    value: function () {\n      var _updateVirtualizerConfig2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(part, config) {\n        var compatible, hostElement;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return this._virtualizer.updateLayoutConfig(config.layout || {});\n            case 2:\n              compatible = _context.sent;\n              if (!compatible) {\n                hostElement = part.parentNode;\n                this._makeVirtualizer(hostElement, config);\n              }\n              this._virtualizer.items = this._items;\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function _updateVirtualizerConfig(_x, _x2) {\n        return _updateVirtualizerConfig2.apply(this, arguments);\n      }\n      return _updateVirtualizerConfig;\n    }()\n  }, {\n    key: \"_setFunctions\",\n    value: function _setFunctions(config) {\n      var _this2 = this;\n      var renderItem = config.renderItem,\n        keyFunction = config.keyFunction;\n      if (renderItem) {\n        this._renderItem = function (item, idx) {\n          return renderItem(item, idx + _this2._first);\n        };\n      }\n      if (keyFunction) {\n        this._keyFunction = function (item, idx) {\n          return keyFunction(item, idx + _this2._first);\n        };\n      }\n    }\n  }, {\n    key: \"_makeVirtualizer\",\n    value: function _makeVirtualizer(hostElement, config) {\n      if (this._virtualizer) {\n        this._virtualizer.disconnected();\n      }\n      var layout = config.layout,\n        scroller = config.scroller,\n        items = config.items;\n      this._virtualizer = new Virtualizer({\n        hostElement: hostElement,\n        layout: layout,\n        scroller: scroller\n      });\n      this._virtualizer.items = items;\n      this._virtualizer.connected();\n    }\n  }, {\n    key: \"_initialize\",\n    value: function _initialize(part, config) {\n      var _this3 = this;\n      var hostElement = part.parentNode;\n      if (hostElement && hostElement.nodeType === 1) {\n        hostElement.addEventListener('rangeChanged', function (e) {\n          _this3._first = e.first;\n          _this3._last = e.last;\n          _this3.setValue(_this3.render());\n        });\n        this._makeVirtualizer(hostElement, config);\n      }\n    }\n  }, {\n    key: \"disconnected\",\n    value: function disconnected() {\n      var _this$_virtualizer;\n      (_this$_virtualizer = this._virtualizer) === null || _this$_virtualizer === void 0 || _this$_virtualizer.disconnected();\n    }\n  }, {\n    key: \"reconnected\",\n    value: function reconnected() {\n      var _this$_virtualizer2;\n      (_this$_virtualizer2 = this._virtualizer) === null || _this$_virtualizer2 === void 0 || _this$_virtualizer2.connected();\n    }\n  }]);\n  return VirtualizeDirective;\n}(AsyncDirective);\nexport var virtualize = directive(VirtualizeDirective);","map":{"version":3,"names":["html","noChange","directive","PartType","AsyncDirective","repeat","Virtualizer","virtualizerRef","defaultKeyFunction","item","defaultRenderItem","idx","_templateObject","_taggedTemplateLiteral","JSON","stringify","VirtualizeDirective","_AsyncDirective","_inherits","part","_this","_classCallCheck","_callSuper","_virtualizer","_first","_last","_renderItem","_keyFunction","_items","type","CHILD","Error","_createClass","key","value","render","config","_setFunctions","itemsToRender","i","push","update","_ref","_ref2","_slicedToArray","itemsChanged","items","_updateVirtualizerConfig","_initialize","_updateVirtualizerConfig2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","compatible","hostElement","wrap","_callee$","_context","prev","next","updateLayoutConfig","layout","sent","parentNode","_makeVirtualizer","stop","_x","_x2","apply","arguments","_this2","renderItem","keyFunction","disconnected","scroller","connected","_this3","nodeType","addEventListener","e","first","last","setValue","_this$_virtualizer","reconnected","_this$_virtualizer2","virtualize"],"sources":["src/virtualize.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport {TemplateResult, ChildPart, html, noChange} from 'lit';\nimport {directive, DirectiveResult, PartInfo, PartType} from 'lit/directive.js';\nimport {AsyncDirective} from 'lit/async-directive.js';\nimport {repeat, KeyFn} from 'lit/directives/repeat.js';\nimport {Virtualizer} from './Virtualizer.js';\nimport {RangeChangedEvent} from './events.js';\nimport {LayoutConfigValue} from './layouts/shared/Layout.js';\n\nexport {virtualizerRef, VirtualizerHostElement} from './Virtualizer.js';\n\n/**\n * Configuration options for the virtualize directive.\n */\nexport interface VirtualizeDirectiveConfig<T> {\n  /**\n   * A function that returns a lit-html TemplateResult. It will be used\n   * to generate the DOM for each item in the virtual list.\n   */\n  renderItem?: RenderItemFunction<T>;\n\n  keyFunction?: KeyFn<T>;\n\n  scroller?: boolean;\n\n  // TODO (graynorton): Document...\n  layout?: LayoutConfigValue;\n\n  /**\n   * The list of items to display via the renderItem function.\n   */\n  items?: Array<T>;\n}\n\nexport type RenderItemFunction<T = unknown> = (\n  item: T,\n  index: number\n) => TemplateResult;\n\nexport const defaultKeyFunction: KeyFn<unknown> = (item: unknown) => item;\nexport const defaultRenderItem: RenderItemFunction<unknown> = (\n  item: unknown,\n  idx: number\n) => html`${idx}: ${JSON.stringify(item, null, 2)}`;\n\nclass VirtualizeDirective<T = unknown> extends AsyncDirective {\n  _virtualizer: Virtualizer | null = null;\n  _first = 0;\n  _last = -1;\n  _renderItem: RenderItemFunction<T> = (item: T, idx: number) =>\n    defaultRenderItem(item, idx + this._first);\n  _keyFunction: KeyFn<T> = (item: T, idx: number) =>\n    defaultKeyFunction(item, idx + this._first);\n  _items: Array<T> = [];\n\n  constructor(part: PartInfo) {\n    super(part);\n    if (part.type !== PartType.CHILD) {\n      throw new Error(\n        'The virtualize directive can only be used in child expressions'\n      );\n    }\n  }\n\n  render(config?: VirtualizeDirectiveConfig<T>) {\n    if (config) {\n      this._setFunctions(config);\n    }\n    const itemsToRender: Array<T> = [];\n\n    if (this._first >= 0 && this._last >= this._first) {\n      for (let i = this._first; i <= this._last; i++) {\n        itemsToRender.push(this._items[i]);\n      }\n    }\n    return repeat(itemsToRender, this._keyFunction, this._renderItem);\n  }\n\n  update(part: ChildPart, [config]: [VirtualizeDirectiveConfig<T>]) {\n    this._setFunctions(config);\n    const itemsChanged = this._items !== config.items;\n    this._items = config.items || [];\n    if (this._virtualizer) {\n      this._updateVirtualizerConfig(part, config);\n    } else {\n      this._initialize(part, config);\n    }\n    return itemsChanged ? noChange : this.render();\n  }\n\n  private async _updateVirtualizerConfig(\n    part: ChildPart,\n    config: VirtualizeDirectiveConfig<T>\n  ) {\n    const compatible = await this._virtualizer!.updateLayoutConfig(\n      config.layout || {}\n    );\n    if (!compatible) {\n      const hostElement = part.parentNode as HTMLElement;\n      this._makeVirtualizer(hostElement, config);\n    }\n    this._virtualizer!.items = this._items;\n  }\n\n  private _setFunctions(config: VirtualizeDirectiveConfig<T>) {\n    const {renderItem, keyFunction} = config;\n    if (renderItem) {\n      this._renderItem = (item, idx) => renderItem(item, idx + this._first);\n    }\n    if (keyFunction) {\n      this._keyFunction = (item, idx) => keyFunction(item, idx + this._first);\n    }\n  }\n\n  private _makeVirtualizer(\n    hostElement: HTMLElement,\n    config: VirtualizeDirectiveConfig<T>\n  ) {\n    if (this._virtualizer) {\n      this._virtualizer.disconnected();\n    }\n    const {layout, scroller, items} = config;\n    this._virtualizer = new Virtualizer({hostElement, layout, scroller});\n    this._virtualizer.items = items;\n    this._virtualizer.connected();\n  }\n\n  private _initialize(part: ChildPart, config: VirtualizeDirectiveConfig<T>) {\n    const hostElement = part.parentNode as HTMLElement;\n    if (hostElement && hostElement.nodeType === 1) {\n      hostElement.addEventListener('rangeChanged', (e: RangeChangedEvent) => {\n        this._first = e.first;\n        this._last = e.last;\n        this.setValue(this.render());\n      });\n      this._makeVirtualizer(hostElement, config);\n    }\n  }\n\n  disconnected() {\n    this._virtualizer?.disconnected();\n  }\n\n  reconnected() {\n    this._virtualizer?.connected();\n  }\n}\n\nexport const virtualize = directive(VirtualizeDirective) as <T>(\n  config?: VirtualizeDirectiveConfig<T>\n) => DirectiveResult<typeof VirtualizeDirective>;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}