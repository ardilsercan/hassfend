{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/helpers/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _callSuper from \"@babel/runtime/helpers/callSuper\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _decorate from \"@babel/runtime/helpers/decorate\";\nimport _get from \"@babel/runtime/helpers/get\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _templateObject;\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.function.name.js\";\nvar mdiFile = \"M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z\";\nimport { html, LitElement } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport { removeFile, uploadFile } from \"../../data/file_upload\";\nimport { showAlertDialog } from \"../../dialogs/generic/show-dialog-box\";\nimport \"../ha-file-upload\";\nexport var HaFileSelector = _decorate([customElement(\"ha-selector-file\")], function (_initialize, _LitElement) {\n  var HaFileSelector = /*#__PURE__*/function (_LitElement2) {\n    _inherits(HaFileSelector, _LitElement2);\n    function HaFileSelector() {\n      var _this;\n      _classCallCheck(this, HaFileSelector);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _callSuper(this, HaFileSelector, [].concat(args));\n      _initialize(_assertThisInitialized(_this));\n      return _this;\n    }\n    return _createClass(HaFileSelector);\n  }(_LitElement);\n  return {\n    F: HaFileSelector,\n    d: [{\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"selector\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"value\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"label\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"helper\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Boolean\n      })],\n      key: \"disabled\",\n      value: function value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Boolean\n      })],\n      key: \"required\",\n      value: function value() {\n        return true;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_filename\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_busy\",\n      value: function value() {\n        return false;\n      }\n    }, {\n      kind: \"method\",\n      key: \"render\",\n      value: function render() {\n        var _this$selector$file, _this$_filename;\n        return html(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n      <ha-file-upload\\n        .hass=\", \"\\n        .accept=\", \"\\n        .icon=\", \"\\n        .label=\", \"\\n        .required=\", \"\\n        .disabled=\", \"\\n        .supports=\", \"\\n        .uploading=\", \"\\n        .value=\", \"\\n        @file-picked=\", \"\\n        @change=\", \"\\n      ></ha-file-upload>\\n    \"])), this.hass, (_this$selector$file = this.selector.file) === null || _this$selector$file === void 0 ? void 0 : _this$selector$file.accept, mdiFile, this.label, this.required, this.disabled, this.helper, this._busy, this.value ? ((_this$_filename = this._filename) === null || _this$_filename === void 0 ? void 0 : _this$_filename.name) || this.hass.localize(\"ui.components.selectors.file.unknown_file\") : undefined, this._uploadFile, this._removeFile);\n      }\n    }, {\n      kind: \"method\",\n      key: \"willUpdate\",\n      value: function willUpdate(changedProps) {\n        _get(_getPrototypeOf(HaFileSelector.prototype), \"willUpdate\", this).call(this, changedProps);\n        if (changedProps.has(\"value\") && this._filename && this.value !== this._filename.fileId) {\n          this._filename = undefined;\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"_uploadFile\",\n      value: function () {\n        var _uploadFile2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(ev) {\n          var file, fileId;\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                this._busy = true;\n                file = ev.detail.files[0];\n                _context.prev = 2;\n                _context.next = 5;\n                return uploadFile(this.hass, file);\n              case 5:\n                fileId = _context.sent;\n                this._filename = {\n                  fileId: fileId,\n                  name: file.name\n                };\n                fireEvent(this, \"value-changed\", {\n                  value: fileId\n                });\n                _context.next = 13;\n                break;\n              case 10:\n                _context.prev = 10;\n                _context.t0 = _context[\"catch\"](2);\n                showAlertDialog(this, {\n                  text: this.hass.localize(\"ui.components.selectors.file.upload_failed\", {\n                    reason: _context.t0.message || _context.t0\n                  })\n                });\n              case 13:\n                _context.prev = 13;\n                this._busy = false;\n                return _context.finish(13);\n              case 16:\n              case \"end\":\n                return _context.stop();\n            }\n          }, _callee, this, [[2, 10, 13, 16]]);\n        }));\n        function _uploadFile(_x) {\n          return _uploadFile2.apply(this, arguments);\n        }\n        return _uploadFile;\n      }()\n    }, {\n      kind: \"field\",\n      key: \"_removeFile\",\n      value: function value() {\n        var _this2 = this;\n        return /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n          return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n            while (1) switch (_context2.prev = _context2.next) {\n              case 0:\n                _this2._busy = true;\n                _context2.prev = 1;\n                _context2.next = 4;\n                return removeFile(_this2.hass, _this2.value);\n              case 4:\n                _context2.next = 8;\n                break;\n              case 6:\n                _context2.prev = 6;\n                _context2.t0 = _context2[\"catch\"](1);\n              case 8:\n                _context2.prev = 8;\n                _this2._busy = false;\n                return _context2.finish(8);\n              case 11:\n                _this2._filename = undefined;\n                fireEvent(_this2, \"value-changed\", {\n                  value: \"\"\n                });\n              case 13:\n              case \"end\":\n                return _context2.stop();\n            }\n          }, _callee2, null, [[1, 6, 8, 11]]);\n        }));\n      }\n    }]\n  };\n}, LitElement);","map":{"version":3,"names":["html","LitElement","customElement","property","state","fireEvent","removeFile","uploadFile","showAlertDialog","HaFileSelector","_decorate","_initialize","_LitElement","_LitElement2","_inherits","_this","_classCallCheck","_len","arguments","length","args","Array","_key","_callSuper","concat","_assertThisInitialized","_createClass","F","d","kind","decorators","attribute","key","value","type","Boolean","render","_this$selector$file","_this$_filename","_templateObject","_taggedTemplateLiteral","hass","selector","file","accept","mdiFile","label","required","disabled","helper","_busy","_filename","name","localize","undefined","_uploadFile","_removeFile","willUpdate","changedProps","_get","_getPrototypeOf","prototype","call","has","fileId","_uploadFile2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","ev","wrap","_callee$","_context","prev","next","detail","files","sent","t0","text","reason","message","finish","stop","_x","apply","_this2","_callee2","_callee2$","_context2"],"sources":["/workspaces/frontend/src/components/ha-selector/ha-selector-file.ts"],"sourcesContent":["import { mdiFile } from \"@mdi/js\";\nimport { html, LitElement, PropertyValues } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport { removeFile, uploadFile } from \"../../data/file_upload\";\nimport { FileSelector } from \"../../data/selector\";\nimport { showAlertDialog } from \"../../dialogs/generic/show-dialog-box\";\nimport { HomeAssistant } from \"../../types\";\nimport \"../ha-file-upload\";\n\n@customElement(\"ha-selector-file\")\nexport class HaFileSelector extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public selector!: FileSelector;\n\n  @property() public value?: string;\n\n  @property() public label?: string;\n\n  @property() public helper?: string;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = true;\n\n  @state() private _filename?: { fileId: string; name: string };\n\n  @state() private _busy = false;\n\n  protected render() {\n    return html`\n      <ha-file-upload\n        .hass=${this.hass}\n        .accept=${this.selector.file?.accept}\n        .icon=${mdiFile}\n        .label=${this.label}\n        .required=${this.required}\n        .disabled=${this.disabled}\n        .supports=${this.helper}\n        .uploading=${this._busy}\n        .value=${this.value\n          ? this._filename?.name ||\n            this.hass.localize(\"ui.components.selectors.file.unknown_file\")\n          : undefined}\n        @file-picked=${this._uploadFile}\n        @change=${this._removeFile}\n      ></ha-file-upload>\n    `;\n  }\n\n  protected willUpdate(changedProps: PropertyValues) {\n    super.willUpdate(changedProps);\n    if (\n      changedProps.has(\"value\") &&\n      this._filename &&\n      this.value !== this._filename.fileId\n    ) {\n      this._filename = undefined;\n    }\n  }\n\n  private async _uploadFile(ev) {\n    this._busy = true;\n\n    const file = ev.detail.files![0];\n\n    try {\n      const fileId = await uploadFile(this.hass, file);\n      this._filename = { fileId, name: file.name };\n      fireEvent(this, \"value-changed\", { value: fileId });\n    } catch (err: any) {\n      showAlertDialog(this, {\n        text: this.hass.localize(\"ui.components.selectors.file.upload_failed\", {\n          reason: err.message || err,\n        }),\n      });\n    } finally {\n      this._busy = false;\n    }\n  }\n\n  private _removeFile = async () => {\n    this._busy = true;\n    try {\n      await removeFile(this.hass, this.value!);\n    } catch (err) {\n      // Not ideal if removal fails, but will be cleaned up later\n    } finally {\n      this._busy = false;\n    }\n    this._filename = undefined;\n    fireEvent(this, \"value-changed\", { value: \"\" });\n  };\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-selector-file\": HaFileSelector;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}