{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.object.assign.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport { getCollection } from \"./collection.js\";\nimport { getServices } from \"./commands.js\";\nimport { debounce } from \"./util.js\";\nfunction processServiceRegistered(conn, store, event) {\n  var _a;\n  var state = store.state;\n  if (state === undefined) return;\n  var _event$data = event.data,\n    domain = _event$data.domain,\n    service = _event$data.service;\n  if (!((_a = state.domain) === null || _a === void 0 ? void 0 : _a.service)) {\n    var domainInfo = Object.assign(Object.assign({}, state[domain]), _defineProperty({}, service, {\n      description: \"\",\n      fields: {}\n    }));\n    store.setState(_defineProperty({}, domain, domainInfo));\n  }\n  debouncedFetchServices(conn, store);\n}\nfunction processServiceRemoved(state, event) {\n  if (state === undefined) return null;\n  var _event$data2 = event.data,\n    domain = _event$data2.domain,\n    service = _event$data2.service;\n  var curDomainInfo = state[domain];\n  if (!curDomainInfo || !(service in curDomainInfo)) return null;\n  var domainInfo = {};\n  Object.keys(curDomainInfo).forEach(function (sKey) {\n    if (sKey !== service) domainInfo[sKey] = curDomainInfo[sKey];\n  });\n  return _defineProperty({}, domain, domainInfo);\n}\nvar debouncedFetchServices = debounce(function (conn, store) {\n  return fetchServices(conn).then(function (services) {\n    return store.setState(services, true);\n  });\n}, 5000);\nvar fetchServices = function fetchServices(conn) {\n  return getServices(conn);\n};\nvar subscribeUpdates = function subscribeUpdates(conn, store) {\n  return Promise.all([conn.subscribeEvents(function (ev) {\n    return processServiceRegistered(conn, store, ev);\n  }, \"service_registered\"), conn.subscribeEvents(store.action(processServiceRemoved), \"service_removed\")]).then(function (unsubs) {\n    return function () {\n      return unsubs.forEach(function (fn) {\n        return fn();\n      });\n    };\n  });\n};\nexport var servicesColl = function servicesColl(conn) {\n  return getCollection(conn, \"_srv\", fetchServices, subscribeUpdates);\n};\nexport var subscribeServices = function subscribeServices(conn, onChange) {\n  return servicesColl(conn).subscribe(onChange);\n};","map":{"version":3,"names":["getCollection","getServices","debounce","processServiceRegistered","conn","store","event","_a","state","undefined","_event$data","data","domain","service","domainInfo","Object","assign","_defineProperty","description","fields","setState","debouncedFetchServices","processServiceRemoved","_event$data2","curDomainInfo","keys","forEach","sKey","fetchServices","then","services","subscribeUpdates","Promise","all","subscribeEvents","ev","action","unsubs","fn","servicesColl","subscribeServices","onChange","subscribe"],"sources":["/Users/sercanardil/Desktop/frontend/node_modules/home-assistant-js-websocket/dist/services.js"],"sourcesContent":["import { getCollection } from \"./collection.js\";\nimport { getServices } from \"./commands.js\";\nimport { debounce } from \"./util.js\";\nfunction processServiceRegistered(conn, store, event) {\n    var _a;\n    const state = store.state;\n    if (state === undefined)\n        return;\n    const { domain, service } = event.data;\n    if (!((_a = state.domain) === null || _a === void 0 ? void 0 : _a.service)) {\n        const domainInfo = Object.assign(Object.assign({}, state[domain]), { [service]: { description: \"\", fields: {} } });\n        store.setState({ [domain]: domainInfo });\n    }\n    debouncedFetchServices(conn, store);\n}\nfunction processServiceRemoved(state, event) {\n    if (state === undefined)\n        return null;\n    const { domain, service } = event.data;\n    const curDomainInfo = state[domain];\n    if (!curDomainInfo || !(service in curDomainInfo))\n        return null;\n    const domainInfo = {};\n    Object.keys(curDomainInfo).forEach((sKey) => {\n        if (sKey !== service)\n            domainInfo[sKey] = curDomainInfo[sKey];\n    });\n    return { [domain]: domainInfo };\n}\nconst debouncedFetchServices = debounce((conn, store) => fetchServices(conn).then((services) => store.setState(services, true)), 5000);\nconst fetchServices = (conn) => getServices(conn);\nconst subscribeUpdates = (conn, store) => Promise.all([\n    conn.subscribeEvents((ev) => processServiceRegistered(conn, store, ev), \"service_registered\"),\n    conn.subscribeEvents(store.action(processServiceRemoved), \"service_removed\"),\n]).then((unsubs) => () => unsubs.forEach((fn) => fn()));\nexport const servicesColl = (conn) => getCollection(conn, \"_srv\", fetchServices, subscribeUpdates);\nexport const subscribeServices = (conn, onChange) => servicesColl(conn).subscribe(onChange);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}