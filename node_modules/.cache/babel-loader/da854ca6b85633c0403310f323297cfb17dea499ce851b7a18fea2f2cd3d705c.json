{"ast":null,"code":"import { getCollection } from \"home-assistant-js-websocket\";\nimport { debounce } from \"../common/util/debounce\";\nimport { domainToName } from \"./integration\";\nexport const DISCOVERY_SOURCES = [\"bluetooth\", \"dhcp\", \"discovery\", \"hardware\", \"hassio\", \"homekit\", \"integration_discovery\", \"mqtt\", \"ssdp\", \"unignore\", \"usb\", \"zeroconf\"];\nexport const ATTENTION_SOURCES = [\"reauth\"];\nconst HEADERS = {\n  \"HA-Frontend-Base\": `${location.protocol}//${location.host}`\n};\nexport const createConfigFlow = (hass, handler) => {\n  var _hass$userData;\n  return hass.callApi(\"POST\", \"config/config_entries/flow\", {\n    handler,\n    show_advanced_options: Boolean((_hass$userData = hass.userData) === null || _hass$userData === void 0 ? void 0 : _hass$userData.showAdvanced)\n  }, HEADERS);\n};\nexport const fetchConfigFlow = (hass, flowId) => hass.callApi(\"GET\", `config/config_entries/flow/${flowId}`, undefined, HEADERS);\nexport const handleConfigFlowStep = (hass, flowId, data) => hass.callApi(\"POST\", `config/config_entries/flow/${flowId}`, data, HEADERS);\nexport const ignoreConfigFlow = (hass, flowId, title) => hass.callWS({\n  type: \"config_entries/ignore_flow\",\n  flow_id: flowId,\n  title\n});\nexport const deleteConfigFlow = (hass, flowId) => hass.callApi(\"DELETE\", `config/config_entries/flow/${flowId}`);\nexport const getConfigFlowHandlers = (hass, type) => hass.callApi(\"GET\", `config/config_entries/flow_handlers${type ? `?type=${type}` : \"\"}`);\nexport const fetchConfigFlowInProgress = conn => conn.sendMessagePromise({\n  type: \"config_entries/flow/progress\"\n});\nconst subscribeConfigFlowInProgressUpdates = (conn, store) => conn.subscribeEvents(debounce(() => fetchConfigFlowInProgress(conn).then(flows => store.setState(flows, true)), 500, true), \"config_entry_discovered\");\nexport const getConfigFlowInProgressCollection = conn => getCollection(conn, \"_configFlowProgress\", fetchConfigFlowInProgress, subscribeConfigFlowInProgressUpdates);\nexport const subscribeConfigFlowInProgress = (hass, onChange) => getConfigFlowInProgressCollection(hass.connection).subscribe(onChange);\nexport const localizeConfigFlowTitle = (localize, flow) => {\n  if (!flow.context.title_placeholders || Object.keys(flow.context.title_placeholders).length === 0) {\n    return domainToName(localize, flow.handler);\n  }\n  return localize(`component.${flow.handler}.config.flow_title`, flow.context.title_placeholders) || (\"name\" in flow.context.title_placeholders ? flow.context.title_placeholders.name : domainToName(localize, flow.handler));\n};","map":{"version":3,"names":["getCollection","debounce","domainToName","DISCOVERY_SOURCES","ATTENTION_SOURCES","HEADERS","location","protocol","host","createConfigFlow","hass","handler","_hass$userData","callApi","show_advanced_options","Boolean","userData","showAdvanced","fetchConfigFlow","flowId","undefined","handleConfigFlowStep","data","ignoreConfigFlow","title","callWS","type","flow_id","deleteConfigFlow","getConfigFlowHandlers","fetchConfigFlowInProgress","conn","sendMessagePromise","subscribeConfigFlowInProgressUpdates","store","subscribeEvents","then","flows","setState","getConfigFlowInProgressCollection","subscribeConfigFlowInProgress","onChange","connection","subscribe","localizeConfigFlowTitle","localize","flow","context","title_placeholders","Object","keys","length","name"],"sources":["/workspaces/frontend/src/data/config_flow.ts"],"sourcesContent":["import { Connection, getCollection } from \"home-assistant-js-websocket\";\nimport { LocalizeFunc } from \"../common/translations/localize\";\nimport { debounce } from \"../common/util/debounce\";\nimport { HomeAssistant } from \"../types\";\nimport { DataEntryFlowProgress, DataEntryFlowStep } from \"./data_entry_flow\";\nimport { domainToName, IntegrationType } from \"./integration\";\n\nexport const DISCOVERY_SOURCES = [\n  \"bluetooth\",\n  \"dhcp\",\n  \"discovery\",\n  \"hardware\",\n  \"hassio\",\n  \"homekit\",\n  \"integration_discovery\",\n  \"mqtt\",\n  \"ssdp\",\n  \"unignore\",\n  \"usb\",\n  \"zeroconf\",\n];\n\nexport const ATTENTION_SOURCES = [\"reauth\"];\n\nconst HEADERS = {\n  \"HA-Frontend-Base\": `${location.protocol}//${location.host}`,\n};\n\nexport const createConfigFlow = (hass: HomeAssistant, handler: string) =>\n  hass.callApi<DataEntryFlowStep>(\n    \"POST\",\n    \"config/config_entries/flow\",\n    {\n      handler,\n      show_advanced_options: Boolean(hass.userData?.showAdvanced),\n    },\n    HEADERS\n  );\n\nexport const fetchConfigFlow = (hass: HomeAssistant, flowId: string) =>\n  hass.callApi<DataEntryFlowStep>(\n    \"GET\",\n    `config/config_entries/flow/${flowId}`,\n    undefined,\n    HEADERS\n  );\n\nexport const handleConfigFlowStep = (\n  hass: HomeAssistant,\n  flowId: string,\n  data: Record<string, any>\n) =>\n  hass.callApi<DataEntryFlowStep>(\n    \"POST\",\n    `config/config_entries/flow/${flowId}`,\n    data,\n    HEADERS\n  );\n\nexport const ignoreConfigFlow = (\n  hass: HomeAssistant,\n  flowId: string,\n  title: string\n) =>\n  hass.callWS({ type: \"config_entries/ignore_flow\", flow_id: flowId, title });\n\nexport const deleteConfigFlow = (hass: HomeAssistant, flowId: string) =>\n  hass.callApi(\"DELETE\", `config/config_entries/flow/${flowId}`);\n\nexport const getConfigFlowHandlers = (\n  hass: HomeAssistant,\n  type?: IntegrationType[]\n) =>\n  hass.callApi<string[]>(\n    \"GET\",\n    `config/config_entries/flow_handlers${type ? `?type=${type}` : \"\"}`\n  );\n\nexport const fetchConfigFlowInProgress = (\n  conn: Connection\n): Promise<DataEntryFlowProgress[]> =>\n  conn.sendMessagePromise({\n    type: \"config_entries/flow/progress\",\n  });\n\nconst subscribeConfigFlowInProgressUpdates = (conn: Connection, store) =>\n  conn.subscribeEvents(\n    debounce(\n      () =>\n        fetchConfigFlowInProgress(conn).then((flows: DataEntryFlowProgress[]) =>\n          store.setState(flows, true)\n        ),\n      500,\n      true\n    ),\n    \"config_entry_discovered\"\n  );\n\nexport const getConfigFlowInProgressCollection = (conn: Connection) =>\n  getCollection<DataEntryFlowProgress[]>(\n    conn,\n    \"_configFlowProgress\",\n    fetchConfigFlowInProgress,\n    subscribeConfigFlowInProgressUpdates\n  );\n\nexport const subscribeConfigFlowInProgress = (\n  hass: HomeAssistant,\n  onChange: (flows: DataEntryFlowProgress[]) => void\n) => getConfigFlowInProgressCollection(hass.connection).subscribe(onChange);\n\nexport const localizeConfigFlowTitle = (\n  localize: LocalizeFunc,\n  flow: DataEntryFlowProgress\n) => {\n  if (\n    !flow.context.title_placeholders ||\n    Object.keys(flow.context.title_placeholders).length === 0\n  ) {\n    return domainToName(localize, flow.handler);\n  }\n  return (\n    localize(\n      `component.${flow.handler}.config.flow_title`,\n      flow.context.title_placeholders\n    ) ||\n    (\"name\" in flow.context.title_placeholders\n      ? flow.context.title_placeholders.name\n      : domainToName(localize, flow.handler))\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}