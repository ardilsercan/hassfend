{"ast":null,"code":"import _decorate from \"@babel/runtime/helpers/decorate\";\nimport \"@material/mwc-button\";\nimport \"../../components/ha-dialog\";\nimport \"../../components/ha-circular-progress\";\nimport \"../../components/ha-icon\";\nimport \"../../components/ha-icon-button\";\nimport { LitElement, css, html, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { haStyleDialog } from \"../../resources/styles\";\nlet HaDialogShowAudioMessage = _decorate([customElement(\"ha-dialog-show-audio-message\")], function (_initialize, _LitElement) {\n  class HaDialogShowAudioMessage extends _LitElement {\n    constructor(...args) {\n      super(...args);\n      _initialize(this);\n    }\n  }\n  return {\n    F: HaDialogShowAudioMessage,\n    d: [{\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_currentMessage\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_errorMsg\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_loading\",\n      value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_opened\",\n      value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_blobUrl\",\n      value: void 0\n    }, {\n      kind: \"method\",\n      key: \"render\",\n      value: function render() {\n        var _this$_currentMessage;\n        return html`\n      <ha-dialog\n        .open=${this._opened}\n        @closed=${this._closeDialog}\n        heading=${this.hass.localize(\"ui.panel.mailbox.playback_title\")}\n      >\n        ${this._loading ? html`<ha-circular-progress indeterminate></ha-circular-progress>` : html`<div class=\"icon\">\n                <ha-icon-button id=\"delicon\" @click=${this._openDeleteDialog}>\n                  <ha-icon icon=\"hass:delete\"></ha-icon>\n                </ha-icon-button>\n              </div>\n              ${this._currentMessage ? html`<div id=\"transcribe\">\n                      ${(_this$_currentMessage = this._currentMessage) === null || _this$_currentMessage === void 0 ? void 0 : _this$_currentMessage.message}\n                    </div>` : nothing}\n                ${this._errorMsg ? html`<div class=\"error\">${this._errorMsg}</div>` : nothing}\n                ${this._blobUrl ? html` <audio id=\"mp3\" preload=\"none\" controls autoplay>\n                        <source\n                          id=\"mp3src\"\n                          src=${this._blobUrl}\n                          type=\"audio/mpeg\"\n                        />\n                      </audio>` : nothing}\n              </div>`}\n      </ha-dialog>\n    `;\n      }\n    }, {\n      kind: \"method\",\n      key: \"showDialog\",\n      value: function showDialog({\n        hass,\n        message\n      }) {\n        this.hass = hass;\n        this._errorMsg = undefined;\n        this._currentMessage = message;\n        this._opened = true;\n        const platform = message.platform;\n        if (platform.has_media) {\n          this._loading = true;\n          const url = `/api/mailbox/media/${platform.name}/${message.sha}`;\n          this.hass.fetchWithAuth(url).then(response => {\n            if (response.ok) {\n              return response.blob();\n            }\n            return Promise.reject({\n              status: response.status,\n              statusText: response.statusText\n            });\n          }).then(blob => {\n            this._loading = false;\n            this._blobUrl = window.URL.createObjectURL(blob);\n          }).catch(err => {\n            this._loading = false;\n            this._errorMsg = `Error loading audio: ${err.statusText}`;\n          });\n        } else {\n          this._loading = false;\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"_openDeleteDialog\",\n      value: function _openDeleteDialog() {\n        if (confirm(this.hass.localize(\"ui.panel.mailbox.delete_prompt\"))) {\n          this._deleteSelected();\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"_deleteSelected\",\n      value: function _deleteSelected() {\n        const msg = this._currentMessage;\n        this.hass.callApi(\"DELETE\", `mailbox/delete/${msg.platform.name}/${msg.sha}`);\n        this._closeDialog();\n      }\n    }, {\n      kind: \"method\",\n      key: \"_closeDialog\",\n      value: function _closeDialog() {\n        const mp3 = this.shadowRoot.querySelector(\"#mp3\");\n        mp3.pause();\n        this._currentMessage = undefined;\n        this._errorMsg = undefined;\n        this._loading = false;\n        this._opened = false;\n      }\n    }, {\n      kind: \"get\",\n      static: true,\n      key: \"styles\",\n      value: function styles() {\n        return [haStyleDialog, css`\n        .error {\n          color: red;\n        }\n        p {\n          color: var(--secondary-text-color);\n        }\n        .icon {\n          text-align: var(--float-end);\n        }\n      `];\n      }\n    }]\n  };\n}, LitElement);","map":{"version":3,"names":["LitElement","css","html","nothing","customElement","property","state","haStyleDialog","HaDialogShowAudioMessage","_decorate","_initialize","_LitElement","constructor","args","F","d","kind","decorators","attribute","key","value","render","_this$_currentMessage","_opened","_closeDialog","hass","localize","_loading","_openDeleteDialog","_currentMessage","message","_errorMsg","_blobUrl","showDialog","undefined","platform","has_media","url","name","sha","fetchWithAuth","then","response","ok","blob","Promise","reject","status","statusText","window","URL","createObjectURL","catch","err","confirm","_deleteSelected","msg","callApi","mp3","shadowRoot","querySelector","pause","static","styles"],"sources":["/workspaces/frontend/src/panels/mailbox/ha-dialog-show-audio-message.ts"],"sourcesContent":["import \"@material/mwc-button\";\nimport \"../../components/ha-dialog\";\nimport \"../../components/ha-circular-progress\";\nimport \"../../components/ha-icon\";\nimport \"../../components/ha-icon-button\";\nimport {\n  CSSResultGroup,\n  LitElement,\n  TemplateResult,\n  css,\n  html,\n  nothing,\n} from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { HomeAssistant } from \"../../types\";\nimport { haStyleDialog } from \"../../resources/styles\";\n\n@customElement(\"ha-dialog-show-audio-message\")\nclass HaDialogShowAudioMessage extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @state() private _currentMessage?: any;\n\n  @state() private _errorMsg?: string;\n\n  @state() private _loading: boolean = false;\n\n  @state() private _opened: boolean = false;\n\n  @state() private _blobUrl?: string;\n\n  protected render(): TemplateResult {\n    return html`\n      <ha-dialog\n        .open=${this._opened}\n        @closed=${this._closeDialog}\n        heading=${this.hass.localize(\"ui.panel.mailbox.playback_title\")}\n      >\n        ${this._loading\n          ? html`<ha-circular-progress indeterminate></ha-circular-progress>`\n          : html`<div class=\"icon\">\n                <ha-icon-button id=\"delicon\" @click=${this._openDeleteDialog}>\n                  <ha-icon icon=\"hass:delete\"></ha-icon>\n                </ha-icon-button>\n              </div>\n              ${\n                this._currentMessage\n                  ? html`<div id=\"transcribe\">\n                      ${this._currentMessage?.message}\n                    </div>`\n                  : nothing\n              }\n                ${\n                  this._errorMsg\n                    ? html`<div class=\"error\">${this._errorMsg}</div>`\n                    : nothing\n                }\n                ${\n                  this._blobUrl\n                    ? html` <audio id=\"mp3\" preload=\"none\" controls autoplay>\n                        <source\n                          id=\"mp3src\"\n                          src=${this._blobUrl}\n                          type=\"audio/mpeg\"\n                        />\n                      </audio>`\n                    : nothing\n                }\n              </div>`}\n      </ha-dialog>\n    `;\n  }\n\n  showDialog({ hass, message }) {\n    this.hass = hass;\n    this._errorMsg = undefined;\n    this._currentMessage = message;\n    this._opened = true;\n    const platform = message.platform;\n    if (platform.has_media) {\n      this._loading = true;\n      const url = `/api/mailbox/media/${platform.name}/${message.sha}`;\n      this.hass\n        .fetchWithAuth(url)\n        .then((response) => {\n          if (response.ok) {\n            return response.blob();\n          }\n          return Promise.reject({\n            status: response.status,\n            statusText: response.statusText,\n          });\n        })\n        .then((blob) => {\n          this._loading = false;\n          this._blobUrl = window.URL.createObjectURL(blob);\n        })\n        .catch((err) => {\n          this._loading = false;\n          this._errorMsg = `Error loading audio: ${err.statusText}`;\n        });\n    } else {\n      this._loading = false;\n    }\n  }\n\n  private _openDeleteDialog() {\n    if (confirm(this.hass.localize(\"ui.panel.mailbox.delete_prompt\"))) {\n      this._deleteSelected();\n    }\n  }\n\n  private _deleteSelected() {\n    const msg = this._currentMessage;\n    this.hass.callApi(\n      \"DELETE\",\n      `mailbox/delete/${msg.platform.name}/${msg.sha}`\n    );\n    this._closeDialog();\n  }\n\n  private _closeDialog() {\n    const mp3 = this.shadowRoot!.querySelector(\"#mp3\")! as any;\n    mp3.pause();\n    this._currentMessage = undefined;\n    this._errorMsg = undefined;\n    this._loading = false;\n    this._opened = false;\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      haStyleDialog,\n      css`\n        .error {\n          color: red;\n        }\n        p {\n          color: var(--secondary-text-color);\n        }\n        .icon {\n          text-align: var(--float-end);\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-dialog-show-audio-message\": HaDialogShowAudioMessage;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}