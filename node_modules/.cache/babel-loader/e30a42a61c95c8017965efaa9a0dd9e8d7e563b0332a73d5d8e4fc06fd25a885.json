{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/helpers/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _callSuper from \"@babel/runtime/helpers/callSuper\";\nimport _get from \"@babel/runtime/helpers/get\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport { subscribeUser, userCollection } from \"../data/ws-user\";\nimport { clearState } from \"../util/ha-pref-storage\";\nexport default (function (superClass) {\n  return /*#__PURE__*/function (_superClass) {\n    _inherits(_class, _superClass);\n    function _class() {\n      _classCallCheck(this, _class);\n      return _callSuper(this, _class, arguments);\n    }\n    _createClass(_class, [{\n      key: \"firstUpdated\",\n      value: function firstUpdated(changedProps) {\n        var _this = this;\n        _get(_getPrototypeOf(_class.prototype), \"firstUpdated\", this).call(this, changedProps);\n        this.addEventListener(\"hass-logout\", function () {\n          return _this._handleLogout();\n        });\n        this.addEventListener(\"hass-refresh-current-user\", function () {\n          userCollection(_this.hass.connection).refresh();\n        });\n      }\n    }, {\n      key: \"hassConnected\",\n      value: function hassConnected() {\n        var _this2 = this;\n        _get(_getPrototypeOf(_class.prototype), \"hassConnected\", this).call(this);\n        subscribeUser(this.hass.connection, function (user) {\n          return _this2._updateHass({\n            user: user\n          });\n        });\n      }\n    }, {\n      key: \"_handleLogout\",\n      value: function () {\n        var _handleLogout2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return this.hass.auth.revoke();\n              case 3:\n                this.hass.connection.close();\n                clearState();\n                document.location.href = \"/\";\n                _context.next = 12;\n                break;\n              case 8:\n                _context.prev = 8;\n                _context.t0 = _context[\"catch\"](0);\n                // eslint-disable-next-line\n                console.error(_context.t0);\n                alert(\"Log out failed\");\n              case 12:\n              case \"end\":\n                return _context.stop();\n            }\n          }, _callee, this, [[0, 8]]);\n        }));\n        function _handleLogout() {\n          return _handleLogout2.apply(this, arguments);\n        }\n        return _handleLogout;\n      }()\n    }]);\n    return _class;\n  }(superClass);\n});","map":{"version":3,"names":["subscribeUser","userCollection","clearState","superClass","_superClass","_inherits","_class","_classCallCheck","_callSuper","arguments","_createClass","key","value","firstUpdated","changedProps","_this","_get","_getPrototypeOf","prototype","call","addEventListener","_handleLogout","hass","connection","refresh","hassConnected","_this2","user","_updateHass","_handleLogout2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","auth","revoke","close","document","location","href","t0","console","error","alert","stop","apply"],"sources":["/Users/sercanardil/Desktop/frontend/src/state/auth-mixin.ts"],"sourcesContent":["import { subscribeUser, userCollection } from \"../data/ws-user\";\nimport { Constructor } from \"../types\";\nimport { clearState } from \"../util/ha-pref-storage\";\nimport { HassBaseEl } from \"./hass-base-mixin\";\n\ndeclare global {\n  // for fire event\n  interface HASSDomEvents {\n    \"hass-refresh-current-user\": undefined;\n  }\n}\n\nexport default <T extends Constructor<HassBaseEl>>(superClass: T) =>\n  class extends superClass {\n    protected firstUpdated(changedProps) {\n      super.firstUpdated(changedProps);\n      this.addEventListener(\"hass-logout\", () => this._handleLogout());\n      this.addEventListener(\"hass-refresh-current-user\", () => {\n        userCollection(this.hass!.connection).refresh();\n      });\n    }\n\n    protected hassConnected() {\n      super.hassConnected();\n      subscribeUser(this.hass!.connection, (user) =>\n        this._updateHass({ user })\n      );\n    }\n\n    private async _handleLogout() {\n      try {\n        await this.hass!.auth.revoke();\n        this.hass!.connection.close();\n        clearState();\n        document.location.href = \"/\";\n      } catch (err: any) {\n        // eslint-disable-next-line\n        console.error(err);\n        alert(\"Log out failed\");\n      }\n    }\n  };\n"],"mappings":";;;;;;;;AAAA,SAASA,aAAa,EAAEC,cAAc,QAAQ,iBAAiB;AAE/D,SAASC,UAAU,QAAQ,yBAAyB;AAUpD,gBAAe,UAAoCC,UAAa;EAAA,8BAAAC,WAAA;IAAAC,SAAA,CAAAC,MAAA,EAAAF,WAAA;IAAA,SAAAE,OAAA;MAAAC,eAAA,OAAAD,MAAA;MAAA,OAAAE,UAAA,OAAAF,MAAA,EAAAG,SAAA;IAAA;IAAAC,YAAA,CAAAJ,MAAA;MAAAK,GAAA;MAAAC,KAAA,EAE5D,SAAAC,aAAuBC,YAAY,EAAE;QAAA,IAAAC,KAAA;QACnCC,IAAA,CAAAC,eAAA,CAAAX,MAAA,CAAAY,SAAA,yBAAAC,IAAA,OAAmBL,YAAY;QAC/B,IAAI,CAACM,gBAAgB,CAAC,aAAa,EAAE;UAAA,OAAML,KAAI,CAACM,aAAa,CAAC,CAAC;QAAA,EAAC;QAChE,IAAI,CAACD,gBAAgB,CAAC,2BAA2B,EAAE,YAAM;UACvDnB,cAAc,CAACc,KAAI,CAACO,IAAI,CAAEC,UAAU,CAAC,CAACC,OAAO,CAAC,CAAC;QACjD,CAAC,CAAC;MACJ;IAAC;MAAAb,GAAA;MAAAC,KAAA,EAED,SAAAa,cAAA,EAA0B;QAAA,IAAAC,MAAA;QACxBV,IAAA,CAAAC,eAAA,CAAAX,MAAA,CAAAY,SAAA,0BAAAC,IAAA;QACAnB,aAAa,CAAC,IAAI,CAACsB,IAAI,CAAEC,UAAU,EAAE,UAACI,IAAI;UAAA,OACxCD,MAAI,CAACE,WAAW,CAAC;YAAED,IAAI,EAAJA;UAAK,CAAC,CAAC;QAAA,CAC5B,CAAC;MACH;IAAC;MAAAhB,GAAA;MAAAC,KAAA;QAAA,IAAAiB,cAAA,GAAAC,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAED,SAAAC,QAAA;UAAA,OAAAF,mBAAA,GAAAG,IAAA,UAAAC,SAAAC,QAAA;YAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;cAAA;gBAAAF,QAAA,CAAAC,IAAA;gBAAAD,QAAA,CAAAE,IAAA;gBAAA,OAEU,IAAI,CAAChB,IAAI,CAAEiB,IAAI,CAACC,MAAM,CAAC,CAAC;cAAA;gBAC9B,IAAI,CAAClB,IAAI,CAAEC,UAAU,CAACkB,KAAK,CAAC,CAAC;gBAC7BvC,UAAU,CAAC,CAAC;gBACZwC,QAAQ,CAACC,QAAQ,CAACC,IAAI,GAAG,GAAG;gBAACR,QAAA,CAAAE,IAAA;gBAAA;cAAA;gBAAAF,QAAA,CAAAC,IAAA;gBAAAD,QAAA,CAAAS,EAAA,GAAAT,QAAA;gBAE7B;gBACAU,OAAO,CAACC,KAAK,CAAAX,QAAA,CAAAS,EAAI,CAAC;gBAClBG,KAAK,CAAC,gBAAgB,CAAC;cAAC;cAAA;gBAAA,OAAAZ,QAAA,CAAAa,IAAA;YAAA;UAAA,GAAAhB,OAAA;QAAA,CAE3B;QAAA,SAAAZ,cAAA;UAAA,OAAAQ,cAAA,CAAAqB,KAAA,OAAAzC,SAAA;QAAA;QAAA,OAAAY,aAAA;MAAA;IAAA;IAAA,OAAAf,MAAA;EAAA,EA3BWH,UAAU;AAAA,CA4BvB"},"metadata":{},"sourceType":"module","externalDependencies":[]}