{"ast":null,"code":"import _decorate from \"@babel/runtime/helpers/decorate\";\nimport _get from \"@babel/runtime/helpers/get\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport \"@material/mwc-button/mwc-button\";\nimport { css, html, LitElement } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { showHassioBackupDialog } from \"../../hassio/src/dialogs/backup/show-dialog-hassio-backup\";\nimport \"../../hassio/src/components/hassio-upload-backup\";\nimport \"../components/ha-ansi-to-html\";\nimport \"../components/ha-card\";\nimport { fetchInstallationType } from \"../data/onboarding\";\nimport \"./onboarding-loading\";\nimport { onBoardingStyles } from \"./styles\";\nimport { removeSearchParam } from \"../common/url/search-params\";\nimport { navigate } from \"../common/navigate\";\nlet OnboardingRestoreBackup = _decorate([customElement(\"onboarding-restore-backup\")], function (_initialize, _LitElement) {\n  class OnboardingRestoreBackup extends _LitElement {\n    constructor(...args) {\n      super(...args);\n      _initialize(this);\n    }\n  }\n  return {\n    F: OnboardingRestoreBackup,\n    d: [{\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"localize\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property()],\n      key: \"language\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_restoring\",\n      value() {\n        return false;\n      }\n    }, {\n      kind: \"method\",\n      key: \"render\",\n      value: function render() {\n        return html`${this._restoring ? html`<h1>\n              ${this.localize(\"ui.panel.page-onboarding.restore.in_progress\")}\n            </h1>\n            <onboarding-loading></onboarding-loading>` : html` <h1>\n              ${this.localize(\"ui.panel.page-onboarding.restore.header\")}\n            </h1>\n            <hassio-upload-backup\n              @backup-uploaded=${this._backupUploaded}\n              .hass=${this.hass}\n            ></hassio-upload-backup>`}\n      <div class=\"footer\">\n        <mwc-button @click=${this._back} .disabled=${this._restoring}>\n          ${this.localize(\"ui.panel.page-onboarding.back\")}\n        </mwc-button>\n      </div> `;\n      }\n    }, {\n      kind: \"method\",\n      key: \"_back\",\n      value: function _back() {\n        navigate(`${location.pathname}?${removeSearchParam(\"page\")}`);\n      }\n    }, {\n      kind: \"method\",\n      key: \"_backupUploaded\",\n      value: function _backupUploaded(ev) {\n        const backup = ev.detail.backup;\n        this._showBackupDialog(backup.slug);\n      }\n    }, {\n      kind: \"method\",\n      key: \"firstUpdated\",\n      value: function firstUpdated(changedProps) {\n        _get(_getPrototypeOf(OnboardingRestoreBackup.prototype), \"firstUpdated\", this).call(this, changedProps);\n        setInterval(() => this._checkRestoreStatus(), 1000);\n      }\n    }, {\n      kind: \"method\",\n      key: \"_checkRestoreStatus\",\n      value: async function _checkRestoreStatus() {\n        if (this._restoring) {\n          try {\n            await fetchInstallationType();\n          } catch (err) {\n            if (err.message === \"unauthorized\" || err.message === \"not_found\") {\n              window.location.replace(\"/\");\n            }\n          }\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"_showBackupDialog\",\n      value: function _showBackupDialog(slug) {\n        showHassioBackupDialog(this, {\n          slug,\n          onboarding: true,\n          localize: this.localize,\n          onRestoring: () => {\n            this._restoring = true;\n          }\n        });\n      }\n    }, {\n      kind: \"get\",\n      static: true,\n      key: \"styles\",\n      value: function styles() {\n        return [onBoardingStyles, css`\n        :host {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n        }\n        hassio-upload-backup {\n          width: 100%;\n        }\n        .footer {\n          width: 100%;\n          text-align: left;\n        }\n      `];\n      }\n    }]\n  };\n}, LitElement);","map":{"version":3,"names":["css","html","LitElement","customElement","property","state","showHassioBackupDialog","fetchInstallationType","onBoardingStyles","removeSearchParam","navigate","OnboardingRestoreBackup","_decorate","_initialize","_LitElement","constructor","args","F","d","kind","decorators","attribute","key","value","render","_restoring","localize","_backupUploaded","hass","_back","location","pathname","ev","backup","detail","_showBackupDialog","slug","firstUpdated","changedProps","_get","_getPrototypeOf","prototype","call","setInterval","_checkRestoreStatus","err","message","window","replace","onboarding","onRestoring","static","styles"],"sources":["/workspaces/frontend/src/onboarding/onboarding-restore-backup.ts"],"sourcesContent":["import \"@material/mwc-button/mwc-button\";\nimport { css, CSSResultGroup, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { showHassioBackupDialog } from \"../../hassio/src/dialogs/backup/show-dialog-hassio-backup\";\nimport \"../../hassio/src/components/hassio-upload-backup\";\nimport type { LocalizeFunc } from \"../common/translations/localize\";\nimport \"../components/ha-ansi-to-html\";\nimport \"../components/ha-card\";\nimport { fetchInstallationType } from \"../data/onboarding\";\nimport { HomeAssistant } from \"../types\";\nimport \"./onboarding-loading\";\nimport { onBoardingStyles } from \"./styles\";\nimport { removeSearchParam } from \"../common/url/search-params\";\nimport { navigate } from \"../common/navigate\";\n\n@customElement(\"onboarding-restore-backup\")\nclass OnboardingRestoreBackup extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public localize!: LocalizeFunc;\n\n  @property() public language!: string;\n\n  @state() public _restoring = false;\n\n  protected render(): TemplateResult {\n    return html`${this._restoring\n        ? html`<h1>\n              ${this.localize(\"ui.panel.page-onboarding.restore.in_progress\")}\n            </h1>\n            <onboarding-loading></onboarding-loading>`\n        : html` <h1>\n              ${this.localize(\"ui.panel.page-onboarding.restore.header\")}\n            </h1>\n            <hassio-upload-backup\n              @backup-uploaded=${this._backupUploaded}\n              .hass=${this.hass}\n            ></hassio-upload-backup>`}\n      <div class=\"footer\">\n        <mwc-button @click=${this._back} .disabled=${this._restoring}>\n          ${this.localize(\"ui.panel.page-onboarding.back\")}\n        </mwc-button>\n      </div> `;\n  }\n\n  private _back(): void {\n    navigate(`${location.pathname}?${removeSearchParam(\"page\")}`);\n  }\n\n  private _backupUploaded(ev) {\n    const backup = ev.detail.backup;\n    this._showBackupDialog(backup.slug);\n  }\n\n  protected firstUpdated(changedProps) {\n    super.firstUpdated(changedProps);\n    setInterval(() => this._checkRestoreStatus(), 1000);\n  }\n\n  private async _checkRestoreStatus(): Promise<void> {\n    if (this._restoring) {\n      try {\n        await fetchInstallationType();\n      } catch (err: any) {\n        if (\n          (err as Error).message === \"unauthorized\" ||\n          (err as Error).message === \"not_found\"\n        ) {\n          window.location.replace(\"/\");\n        }\n      }\n    }\n  }\n\n  private _showBackupDialog(slug: string): void {\n    showHassioBackupDialog(this, {\n      slug,\n      onboarding: true,\n      localize: this.localize,\n      onRestoring: () => {\n        this._restoring = true;\n      },\n    });\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      onBoardingStyles,\n      css`\n        :host {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n        }\n        hassio-upload-backup {\n          width: 100%;\n        }\n        .footer {\n          width: 100%;\n          text-align: left;\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"onboarding-restore-backup\": OnboardingRestoreBackup;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}