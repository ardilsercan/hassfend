{"ast":null,"code":"import { getCollection } from \"home-assistant-js-websocket\";\nimport { fetchConfig } from \"./lovelace/config/types\";\nexport var subscribeLovelaceUpdates = function subscribeLovelaceUpdates(conn, urlPath, onChange) {\n  return conn.subscribeEvents(function (ev) {\n    if (ev.data.url_path === urlPath) {\n      onChange();\n    }\n  }, \"lovelace_updated\");\n};\nexport var getLovelaceCollection = function getLovelaceCollection(conn) {\n  var urlPath = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  return getCollection(conn, \"_lovelace_\".concat(urlPath !== null && urlPath !== void 0 ? urlPath : \"\"), function (conn2) {\n    return fetchConfig(conn2, urlPath, false);\n  }, function (_conn, store) {\n    return subscribeLovelaceUpdates(conn, urlPath, function () {\n      return fetchConfig(conn, urlPath, false).then(function (config) {\n        return store.setState(config, true);\n      });\n    });\n  });\n};\n\n// Legacy functions to support cast for Home Assistion < 0.107\nvar fetchLegacyConfig = function fetchLegacyConfig(conn, force) {\n  return conn.sendMessagePromise({\n    type: \"lovelace/config\",\n    force: force\n  });\n};\nvar subscribeLegacyLovelaceUpdates = function subscribeLegacyLovelaceUpdates(conn, onChange) {\n  return conn.subscribeEvents(onChange, \"lovelace_updated\");\n};\nexport var getLegacyLovelaceCollection = function getLegacyLovelaceCollection(conn) {\n  return getCollection(conn, \"_lovelace\", function (conn2) {\n    return fetchLegacyConfig(conn2, false);\n  }, function (_conn, store) {\n    return subscribeLegacyLovelaceUpdates(conn, function () {\n      return fetchLegacyConfig(conn, false).then(function (config) {\n        return store.setState(config, true);\n      });\n    });\n  });\n};","map":{"version":3,"names":["getCollection","fetchConfig","subscribeLovelaceUpdates","conn","urlPath","onChange","subscribeEvents","ev","data","url_path","getLovelaceCollection","arguments","length","undefined","concat","conn2","_conn","store","then","config","setState","fetchLegacyConfig","force","sendMessagePromise","type","subscribeLegacyLovelaceUpdates","getLegacyLovelaceCollection"],"sources":["/workspaces/frontend/src/data/lovelace.ts"],"sourcesContent":["import {\n  Connection,\n  getCollection,\n  HassEventBase,\n} from \"home-assistant-js-websocket\";\nimport { HuiErrorCard } from \"../panels/lovelace/cards/hui-error-card\";\nimport {\n  Lovelace,\n  LovelaceBadge,\n  LovelaceCard,\n} from \"../panels/lovelace/types\";\nimport { HomeAssistant } from \"../types\";\nimport { fetchConfig, LegacyLovelaceConfig } from \"./lovelace/config/types\";\nimport { LovelaceViewConfig } from \"./lovelace/config/view\";\n\nexport interface LovelacePanelConfig {\n  mode: \"yaml\" | \"storage\";\n}\n\nexport interface LovelaceViewElement extends HTMLElement {\n  hass?: HomeAssistant;\n  lovelace?: Lovelace;\n  narrow?: boolean;\n  index?: number;\n  cards?: Array<LovelaceCard | HuiErrorCard>;\n  badges?: LovelaceBadge[];\n  isStrategy: boolean;\n  setConfig(config: LovelaceViewConfig): void;\n}\n\ntype LovelaceUpdatedEvent = HassEventBase & {\n  event_type: \"lovelace_updated\";\n  data: {\n    url_path: string | null;\n    mode: \"yaml\" | \"storage\";\n  };\n};\n\nexport const subscribeLovelaceUpdates = (\n  conn: Connection,\n  urlPath: string | null,\n  onChange: () => void\n) =>\n  conn.subscribeEvents<LovelaceUpdatedEvent>((ev) => {\n    if (ev.data.url_path === urlPath) {\n      onChange();\n    }\n  }, \"lovelace_updated\");\n\nexport const getLovelaceCollection = (\n  conn: Connection,\n  urlPath: string | null = null\n) =>\n  getCollection(\n    conn,\n    `_lovelace_${urlPath ?? \"\"}`,\n    (conn2) => fetchConfig(conn2, urlPath, false),\n    (_conn, store) =>\n      subscribeLovelaceUpdates(conn, urlPath, () =>\n        fetchConfig(conn, urlPath, false).then((config) =>\n          store.setState(config, true)\n        )\n      )\n  );\n\n// Legacy functions to support cast for Home Assistion < 0.107\nconst fetchLegacyConfig = (\n  conn: Connection,\n  force: boolean\n): Promise<LegacyLovelaceConfig> =>\n  conn.sendMessagePromise({\n    type: \"lovelace/config\",\n    force,\n  });\n\nconst subscribeLegacyLovelaceUpdates = (\n  conn: Connection,\n  onChange: () => void\n) => conn.subscribeEvents(onChange, \"lovelace_updated\");\n\nexport const getLegacyLovelaceCollection = (conn: Connection) =>\n  getCollection(\n    conn,\n    \"_lovelace\",\n    (conn2) => fetchLegacyConfig(conn2, false),\n    (_conn, store) =>\n      subscribeLegacyLovelaceUpdates(conn, () =>\n        fetchLegacyConfig(conn, false).then((config) =>\n          store.setState(config, true)\n        )\n      )\n  );\n"],"mappings":"AAAA,SAEEA,aAAa,QAER,6BAA6B;AAQpC,SAASC,WAAW,QAA8B,yBAAyB;AA0B3E,OAAO,IAAMC,wBAAwB,GAAG,SAA3BA,wBAAwBA,CACnCC,IAAgB,EAChBC,OAAsB,EACtBC,QAAoB;EAAA,OAEpBF,IAAI,CAACG,eAAe,CAAuB,UAACC,EAAE,EAAK;IACjD,IAAIA,EAAE,CAACC,IAAI,CAACC,QAAQ,KAAKL,OAAO,EAAE;MAChCC,QAAQ,CAAC,CAAC;IACZ;EACF,CAAC,EAAE,kBAAkB,CAAC;AAAA;AAExB,OAAO,IAAMK,qBAAqB,GAAG,SAAxBA,qBAAqBA,CAChCP,IAAgB;EAAA,IAChBC,OAAsB,GAAAO,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,IAAI;EAAA,OAE7BX,aAAa,CACXG,IAAI,eAAAW,MAAA,CACSV,OAAO,aAAPA,OAAO,cAAPA,OAAO,GAAI,EAAE,GAC1B,UAACW,KAAK;IAAA,OAAKd,WAAW,CAACc,KAAK,EAAEX,OAAO,EAAE,KAAK,CAAC;EAAA,GAC7C,UAACY,KAAK,EAAEC,KAAK;IAAA,OACXf,wBAAwB,CAACC,IAAI,EAAEC,OAAO,EAAE;MAAA,OACtCH,WAAW,CAACE,IAAI,EAAEC,OAAO,EAAE,KAAK,CAAC,CAACc,IAAI,CAAC,UAACC,MAAM;QAAA,OAC5CF,KAAK,CAACG,QAAQ,CAACD,MAAM,EAAE,IAAI,CAAC;MAAA,CAC9B,CAAC;IAAA,CACH,CAAC;EAAA,CACL,CAAC;AAAA;;AAEH;AACA,IAAME,iBAAiB,GAAG,SAApBA,iBAAiBA,CACrBlB,IAAgB,EAChBmB,KAAc;EAAA,OAEdnB,IAAI,CAACoB,kBAAkB,CAAC;IACtBC,IAAI,EAAE,iBAAiB;IACvBF,KAAK,EAALA;EACF,CAAC,CAAC;AAAA;AAEJ,IAAMG,8BAA8B,GAAG,SAAjCA,8BAA8BA,CAClCtB,IAAgB,EAChBE,QAAoB;EAAA,OACjBF,IAAI,CAACG,eAAe,CAACD,QAAQ,EAAE,kBAAkB,CAAC;AAAA;AAEvD,OAAO,IAAMqB,2BAA2B,GAAG,SAA9BA,2BAA2BA,CAAIvB,IAAgB;EAAA,OAC1DH,aAAa,CACXG,IAAI,EACJ,WAAW,EACX,UAACY,KAAK;IAAA,OAAKM,iBAAiB,CAACN,KAAK,EAAE,KAAK,CAAC;EAAA,GAC1C,UAACC,KAAK,EAAEC,KAAK;IAAA,OACXQ,8BAA8B,CAACtB,IAAI,EAAE;MAAA,OACnCkB,iBAAiB,CAAClB,IAAI,EAAE,KAAK,CAAC,CAACe,IAAI,CAAC,UAACC,MAAM;QAAA,OACzCF,KAAK,CAACG,QAAQ,CAACD,MAAM,EAAE,IAAI,CAAC;MAAA,CAC9B,CAAC;IAAA,CACH,CAAC;EAAA,CACL,CAAC;AAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}