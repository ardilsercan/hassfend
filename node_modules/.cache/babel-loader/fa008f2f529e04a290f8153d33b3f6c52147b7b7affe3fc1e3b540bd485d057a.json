{"ast":null,"code":"// Compat needs to be first import\nimport \"../resources/compatibility\";\nimport \"../resources/safari-14-attachshadow-patch\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { isNavigationClick } from \"../common/dom/is-navigation-click\";\nimport { loadJS } from \"../common/dom/load_resource\";\nimport { webComponentsSupported } from \"../common/feature-detect/support-web-components\";\nimport { navigate } from \"../common/navigate\";\nimport { baseEntrypointStyles } from \"../resources/styles\";\nimport { createCustomPanelElement } from \"../util/custom-panel/create-custom-panel-element\";\nimport { loadCustomPanel } from \"../util/custom-panel/load-custom-panel\";\nimport { setCustomPanelProperties } from \"../util/custom-panel/set-custom-panel-properties\";\nimport(\"@polymer/polymer/lib/utils/settings\").then(({\n  setCancelSyntheticClickEvents\n}) => setCancelSyntheticClickEvents(false));\nlet es5Loaded;\nwindow.loadES5Adapter = () => {\n  if (!es5Loaded) {\n    es5Loaded = loadJS(`${__STATIC_PATH__}polyfills/custom-elements-es5-adapter.js`).catch(); // Swallow errors as it raises errors on old browsers.\n  }\n  return es5Loaded;\n};\nlet panelEl;\nfunction setProperties(properties) {\n  if (!panelEl) {\n    return;\n  }\n  setCustomPanelProperties(panelEl, properties);\n}\nfunction initialize(panel, properties) {\n  const style = document.createElement(\"style\");\n  style.innerHTML = `\n  body {\n    margin:0;\n    background-color: var(--primary-background-color, #fafafa);\n    color: var(--primary-text-color, #212121);\n  }\n  @media (prefers-color-scheme: dark) {\n    body {\n      background-color: var(--primary-background-color, #111111);\n      color: var(--primary-text-color, #e1e1e1);\n    }\n  }`;\n  document.head.appendChild(style);\n  const config = panel.config._panel_custom;\n  let start = Promise.resolve();\n  if (!webComponentsSupported) {\n    start = start.then(() => loadJS(`${__STATIC_PATH__}polyfills/webcomponents-bundle.js`));\n  }\n  if (__BUILD__ === \"es5\") {\n    start = start.then(() => window.loadES5Adapter());\n  }\n  start.then(() => loadCustomPanel(config))\n  // If our element is using es5, let it finish loading that and define element\n  // This avoids elements getting upgraded after being added to the DOM\n  .then(() => es5Loaded || Promise.resolve()).then(() => {\n    panelEl = createCustomPanelElement(config);\n    const forwardEvent = ev => {\n      if (window.parent.customPanel) {\n        fireEvent(window.parent.customPanel, ev.type, ev.detail);\n      }\n    };\n    panelEl.addEventListener(\"hass-toggle-menu\", forwardEvent);\n    window.addEventListener(\"location-changed\", ev => {\n      if (window.parent.customPanel) {\n        window.parent.customPanel.navigate(window.location.pathname, ev.detail);\n      }\n    });\n    setProperties({\n      panel,\n      ...properties\n    });\n    document.body.appendChild(panelEl);\n  }, err => {\n    // eslint-disable-next-line\n    console.error(err, panel);\n    let errorScreen;\n    if (panel.url_path === \"hassio\") {\n      import(\"../layouts/supervisor-error-screen\");\n      errorScreen = document.createElement(\"supervisor-error-screen\");\n    } else {\n      import(\"../layouts/hass-error-screen\");\n      errorScreen = document.createElement(\"hass-error-screen\");\n      errorScreen.error = `Unable to load the panel source: ${err}.`;\n    }\n    const errorStyle = document.createElement(\"style\");\n    errorStyle.innerHTML = baseEntrypointStyles.cssText;\n    document.body.appendChild(errorStyle);\n    errorScreen.hass = properties.hass;\n    document.body.appendChild(errorScreen);\n  });\n  document.body.addEventListener(\"click\", ev => {\n    const href = isNavigationClick(ev);\n    if (href) {\n      navigate(href);\n    }\n  });\n}\ndocument.addEventListener(\"DOMContentLoaded\", () => window.parent.customPanel.registerIframe(initialize, setProperties), {\n  once: true\n});\nwindow.addEventListener(\"unload\", () => {\n  // allow disconnected callback to fire\n  while (document.body.lastChild) {\n    document.body.removeChild(document.body.lastChild);\n  }\n});","map":{"version":3,"names":["fireEvent","isNavigationClick","loadJS","webComponentsSupported","navigate","baseEntrypointStyles","createCustomPanelElement","loadCustomPanel","setCustomPanelProperties","then","setCancelSyntheticClickEvents","es5Loaded","window","loadES5Adapter","__STATIC_PATH__","catch","panelEl","setProperties","properties","initialize","panel","style","document","createElement","innerHTML","head","appendChild","config","_panel_custom","start","Promise","resolve","__BUILD__","forwardEvent","ev","parent","customPanel","type","detail","addEventListener","location","pathname","body","err","console","error","errorScreen","url_path","errorStyle","cssText","hass","href","registerIframe","once","lastChild","removeChild"],"sources":["/workspaces/frontend/src/entrypoints/custom-panel.ts"],"sourcesContent":["// Compat needs to be first import\nimport \"../resources/compatibility\";\nimport \"../resources/safari-14-attachshadow-patch\";\n\nimport { CSSResult } from \"lit\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { isNavigationClick } from \"../common/dom/is-navigation-click\";\nimport { loadJS } from \"../common/dom/load_resource\";\nimport { webComponentsSupported } from \"../common/feature-detect/support-web-components\";\nimport { navigate } from \"../common/navigate\";\nimport { CustomPanelInfo } from \"../data/panel_custom\";\nimport { baseEntrypointStyles } from \"../resources/styles\";\nimport { createCustomPanelElement } from \"../util/custom-panel/create-custom-panel-element\";\nimport { loadCustomPanel } from \"../util/custom-panel/load-custom-panel\";\nimport { setCustomPanelProperties } from \"../util/custom-panel/set-custom-panel-properties\";\n\nimport(\"@polymer/polymer/lib/utils/settings\").then(\n  ({ setCancelSyntheticClickEvents }) => setCancelSyntheticClickEvents(false)\n);\n\ndeclare global {\n  interface Window {\n    loadES5Adapter: () => Promise<unknown>;\n  }\n}\n\nlet es5Loaded: Promise<unknown> | undefined;\n\nwindow.loadES5Adapter = () => {\n  if (!es5Loaded) {\n    es5Loaded = loadJS(\n      `${__STATIC_PATH__}polyfills/custom-elements-es5-adapter.js`\n    ).catch(); // Swallow errors as it raises errors on old browsers.\n  }\n  return es5Loaded;\n};\n\nlet panelEl: HTMLElement | undefined;\n\nfunction setProperties(properties) {\n  if (!panelEl) {\n    return;\n  }\n  setCustomPanelProperties(panelEl, properties);\n}\n\nfunction initialize(\n  panel: CustomPanelInfo,\n  properties: Record<string, unknown>\n) {\n  const style = document.createElement(\"style\");\n\n  style.innerHTML = `\n  body {\n    margin:0;\n    background-color: var(--primary-background-color, #fafafa);\n    color: var(--primary-text-color, #212121);\n  }\n  @media (prefers-color-scheme: dark) {\n    body {\n      background-color: var(--primary-background-color, #111111);\n      color: var(--primary-text-color, #e1e1e1);\n    }\n  }`;\n  document.head.appendChild(style);\n\n  const config = panel.config._panel_custom;\n  let start: Promise<unknown> = Promise.resolve();\n\n  if (!webComponentsSupported) {\n    start = start.then(() =>\n      loadJS(`${__STATIC_PATH__}polyfills/webcomponents-bundle.js`)\n    );\n  }\n\n  if (__BUILD__ === \"es5\") {\n    start = start.then(() => window.loadES5Adapter());\n  }\n\n  start\n    .then(() => loadCustomPanel(config))\n    // If our element is using es5, let it finish loading that and define element\n    // This avoids elements getting upgraded after being added to the DOM\n    .then(() => es5Loaded || Promise.resolve())\n    .then(\n      () => {\n        panelEl = createCustomPanelElement(config);\n\n        const forwardEvent = (ev) => {\n          if (window.parent.customPanel) {\n            fireEvent(window.parent.customPanel, ev.type, ev.detail);\n          }\n        };\n        panelEl!.addEventListener(\"hass-toggle-menu\", forwardEvent);\n        window.addEventListener(\"location-changed\", (ev: any) => {\n          if (window.parent.customPanel) {\n            window.parent.customPanel.navigate(\n              window.location.pathname,\n              ev.detail\n            );\n          }\n        });\n        setProperties({ panel, ...properties });\n        document.body.appendChild(panelEl!);\n      },\n      (err) => {\n        // eslint-disable-next-line\n        console.error(err, panel);\n        let errorScreen;\n        if (panel.url_path === \"hassio\") {\n          import(\"../layouts/supervisor-error-screen\");\n          errorScreen = document.createElement(\n            \"supervisor-error-screen\"\n          ) as any;\n        } else {\n          import(\"../layouts/hass-error-screen\");\n          errorScreen = document.createElement(\"hass-error-screen\") as any;\n          errorScreen.error = `Unable to load the panel source: ${err}.`;\n        }\n\n        const errorStyle = document.createElement(\"style\");\n        errorStyle.innerHTML = (baseEntrypointStyles as CSSResult).cssText;\n        document.body.appendChild(errorStyle);\n\n        errorScreen.hass = properties.hass;\n        document.body.appendChild(errorScreen);\n      }\n    );\n\n  document.body.addEventListener(\"click\", (ev) => {\n    const href = isNavigationClick(ev);\n    if (href) {\n      navigate(href);\n    }\n  });\n}\n\ndocument.addEventListener(\n  \"DOMContentLoaded\",\n  () => window.parent.customPanel!.registerIframe(initialize, setProperties),\n  { once: true }\n);\n\nwindow.addEventListener(\"unload\", () => {\n  // allow disconnected callback to fire\n  while (document.body.lastChild) {\n    document.body.removeChild(document.body.lastChild);\n  }\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}