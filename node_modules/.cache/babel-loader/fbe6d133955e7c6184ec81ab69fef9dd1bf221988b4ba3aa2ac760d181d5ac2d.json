{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _callSuper from \"@babel/runtime/helpers/callSuper\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _decorate from \"@babel/runtime/helpers/decorate\";\nimport _get from \"@babel/runtime/helpers/get\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _templateObject, _templateObject2, _templateObject3;\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.sort.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.filter.js\";\nimport \"core-js/modules/esnext.iterator.map.js\";\nimport \"core-js/modules/esnext.iterator.some.js\";\nimport \"@material/mwc-list/mwc-list-item\";\nimport { LitElement, css, html, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { fireEvent } from \"../../../../common/dom/fire_event\";\nimport { stringCompare } from \"../../../../common/string/compare\";\nimport \"../../../../components/user/ha-user-badge\";\nimport { fetchUsers } from \"../../../../data/user\";\nexport var HuiViewVisibilityEditor = _decorate([customElement(\"hui-view-visibility-editor\")], function (_initialize, _LitElement) {\n  var HuiViewVisibilityEditor = /*#__PURE__*/function (_LitElement2) {\n    _inherits(HuiViewVisibilityEditor, _LitElement2);\n    function HuiViewVisibilityEditor() {\n      var _this;\n      _classCallCheck(this, HuiViewVisibilityEditor);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _callSuper(this, HuiViewVisibilityEditor, [].concat(args));\n      _initialize(_assertThisInitialized(_this));\n      return _this;\n    }\n    return _createClass(HuiViewVisibilityEditor);\n  }(_LitElement);\n  return {\n    F: HuiViewVisibilityEditor,\n    d: [{\n      kind: \"set\",\n      key: \"config\",\n      value: function config(_config) {\n        this._config = _config;\n        this._visible = this._config.visible === undefined ? true : this._config.visible;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_config\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_users\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_visible\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      key: \"_sortedUsers\",\n      value: function value() {\n        var _this2 = this;\n        return memoizeOne(function (users) {\n          return users.sort(function (a, b) {\n            return stringCompare(a.name, b.name, _this2.hass.locale.language);\n          });\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"firstUpdated\",\n      value: function firstUpdated(changedProps) {\n        var _this3 = this;\n        _get(_getPrototypeOf(HuiViewVisibilityEditor.prototype), \"firstUpdated\", this).call(this, changedProps);\n        fetchUsers(this.hass).then(function (users) {\n          _this3._users = users.filter(function (user) {\n            return !user.system_generated;\n          });\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"render\",\n      value: function render() {\n        var _this4 = this;\n        if (!this.hass || !this._users) {\n          return nothing;\n        }\n        return html(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n      <p>\\n        \", \"\\n      </p>\\n      \", \"\\n    \"])), this.hass.localize(\"ui.panel.lovelace.editor.edit_view.visibility.select_users\"), this._sortedUsers(this._users).map(function (user) {\n          return html(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\\n          <mwc-list-item graphic=\\\"avatar\\\" hasMeta>\\n            <ha-user-badge\\n              slot=\\\"graphic\\\"\\n              .hass=\", \"\\n              .user=\", \"\\n            ></ha-user-badge>\\n            <span>\", \"</span>\\n            <ha-switch\\n              slot=\\\"meta\\\"\\n              .userId=\", \"\\n              @change=\", \"\\n              .checked=\", \"\\n            ></ha-switch>\\n          </mwc-list-item>\\n        \"])), _this4.hass, user, user.name, user.id, _this4.valChange, _this4.checkUser(user.id));\n        }));\n      }\n    }, {\n      kind: \"method\",\n      key: \"checkUser\",\n      value: function checkUser(userId) {\n        if (this._visible === undefined) {\n          return true;\n        }\n        if (typeof this._visible === \"boolean\") {\n          return this._visible;\n        }\n        return this._visible.some(function (u) {\n          return u.user === userId;\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"valChange\",\n      value: function valChange(ev) {\n        var _this5 = this;\n        var userId = ev.currentTarget.userId;\n        var checked = ev.currentTarget.checked;\n        var newVisible = [];\n        if (typeof this._visible === \"boolean\") {\n          var lastValue = this._visible;\n          if (lastValue) {\n            newVisible = this._users.map(function (u) {\n              return {\n                user: u.id\n              };\n            });\n          }\n        } else {\n          newVisible = _toConsumableArray(this._visible);\n        }\n        if (checked === true) {\n          var newEntry = {\n            user: userId\n          };\n          newVisible.push(newEntry);\n        } else {\n          newVisible = newVisible.filter(function (c) {\n            return c.user !== userId;\n          });\n        }\n\n        // this removes users that doesn't exists in system but had view permissions\n        this._visible = newVisible.filter(function (c) {\n          return _this5._users.some(function (u) {\n            return u.id === c.user;\n          });\n        });\n        fireEvent(this, \"view-visibility-changed\", {\n          visible: this._visible\n        });\n      }\n    }, {\n      kind: \"get\",\n      static: true,\n      key: \"styles\",\n      value: function styles() {\n        return css(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\\n      :host {\\n        display: block;\\n      }\\n    \"])));\n      }\n    }]\n  };\n}, LitElement);","map":{"version":3,"names":["LitElement","css","html","nothing","customElement","property","state","memoizeOne","fireEvent","stringCompare","fetchUsers","HuiViewVisibilityEditor","_decorate","_initialize","_LitElement","_LitElement2","_inherits","_this","_classCallCheck","_len","arguments","length","args","Array","_key","_callSuper","concat","_assertThisInitialized","_createClass","F","d","kind","key","value","config","_config","_visible","visible","undefined","decorators","attribute","_this2","users","sort","a","b","name","hass","locale","language","firstUpdated","changedProps","_this3","_get","_getPrototypeOf","prototype","call","then","_users","filter","user","system_generated","render","_this4","_templateObject","_taggedTemplateLiteral","localize","_sortedUsers","map","_templateObject2","id","valChange","checkUser","userId","some","u","ev","_this5","currentTarget","checked","newVisible","lastValue","_toConsumableArray","newEntry","push","c","static","styles","_templateObject3"],"sources":["/workspaces/frontend/src/panels/lovelace/editor/view-editor/hui-view-visibility-editor.ts"],"sourcesContent":["import \"@material/mwc-list/mwc-list-item\";\nimport {\n  CSSResultGroup,\n  LitElement,\n  PropertyValues,\n  css,\n  html,\n  nothing,\n} from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { fireEvent } from \"../../../../common/dom/fire_event\";\nimport { stringCompare } from \"../../../../common/string/compare\";\nimport { HaSwitch } from \"../../../../components/ha-switch\";\nimport \"../../../../components/user/ha-user-badge\";\nimport {\n  LovelaceViewConfig,\n  ShowViewConfig,\n} from \"../../../../data/lovelace/config/view\";\nimport { User, fetchUsers } from \"../../../../data/user\";\nimport { HomeAssistant } from \"../../../../types\";\n\ndeclare global {\n  interface HASSDomEvents {\n    \"view-visibility-changed\": {\n      visible: ShowViewConfig[];\n    };\n  }\n}\n\n@customElement(\"hui-view-visibility-editor\")\nexport class HuiViewVisibilityEditor extends LitElement {\n  set config(config: LovelaceViewConfig) {\n    this._config = config;\n    this._visible =\n      this._config.visible === undefined ? true : this._config.visible;\n  }\n\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @state() private _config!: LovelaceViewConfig;\n\n  @state() private _users!: User[];\n\n  @state() private _visible!: boolean | ShowViewConfig[];\n\n  private _sortedUsers = memoizeOne((users: User[]) =>\n    users.sort((a, b) =>\n      stringCompare(a.name, b.name, this.hass.locale.language)\n    )\n  );\n\n  protected firstUpdated(changedProps: PropertyValues) {\n    super.firstUpdated(changedProps);\n\n    fetchUsers(this.hass).then((users) => {\n      this._users = users.filter((user) => !user.system_generated);\n    });\n  }\n\n  protected render() {\n    if (!this.hass || !this._users) {\n      return nothing;\n    }\n\n    return html`\n      <p>\n        ${this.hass.localize(\n          \"ui.panel.lovelace.editor.edit_view.visibility.select_users\"\n        )}\n      </p>\n      ${this._sortedUsers(this._users).map(\n        (user) => html`\n          <mwc-list-item graphic=\"avatar\" hasMeta>\n            <ha-user-badge\n              slot=\"graphic\"\n              .hass=${this.hass}\n              .user=${user}\n            ></ha-user-badge>\n            <span>${user.name}</span>\n            <ha-switch\n              slot=\"meta\"\n              .userId=${user.id}\n              @change=${this.valChange}\n              .checked=${this.checkUser(user.id)}\n            ></ha-switch>\n          </mwc-list-item>\n        `\n      )}\n    `;\n  }\n\n  protected checkUser(userId: string): boolean {\n    if (this._visible === undefined) {\n      return true;\n    }\n    if (typeof this._visible === \"boolean\") {\n      return this._visible as boolean;\n    }\n    return (this._visible as ShowViewConfig[]).some((u) => u.user === userId);\n  }\n\n  private valChange(ev: Event): void {\n    const userId = (ev.currentTarget as any).userId;\n    const checked = (ev.currentTarget as HaSwitch).checked;\n\n    let newVisible: ShowViewConfig[] = [];\n\n    if (typeof this._visible === \"boolean\") {\n      const lastValue = this._visible as boolean;\n      if (lastValue) {\n        newVisible = this._users.map((u) => ({\n          user: u.id,\n        }));\n      }\n    } else {\n      newVisible = [...this._visible];\n    }\n\n    if (checked === true) {\n      const newEntry: ShowViewConfig = {\n        user: userId,\n      };\n      newVisible.push(newEntry);\n    } else {\n      newVisible = (newVisible as ShowViewConfig[]).filter(\n        (c) => c.user !== userId\n      );\n    }\n\n    // this removes users that doesn't exists in system but had view permissions\n    this._visible = newVisible.filter((c) =>\n      this._users.some((u) => u.id === c.user)\n    );\n\n    fireEvent(this, \"view-visibility-changed\", { visible: this._visible });\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      :host {\n        display: block;\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"hui-view-visibility-editor\": HuiViewVisibilityEditor;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}