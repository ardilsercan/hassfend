{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/helpers/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _createForOfIteratorHelper from \"@babel/runtime/helpers/createForOfIteratorHelper\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _callSuper from \"@babel/runtime/helpers/callSuper\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _decorate from \"@babel/runtime/helpers/decorate\";\nimport _get from \"@babel/runtime/helpers/get\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _templateObject, _templateObject2;\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.object.assign.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.parse-int.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport { Calendar } from \"@fullcalendar/core\";\nimport allLocales from \"@fullcalendar/core/locales-all\";\nimport interactionPlugin from \"@fullcalendar/interaction\";\nimport timeGridPlugin from \"@fullcalendar/timegrid\";\nimport { addDays, isSameDay, isSameWeek, nextDay } from \"date-fns\";\nimport { LitElement, css, html, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { firstWeekdayIndex } from \"../../../../common/datetime/first_weekday\";\nimport { formatTime24h } from \"../../../../common/datetime/format_time\";\nimport { useAmPm } from \"../../../../common/datetime/use_am_pm\";\nimport { fireEvent } from \"../../../../common/dom/fire_event\";\nimport \"../../../../components/ha-icon-picker\";\nimport \"../../../../components/ha-textfield\";\nimport { weekdays } from \"../../../../data/schedule\";\nimport { TimeZone } from \"../../../../data/translation\";\nimport { showConfirmationDialog } from \"../../../../dialogs/generic/show-dialog-box\";\nimport { haStyle } from \"../../../../resources/styles\";\nvar defaultFullCalendarConfig = {\n  plugins: [timeGridPlugin, interactionPlugin],\n  headerToolbar: false,\n  initialView: \"timeGridWeek\",\n  editable: true,\n  selectable: true,\n  selectMirror: true,\n  selectOverlap: false,\n  eventOverlap: false,\n  allDaySlot: false,\n  height: \"parent\",\n  locales: allLocales,\n  firstDay: 1,\n  dayHeaderFormat: {\n    weekday: \"short\",\n    month: undefined,\n    day: undefined\n  }\n};\nvar HaScheduleForm = _decorate([customElement(\"ha-schedule-form\")], function (_initialize, _LitElement) {\n  var HaScheduleForm = /*#__PURE__*/function (_LitElement2) {\n    _inherits(HaScheduleForm, _LitElement2);\n    function HaScheduleForm() {\n      var _this;\n      _classCallCheck(this, HaScheduleForm);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _callSuper(this, HaScheduleForm, [].concat(args));\n      _initialize(_assertThisInitialized(_this));\n      return _this;\n    }\n    return _createClass(HaScheduleForm);\n  }(_LitElement);\n  return {\n    F: HaScheduleForm,\n    d: [{\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [property({\n        type: Boolean\n      })],\n      key: \"new\",\n      value: function value() {\n        return false;\n      }\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_name\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_icon\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_monday\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_tuesday\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_wednesday\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_thursday\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_friday\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_saturday\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_sunday\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"calendar\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      key: \"_item\",\n      value: void 0\n    }, {\n      kind: \"set\",\n      key: \"item\",\n      value: function item(_item) {\n        this._item = _item;\n        if (_item) {\n          this._name = _item.name || \"\";\n          this._icon = _item.icon || \"\";\n          this._monday = _item.monday || [];\n          this._tuesday = _item.tuesday || [];\n          this._wednesday = _item.wednesday || [];\n          this._thursday = _item.thursday || [];\n          this._friday = _item.friday || [];\n          this._saturday = _item.saturday || [];\n          this._sunday = _item.sunday || [];\n        } else {\n          this._name = \"\";\n          this._icon = \"\";\n          this._monday = [];\n          this._tuesday = [];\n          this._wednesday = [];\n          this._thursday = [];\n          this._friday = [];\n          this._saturday = [];\n          this._sunday = [];\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"disconnectedCallback\",\n      value: function disconnectedCallback() {\n        var _this$calendar, _this$renderRoot$quer;\n        _get(_getPrototypeOf(HaScheduleForm.prototype), \"disconnectedCallback\", this).call(this);\n        (_this$calendar = this.calendar) === null || _this$calendar === void 0 || _this$calendar.destroy();\n        this.calendar = undefined;\n        (_this$renderRoot$quer = this.renderRoot.querySelector(\"style[data-fullcalendar]\")) === null || _this$renderRoot$quer === void 0 || _this$renderRoot$quer.remove();\n      }\n    }, {\n      kind: \"method\",\n      key: \"connectedCallback\",\n      value: function connectedCallback() {\n        _get(_getPrototypeOf(HaScheduleForm.prototype), \"connectedCallback\", this).call(this);\n        if (this.hasUpdated && !this.calendar) {\n          this.setupCalendar();\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"focus\",\n      value: function focus() {\n        var _this2 = this;\n        this.updateComplete.then(function () {\n          var _this2$shadowRoot;\n          return (_this2$shadowRoot = _this2.shadowRoot) === null || _this2$shadowRoot === void 0 || (_this2$shadowRoot = _this2$shadowRoot.querySelector(\"[dialogInitialFocus]\")) === null || _this2$shadowRoot === void 0 ? void 0 : _this2$shadowRoot.focus();\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"render\",\n      value: function render() {\n        if (!this.hass) {\n          return nothing;\n        }\n        return html(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n      <div class=\\\"form\\\">\\n        <ha-textfield\\n          .value=\", \"\\n          .configValue=\", \"\\n          @input=\", \"\\n          .label=\", \"\\n          autoValidate\\n          required\\n          .validationMessage=\", \"\\n          dialogInitialFocus\\n        ></ha-textfield>\\n        <ha-icon-picker\\n          .hass=\", \"\\n          .value=\", \"\\n          .configValue=\", \"\\n          @value-changed=\", \"\\n          .label=\", \"\\n        ></ha-icon-picker>\\n        <div id=\\\"calendar\\\"></div>\\n      </div>\\n    \"])), this._name, \"name\", this._valueChanged, this.hass.localize(\"ui.dialogs.helper_settings.generic.name\"), this.hass.localize(\"ui.dialogs.helper_settings.required_error_msg\"), this.hass, this._icon, \"icon\", this._valueChanged, this.hass.localize(\"ui.dialogs.helper_settings.generic.icon\"));\n      }\n    }, {\n      kind: \"method\",\n      key: \"willUpdate\",\n      value: function willUpdate(changedProps) {\n        _get(_getPrototypeOf(HaScheduleForm.prototype), \"willUpdate\", this).call(this, changedProps);\n        if (!this.calendar) {\n          return;\n        }\n        if (changedProps.has(\"_sunday\") || changedProps.has(\"_monday\") || changedProps.has(\"_tuesday\") || changedProps.has(\"_wednesday\") || changedProps.has(\"_thursday\") || changedProps.has(\"_friday\") || changedProps.has(\"_saturday\") || changedProps.has(\"calendar\")) {\n          this.calendar.removeAllEventSources();\n          this.calendar.addEventSource(this._events);\n        }\n        var oldHass = changedProps.get(\"hass\");\n        if (oldHass && oldHass.language !== this.hass.language) {\n          this.calendar.setOption(\"locale\", this.hass.language);\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"firstUpdated\",\n      value: function firstUpdated() {\n        this.setupCalendar();\n      }\n    }, {\n      kind: \"method\",\n      key: \"setupCalendar\",\n      value: function setupCalendar() {\n        var _this3 = this;\n        var config = Object.assign(Object.assign({}, defaultFullCalendarConfig), {}, {\n          locale: this.hass.language,\n          firstDay: firstWeekdayIndex(this.hass.locale),\n          slotLabelFormat: {\n            hour: \"numeric\",\n            minute: undefined,\n            hour12: useAmPm(this.hass.locale),\n            meridiem: useAmPm(this.hass.locale) ? \"narrow\" : false\n          },\n          eventTimeFormat: {\n            hour: useAmPm(this.hass.locale) ? \"numeric\" : \"2-digit\",\n            minute: useAmPm(this.hass.locale) ? \"numeric\" : \"2-digit\",\n            hour12: useAmPm(this.hass.locale),\n            meridiem: useAmPm(this.hass.locale) ? \"narrow\" : false\n          }\n        });\n        config.eventClick = function (info) {\n          return _this3._handleEventClick(info);\n        };\n        config.select = function (info) {\n          return _this3._handleSelect(info);\n        };\n        config.eventResize = function (info) {\n          return _this3._handleEventResize(info);\n        };\n        config.eventDrop = function (info) {\n          return _this3._handleEventDrop(info);\n        };\n        this.calendar = new Calendar(this.shadowRoot.getElementById(\"calendar\"), config);\n        this.calendar.render();\n      }\n    }, {\n      kind: \"get\",\n      key: \"_events\",\n      value: function _events() {\n        var _this4 = this;\n        var events = [];\n        var _iterator = _createForOfIteratorHelper(weekdays.entries()),\n          _step;\n        try {\n          var _loop = function _loop() {\n            var _step$value = _slicedToArray(_step.value, 2),\n              i = _step$value[0],\n              day = _step$value[1];\n            if (!_this4[\"_\".concat(day)].length) {\n              return 1; // continue\n            }\n            _this4[\"_\".concat(day)].forEach(function (item, index) {\n              var date = nextDay(new Date(), i);\n              if (!isSameWeek(date, new Date(), {\n                weekStartsOn: firstWeekdayIndex(_this4.hass.locale)\n              })) {\n                date = addDays(date, -7);\n              }\n              var start = new Date(date);\n              var start_tokens = item.from.split(\":\");\n              start.setHours(parseInt(start_tokens[0]), parseInt(start_tokens[1]), 0, 0);\n              var end = new Date(date);\n              var end_tokens = item.to.split(\":\");\n              end.setHours(parseInt(end_tokens[0]), parseInt(end_tokens[1]), 0, 0);\n              events.push({\n                id: \"\".concat(day, \"-\").concat(index),\n                start: start.toISOString(),\n                end: end.toISOString()\n              });\n            });\n          };\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            if (_loop()) continue;\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n        return events;\n      }\n    }, {\n      kind: \"method\",\n      key: \"_handleSelect\",\n      value: function _handleSelect(info) {\n        var start = info.start,\n          end = info.end;\n        var day = weekdays[start.getDay()];\n        var value = _toConsumableArray(this[\"_\".concat(day)]);\n        var newValue = Object.assign({}, this._item);\n\n        // Schedule is timezone unaware, we need to format it in local time\n        var endFormatted = formatTime24h(end, Object.assign(Object.assign({}, this.hass.locale), {}, {\n          time_zone: TimeZone.local\n        }), this.hass.config);\n        value.push({\n          from: formatTime24h(start, Object.assign(Object.assign({}, this.hass.locale), {}, {\n            time_zone: TimeZone.local\n          }), this.hass.config),\n          to: !isSameDay(start, end) || endFormatted === \"0:00\" ? \"24:00\" : endFormatted\n        });\n        newValue[day] = value;\n        fireEvent(this, \"value-changed\", {\n          value: newValue\n        });\n        if (!isSameDay(start, end)) {\n          this.calendar.unselect();\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"_handleEventResize\",\n      value: function _handleEventResize(info) {\n        var _info$event = info.event,\n          id = _info$event.id,\n          start = _info$event.start,\n          end = _info$event.end;\n        var _id$split = id.split(\"-\"),\n          _id$split2 = _slicedToArray(_id$split, 2),\n          day = _id$split2[0],\n          index = _id$split2[1];\n        var value = this[\"_\".concat(day)][parseInt(index)];\n        var newValue = Object.assign({}, this._item);\n        var endFormatted = formatTime24h(end, this.hass.locale, this.hass.config);\n        newValue[day][index] = {\n          from: value.from,\n          to: !isSameDay(start, end) || endFormatted === \"0:00\" ? \"24:00\" : endFormatted\n        };\n        fireEvent(this, \"value-changed\", {\n          value: newValue\n        });\n        if (!isSameDay(start, end)) {\n          this.requestUpdate(\"_\".concat(day));\n          info.revert();\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"_handleEventDrop\",\n      value: function _handleEventDrop(info) {\n        var _info$event2 = info.event,\n          id = _info$event2.id,\n          start = _info$event2.start,\n          end = _info$event2.end;\n        var _id$split3 = id.split(\"-\"),\n          _id$split4 = _slicedToArray(_id$split3, 2),\n          day = _id$split4[0],\n          index = _id$split4[1];\n        var newDay = weekdays[start.getDay()];\n        var newValue = Object.assign({}, this._item);\n        var endFormatted = formatTime24h(end, this.hass.locale, this.hass.config);\n        var event = {\n          from: formatTime24h(start, this.hass.locale, this.hass.config),\n          to: !isSameDay(start, end) || endFormatted === \"0:00\" ? \"24:00\" : endFormatted\n        };\n        if (newDay === day) {\n          newValue[day][index] = event;\n        } else {\n          newValue[day].splice(index, 1);\n          var value = _toConsumableArray(this[\"_\".concat(newDay)]);\n          value.push(event);\n          newValue[newDay] = value;\n        }\n        fireEvent(this, \"value-changed\", {\n          value: newValue\n        });\n        if (!isSameDay(start, end)) {\n          this.requestUpdate(\"_\".concat(day));\n          info.revert();\n        }\n      }\n    }, {\n      kind: \"method\",\n      key: \"_handleEventClick\",\n      value: function () {\n        var _handleEventClick2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(info) {\n          var _info$event$id$split, _info$event$id$split2, day, index, value, newValue;\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return showConfirmationDialog(this, {\n                  title: this.hass.localize(\"ui.dialogs.helper_settings.schedule.delete\"),\n                  text: this.hass.localize(\"ui.dialogs.helper_settings.schedule.confirm_delete\"),\n                  destructive: true,\n                  confirmText: this.hass.localize(\"ui.common.delete\")\n                });\n              case 2:\n                if (_context.sent) {\n                  _context.next = 4;\n                  break;\n                }\n                return _context.abrupt(\"return\");\n              case 4:\n                _info$event$id$split = info.event.id.split(\"-\"), _info$event$id$split2 = _slicedToArray(_info$event$id$split, 2), day = _info$event$id$split2[0], index = _info$event$id$split2[1];\n                value = _toConsumableArray(this[\"_\".concat(day)]);\n                newValue = Object.assign({}, this._item);\n                value.splice(parseInt(index), 1);\n                newValue[day] = value;\n                fireEvent(this, \"value-changed\", {\n                  value: newValue\n                });\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }, _callee, this);\n        }));\n        function _handleEventClick(_x) {\n          return _handleEventClick2.apply(this, arguments);\n        }\n        return _handleEventClick;\n      }()\n    }, {\n      kind: \"method\",\n      key: \"_valueChanged\",\n      value: function _valueChanged(ev) {\n        var _ev$detail;\n        if (!this.new && !this._item) {\n          return;\n        }\n        ev.stopPropagation();\n        var configValue = ev.target.configValue;\n        var value = ((_ev$detail = ev.detail) === null || _ev$detail === void 0 ? void 0 : _ev$detail.value) || ev.target.value;\n        if (this[\"_\".concat(configValue)] === value) {\n          return;\n        }\n        var newValue = Object.assign({}, this._item);\n        if (!value) {\n          delete newValue[configValue];\n        } else {\n          newValue[configValue] = value;\n        }\n        fireEvent(this, \"value-changed\", {\n          value: newValue\n        });\n      }\n    }, {\n      kind: \"get\",\n      static: true,\n      key: \"styles\",\n      value: function styles() {\n        return [haStyle, css(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\\n        .form {\\n          color: var(--primary-text-color);\\n        }\\n\\n        ha-textfield {\\n          display: block;\\n          margin: 8px 0;\\n        }\\n\\n        #calendar {\\n          margin: 8px 0;\\n          height: 450px;\\n          width: 100%;\\n          -webkit-user-select: none;\\n          -ms-user-select: none;\\n          user-select: none;\\n          --fc-border-color: var(--divider-color);\\n          --fc-event-border-color: var(--divider-color);\\n        }\\n\\n        .fc-v-event .fc-event-time {\\n          white-space: inherit;\\n        }\\n        .fc-theme-standard .fc-scrollgrid {\\n          border: 1px solid var(--divider-color);\\n          border-radius: var(--mdc-shape-small, 4px);\\n        }\\n\\n        .fc-scrollgrid-section-header td {\\n          border: none;\\n        }\\n        :host([narrow]) .fc-scrollgrid-sync-table {\\n          overflow: hidden;\\n        }\\n        table.fc-scrollgrid-sync-table\\n          tbody\\n          tr:first-child\\n          .fc-daygrid-day-top {\\n          padding-top: 0;\\n        }\\n        .fc-scroller::-webkit-scrollbar {\\n          width: 0.4rem;\\n          height: 0.4rem;\\n        }\\n        .fc-scroller::-webkit-scrollbar-thumb {\\n          -webkit-border-radius: 4px;\\n          border-radius: 4px;\\n          background: var(--scrollbar-thumb-color);\\n        }\\n        .fc-scroller {\\n          overflow-y: auto;\\n          scrollbar-color: var(--scrollbar-thumb-color) transparent;\\n          scrollbar-width: thin;\\n        }\\n\\n        .fc-timegrid-event-short .fc-event-time:after {\\n          content: \\\"\\\"; /* prevent trailing dash in half hour events since we do not have event titles */\\n        }\\n\\n        a {\\n          color: inherit !important;\\n        }\\n\\n        th.fc-col-header-cell.fc-day {\\n          background-color: var(--table-header-background-color);\\n          color: var(--primary-text-color);\\n          font-size: 11px;\\n          font-weight: bold;\\n          text-transform: uppercase;\\n        }\\n      \"])))];\n      }\n    }]\n  };\n}, LitElement);","map":{"version":3,"names":["Calendar","allLocales","interactionPlugin","timeGridPlugin","addDays","isSameDay","isSameWeek","nextDay","LitElement","css","html","nothing","customElement","property","state","firstWeekdayIndex","formatTime24h","useAmPm","fireEvent","weekdays","TimeZone","showConfirmationDialog","haStyle","defaultFullCalendarConfig","plugins","headerToolbar","initialView","editable","selectable","selectMirror","selectOverlap","eventOverlap","allDaySlot","height","locales","firstDay","dayHeaderFormat","weekday","month","undefined","day","HaScheduleForm","_decorate","_initialize","_LitElement","_LitElement2","_inherits","_this","_classCallCheck","_len","arguments","length","args","Array","_key","_callSuper","concat","_assertThisInitialized","_createClass","F","d","kind","decorators","attribute","key","value","type","Boolean","item","_item","_name","name","_icon","icon","_monday","monday","_tuesday","tuesday","_wednesday","wednesday","_thursday","thursday","_friday","friday","_saturday","saturday","_sunday","sunday","disconnectedCallback","_this$calendar","_this$renderRoot$quer","_get","_getPrototypeOf","prototype","call","calendar","destroy","renderRoot","querySelector","remove","connectedCallback","hasUpdated","setupCalendar","focus","_this2","updateComplete","then","_this2$shadowRoot","shadowRoot","render","hass","_templateObject","_taggedTemplateLiteral","_valueChanged","localize","willUpdate","changedProps","has","removeAllEventSources","addEventSource","_events","oldHass","get","language","setOption","firstUpdated","_this3","config","Object","assign","locale","slotLabelFormat","hour","minute","hour12","meridiem","eventTimeFormat","eventClick","info","_handleEventClick","select","_handleSelect","eventResize","_handleEventResize","eventDrop","_handleEventDrop","getElementById","_this4","events","_iterator","_createForOfIteratorHelper","entries","_step","_loop","_step$value","_slicedToArray","i","forEach","index","date","Date","weekStartsOn","start","start_tokens","from","split","setHours","parseInt","end","end_tokens","to","push","id","toISOString","s","n","done","err","e","f","getDay","_toConsumableArray","newValue","endFormatted","time_zone","local","unselect","_info$event","event","_id$split","_id$split2","requestUpdate","revert","_info$event2","_id$split3","_id$split4","newDay","splice","_handleEventClick2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_info$event$id$split","_info$event$id$split2","wrap","_callee$","_context","prev","next","title","text","destructive","confirmText","sent","abrupt","stop","_x","apply","ev","_ev$detail","new","stopPropagation","configValue","target","detail","static","styles","_templateObject2"],"sources":["/workspaces/frontend/src/panels/config/helpers/forms/ha-schedule-form.ts"],"sourcesContent":["import { Calendar, CalendarOptions } from \"@fullcalendar/core\";\nimport allLocales from \"@fullcalendar/core/locales-all\";\nimport interactionPlugin from \"@fullcalendar/interaction\";\nimport timeGridPlugin from \"@fullcalendar/timegrid\";\nimport { addDays, isSameDay, isSameWeek, nextDay } from \"date-fns\";\nimport {\n  CSSResultGroup,\n  LitElement,\n  PropertyValues,\n  css,\n  html,\n  nothing,\n} from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { firstWeekdayIndex } from \"../../../../common/datetime/first_weekday\";\nimport { formatTime24h } from \"../../../../common/datetime/format_time\";\nimport { useAmPm } from \"../../../../common/datetime/use_am_pm\";\nimport { fireEvent } from \"../../../../common/dom/fire_event\";\nimport \"../../../../components/ha-icon-picker\";\nimport \"../../../../components/ha-textfield\";\nimport { Schedule, ScheduleDay, weekdays } from \"../../../../data/schedule\";\nimport { TimeZone } from \"../../../../data/translation\";\nimport { showConfirmationDialog } from \"../../../../dialogs/generic/show-dialog-box\";\nimport { haStyle } from \"../../../../resources/styles\";\nimport { HomeAssistant } from \"../../../../types\";\n\nconst defaultFullCalendarConfig: CalendarOptions = {\n  plugins: [timeGridPlugin, interactionPlugin],\n  headerToolbar: false,\n  initialView: \"timeGridWeek\",\n  editable: true,\n  selectable: true,\n  selectMirror: true,\n  selectOverlap: false,\n  eventOverlap: false,\n  allDaySlot: false,\n  height: \"parent\",\n  locales: allLocales,\n  firstDay: 1,\n  dayHeaderFormat: { weekday: \"short\", month: undefined, day: undefined },\n};\n\n@customElement(\"ha-schedule-form\")\nclass HaScheduleForm extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ type: Boolean }) public new = false;\n\n  @state() private _name!: string;\n\n  @state() private _icon!: string;\n\n  @state() private _monday!: ScheduleDay[];\n\n  @state() private _tuesday!: ScheduleDay[];\n\n  @state() private _wednesday!: ScheduleDay[];\n\n  @state() private _thursday!: ScheduleDay[];\n\n  @state() private _friday!: ScheduleDay[];\n\n  @state() private _saturday!: ScheduleDay[];\n\n  @state() private _sunday!: ScheduleDay[];\n\n  @state() private calendar?: Calendar;\n\n  private _item?: Schedule;\n\n  set item(item: Schedule) {\n    this._item = item;\n    if (item) {\n      this._name = item.name || \"\";\n      this._icon = item.icon || \"\";\n      this._monday = item.monday || [];\n      this._tuesday = item.tuesday || [];\n      this._wednesday = item.wednesday || [];\n      this._thursday = item.thursday || [];\n      this._friday = item.friday || [];\n      this._saturday = item.saturday || [];\n      this._sunday = item.sunday || [];\n    } else {\n      this._name = \"\";\n      this._icon = \"\";\n      this._monday = [];\n      this._tuesday = [];\n      this._wednesday = [];\n      this._thursday = [];\n      this._friday = [];\n      this._saturday = [];\n      this._sunday = [];\n    }\n  }\n\n  public disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this.calendar?.destroy();\n    this.calendar = undefined;\n    this.renderRoot.querySelector(\"style[data-fullcalendar]\")?.remove();\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n    if (this.hasUpdated && !this.calendar) {\n      this.setupCalendar();\n    }\n  }\n\n  public focus() {\n    this.updateComplete.then(() =>\n      (\n        this.shadowRoot?.querySelector(\"[dialogInitialFocus]\") as HTMLElement\n      )?.focus()\n    );\n  }\n\n  protected render() {\n    if (!this.hass) {\n      return nothing;\n    }\n\n    return html`\n      <div class=\"form\">\n        <ha-textfield\n          .value=${this._name}\n          .configValue=${\"name\"}\n          @input=${this._valueChanged}\n          .label=${this.hass!.localize(\n            \"ui.dialogs.helper_settings.generic.name\"\n          )}\n          autoValidate\n          required\n          .validationMessage=${this.hass!.localize(\n            \"ui.dialogs.helper_settings.required_error_msg\"\n          )}\n          dialogInitialFocus\n        ></ha-textfield>\n        <ha-icon-picker\n          .hass=${this.hass}\n          .value=${this._icon}\n          .configValue=${\"icon\"}\n          @value-changed=${this._valueChanged}\n          .label=${this.hass!.localize(\n            \"ui.dialogs.helper_settings.generic.icon\"\n          )}\n        ></ha-icon-picker>\n        <div id=\"calendar\"></div>\n      </div>\n    `;\n  }\n\n  public willUpdate(changedProps: PropertyValues): void {\n    super.willUpdate(changedProps);\n    if (!this.calendar) {\n      return;\n    }\n\n    if (\n      changedProps.has(\"_sunday\") ||\n      changedProps.has(\"_monday\") ||\n      changedProps.has(\"_tuesday\") ||\n      changedProps.has(\"_wednesday\") ||\n      changedProps.has(\"_thursday\") ||\n      changedProps.has(\"_friday\") ||\n      changedProps.has(\"_saturday\") ||\n      changedProps.has(\"calendar\")\n    ) {\n      this.calendar.removeAllEventSources();\n      this.calendar.addEventSource(this._events);\n    }\n\n    const oldHass = changedProps.get(\"hass\") as HomeAssistant;\n\n    if (oldHass && oldHass.language !== this.hass.language) {\n      this.calendar.setOption(\"locale\", this.hass.language);\n    }\n  }\n\n  protected firstUpdated(): void {\n    this.setupCalendar();\n  }\n\n  private setupCalendar(): void {\n    const config: CalendarOptions = {\n      ...defaultFullCalendarConfig,\n      locale: this.hass.language,\n      firstDay: firstWeekdayIndex(this.hass.locale),\n      slotLabelFormat: {\n        hour: \"numeric\",\n        minute: undefined,\n        hour12: useAmPm(this.hass.locale),\n        meridiem: useAmPm(this.hass.locale) ? \"narrow\" : false,\n      },\n      eventTimeFormat: {\n        hour: useAmPm(this.hass.locale) ? \"numeric\" : \"2-digit\",\n        minute: useAmPm(this.hass.locale) ? \"numeric\" : \"2-digit\",\n        hour12: useAmPm(this.hass.locale),\n        meridiem: useAmPm(this.hass.locale) ? \"narrow\" : false,\n      },\n    };\n\n    config.eventClick = (info) => this._handleEventClick(info);\n    config.select = (info) => this._handleSelect(info);\n    config.eventResize = (info) => this._handleEventResize(info);\n    config.eventDrop = (info) => this._handleEventDrop(info);\n\n    this.calendar = new Calendar(\n      this.shadowRoot!.getElementById(\"calendar\")!,\n      config\n    );\n\n    this.calendar!.render();\n  }\n\n  private get _events() {\n    const events: any[] = [];\n\n    for (const [i, day] of weekdays.entries()) {\n      if (!this[`_${day}`].length) {\n        continue;\n      }\n\n      this[`_${day}`].forEach((item: ScheduleDay, index: number) => {\n        let date = nextDay(new Date(), i as Day);\n        if (\n          !isSameWeek(date, new Date(), {\n            weekStartsOn: firstWeekdayIndex(this.hass.locale),\n          })\n        ) {\n          date = addDays(date, -7);\n        }\n        const start = new Date(date);\n        const start_tokens = item.from.split(\":\");\n        start.setHours(\n          parseInt(start_tokens[0]),\n          parseInt(start_tokens[1]),\n          0,\n          0\n        );\n\n        const end = new Date(date);\n        const end_tokens = item.to.split(\":\");\n        end.setHours(parseInt(end_tokens[0]), parseInt(end_tokens[1]), 0, 0);\n\n        events.push({\n          id: `${day}-${index}`,\n          start: start.toISOString(),\n          end: end.toISOString(),\n        });\n      });\n    }\n\n    return events;\n  }\n\n  private _handleSelect(info: { start: Date; end: Date }) {\n    const { start, end } = info;\n\n    const day = weekdays[start.getDay()];\n    const value = [...this[`_${day}`]];\n    const newValue = { ...this._item };\n\n    // Schedule is timezone unaware, we need to format it in local time\n    const endFormatted = formatTime24h(\n      end,\n      { ...this.hass.locale, time_zone: TimeZone.local },\n      this.hass.config\n    );\n    value.push({\n      from: formatTime24h(\n        start,\n        { ...this.hass.locale, time_zone: TimeZone.local },\n        this.hass.config\n      ),\n      to:\n        !isSameDay(start, end) || endFormatted === \"0:00\"\n          ? \"24:00\"\n          : endFormatted,\n    });\n\n    newValue[day] = value;\n\n    fireEvent(this, \"value-changed\", {\n      value: newValue,\n    });\n\n    if (!isSameDay(start, end)) {\n      this.calendar!.unselect();\n    }\n  }\n\n  private _handleEventResize(info: any) {\n    const { id, start, end } = info.event;\n\n    const [day, index] = id.split(\"-\");\n    const value = this[`_${day}`][parseInt(index)];\n    const newValue = { ...this._item };\n\n    const endFormatted = formatTime24h(end, this.hass.locale, this.hass.config);\n    newValue[day][index] = {\n      from: value.from,\n      to:\n        !isSameDay(start, end) || endFormatted === \"0:00\"\n          ? \"24:00\"\n          : endFormatted,\n    };\n\n    fireEvent(this, \"value-changed\", {\n      value: newValue,\n    });\n\n    if (!isSameDay(start, end)) {\n      this.requestUpdate(`_${day}`);\n      info.revert();\n    }\n  }\n\n  private _handleEventDrop(info: any) {\n    const { id, start, end } = info.event;\n\n    const [day, index] = id.split(\"-\");\n    const newDay = weekdays[start.getDay()];\n    const newValue = { ...this._item };\n\n    const endFormatted = formatTime24h(end, this.hass.locale, this.hass.config);\n    const event = {\n      from: formatTime24h(start, this.hass.locale, this.hass.config),\n      to:\n        !isSameDay(start, end) || endFormatted === \"0:00\"\n          ? \"24:00\"\n          : endFormatted,\n    };\n\n    if (newDay === day) {\n      newValue[day][index] = event;\n    } else {\n      newValue[day].splice(index, 1);\n      const value = [...this[`_${newDay}`]];\n      value.push(event);\n      newValue[newDay] = value;\n    }\n\n    fireEvent(this, \"value-changed\", {\n      value: newValue,\n    });\n\n    if (!isSameDay(start, end)) {\n      this.requestUpdate(`_${day}`);\n      info.revert();\n    }\n  }\n\n  private async _handleEventClick(info: any) {\n    if (\n      !(await showConfirmationDialog(this, {\n        title: this.hass.localize(\"ui.dialogs.helper_settings.schedule.delete\"),\n        text: this.hass.localize(\n          \"ui.dialogs.helper_settings.schedule.confirm_delete\"\n        ),\n        destructive: true,\n        confirmText: this.hass.localize(\"ui.common.delete\"),\n      }))\n    ) {\n      return;\n    }\n    const [day, index] = info.event.id.split(\"-\");\n    const value = [...this[`_${day}`]];\n\n    const newValue = { ...this._item };\n    value.splice(parseInt(index), 1);\n    newValue[day] = value;\n\n    fireEvent(this, \"value-changed\", {\n      value: newValue,\n    });\n  }\n\n  private _valueChanged(ev: CustomEvent) {\n    if (!this.new && !this._item) {\n      return;\n    }\n\n    ev.stopPropagation();\n    const configValue = (ev.target as any).configValue;\n    const value = ev.detail?.value || (ev.target as any).value;\n    if (this[`_${configValue}`] === value) {\n      return;\n    }\n    const newValue = { ...this._item };\n    if (!value) {\n      delete newValue[configValue];\n    } else {\n      newValue[configValue] = value;\n    }\n    fireEvent(this, \"value-changed\", {\n      value: newValue,\n    });\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      haStyle,\n      css`\n        .form {\n          color: var(--primary-text-color);\n        }\n\n        ha-textfield {\n          display: block;\n          margin: 8px 0;\n        }\n\n        #calendar {\n          margin: 8px 0;\n          height: 450px;\n          width: 100%;\n          -webkit-user-select: none;\n          -ms-user-select: none;\n          user-select: none;\n          --fc-border-color: var(--divider-color);\n          --fc-event-border-color: var(--divider-color);\n        }\n\n        .fc-v-event .fc-event-time {\n          white-space: inherit;\n        }\n        .fc-theme-standard .fc-scrollgrid {\n          border: 1px solid var(--divider-color);\n          border-radius: var(--mdc-shape-small, 4px);\n        }\n\n        .fc-scrollgrid-section-header td {\n          border: none;\n        }\n        :host([narrow]) .fc-scrollgrid-sync-table {\n          overflow: hidden;\n        }\n        table.fc-scrollgrid-sync-table\n          tbody\n          tr:first-child\n          .fc-daygrid-day-top {\n          padding-top: 0;\n        }\n        .fc-scroller::-webkit-scrollbar {\n          width: 0.4rem;\n          height: 0.4rem;\n        }\n        .fc-scroller::-webkit-scrollbar-thumb {\n          -webkit-border-radius: 4px;\n          border-radius: 4px;\n          background: var(--scrollbar-thumb-color);\n        }\n        .fc-scroller {\n          overflow-y: auto;\n          scrollbar-color: var(--scrollbar-thumb-color) transparent;\n          scrollbar-width: thin;\n        }\n\n        .fc-timegrid-event-short .fc-event-time:after {\n          content: \"\"; /* prevent trailing dash in half hour events since we do not have event titles */\n        }\n\n        a {\n          color: inherit !important;\n        }\n\n        th.fc-col-header-cell.fc-day {\n          background-color: var(--table-header-background-color);\n          color: var(--primary-text-color);\n          font-size: 11px;\n          font-weight: bold;\n          text-transform: uppercase;\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-schedule-form\": HaScheduleForm;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}