{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/helpers/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _callSuper from \"@babel/runtime/helpers/callSuper\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _decorate from \"@babel/runtime/helpers/decorate\";\nvar _templateObject, _templateObject2, _templateObject3;\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.sort.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/esnext.iterator.map.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { getRelativePosition } from \"chart.js/helpers\";\nimport { differenceInDays } from \"date-fns/esm\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property, query, state } from \"lit/decorators\";\nimport { classMap } from \"lit/directives/class-map\";\nimport memoizeOne from \"memoize-one\";\nimport { getColorByIndex } from \"../../../../common/color/colors\";\nimport { fireEvent } from \"../../../../common/dom/fire_event\";\nimport { formatNumber, numberFormatToLocale } from \"../../../../common/number/format_number\";\nimport \"../../../../components/chart/ha-chart-base\";\nimport \"../../../../components/ha-card\";\nimport { getEnergyDataCollection } from \"../../../../data/energy\";\nimport { calculateStatisticSumGrowth, fetchStatistics, getStatisticLabel } from \"../../../../data/recorder\";\nimport { SubscribeMixin } from \"../../../../mixins/subscribe-mixin\";\nimport { hasConfigChanged } from \"../../common/has-changed\";\nexport var HuiEnergyDevicesGraphCard = _decorate([customElement(\"hui-energy-devices-graph-card\")], function (_initialize, _SubscribeMixin) {\n  var HuiEnergyDevicesGraphCard = /*#__PURE__*/function (_SubscribeMixin2) {\n    _inherits(HuiEnergyDevicesGraphCard, _SubscribeMixin2);\n    function HuiEnergyDevicesGraphCard() {\n      var _this;\n      _classCallCheck(this, HuiEnergyDevicesGraphCard);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _callSuper(this, HuiEnergyDevicesGraphCard, [].concat(args));\n      _initialize(_assertThisInitialized(_this));\n      return _this;\n    }\n    return _createClass(HuiEnergyDevicesGraphCard);\n  }(_SubscribeMixin);\n  return {\n    F: HuiEnergyDevicesGraphCard,\n    d: [{\n      kind: \"field\",\n      decorators: [property({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_config\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_chartData\",\n      value: function value() {\n        return {\n          datasets: []\n        };\n      }\n    }, {\n      kind: \"field\",\n      decorators: [state()],\n      key: \"_data\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [query(\"ha-chart-base\")],\n      key: \"_chart\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      key: \"hassSubscribeRequiredHostProps\",\n      value: function value() {\n        return [\"_config\"];\n      }\n    }, {\n      kind: \"method\",\n      key: \"hassSubscribe\",\n      value: function hassSubscribe() {\n        var _this$_config,\n          _this2 = this;\n        return [getEnergyDataCollection(this.hass, {\n          key: (_this$_config = this._config) === null || _this$_config === void 0 ? void 0 : _this$_config.collection_key\n        }).subscribe(function (data) {\n          _this2._data = data;\n          _this2._getStatistics(data);\n        })];\n      }\n    }, {\n      kind: \"method\",\n      key: \"getCardSize\",\n      value: function getCardSize() {\n        return 3;\n      }\n    }, {\n      kind: \"method\",\n      key: \"setConfig\",\n      value: function setConfig(config) {\n        this._config = config;\n      }\n    }, {\n      kind: \"method\",\n      key: \"shouldUpdate\",\n      value: function shouldUpdate(changedProps) {\n        return hasConfigChanged(this, changedProps) || changedProps.size > 1 || !changedProps.has(\"hass\");\n      }\n    }, {\n      kind: \"method\",\n      key: \"render\",\n      value: function render() {\n        var _this$_chartData;\n        if (!this.hass || !this._config) {\n          return nothing;\n        }\n        return html(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n      <ha-card>\\n        \", \"\\n        <div\\n          class=\\\"content \", \"\\\"\\n        >\\n          <ha-chart-base\\n            .hass=\", \"\\n            .data=\", \"\\n            .options=\", \"\\n            .height=\", \"\\n            chart-type=\\\"bar\\\"\\n          ></ha-chart-base>\\n        </div>\\n      </ha-card>\\n    \"])), this._config.title ? html(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"<h1 class=\\\"card-header\\\">\", \"</h1>\"])), this._config.title) : \"\", classMap({\n          \"has-header\": !!this._config.title\n        }), this.hass, this._chartData, this._createOptions(this.hass.locale), (((_this$_chartData = this._chartData) === null || _this$_chartData === void 0 || (_this$_chartData = _this$_chartData.datasets[0]) === null || _this$_chartData === void 0 ? void 0 : _this$_chartData.data.length) || 0) * 28 + 50);\n      }\n    }, {\n      kind: \"field\",\n      key: \"_createOptions\",\n      value: function value() {\n        var _this3 = this;\n        return memoizeOne(function (locale) {\n          return {\n            parsing: false,\n            animation: false,\n            responsive: true,\n            maintainAspectRatio: false,\n            indexAxis: \"y\",\n            scales: {\n              y: {\n                type: \"category\",\n                ticks: {\n                  autoSkip: false,\n                  callback: function callback(index) {\n                    var _this3$_data;\n                    var statisticId = _this3._chartData.datasets[0].data[index].y;\n                    return getStatisticLabel(_this3.hass, statisticId, (_this3$_data = _this3._data) === null || _this3$_data === void 0 ? void 0 : _this3$_data.statsMetadata[statisticId]);\n                  }\n                }\n              },\n              x: {\n                title: {\n                  display: true,\n                  text: \"kWh\"\n                }\n              }\n            },\n            elements: {\n              bar: {\n                borderWidth: 1,\n                borderRadius: 4\n              }\n            },\n            plugins: {\n              tooltip: {\n                mode: \"nearest\",\n                callbacks: {\n                  title: function title(item) {\n                    var _this3$_data2;\n                    var statisticId = item[0].label;\n                    return getStatisticLabel(_this3.hass, statisticId, (_this3$_data2 = _this3._data) === null || _this3$_data2 === void 0 ? void 0 : _this3$_data2.statsMetadata[statisticId]);\n                  },\n                  label: function label(context) {\n                    return \"\".concat(context.dataset.label, \": \").concat(formatNumber(context.parsed.x, locale), \" kWh\");\n                  }\n                }\n              }\n            },\n            // @ts-expect-error\n            locale: numberFormatToLocale(_this3.hass.locale),\n            onClick: function onClick(e) {\n              var _this3$_chartData;\n              var chart = e.chart;\n              var canvasPosition = getRelativePosition(e, chart);\n              var index = Math.abs(chart.scales.y.getValueForPixel(canvasPosition.y));\n              fireEvent(_this3, \"hass-more-info\", {\n                // @ts-ignore\n                entityId: (_this3$_chartData = _this3._chartData) === null || _this3$_chartData === void 0 || (_this3$_chartData = _this3$_chartData.datasets[0]) === null || _this3$_chartData === void 0 || (_this3$_chartData = _this3$_chartData.data[index]) === null || _this3$_chartData === void 0 ? void 0 : _this3$_chartData.y\n              });\n              chart.canvas.dispatchEvent(new Event(\"mouseout\")); // to hide tooltip\n            }\n          };\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"_getStatistics\",\n      value: function () {\n        var _getStatistics2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(energyData) {\n          var _this$_config2, _this$_chart;\n          var dayDifference, devices, period, lengthUnit, units, data, compareData, chartData, chartDataCompare, borderColor, borderColorCompare, backgroundColor, backgroundColorCompare, datasets;\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                dayDifference = differenceInDays(energyData.end || new Date(), energyData.start);\n                devices = energyData.prefs.device_consumption.map(function (device) {\n                  return device.stat_consumption;\n                });\n                period = dayDifference > 35 ? \"month\" : dayDifference > 2 ? \"day\" : \"hour\";\n                lengthUnit = this.hass.config.unit_system.length || \"\";\n                units = {\n                  energy: \"kWh\",\n                  volume: lengthUnit === \"km\" ? \"m続\" : \"ft続\"\n                };\n                _context.next = 7;\n                return fetchStatistics(this.hass, energyData.start, energyData.end, devices, period, units, [\"change\"]);\n              case 7:\n                data = _context.sent;\n                if (!(energyData.startCompare && energyData.endCompare)) {\n                  _context.next = 12;\n                  break;\n                }\n                _context.next = 11;\n                return fetchStatistics(this.hass, energyData.startCompare, energyData.endCompare, devices, period, units, [\"change\"]);\n              case 11:\n                compareData = _context.sent;\n              case 12:\n                chartData = [];\n                chartDataCompare = [];\n                borderColor = [];\n                borderColorCompare = [];\n                backgroundColor = [];\n                backgroundColorCompare = [];\n                datasets = [{\n                  label: this.hass.localize(\"ui.panel.lovelace.cards.energy.energy_devices_graph.energy_usage\"),\n                  borderColor: borderColor,\n                  backgroundColor: backgroundColor,\n                  data: chartData,\n                  barThickness: compareData ? 10 : 20\n                }];\n                if (compareData) {\n                  datasets.push({\n                    label: this.hass.localize(\"ui.panel.lovelace.cards.energy.energy_devices_graph.previous_energy_usage\"),\n                    borderColor: borderColorCompare,\n                    backgroundColor: backgroundColorCompare,\n                    data: chartDataCompare,\n                    barThickness: 10\n                  });\n                }\n                energyData.prefs.device_consumption.forEach(function (device, idx) {\n                  var value = device.stat_consumption in data ? calculateStatisticSumGrowth(data[device.stat_consumption]) || 0 : 0;\n                  chartData.push({\n                    // @ts-expect-error\n                    y: device.stat_consumption,\n                    x: value,\n                    idx: idx\n                  });\n                  if (compareData) {\n                    var compareValue = device.stat_consumption in compareData ? calculateStatisticSumGrowth(compareData[device.stat_consumption]) || 0 : 0;\n                    chartDataCompare.push({\n                      // @ts-expect-error\n                      y: device.stat_consumption,\n                      x: compareValue,\n                      idx: idx\n                    });\n                  }\n                });\n                chartData.sort(function (a, b) {\n                  return b.x - a.x;\n                });\n                chartData.length = ((_this$_config2 = this._config) === null || _this$_config2 === void 0 ? void 0 : _this$_config2.max_devices) || chartData.length;\n                chartData.forEach(function (d) {\n                  var color = getColorByIndex(d.idx);\n                  borderColor.push(color);\n                  backgroundColor.push(color + \"7F\");\n                });\n                chartDataCompare.forEach(function (d) {\n                  var color = getColorByIndex(d.idx);\n                  borderColorCompare.push(color + \"7F\");\n                  backgroundColorCompare.push(color + \"32\");\n                });\n                this._chartData = {\n                  labels: chartData.map(function (d) {\n                    return d.y;\n                  }),\n                  datasets: datasets\n                };\n                _context.next = 28;\n                return this.updateComplete;\n              case 28:\n                (_this$_chart = this._chart) === null || _this$_chart === void 0 || _this$_chart.updateChart(\"none\");\n              case 29:\n              case \"end\":\n                return _context.stop();\n            }\n          }, _callee, this);\n        }));\n        function _getStatistics(_x) {\n          return _getStatistics2.apply(this, arguments);\n        }\n        return _getStatistics;\n      }()\n    }, {\n      kind: \"get\",\n      static: true,\n      key: \"styles\",\n      value: function styles() {\n        return css(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\\n      .card-header {\\n        padding-bottom: 0;\\n      }\\n      .content {\\n        padding: 16px;\\n      }\\n      .has-header {\\n        padding-top: 0;\\n      }\\n      ha-chart-base {\\n        --chart-max-height: none;\\n      }\\n    \"])));\n      }\n    }]\n  };\n}, SubscribeMixin(LitElement));","map":{"version":3,"names":["getRelativePosition","differenceInDays","css","html","LitElement","nothing","customElement","property","query","state","classMap","memoizeOne","getColorByIndex","fireEvent","formatNumber","numberFormatToLocale","getEnergyDataCollection","calculateStatisticSumGrowth","fetchStatistics","getStatisticLabel","SubscribeMixin","hasConfigChanged","HuiEnergyDevicesGraphCard","_decorate","_initialize","_SubscribeMixin","_SubscribeMixin2","_inherits","_this","_classCallCheck","_len","arguments","length","args","Array","_key","_callSuper","concat","_assertThisInitialized","_createClass","F","d","kind","decorators","attribute","key","value","datasets","hassSubscribe","_this$_config","_this2","hass","_config","collection_key","subscribe","data","_data","_getStatistics","getCardSize","setConfig","config","shouldUpdate","changedProps","size","has","render","_this$_chartData","_templateObject","_taggedTemplateLiteral","title","_templateObject2","_chartData","_createOptions","locale","_this3","parsing","animation","responsive","maintainAspectRatio","indexAxis","scales","y","type","ticks","autoSkip","callback","index","_this3$_data","statisticId","statsMetadata","x","display","text","elements","bar","borderWidth","borderRadius","plugins","tooltip","mode","callbacks","item","_this3$_data2","label","context","dataset","parsed","onClick","e","_this3$_chartData","chart","canvasPosition","Math","abs","getValueForPixel","entityId","canvas","dispatchEvent","Event","_getStatistics2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","energyData","_this$_config2","_this$_chart","dayDifference","devices","period","lengthUnit","units","compareData","chartData","chartDataCompare","borderColor","borderColorCompare","backgroundColor","backgroundColorCompare","wrap","_callee$","_context","prev","next","end","Date","start","prefs","device_consumption","map","device","stat_consumption","unit_system","energy","volume","sent","startCompare","endCompare","localize","barThickness","push","forEach","idx","compareValue","sort","a","b","max_devices","color","labels","updateComplete","_chart","updateChart","stop","_x","apply","static","styles","_templateObject3"],"sources":["/workspaces/frontend/src/panels/lovelace/cards/energy/hui-energy-devices-graph-card.ts"],"sourcesContent":["import {\n  ChartData,\n  ChartDataset,\n  ChartOptions,\n  ParsedDataType,\n  ScatterDataPoint,\n} from \"chart.js\";\nimport { getRelativePosition } from \"chart.js/helpers\";\nimport { differenceInDays } from \"date-fns/esm\";\nimport { UnsubscribeFunc } from \"home-assistant-js-websocket\";\nimport {\n  css,\n  CSSResultGroup,\n  html,\n  LitElement,\n  nothing,\n  PropertyValues,\n} from \"lit\";\nimport { customElement, property, query, state } from \"lit/decorators\";\nimport { classMap } from \"lit/directives/class-map\";\nimport memoizeOne from \"memoize-one\";\nimport { getColorByIndex } from \"../../../../common/color/colors\";\nimport { fireEvent } from \"../../../../common/dom/fire_event\";\nimport {\n  formatNumber,\n  numberFormatToLocale,\n} from \"../../../../common/number/format_number\";\nimport \"../../../../components/chart/ha-chart-base\";\nimport type { HaChartBase } from \"../../../../components/chart/ha-chart-base\";\nimport \"../../../../components/ha-card\";\nimport { EnergyData, getEnergyDataCollection } from \"../../../../data/energy\";\nimport {\n  calculateStatisticSumGrowth,\n  fetchStatistics,\n  getStatisticLabel,\n  Statistics,\n  StatisticsUnitConfiguration,\n} from \"../../../../data/recorder\";\nimport { FrontendLocaleData } from \"../../../../data/translation\";\nimport { SubscribeMixin } from \"../../../../mixins/subscribe-mixin\";\nimport { HomeAssistant } from \"../../../../types\";\nimport { LovelaceCard } from \"../../types\";\nimport { EnergyDevicesGraphCardConfig } from \"../types\";\nimport { hasConfigChanged } from \"../../common/has-changed\";\n\n@customElement(\"hui-energy-devices-graph-card\")\nexport class HuiEnergyDevicesGraphCard\n  extends SubscribeMixin(LitElement)\n  implements LovelaceCard\n{\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @state() private _config?: EnergyDevicesGraphCardConfig;\n\n  @state() private _chartData: ChartData = { datasets: [] };\n\n  @state() private _data?: EnergyData;\n\n  @query(\"ha-chart-base\") private _chart?: HaChartBase;\n\n  protected hassSubscribeRequiredHostProps = [\"_config\"];\n\n  public hassSubscribe(): UnsubscribeFunc[] {\n    return [\n      getEnergyDataCollection(this.hass, {\n        key: this._config?.collection_key,\n      }).subscribe((data) => {\n        this._data = data;\n        this._getStatistics(data);\n      }),\n    ];\n  }\n\n  public getCardSize(): Promise<number> | number {\n    return 3;\n  }\n\n  public setConfig(config: EnergyDevicesGraphCardConfig): void {\n    this._config = config;\n  }\n\n  protected shouldUpdate(changedProps: PropertyValues): boolean {\n    return (\n      hasConfigChanged(this, changedProps) ||\n      changedProps.size > 1 ||\n      !changedProps.has(\"hass\")\n    );\n  }\n\n  protected render() {\n    if (!this.hass || !this._config) {\n      return nothing;\n    }\n\n    return html`\n      <ha-card>\n        ${this._config.title\n          ? html`<h1 class=\"card-header\">${this._config.title}</h1>`\n          : \"\"}\n        <div\n          class=\"content ${classMap({\n            \"has-header\": !!this._config.title,\n          })}\"\n        >\n          <ha-chart-base\n            .hass=${this.hass}\n            .data=${this._chartData}\n            .options=${this._createOptions(this.hass.locale)}\n            .height=${(this._chartData?.datasets[0]?.data.length || 0) * 28 +\n            50}\n            chart-type=\"bar\"\n          ></ha-chart-base>\n        </div>\n      </ha-card>\n    `;\n  }\n\n  private _createOptions = memoizeOne(\n    (locale: FrontendLocaleData): ChartOptions => ({\n      parsing: false,\n      animation: false,\n      responsive: true,\n      maintainAspectRatio: false,\n      indexAxis: \"y\",\n      scales: {\n        y: {\n          type: \"category\",\n          ticks: {\n            autoSkip: false,\n            callback: (index) => {\n              const statisticId = (\n                this._chartData.datasets[0].data[index] as ScatterDataPoint\n              ).y;\n              return getStatisticLabel(\n                this.hass,\n                statisticId as any,\n                this._data?.statsMetadata[statisticId]\n              );\n            },\n          },\n        },\n        x: {\n          title: {\n            display: true,\n            text: \"kWh\",\n          },\n        },\n      },\n      elements: { bar: { borderWidth: 1, borderRadius: 4 } },\n      plugins: {\n        tooltip: {\n          mode: \"nearest\",\n          callbacks: {\n            title: (item) => {\n              const statisticId = item[0].label;\n              return getStatisticLabel(\n                this.hass,\n                statisticId,\n                this._data?.statsMetadata[statisticId]\n              );\n            },\n            label: (context) =>\n              `${context.dataset.label}: ${formatNumber(\n                context.parsed.x,\n                locale\n              )} kWh`,\n          },\n        },\n      },\n      // @ts-expect-error\n      locale: numberFormatToLocale(this.hass.locale),\n      onClick: (e: any) => {\n        const chart = e.chart;\n        const canvasPosition = getRelativePosition(e, chart);\n\n        const index = Math.abs(\n          chart.scales.y.getValueForPixel(canvasPosition.y)\n        );\n        fireEvent(this, \"hass-more-info\", {\n          // @ts-ignore\n          entityId: this._chartData?.datasets[0]?.data[index]?.y,\n        });\n        chart.canvas.dispatchEvent(new Event(\"mouseout\")); // to hide tooltip\n      },\n    })\n  );\n\n  private async _getStatistics(energyData: EnergyData): Promise<void> {\n    const dayDifference = differenceInDays(\n      energyData.end || new Date(),\n      energyData.start\n    );\n\n    const devices = energyData.prefs.device_consumption.map(\n      (device) => device.stat_consumption\n    );\n\n    const period =\n      dayDifference > 35 ? \"month\" : dayDifference > 2 ? \"day\" : \"hour\";\n\n    const lengthUnit = this.hass.config.unit_system.length || \"\";\n    const units: StatisticsUnitConfiguration = {\n      energy: \"kWh\",\n      volume: lengthUnit === \"km\" ? \"m続\" : \"ft続\",\n    };\n\n    const data = await fetchStatistics(\n      this.hass,\n      energyData.start,\n      energyData.end,\n      devices,\n      period,\n      units,\n      [\"change\"]\n    );\n\n    let compareData: Statistics | undefined;\n\n    if (energyData.startCompare && energyData.endCompare) {\n      compareData = await fetchStatistics(\n        this.hass,\n        energyData.startCompare,\n        energyData.endCompare,\n        devices,\n        period,\n        units,\n        [\"change\"]\n      );\n    }\n\n    const chartData: Array<ChartDataset<\"bar\", ParsedDataType<\"bar\">>[\"data\"]> =\n      [];\n    const chartDataCompare: Array<\n      ChartDataset<\"bar\", ParsedDataType<\"bar\">>[\"data\"]\n    > = [];\n    const borderColor: string[] = [];\n    const borderColorCompare: string[] = [];\n    const backgroundColor: string[] = [];\n    const backgroundColorCompare: string[] = [];\n\n    const datasets: ChartDataset<\"bar\", ParsedDataType<\"bar\">[]>[] = [\n      {\n        label: this.hass.localize(\n          \"ui.panel.lovelace.cards.energy.energy_devices_graph.energy_usage\"\n        ),\n        borderColor,\n        backgroundColor,\n        data: chartData,\n        barThickness: compareData ? 10 : 20,\n      },\n    ];\n\n    if (compareData) {\n      datasets.push({\n        label: this.hass.localize(\n          \"ui.panel.lovelace.cards.energy.energy_devices_graph.previous_energy_usage\"\n        ),\n        borderColor: borderColorCompare,\n        backgroundColor: backgroundColorCompare,\n        data: chartDataCompare,\n        barThickness: 10,\n      });\n    }\n\n    energyData.prefs.device_consumption.forEach((device, idx) => {\n      const value =\n        device.stat_consumption in data\n          ? calculateStatisticSumGrowth(data[device.stat_consumption]) || 0\n          : 0;\n\n      chartData.push({\n        // @ts-expect-error\n        y: device.stat_consumption,\n        x: value,\n        idx,\n      });\n\n      if (compareData) {\n        const compareValue =\n          device.stat_consumption in compareData\n            ? calculateStatisticSumGrowth(\n                compareData[device.stat_consumption]\n              ) || 0\n            : 0;\n\n        chartDataCompare.push({\n          // @ts-expect-error\n          y: device.stat_consumption,\n          x: compareValue,\n          idx,\n        });\n      }\n    });\n\n    chartData.sort((a, b) => b.x - a.x);\n\n    chartData.length = this._config?.max_devices || chartData.length;\n\n    chartData.forEach((d: any) => {\n      const color = getColorByIndex(d.idx);\n\n      borderColor.push(color);\n      backgroundColor.push(color + \"7F\");\n    });\n\n    chartDataCompare.forEach((d: any) => {\n      const color = getColorByIndex(d.idx);\n\n      borderColorCompare.push(color + \"7F\");\n      backgroundColorCompare.push(color + \"32\");\n    });\n\n    this._chartData = {\n      labels: chartData.map((d) => d.y),\n      datasets,\n    };\n    await this.updateComplete;\n    this._chart?.updateChart(\"none\");\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      .card-header {\n        padding-bottom: 0;\n      }\n      .content {\n        padding: 16px;\n      }\n      .has-header {\n        padding-top: 0;\n      }\n      ha-chart-base {\n        --chart-max-height: none;\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"hui-energy-devices-graph-card\": HuiEnergyDevicesGraphCard;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}